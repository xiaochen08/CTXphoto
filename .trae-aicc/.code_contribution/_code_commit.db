{
  "range-cache-file:///c%3A/Users/123/%E4%BB%A3%E7%A0%81/photo_sorter_modern.py": "[{\"originRange\":{\"start\":{\"line\":0,\"character\":0},\"end\":{\"line\":1456,\"character\":13}},\"modifyRange\":{\"start\":{\"line\":0,\"character\":0},\"end\":{\"line\":1456,\"character\":13}},\"action\":\"None\",\"isLine\":false,\"originText\":\"# é™ˆåŒå­¦å½±åƒç®¡ç†åŠ©æ‰‹ v2.0.0\\\\n# ç°ä»£UIç‰ˆæœ¬ - ä¿ç•™æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼Œå¢å¼ºè§†è§‰ä½“éªŒå’Œäº¤äº’æ€§\\\\n\\\\nimport os, sys, json, time, shutil, platform, subprocess, re\\\\nimport tkinter as tk\\\\nfrom tkinter import ttk, messagebox, filedialog, simpledialog\\\\nfrom datetime import datetime\\\\nimport threading\\\\nfrom PIL import Image, ImageTk, ExifTags\\\\nimport psutil\\\\nimport exifread\\\\nfrom typing import Dict, List, Tuple, Optional, Set\\\\n\\\\nVERSION = \\\\\\\"v2.0.0\\\\\\\"\\\\nCONFIG_FILE = \\\\\\\"photo_sorter_config.json\\\\\\\"\\\\nCATEGORIES = [\\\\\\\"å©šç¤¼\\\\\\\", \\\\\\\"å†™çœŸ\\\\\\\", \\\\\\\"æ—¥å¸¸è®°å½•\\\\\\\", \\\\\\\"æ—…æ¸¸è®°å½•\\\\\\\", \\\\\\\"å•†ä¸šæ´»åŠ¨æ‹æ‘„\\\\\\\"]\\\\nTHEMES = [\\\\\\\"æ—¥é—´\\\\\\\", \\\\\\\"æš—é»‘\\\\\\\"]\\\\n\\\\n# æ”¯æŒçš„æ–‡ä»¶ç±»å‹\\\\ndef is_raw_ext(e): return e.lower() in {\\\\\\\"cr2\\\\\\\", \\\\\\\"cr3\\\\\\\", \\\\\\\"nef\\\\\\\", \\\\\\\"nrw\\\\\\\", \\\\\\\"arw\\\\\\\", \\\\\\\"srf\\\\\\\", \\\\\\\"sr2\\\\\\\", \\\\\\\"raf\\\\\\\", \\\\\\\"rw2\\\\\\\", \\\\\\\"orf\\\\\\\", \\\\\\\"dng\\\\\\\", \\\\\\\"pef\\\\\\\", \\\\\\\"raw\\\\\\\"}\\\\ndef is_jpg_ext(e): return e.lower() in {\\\\\\\"jpg\\\\\\\", \\\\\\\"jpeg\\\\\\\", \\\\\\\"jpe\\\\\\\"}\\\\ndef is_video_ext(e): return e.lower() in {\\\\\\\"mp4\\\\\\\", \\\\\\\"mov\\\\\\\", \\\\\\\"avi\\\\\\\", \\\\\\\"mkv\\\\\\\", \\\\\\\"wmv\\\\\\\"}\\\\ndef is_image_ext(e): return is_raw_ext(e) or is_jpg_ext(e)\\\\n\\\\n# æç¤ºéŸ³åŠŸèƒ½\\\\ntry:\\\\n    import winsound\\\\n    def beep_start(): winsound.MessageBeep(winsound.MB_ICONASTERISK)\\\\n    def beep_done():  winsound.MessageBeep(winsound.MB_ICONEXCLAMATION)\\\\nexcept Exception:\\\\n    def beep_start(): pass\\\\n    def beep_done():  pass\\\\n\\\\n# ---------- å·¥å…·å‡½æ•° ----------\\\\ndef ts(): return datetime.now().strftime(\\\\\\\"%H:%M:%S\\\\\\\")\\\\n\\\\ndef bytes_to_human(n) -> str:\\\\n    try: n = int(n)\\\\n    except Exception: return \\\\\\\"N/A\\\\\\\"\\\\n    units = [\\\\\\\"B\\\\\\\", \\\\\\\"KB\\\\\\\", \\\\\\\"MB\\\\\\\", \\\\\\\"GB\\\\\\\", \\\\\\\"TB\\\\\\\", \\\\\\\"PB\\\\\\\", \\\\\\\"EB\\\\\\\"]\\\\n    i = 0; v = float(n)\\\\n    while v >= 1024.0 and i < len(units) - 1:\\\\n        v /= 1024.0; i += 1\\\\n    return f\\\\\\\"{v:.2f} {units[i]}\\\\\\\"\\\\n\\\\ndef get_drive_type_code(letter):\\\\n    import ctypes\\\\n    try: return ctypes.windll.kernel32.GetDriveTypeW(letter + \\\\\\\"\\\\\\\\\\\\\\\\\\\\\\\")\\\\n    except Exception: return 0\\\\n\\\\ndef drive_type_name(code): return {2:\\\\\\\"ç§»åŠ¨\\\\\\\",3:\\\\\\\"å›ºå®š\\\\\\\",4:\\\\\\\"ç½‘ç»œ\\\\\\\",5:\\\\\\\"å…‰é©±\\\\\\\",6:\\\\\\\"RAM\\\\\\\"}.get(code,\\\\\\\"æœªçŸ¥\\\\\\\")\\\\ndef is_system_drive(letter): return letter.upper().startswith(os.environ.get(\\\\\\\"SystemDrive\\\\\\\",\\\\\\\"C:\\\\\\\").upper())\\\\ndef list_drives(): return [p.device for p in psutil.disk_partitions(all=True) if os.path.exists(p.mountpoint)]\\\\n\\\\ndef get_drive_label(letter):\\\\n    import ctypes\\\\n    try:\\\\n        vn=ctypes.create_unicode_buffer(1024); fs=ctypes.create_unicode_buffer(1024)\\\\n        sn=ctypes.c_ulong(); mcl=ctypes.c_ulong(); fl=ctypes.c_ulong()\\\\n        ctypes.windll.kernel32.GetVolumeInformationW(letter+\\\\\\\"\\\\\\\\\\\\\\\\\\\\\\\",vn,1024,ctypes.byref(sn),ctypes.byref(mcl),ctypes.byref(fl),fs,1024)\\\\n        name=vn.value.strip()\\\\n    except Exception: name=\\\\\\\"\\\\\\\"\\\\n    if not name and get_drive_type_code(letter)==2: return \\\\\\\"Uç›˜\\\\\\\"\\\\n    return name or \\\\\\\"(æ— åç§°)\\\\\\\"\\\\n\\\\ndef get_drive_usage_bytes(root):\\\\n    u=psutil.disk_usage(root); return u.total,u.free\\\\n\\\\ndef load_config():\\\\n    if os.path.exists(CONFIG_FILE):\\\\n        with open(CONFIG_FILE,\\\\\\\"r\\\\\\\",encoding=\\\\\\\"utf-8\\\\\\\") as f:\\\\n            cfg = json.load(f)\\\\n            # ç¡®ä¿é…ç½®é¡¹å­˜åœ¨\\\\n            if \\\\\\\"theme\\\\\\\" not in cfg: cfg[\\\\\\\"theme\\\\\\\"] = \\\\\\\"light\\\\\\\"\\\\n            if \\\\\\\"sash_ratio\\\\\\\" not in cfg: cfg[\\\\\\\"sash_ratio\\\\\\\"] = 0.55\\\\n            if \\\\\\\"window_pos\\\\\\\" not in cfg: cfg[\\\\\\\"window_pos\\\\\\\"] = {\\\\\\\"x\\\\\\\": 100, \\\\\\\"y\\\\\\\": 100}\\\\n            if \\\\\\\"window_size\\\\\\\" not in cfg: cfg[\\\\\\\"window_size\\\\\\\"] = {\\\\\\\"width\\\\\\\": 1000, \\\\\\\"height\\\\\\\": 720}\\\\n            return cfg\\\\n    return {\\\\\\\"last_target_root\\\\\\\": \\\\\\\"\\\\\\\", \\\\\\\"theme\\\\\\\": \\\\\\\"light\\\\\\\", \\\\\\\"sash_ratio\\\\\\\": 0.55, \\\\\\\"window_pos\\\\\\\": {\\\\\\\"x\\\\\\\": 100, \\\\\\\"y\\\\\\\": 100}, \\\\\\\"window_size\\\\\\\": {\\\\\\\"width\\\\\\\": 1000, \\\\\\\"height\\\\\\\": 720}}\\\\n\\\\ndef save_config(cfg):\\\\n    with open(CONFIG_FILE,\\\\\\\"w\\\\\\\",encoding=\\\\\\\"utf-8\\\\\\\") as f: json.dump(cfg,f,ensure_ascii=False,indent=2)\\\\n\\\\n# ---------- EXIF / XMPå¤„ç† ----------\\\\ndef _parse_exif_str(s):\\\\n    s=s.strip()\\\\n    if len(s)>=19 and s[4]==\\\\\\\":\\\\\\\" and s[7]==\\\\\\\":\\\\\\\" and s[10]==\\\\\\\" \\\\\\\" and s[13]==\\\\\\\":\\\\\\\" and s[16]==\\\\\\\":\\\\\\\" :\\\\n        return datetime.strptime(s[:19],\\\\\\\"%Y:%m:%d %H:%M:%S\\\\\\\")\\\\n    return None\\\\n\\\\ndef _exif_dt_from_jpg(p):\\\\n    try:\\\\n        im=Image.open(p); exif=im._getexif()\\\\n        if not exif: return None\\\\n        tag={ExifTags.TAGS.get(k,k):v for k,v in exif.items()}\\\\n        for k in(\\\\\\\"DateTimeOriginal\\\\\\\",\\\\\\\"DateTimeDigitized\\\\\\\",\\\\\\\"DateTime\\\\\\\"):\\\\n            v=tag.get(k)\\\\n            if isinstance(v,str):\\\\n                dt=_parse_exif_str(v)\\\\n                if dt: return dt\\\\n    except Exception: pass\\\\n    return None\\\\n\\\\ndef _exif_dt_from_any(p):\\\\n    try:\\\\n        with open(p,\\\\\\\"rb\\\\\\\") as f: tags=exifread.process_file(f,stop_tag=\\\\\\\"EXIF DateTimeOriginal\\\\\\\",details=False)\\\\n        for k in(\\\\\\\"EXIF DateTimeOriginal\\\\\\\",\\\\\\\"Image DateTime\\\\\\\",\\\\\\\"EXIF DateTimeDigitized\\\\\\\"):\\\\n            if k in tags:\\\\n                dt=_parse_exif_str(str(tags[k]))\\\\n                if dt: return dt\\\\n    except Exception: pass\\\\n    return None\\\\n\\\\ndef get_capture_dt(p):\\\\n    ext=p.rsplit(\\\\\\\".\\\\\\\",1)[-1].lower() if \\\\\\\".\\\\\\\" in p else \\\\\\\"\\\\\\\"\\\\n    if is_jpg_ext(ext): dt=_exif_dt_from_jpg(p) or _exif_dt_from_any(p)\\\\n    elif is_raw_ext(ext): dt=_exif_dt_from_any(p)\\\\n    else: dt=None\\\\n    if dt: return dt\\\\n    try: return datetime.fromtimestamp(os.path.getmtime(p))\\\\n    except Exception: return datetime.now()\\\\n\\\\n# ---------- æ˜Ÿæ ‡æ£€æµ‹ ----------\\\\n_XMP_RATING_PATTERNS = [\\\\n    re.compile(rb\\\\\\\"<xmp:Rating>\\\\\\\\s*(-?\\\\\\\\d+)\\\\\\\\s*</xmp:Rating>\\\\\\\", re.I),\\\\n    re.compile(rb\\\\\\\"Rating=\\\\\\\\\\\\\\\"\\\\\\\\s*(-?\\\\\\\\d+)\\\\\\\\s*\\\\\\\\\\\\\\\"\\\\\\\", re.I),\\\\n]\\\\n\\\\ndef _find_rating_in_bytes(b: bytes) -> int:\\\\n    for pat in _XMP_RATING_PATTERNS:\\\\n        m = pat.search(b)\\\\n        if m:\\\\n            try: return int(m.group(1))\\\\n            except Exception: pass\\\\n    return 0\\\\n\\\\ndef is_starred_file(path: str) -> bool:\\\\n    stem, _ = os.path.splitext(path)\\\\n    sidecar = stem + \\\\\\\".xmp\\\\\\\"\\\\n    try:\\\\n        if os.path.isfile(sidecar):\\\\n            with open(sidecar, \\\\\\\"rb\\\\\\\") as f:\\\\n                rating = _find_rating_in_bytes(f.read(512*1024))\\\\n                return rating >= 1\\\\n    except Exception:\\\\n        pass\\\\n    try:\\\\n        with open(path, \\\\\\\"rb\\\\\\\") as f:\\\\n            rating = _find_rating_in_bytes(f.read(1024*1024))\\\\n            return rating >= 1\\\\n    except Exception:\\\\n        return False\\\\n\\\\n# ---------- å…¶ä»–å·¥å…· ----------\\\\ndef unique_path(d, f):\\\\n    n, e = os.path.splitext(f); c = os.path.join(d, f); i = 1\\\\n    while os.path.exists(c):\\\\n        c = os.path.join(d, f\\\\\\\"{n}({i}){e}\\\\\\\"); i += 1\\\\n    return c\\\\n\\\\ndef _open_folder(p):\\\\n    try:\\\\n        if platform.system() == \\\\\\\"Windows\\\\\\\": os.startfile(p)\\\\n        elif platform.system() == \\\\\\\"Darwin\\\\\\\": subprocess.Popen([\\\\\\\"open\\\\\\\", p])\\\\n        else: subprocess.Popen([\\\\\\\"xdg-open\\\\\\\", p])\\\\n    except Exception:\\\\n        pass\\\\n\\\\n# ---------- æ—¥å¿—å¤„ç† ----------\\\\ndef log_init_if_empty(text_widget, line):\\\\n    if float(text_widget.index(\\\\\\\"end-1c\\\\\\\")) == 1.0:\\\\n        text_widget.configure(state=\\\\\\\"normal\\\\\\\")\\\\n        text_widget.insert(\\\\\\\"end\\\\\\\", f\\\\\\\"[{ts()}] {line}\\\\\\\\n\\\\\\\")\\\\n        text_widget.configure(state=\\\\\\\"disabled\\\\\\\")\\\\n\\\\ndef log_add(text_widget, line):\\\\n    text_widget.configure(state=\\\\\\\"normal\\\\\\\")\\\\n    text_widget.insert(\\\\\\\"end\\\\\\\", f\\\\\\\"[{ts()}] {line}\\\\\\\\n\\\\\\\")\\\\n    text_widget.see(\\\\\\\"end\\\\\\\")\\\\n    text_widget.configure(state=\\\\\\\"disabled\\\\\\\")\\\\n\\\\n# ---------- æ‰«æ/è®¡åˆ’ ----------\\\\ndef preflight_scan(src_root):\\\\n    counts = {\\\\\\\"RAW\\\\\\\": 0, \\\\\\\"JPG\\\\\\\": 0, \\\\\\\"VIDEO\\\\\\\": 0};\\\\n    sizes = {\\\\\\\"RAW\\\\\\\": 0, \\\\\\\"JPG\\\\\\\": 0, \\\\\\\"VIDEO\\\\\\\": 0}\\\\n    files = {\\\\\\\"RAW\\\\\\\": [], \\\\\\\"JPG\\\\\\\": [], \\\\\\\"VIDEO\\\\\\\": []}\\\\n    \\\\n    for root, _, fs in os.walk(src_root):\\\\n        for f in fs:\\\\n            ext = f.rsplit(\\\\'.\\\\', 1)[-1].lower() if \\\\'.\\\\' in f else \\\\\\\"\\\\\\\"\\\\n            full = os.path.join(root, f)\\\\n            try: sz = os.path.getsize(full)\\\\n            except Exception: sz = 0\\\\n            \\\\n            if is_raw_ext(ext): \\\\n                counts[\\\\\\\"RAW\\\\\\\"] += 1; sizes[\\\\\\\"RAW\\\\\\\"] += sz; files[\\\\\\\"RAW\\\\\\\"].append(full)\\\\n            elif is_jpg_ext(ext): \\\\n                counts[\\\\\\\"JPG\\\\\\\"] += 1; sizes[\\\\\\\"JPG\\\\\\\"] += sz; files[\\\\\\\"JPG\\\\\\\"].append(full)\\\\n            elif is_video_ext(ext): \\\\n                counts[\\\\\\\"VIDEO\\\\\\\"] += 1; sizes[\\\\\\\"VIDEO\\\\\\\"] += sz; files[\\\\\\\"VIDEO\\\\\\\"].append(full)\\\\n    \\\\n    return counts, sizes, files\\\\n\\\\ndef build_seq_plan(photo_files, mmdd_str):\\\\n    entries = []\\\\n    for p in photo_files:\\\\n        ext = p.rsplit(\\\\\\\".\\\\\\\", 1)[-1].lower() if \\\\\\\".\\\\\\\" in p else \\\\\\\"\\\\\\\"\\\\n        stem = os.path.splitext(os.path.basename(p))[0]\\\\n        dt = get_capture_dt(p)\\\\n        entries.append({\\\\\\\"path\\\\\\\": p, \\\\\\\"ext\\\\\\\": ext, \\\\\\\"stem\\\\\\\": stem, \\\\\\\"dt\\\\\\\": dt})\\\\n    \\\\n    entries.sort(key=lambda x: (x[\\\\\\\"dt\\\\\\\"], x[\\\\\\\"stem\\\\\\\"], x[\\\\\\\"ext\\\\\\\"]))\\\\n    stem_to_idx = {}; seq = 0; plan = []\\\\n    \\\\n    for e in entries:\\\\n        if e[\\\\\\\"stem\\\\\\\"] in stem_to_idx: idx = stem_to_idx[e[\\\\\\\"stem\\\\\\\"]]\\\\n        else: seq += 1; idx = seq; stem_to_idx[e[\\\\\\\"stem\\\\\\\"]] = idx\\\\n        plan.append((e[\\\\\\\"path\\\\\\\"], f\\\\\\\"{mmdd_str}-{idx:04d}\\\\\\\", e[\\\\\\\"ext\\\\\\\"]))\\\\n    \\\\n    return plan\\\\n\\\\n# ---------- ä¸»é¢˜ç®¡ç† ----------\\\\nclass ThemeManager:\\\\n    \\\\\\\"\\\\\\\"\\\\\\\"ä¸»é¢˜ç®¡ç†å™¨ - æä¾›ç°ä»£UIçš„ä¸»é¢˜æ”¯æŒ\\\\\\\"\\\\\\\"\\\\\\\"\\\\n    \\\\n    THEMES = {\\\\n        \\\\\\\"light\\\\\\\": {\\\\n            \\\\\\\"BG\\\\\\\": \\\\\\\"#F8FAFC\\\\\\\",\\\\n            \\\\\\\"CARD\\\\\\\": \\\\\\\"#FFFFFF\\\\\\\",\\\\n            \\\\\\\"TEXT\\\\\\\": \\\\\\\"#1E293B\\\\\\\",\\\\n            \\\\\\\"TEXT_SECONDARY\\\\\\\": \\\\\\\"#64748B\\\\\\\",\\\\n            \\\\\\\"BORDER\\\\\\\": \\\\\\\"#E2E8F0\\\\\\\",\\\\n            \\\\\\\"PRIMARY\\\\\\\": \\\\\\\"#3B82F6\\\\\\\",  # è“è‰²ä¸»é¢˜\\\\n            \\\\\\\"PRIMARY_HOVER\\\\\\\": \\\\\\\"#2563EB\\\\\\\",\\\\n            \\\\\\\"SUCCESS\\\\\\\": \\\\\\\"#10B981\\\\\\\",  # ç»¿è‰²\\\\n            \\\\\\\"WARNING\\\\\\\": \\\\\\\"#F59E0B\\\\\\\",  # é»„è‰²\\\\n            \\\\\\\"DANGER\\\\\\\": \\\\\\\"#EF4444\\\\\\\",   # çº¢è‰²\\\\n            \\\\\\\"INPUT_BG\\\\\\\": \\\\\\\"#FFFFFF\\\\\\\",\\\\n            \\\\\\\"INPUT_FG\\\\\\\": \\\\\\\"#1E293B\\\\\\\",\\\\n            \\\\\\\"PROGRESS_BG\\\\\\\": \\\\\\\"#E2E8F0\\\\\\\",\\\\n            \\\\\\\"LOG_BG\\\\\\\": \\\\\\\"#F1F5F9\\\\\\\",\\\\n            \\\\\\\"SHADOW\\\\\\\": \\\\\\\"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)\\\\\\\"\\\\n        },\\\\n        \\\\\\\"dark\\\\\\\": {\\\\n            \\\\\\\"BG\\\\\\\": \\\\\\\"#0F172A\\\\\\\",\\\\n            \\\\\\\"CARD\\\\\\\": \\\\\\\"#1E293B\\\\\\\",\\\\n            \\\\\\\"TEXT\\\\\\\": \\\\\\\"#F8FAFC\\\\\\\",\\\\n            \\\\\\\"TEXT_SECONDARY\\\\\\\": \\\\\\\"#94A3B8\\\\\\\",\\\\n            \\\\\\\"BORDER\\\\\\\": \\\\\\\"#334155\\\\\\\",\\\\n            \\\\\\\"PRIMARY\\\\\\\": \\\\\\\"#3B82F6\\\\\\\",\\\\n            \\\\\\\"PRIMARY_HOVER\\\\\\\": \\\\\\\"#60A5FA\\\\\\\",\\\\n            \\\\\\\"SUCCESS\\\\\\\": \\\\\\\"#10B981\\\\\\\",\\\\n            \\\\\\\"WARNING\\\\\\\": \\\\\\\"#F59E0B\\\\\\\",\\\\n            \\\\\\\"DANGER\\\\\\\": \\\\\\\"#EF4444\\\\\\\",\\\\n            \\\\\\\"INPUT_BG\\\\\\\": \\\\\\\"#334155\\\\\\\",\\\\n            \\\\\\\"INPUT_FG\\\\\\\": \\\\\\\"#F8FAFC\\\\\\\",\\\\n            \\\\\\\"PROGRESS_BG\\\\\\\": \\\\\\\"#334155\\\\\\\",\\\\n            \\\\\\\"LOG_BG\\\\\\\": \\\\\\\"#0F172A\\\\\\\",\\\\n            \\\\\\\"SHADOW\\\\\\\": \\\\\\\"0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2)\\\\\\\"\\\\n        }\\\\n    }\\\\n    \\\\n    @staticmethod\\\\n    def apply_theme(root, theme_key, widgets=None):\\\\n        \\\\\\\"\\\\\\\"\\\\\\\"åº”ç”¨ä¸»é¢˜åˆ°æ ¹çª—å£å’ŒæŒ‡å®šæ§ä»¶\\\\\\\"\\\\\\\"\\\\\\\"\\\\n        style = ttk.Style()\\\\n        try: style.theme_use(\\\\\\\"clam\\\\\\\")\\\\n        except Exception: pass\\\\n        \\\\n        P = ThemeManager.THEMES[\\\\\\\"dark\\\\\\\" if theme_key == \\\\\\\"dark\\\\\\\" else \\\\\\\"light\\\\\\\"]\\\\n        \\\\n        # é…ç½®æ ¹çª—å£\\\\n        root.configure(bg=P[\\\\\\\"BG\\\\\\\"])\\\\n        \\\\n        # é…ç½®ttkæ ·å¼\\\\n        # æ ‡é¢˜æ ‡ç­¾\\\\n        style.configure(\\\\n            \\\\\\\"Modern.Title.TLabel\\\\\\\",\\\\n            background=P[\\\\\\\"BG\\\\\\\"],\\\\n            foreground=P[\\\\\\\"TEXT\\\\\\\"],\\\\n            font=(\\\\\\\"Microsoft YaHei UI\\\\\\\", 20, \\\\\\\"bold\\\\\\\"),\\\\n            padding=(0, 10)\\\\n        )\\\\n        \\\\n        # å‰¯æ ‡é¢˜æ ‡ç­¾\\\\n        style.configure(\\\\n            \\\\\\\"Modern.Subtitle.TLabel\\\\\\\",\\\\n            background=P[\\\\\\\"BG\\\\\\\"],\\\\n            foreground=P[\\\\\\\"TEXT\\\\\\\"],\\\\n            font=(\\\\\\\"Microsoft YaHei UI\\\\\\\", 14, \\\\\\\"bold\\\\\\\"),\\\\n            padding=(0, 8)\\\\n        )\\\\n        \\\\n        # æ­£æ–‡æ ‡ç­¾\\\\n        style.configure(\\\\n            \\\\\\\"Modern.Body.TLabel\\\\\\\",\\\\n            background=P[\\\\\\\"BG\\\\\\\"],\\\\n            foreground=P[\\\\\\\"TEXT\\\\\\\"],\\\\n            font=(\\\\\\\"Microsoft YaHei UI\\\\\\\", 12),\\\\n            padding=(0, 4)\\\\n        )\\\\n        \\\\n        # æ¬¡è¦æ–‡æœ¬æ ‡ç­¾\\\\n        style.configure(\\\\n            \\\\\\\"Modern.Secondary.TLabel\\\\\\\",\\\\n            background=P[\\\\\\\"BG\\\\\\\"],\\\\n            foreground=P[\\\\\\\"TEXT_SECONDARY\\\\\\\"],\\\\n            font=(\\\\\\\"Microsoft YaHei UI\\\\\\\", 11),\\\\n            padding=(0, 4)\\\\n        )\\\\n        \\\\n        # æ¡†æ¶æ ·å¼\\\\n        style.configure(\\\\n            \\\\\\\"Modern.Frame.TFrame\\\\\\\",\\\\n            background=P[\\\\\\\"BG\\\\\\\"],\\\\n            borderwidth=0\\\\n        )\\\\n        \\\\n        # å¡ç‰‡æ ·å¼\\\\n        style.configure(\\\\n            \\\\\\\"Modern.Card.TFrame\\\\\\\",\\\\n            background=P[\\\\\\\"CARD\\\\\\\"],\\\\n            borderwidth=1,\\\\n            relief=\\\\\\\"flat\\\\\\\",\\\\n            bordercolor=P[\\\\\\\"BORDER\\\\\\\"]\\\\n        )\\\\n        \\\\n        # ä¸»æŒ‰é’®\\\\n        style.configure(\\\\n            \\\\\\\"Modern.Primary.TButton\\\\\\\",\\\\n            background=P[\\\\\\\"PRIMARY\\\\\\\"],\\\\n            foreground=\\\\\\\"#FFFFFF\\\\\\\",\\\\n            font=(\\\\\\\"Microsoft YaHei UI\\\\\\\", 12, \\\\\\\"bold\\\\\\\"),\\\\n            padding=(12, 6),\\\\n            borderwidth=0,\\\\n            focuscolor=\\\\\\\"none\\\\\\\"\\\\n        )\\\\n        style.map(\\\\n            \\\\\\\"Modern.Primary.TButton\\\\\\\",\\\\n            background=[(\\\\\\\"active\\\\\\\", P[\\\\\\\"PRIMARY_HOVER\\\\\\\"])],\\\\n            relief=[(\\\\\\\"pressed\\\\\\\", \\\\\\\"flat\\\\\\\")]\\\\n        )\\\\n        \\\\n        # æ¬¡è¦æŒ‰é’®\\\\n        style.configure(\\\\n            \\\\\\\"Modern.Secondary.TButton\\\\\\\",\\\\n            background=P[\\\\\\\"BORDER\\\\\\\"],\\\\n            foreground=P[\\\\\\\"TEXT\\\\\\\"],\\\\n            font=(\\\\\\\"Microsoft YaHei UI\\\\\\\", 12),\\\\n            padding=(12, 6),\\\\n            borderwidth=0\\\\n        )\\\\n        style.map(\\\\n            \\\\\\\"Modern.Secondary.TButton\\\\\\\",\\\\n            background=[(\\\\\\\"active\\\\\\\", P[\\\\\\\"CARD\\\\\\\"])],\\\\n            relief=[(\\\\\\\"pressed\\\\\\\", \\\\\\\"flat\\\\\\\")]\\\\n        )\\\\n        \\\\n        # è¿›åº¦æ¡\\\\n        style.configure(\\\\n            \\\\\\\"Modern.Horizontal.TProgressbar\\\\\\\",\\\\n            troughcolor=P[\\\\\\\"PROGRESS_BG\\\\\\\"],\\\\n            background=P[\\\\\\\"PRIMARY\\\\\\\"],\\\\n            bordercolor=P[\\\\\\\"PROGRESS_BG\\\\\\\"],\\\\n            lightcolor=P[\\\\\\\"PRIMARY\\\\\\\"],\\\\n            darkcolor=P[\\\\\\\"PRIMARY\\\\\\\"],\\\\n            borderwidth=0\\\\n        )\\\\n        \\\\n        # ä¸‹æ‹‰æ¡†\\\\n        style.configure(\\\\n            \\\\\\\"Modern.TCombobox\\\\\\\",\\\\n            fieldbackground=P[\\\\\\\"INPUT_BG\\\\\\\"],\\\\n            background=P[\\\\\\\"INPUT_BG\\\\\\\"],\\\\n            foreground=P[\\\\\\\"INPUT_FG\\\\\\\"],\\\\n            bordercolor=P[\\\\\\\"BORDER\\\\\\\"],\\\\n            arrowcolor=P[\\\\\\\"TEXT\\\\\\\"],\\\\n            font=(\\\\\\\"Microsoft YaHei UI\\\\\\\", 11),\\\\n            padding=(6, 4)\\\\n        )\\\\n        style.map(\\\\n            \\\\\\\"Modern.TCombobox\\\\\\\",\\\\n            fieldbackground=[(\\\\\\\"readonly\\\\\\\", P[\\\\\\\"INPUT_BG\\\\\\\"])],\\\\n            foreground=[(\\\\\\\"readonly\\\\\\\", P[\\\\\\\"INPUT_FG\\\\\\\"])],\\\\n            background=[(\\\\\\\"readonly\\\\\\\", P[\\\\\\\"INPUT_BG\\\\\\\"])],\\\\n            arrowcolor=[(\\\\\\\"active\\\\\\\", P[\\\\\\\"PRIMARY\\\\\\\"])]\\\\n        )\\\\n        \\\\n        # å¤é€‰æ¡†\\\\n        style.configure(\\\\n            \\\\\\\"Modern.TCheckbutton\\\\\\\",\\\\n            background=P[\\\\\\\"BG\\\\\\\"],\\\\n            foreground=P[\\\\\\\"TEXT\\\\\\\"],\\\\n            font=(\\\\\\\"Microsoft YaHei UI\\\\\\\", 11)\\\\n        )\\\\n        style.map(\\\\n            \\\\\\\"Modern.TCheckbutton\\\\\\\",\\\\n            background=[(\\\\\\\"active\\\\\\\", P[\\\\\\\"BG\\\\\\\"])]\\\\n        )\\\\n        \\\\n        # é…ç½®è‡ªå®šä¹‰æ§ä»¶\\\\n        if widgets:\\\\n            for widget_type, widget_list in widgets.items():\\\\n                if widget_type == \\\\\\\"text\\\\\\\":\\\\n                    for text_widget in widget_list:\\\\n                        text_widget.configure(\\\\n                            bg=P[\\\\\\\"LOG_BG\\\\\\\"],\\\\n                            fg=P[\\\\\\\"TEXT\\\\\\\"],\\\\n                            insertbackground=P[\\\\\\\"TEXT\\\\\\\"],\\\\n                            font=(\\\\\\\"Microsoft YaHei UI\\\\\\\", 10)\\\\n                        )\\\\n                elif widget_type == \\\\\\\"canvas\\\\\\\":\\\\n                    for canvas in widget_list:\\\\n                        canvas.configure(bg=P[\\\\\\\"CARD\\\\\\\"])\\\\n\\\\n# ---------- å›¾åƒé¢„è§ˆç®¡ç†å™¨ ----------\\\\nclass ImagePreviewManager:\\\\n    \\\\\\\"\\\\\\\"\\\\\\\"å›¾åƒé¢„è§ˆç®¡ç†å™¨ - è´Ÿè´£å¤„ç†å’Œæ˜¾ç¤ºå›¾åƒé¢„è§ˆ\\\\\\\"\\\\\\\"\\\\\\\"\\\\n    \\\\n    def __init__(self, canvas, theme_manager):\\\\n        self.canvas = canvas\\\\n        self.theme_manager = theme_manager\\\\n        self.current_image = None\\\\n        self.current_thumb = None\\\\n        self.current_info = None\\\\n        \\\\n        # ç»‘å®šç”»å¸ƒè°ƒæ•´äº‹ä»¶\\\\n        self.canvas.bind(\\\\\\\"<Configure>\\\\\\\", self._on_canvas_resize)\\\\n    \\\\n    def _on_canvas_resize(self, event):\\\\n        \\\\\\\"\\\\\\\"\\\\\\\"ç”»å¸ƒå¤§å°æ”¹å˜æ—¶é‡æ–°æ˜¾ç¤ºé¢„è§ˆ\\\\\\\"\\\\\\\"\\\\\\\"\\\\n        if self.current_image:\\\\n            self.show_preview(self.current_image, self.current_info)\\\\n    \\\\n    def show_preview(self, image_path, info=None):\\\\n        \\\\\\\"\\\\\\\"\\\\\\\"æ˜¾ç¤ºå›¾åƒé¢„è§ˆ\\\\\\\"\\\\\\\"\\\\\\\"\\\\n        self.current_image = image_path\\\\n        self.current_info = info\\\\n        \\\\n        try:\\\\n            # æ¸…ç©ºç”»å¸ƒ\\\\n            self.canvas.delete(\\\\\\\"all\\\\\\\")\\\\n            \\\\n            # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”ä¸ºå›¾åƒ\\\\n            if not os.path.exists(image_path) or not is_image_ext(image_path.split(\\\\\\\".\\\\\\\")[-1]):\\\\n                self._show_placeholder(\\\\\\\"ä¸æ”¯æŒé¢„è§ˆæ­¤æ–‡ä»¶ç±»å‹\\\\\\\")\\\\n                return\\\\n            \\\\n            # å°è¯•æ‰“å¼€å›¾åƒ\\\\n            with Image.open(image_path) as img:\\\\n                # è·å–ç”»å¸ƒå°ºå¯¸\\\\n                canvas_width = self.canvas.winfo_width()\\\\n                canvas_height = self.canvas.winfo_height()\\\\n                \\\\n                if canvas_width <= 10 or canvas_height <= 10:  # ç”»å¸ƒå°šæœªæ¸²æŸ“\\\\n                    return\\\\n                \\\\n                # è®¡ç®—ç¼©æ”¾æ¯”ä¾‹\\\\n                max_size = (canvas_width - 40, canvas_height - 80)  # ç•™å‡ºè¾¹è·\\\\n                img.thumbnail(max_size, Image.Resampling.LANCZOS)\\\\n                \\\\n                # åˆ›å»ºç¼©ç•¥å›¾\\\\n                self.current_thumb = ImageTk.PhotoImage(img)\\\\n                \\\\n                # æ˜¾ç¤ºå›¾åƒï¼ˆå±…ä¸­ï¼‰\\\\n                x = (canvas_width - self.current_thumb.width()) // 2\\\\n                y = (canvas_height - self.current_thumb.height() - 40) // 2  # ç•™å‡ºåº•éƒ¨ä¿¡æ¯ç©ºé—´\\\\n                self.canvas.create_image(x, y, anchor=tk.CENTER, image=self.current_thumb)\\\\n                \\\\n                # ç»˜åˆ¶æ–‡ä»¶å\\\\n                filename = os.path.basename(image_path)\\\\n                self.canvas.create_text(\\\\n                    canvas_width // 2, \\\\n                    canvas_height - 50, \\\\n                    text=filename, \\\\n                    fill=self.theme_manager.THEMES[\\\\\\\"light\\\\\\\"][\\\\\\\"TEXT\\\\\\\"],  # ç®€åŒ–å¤„ç†ï¼Œå®é™…åº”æ ¹æ®å½“å‰ä¸»é¢˜è·å–\\\\n                    font=(\\\\\\\"Microsoft YaHei UI\\\\\\\", 10, \\\\\\\"bold\\\\\\\"),\\\\n                    width=canvas_width - 40\\\\n                )\\\\n                \\\\n                # ç»˜åˆ¶æ–‡ä»¶ä¿¡æ¯\\\\n                if info:\\\\n                    self.canvas.create_text(\\\\n                        canvas_width // 2, \\\\n                        canvas_height - 25, \\\\n                        text=info, \\\\n                        fill=self.theme_manager.THEMES[\\\\\\\"light\\\\\\\"][\\\\\\\"TEXT_SECONDARY\\\\\\\"],\\\\n                        font=(\\\\\\\"Microsoft YaHei UI\\\\\\\", 9),\\\\n                        width=canvas_width - 40\\\\n                    )\\\\n        \\\\n        except Exception as e:\\\\n            self._show_placeholder(\\\\\\\"æ— æ³•é¢„è§ˆå›¾åƒ\\\\\\\")\\\\n    \\\\n    def _show_placeholder(self, text):\\\\n        \\\\\\\"\\\\\\\"\\\\\\\"æ˜¾ç¤ºå ä½ç¬¦\\\\\\\"\\\\\\\"\\\\\\\"\\\\n        self.canvas.delete(\\\\\\\"all\\\\\\\")\\\\n        canvas_width = self.canvas.winfo_width()\\\\n        canvas_height = self.canvas.winfo_height()\\\\n        \\\\n        # ç»˜åˆ¶å ä½ç¬¦å›¾æ ‡ï¼ˆç®€åŒ–ä¸ºæ–‡æœ¬ï¼‰\\\\n        self.canvas.create_text(\\\\n            canvas_width // 2, \\\\n            canvas_height // 2, \\\\n            text=\\\\\\\"ğŸ“·\\\\\\\", \\\\n            font=(\\\\\\\"Arial\\\\\\\", 48)\\\\n        )\\\\n        \\\\n        # ç»˜åˆ¶æç¤ºæ–‡æœ¬\\\\n        self.canvas.create_text(\\\\n            canvas_width // 2, \\\\n            canvas_height // 2 + 40, \\\\n            text=text, \\\\n            fill=self.theme_manager.THEMES[\\\\\\\"light\\\\\\\"][\\\\\\\"TEXT_SECONDARY\\\\\\\"],\\\\n            font=(\\\\\\\"Microsoft YaHei UI\\\\\\\", 11)\\\\n        )\\\\n    \\\\n    def clear_preview(self):\\\\n        \\\\\\\"\\\\\\\"\\\\\\\"æ¸…é™¤é¢„è§ˆ\\\\\\\"\\\\\\\"\\\\\\\"\\\\n        self.canvas.delete(\\\\\\\"all\\\\\\\")\\\\n        self.current_image = None\\\\n        self.current_thumb = None\\\\n        self.current_info = None\\\\n        self._show_placeholder(\\\\\\\"ç­‰å¾…é¢„è§ˆ\\\\\\\")\\\\n\\\\n# ---------- å¤åˆ¶ç®¡ç†å™¨ ----------\\\\nclass CopyManager:\\\\n    \\\\\\\"\\\\\\\"\\\\\\\"å¤åˆ¶ç®¡ç†å™¨ - å¤„ç†æ–‡ä»¶å¤åˆ¶é€»è¾‘ï¼Œæ”¯æŒè¿›åº¦æŠ¥å‘Šå’Œé¢„è§ˆæ›´æ–°\\\\\\\"\\\\\\\"\\\\\\\"\\\\n    \\\\n    def __init__(self, log_widget, status_var, progress_var, preview_manager=None):\\\\n        self.log_widget = log_widget\\\\n        self.status_var = status_var\\\\n        self.progress_var = progress_var\\\\n        self.preview_manager = preview_manager\\\\n        self.stop_event = threading.Event()\\\\n        self.created_files = []\\\\n    \\\\n    def start_copy(self, src_drive, dst_letter, cfg, root, category, extract_star=False):\\\\n        \\\\\\\"\\\\\\\"\\\\\\\"å¼€å§‹å¤åˆ¶è¿‡ç¨‹\\\\\\\"\\\\\\\"\\\\\\\"\\\\n        # é‡ç½®çŠ¶æ€\\\\n        self.stop_event.clear()\\\\n        self.created_files = []\\\\n        \\\\n        # åˆ›å»ºå¹¶å¯åŠ¨çº¿ç¨‹\\\\n        copy_thread = threading.Thread(\\\\n            target=self._copy_thread,\\\\n            args=(src_drive, dst_letter, cfg, root, category, extract_star)\\\\n        )\\\\n        copy_thread.daemon = True\\\\n        copy_thread.start()\\\\n        \\\\n        return copy_thread\\\\n    \\\\n    def stop_copy(self):\\\\n        \\\\\\\"\\\\\\\"\\\\\\\"åœæ­¢å¤åˆ¶è¿‡ç¨‹\\\\\\\"\\\\\\\"\\\\\\\"\\\\n        self.stop_event.set()\\\\n    \\\\n    def _copy_thread(self, src_drive, dst_letter, cfg, root, category, extract_star):\\\\n        \\\\\\\"\\\\\\\"\\\\\\\"å¤åˆ¶çº¿ç¨‹å‡½æ•°\\\\\\\"\\\\\\\"\\\\\\\"\\\\n        try:\\\\n            # 1. æ”¶é›†ä¿¡æ¯å’Œåˆ›å»ºç›®å½•\\\\n            log_add(self.log_widget, f\\\\\\\"ç´ æç›˜ï¼š{src_drive}ï¼ˆ{get_drive_label(src_drive)} | {drive_type_name(get_drive_type_code(src_drive))}ï¼‰\\\\\\\")\\\\n            \\\\n            # 2. è·å–æ‹æ‘„åç§°\\\\n            shoot_name = None\\\\n            def ask_name():\\\\n                nonlocal shoot_name\\\\n                shoot_name = simpledialog.askstring(\\\\\\\"æœ¬æ¬¡æ‹æ‘„åç§°\\\\\\\", \\\\\\\"è¾“å…¥æ‹æ‘„åœ°ç‚¹æˆ–ä¸»é¢˜ï¼ˆå¯ä¸­æ–‡ï¼‰ï¼š\\\\\\\", parent=root)\\\\n            root.after(0, ask_name)\\\\n            \\\\n            # ç­‰å¾…ç”¨æˆ·è¾“å…¥\\\\n            while shoot_name is None and not self.stop_event.is_set():\\\\n                time.sleep(0.1)\\\\n            \\\\n            if self.stop_event.is_set() or not shoot_name:\\\\n                root.after(0, lambda: log_add(self.log_widget, \\\\\\\"ç”¨æˆ·å–æ¶ˆæ“ä½œ\\\\\\\"))\\\\n                return\\\\n            \\\\n            # 3. é¢„æ£€æ–‡ä»¶\\\\n            root.after(0, lambda: log_add(self.log_widget, \\\\\\\"å¼€å§‹é¢„æ£€æºæ–‡ä»¶â€¦\\\\\\\"))\\\\n            counts, sizes, files = preflight_scan(src_drive)\\\\n            total_files = counts[\\\\\\\"RAW\\\\\\\"] + counts[\\\\\\\"JPG\\\\\\\"] + counts[\\\\\\\"VIDEO\\\\\\\"]\\\\n            total_size = sizes[\\\\\\\"RAW\\\\\\\"] + sizes[\\\\\\\"JPG\\\\\\\"] + sizes[\\\\\\\"VIDEO\\\\\\\"]\\\\n            \\\\n            root.after(0, lambda: log_add(self.log_widget, \\\\n                f\\\\\\\"é¢„æ£€å®Œæˆ RAW:{counts[\\\\'RAW\\\\']} JPG:{counts[\\\\'JPG\\\\']} VIDEO:{counts[\\\\'VIDEO\\\\']} åˆè®¡:{total_files} | ä½“ç§¯ {bytes_to_human(total_size)}\\\\\\\"))\\\\n            \\\\n            # 4. ç¡®è®¤å¯¹è¯æ¡†\\\\n            confirm = False\\\\n            def show_confirm():\\\\n                nonlocal confirm\\\\n                confirm = messagebox.askyesno(\\\\n                    \\\\\\\"ç¡®è®¤å¤åˆ¶\\\\\\\",\\\\n                    f\\\\\\\"é¢„æ£€å®Œæˆï¼š\\\\\\\\n\\\\\\\"\\\\n                f\\\\\\\"RAWï¼š{counts[\\\\'RAW\\\\']}ï¼ˆ{bytes_to_human(sizes[\\\\'RAW\\\\'])}ï¼‰\\\\\\\\n\\\\\\\"\\\\n                f\\\\\\\"JPGï¼š{counts[\\\\'JPG\\\\']}ï¼ˆ{bytes_to_human(sizes[\\\\'JPG\\\\'])}ï¼‰\\\\\\\\n\\\\\\\"\\\\n                f\\\\\\\"VIDEOï¼š{counts[\\\\'VIDEO\\\\']}ï¼ˆ{bytes_to_human(sizes[\\\\'VIDEO\\\\'])}ï¼‰\\\\\\\\n\\\\\\\"\\\\n                f\\\\\\\"åˆè®¡ï¼š{total_files}ï¼ˆ{bytes_to_human(total_size)}ï¼‰\\\\\\\\n\\\\\\\\n\\\\\\\"\\\\n                f\\\\\\\"å°†å¤åˆ¶åˆ°ï¼šå¹´/æ‹æ‘„ç±»å‹/MMæœˆ/MM.DD_æ‹æ‘„å/ï¼ˆRAW,JPG,VIDEOï¼ŒåŠå¯é€‰å·²æ˜Ÿæ ‡ç…§ç‰‡ï¼‰\\\\\\\\n\\\\\\\"\\\\n                f\\\\\\\"ç…§ç‰‡é‡å‘½åï¼šMMDD-0001 èµ·ï¼›è§†é¢‘ä¿ç•™åŸåã€‚\\\\\\\"\\\\n                )\\\\n            root.after(0, show_confirm)\\\\n            \\\\n            # ç­‰å¾…ç”¨æˆ·ç¡®è®¤\\\\n            while confirm is None and not self.stop_event.is_set():\\\\n                time.sleep(0.1)\\\\n            \\\\n            if self.stop_event.is_set() or not confirm:\\\\n                root.after(0, lambda: log_add(self.log_widget, \\\\\\\"ç”¨æˆ·å–æ¶ˆå¤åˆ¶\\\\\\\"))\\\\n                return\\\\n            \\\\n            # 5. ç¡®å®šç›®æ ‡ç›®å½•\\\\n            if dst_letter:\\\\n                target_root = dst_letter + \\\\\\\"\\\\\\\\\\\\\\\\\\\\\\\"\\\\n            else:\\\\n                target_root = cfg.get(\\\\\\\"last_target_root\\\\\\\", \\\\\\\"\\\\\\\")\\\\n                if not os.path.exists(target_root):\\\\n                    def ask_dir():\\\\n                        nonlocal target_root\\\\n                        target_root = filedialog.askdirectory(title=\\\\\\\"é€‰æ‹©ç›®æ ‡ç¡¬ç›˜æ–‡ä»¶å¤¹ï¼ˆå»ºè®®ä¸ºå¤–ç½®ç¡¬ç›˜æ ¹ç›®å½•ï¼‰\\\\\\\")\\\\n                    root.after(0, ask_dir)\\\\n                    \\\\n                    while target_root is None and not self.stop_event.is_set():\\\\n                        time.sleep(0.1)\\\\n                    \\\\n                    if self.stop_event.is_set() or not target_root:\\\\n                        root.after(0, lambda: log_add(self.log_widget, \\\\\\\"ç”¨æˆ·å–æ¶ˆæ“ä½œ\\\\\\\"))\\\\n                        return\\\\n            \\\\n            cfg[\\\\\\\"last_target_root\\\\\\\"] = target_root\\\\n            save_config(cfg)\\\\n            \\\\n            # æ£€æŸ¥ç›®æ ‡ç›˜ä¸æºç›˜æ˜¯å¦ç›¸åŒ\\\\n            if os.path.splitdrive(target_root)[0].upper() == os.path.splitdrive(src_drive)[0].upper():\\\\n                same_drive = False\\\\n                def ask_same_drive():\\\\n                    nonlocal same_drive\\\\n                    same_drive = messagebox.askyesno(\\\\\\\"é£é™©æç¤º\\\\\\\", \\\\\\\"ç›®æ ‡ç›˜ä¸ç´ æç›˜ç›¸åŒç›˜ç¬¦ï¼Œå»ºè®®ä¸åŒç‰©ç†ç›˜ã€‚ç»§ç»­ï¼Ÿ\\\\\\\")\\\\n                root.after(0, ask_same_drive)\\\\n                \\\\n                while same_drive is None and not self.stop_event.is_set():\\\\n                    time.sleep(0.1)\\\\n                \\\\n                if self.stop_event.is_set() or not same_drive:\\\\n                    root.after(0, lambda: log_add(self.log_widget, \\\\\\\"ç”¨æˆ·å–æ¶ˆæ“ä½œ\\\\\\\"))\\\\n                    return\\\\n            \\\\n            # 6. åˆ›å»ºç›®æ ‡ç›®å½•ç»“æ„\\\\n            today = datetime.now()\\\\n            year_dir = os.path.join(target_root, str(today.year))\\\\n            cat_dir = os.path.join(year_dir, category)\\\\n            month_dir = os.path.join(cat_dir, f\\\\\\\"{today.month:02d}æœˆ\\\\\\\")\\\\n            day_folder = f\\\\\\\"{today.month:02d}.{today.day:02d}_{shoot_name}\\\\\\\"\\\\n            target_dir = os.path.join(month_dir, day_folder)\\\\n            \\\\n            os.makedirs(target_dir, exist_ok=True)\\\\n            root.after(0, lambda: log_add(self.log_widget, f\\\\\\\"ç›®æ ‡ç›®å½•ï¼š{target_dir}\\\\\\\"))\\\\n            \\\\n            # 7. æ£€æŸ¥ç›®æ ‡ç©ºé—´\\\\n            try:\\\\n                _, dst_free = get_drive_usage_bytes(os.path.splitdrive(target_root)[0] + \\\\\\\"\\\\\\\\\\\\\\\\\\\\\\\")\\\\n                if dst_free < total_size:\\\\n                    root.after(0, lambda: log_add(self.log_widget, \\\\n                        f\\\\\\\"ç›®æ ‡å‰©ä½™ {bytes_to_human(dst_free)} < éœ€è¦ {bytes_to_human(total_size)}\\\\\\\"))\\\\n                    \\\\n                    space_ok = False\\\\n                    def ask_space():\\\\n                        nonlocal space_ok\\\\n                        space_ok = messagebox.askretrycancel(\\\\n                            \\\\\\\"ç©ºé—´ä¸è¶³\\\\\\\",\\\\n                            f\\\\\\\"ç›®æ ‡å‰©ä½™ {bytes_to_human(dst_free)}ï¼Œé¢„è®¡éœ€è¦ {bytes_to_human(total_size)}ã€‚æ¸…ç†åé‡è¯•ã€‚\\\\\\\"\\\\n                        )\\\\n                    root.after(0, ask_space)\\\\n                    \\\\n                    while space_ok is None and not self.stop_event.is_set():\\\\n                        time.sleep(0.1)\\\\n                    \\\\n                    if self.stop_event.is_set() or not space_ok:\\\\n                        root.after(0, lambda: log_add(self.log_widget, \\\\\\\"ç©ºé—´ä¸è¶³ï¼Œå–æ¶ˆæ“ä½œ\\\\\\\"))\\\\n                        return\\\\n            except Exception:\\\\n                pass\\\\n            \\\\n            # 8. å‡†å¤‡å¤åˆ¶\\\\n            log_file = os.path.join(target_dir, \\\\\\\"copy_log.txt\\\\\\\")\\\\n            mmdd_str = f\\\\\\\"{today.month:02d}{today.day:02d}\\\\\\\"\\\\n            \\\\n            # åˆå§‹åŒ–è¿›åº¦æ¡\\\\n            root.after(0, lambda: self.progress_var.set(0))\\\\n            root.after(0, lambda: self.status_var.set(\\\\\\\"å‡†å¤‡å¤åˆ¶â€¦\\\\\\\"))\\\\n            \\\\n            # å¼€å§‹æç¤ºéŸ³\\\\n            beep_start()\\\\n            root.after(0, lambda: log_add(self.log_widget, \\\\\\\"å¼€å§‹å¤åˆ¶â€¦\\\\\\\"))\\\\n            \\\\n            # 9. æ‰§è¡Œå¤åˆ¶\\\\n            self._copy_files(files, target_dir, log_file, mmdd_str, total_size, extract_star, root)\\\\n            \\\\n            # 10. å®Œæˆæ“ä½œ\\\\n            if not self.stop_event.is_set():\\\\n                root.after(0, lambda: log_add(self.log_widget, f\\\\\\\"å¤åˆ¶å®Œæˆ å…± {len(self.created_files)} ä¸ªç›®æ ‡æ–‡ä»¶\\\\\\\"))\\\\n                root.after(0, lambda: self.status_var.set(\\\\\\\"å¤åˆ¶å®Œæˆ\\\\\\\"))\\\\n                \\\\n                # åˆ›å»ºæ¸…å•æ–‡ä»¶\\\\n                ts2 = datetime.now().strftime(\\\\\\\"%Y%m%d_%H%M%S\\\\\\\")\\\\n                manifest = {\\\\n                    \\\\\\\"version\\\\\\\": VERSION,\\\\n                    \\\\\\\"created_at\\\\\\\": ts2,\\\\n                    \\\\\\\"source_drive\\\\\\\": src_drive,\\\\n                    \\\\\\\"target_dir\\\\\\\": target_dir,\\\\n                    \\\\\\\"files\\\\\\\": self.created_files\\\\n                }\\\\n                \\\\n                try:\\\\n                    with open(os.path.join(target_dir, f\\\\\\\"import_manifest_{ts2}.json\\\\\\\"), \\\\\\\"w\\\\\\\", encoding=\\\\\\\"utf-8\\\\\\\") as f:\\\\n                        json.dump(manifest, f, ensure_ascii=False, indent=2)\\\\n                except Exception:\\\\n                    pass\\\\n                \\\\n                # å®Œæˆæç¤ºéŸ³\\\\n                beep_done()\\\\n                \\\\n                # æ˜¾ç¤ºå®Œæˆçª—å£\\\\n                root.after(0, lambda: self._show_finish_window(root, target_dir))\\\\n            else:\\\\n                root.after(0, lambda: self.status_var.set(\\\\\\\"å·²åœæ­¢\\\\\\\"))\\\\n                root.after(0, lambda: log_add(self.log_widget, \\\\\\\"å¤åˆ¶å·²åœæ­¢\\\\\\\"))\\\\n        \\\\n        except Exception as e:\\\\n            root.after(0, lambda: log_add(self.log_widget, f\\\\\\\"é”™è¯¯ï¼š{str(e)}\\\\\\\"))\\\\n            root.after(0, lambda: self.status_var.set(\\\\\\\"é”™è¯¯\\\\\\\"))\\\\n    \\\\n    def _copy_files(self, src_files, dst, log_file, mmdd_str, total_bytes, extract_star, root):\\\\n        \\\\\\\"\\\\\\\"\\\\\\\"æ‰§è¡Œæ–‡ä»¶å¤åˆ¶ï¼Œæ˜¾ç¤ºè¿›åº¦å’Œé¢„è§ˆ\\\\\\\"\\\\\\\"\\\\\\\"\\\\n        created = []; done = set()\\\\n        \\\\n        # è¯»å–å·²å®Œæˆçš„æ–‡ä»¶\\\\n        if os.path.exists(log_file):\\\\n            try:\\\\n                with open(log_file, \\\\\\\"r\\\\\\\", encoding=\\\\\\\"utf-8\\\\\\\") as f:\\\\n                    for line in f:\\\\n                        if line.startswith(\\\\\\\"å®Œæˆ: \\\\\\\"):\\\\n                            done.add(line.split(\\\\\\\"å®Œæˆ: \\\\\\\", 1)[1].split(\\\\\\\" -> \\\\\\\", 1)[0].strip())\\\\n            except Exception:\\\\n                pass\\\\n        \\\\n        # å‡†å¤‡ç›®æ ‡ç›®å½•\\\\n        photo_files = src_files[\\\\\\\"RAW\\\\\\\"] + src_files[\\\\\\\"JPG\\\\\\\"]\\\\n        video_files = src_files[\\\\\\\"VIDEO\\\\\\\"]\\\\n        \\\\n        raw_dir = os.path.join(dst, \\\\\\\"RAW\\\\\\\")\\\\n        jpg_dir = os.path.join(dst, \\\\\\\"JPG\\\\\\\")\\\\n        vid_dir = os.path.join(dst, \\\\\\\"VIDEO\\\\\\\")\\\\n        \\\\n        os.makedirs(raw_dir, exist_ok=True)\\\\n        os.makedirs(jpg_dir, exist_ok=True)\\\\n        os.makedirs(vid_dir, exist_ok=True)\\\\n        \\\\n        # å‡†å¤‡æ˜Ÿæ ‡ç›®å½•\\\\n        star_root = os.path.join(dst, \\\\\\\"å·²æ˜Ÿæ ‡ç…§ç‰‡\\\\\\\")\\\\n        star_jpg = os.path.join(star_root, \\\\\\\"å·²æ˜Ÿæ ‡JPG\\\\\\\")\\\\n        star_raw = os.path.join(star_root, \\\\\\\"å·²æ˜Ÿæ ‡RAW\\\\\\\")\\\\n        \\\\n        if extract_star:\\\\n            os.makedirs(star_jpg, exist_ok=True)\\\\n            os.makedirs(star_raw, exist_ok=True)\\\\n        \\\\n        # æ„å»ºç…§ç‰‡é‡å‘½åè®¡åˆ’\\\\n        plan = build_seq_plan(photo_files, mmdd_str)\\\\n        final_map = {}\\\\n        \\\\n        bytes_done = 0\\\\n        t0 = time.time()\\\\n        last_preview_update = 0\\\\n        \\\\n        # æ›´æ–°çŠ¶æ€å‡½æ•°\\\\n        def update_status(label_text):\\\\n            elapsed = max(time.time() - t0, 1e-6)\\\\n            speed_mb = bytes_done / elapsed / (1024 * 1024)\\\\n            pct = (bytes_done / total_bytes * 100) if total_bytes > 0 else 0\\\\n            \\\\n            root.after(0, lambda: self.progress_var.set(min(max(pct, 0), 100)))\\\\n            root.after(0, lambda: self.status_var.set(\\\\n                f\\\\\\\"{label_text} | {bytes_to_human(bytes_done)} / {bytes_to_human(total_bytes)} | é€Ÿåº¦ {speed_mb:.2f} MB/s\\\\\\\"\\\\n            ))\\\\n        \\\\n        # 1. å¤åˆ¶ç…§ç‰‡\\\\n        for src, base, ext in plan:\\\\n            if self.stop_event.is_set():\\\\n                return\\\\n            \\\\n            if src in done:\\\\n                update_status(\\\\\\\"ç…§ç‰‡\\\\\\\")\\\\n                continue\\\\n            \\\\n            td = raw_dir if is_raw_ext(ext) else jpg_dir\\\\n            dst_path = unique_path(td, f\\\\\\\"{base}.{ext}\\\\\\\")\\\\n            \\\\n            try:\\\\n                size = 0\\\\n                try: size = os.path.getsize(src)\\\\n                except Exception: size = 0\\\\n                \\\\n                shutil.copy2(src, dst_path)\\\\n                created.append(dst_path)\\\\n                final_map[src] = dst_path\\\\n                \\\\n                with open(log_file, \\\\\\\"a\\\\\\\", encoding=\\\\\\\"utf-8\\\\\\\") as f:\\\\n                    f.write(f\\\\\\\"å®Œæˆ: {src} -> {os.path.basename(dst_path)}\\\\\\\\n\\\\\\\")\\\\n                \\\\n                bytes_done += size\\\\n                update_status(\\\\\\\"ç…§ç‰‡\\\\\\\")\\\\n                \\\\n                # æ›´æ–°æ—¥å¿—å’Œé¢„è§ˆï¼ˆé™ä½é¢‘ç‡ï¼‰\\\\n                current_time = time.time()\\\\n                if current_time - last_preview_update > 1:  # æ¯ç§’æœ€å¤šæ›´æ–°ä¸€æ¬¡é¢„è§ˆ\\\\n                    root.after(0, lambda dst=dst_path: log_add(self.log_widget, f\\\\\\\"å¤åˆ¶ï¼š{os.path.basename(dst)}\\\\\\\"))\\\\n                    \\\\n                    if self.preview_manager and is_jpg_ext(ext):  # åªé¢„è§ˆJPGä»¥æé«˜æ€§èƒ½\\\\n                        file_info = f\\\\\\\"{bytes_to_human(size)} | {os.path.basename(dst)}\\\\\\\"\\\\n                        root.after(0, lambda src=src, info=file_info: self.preview_manager.show_preview(src, info))\\\\n                    \\\\n                    last_preview_update = current_time\\\\n                    \\\\n            except Exception as e:\\\\n                with open(log_file, \\\\\\\"a\\\\\\\", encoding=\\\\\\\"utf-8\\\\\\\") as f:\\\\n                    f.write(f\\\\\\\"é”™è¯¯: {src} | {e}\\\\\\\\n\\\\\\\")\\\\n        \\\\n        # 2. å¤åˆ¶è§†é¢‘\\\\n        for src in video_files:\\\\n            if self.stop_event.is_set():\\\\n                return\\\\n            \\\\n            if src in done:\\\\n                update_status(\\\\\\\"è§†é¢‘\\\\\\\")\\\\n                continue\\\\n            \\\\n            dst_path = unique_path(vid_dir, os.path.basename(src))\\\\n            \\\\n            try:\\\\n                size = 0\\\\n                try: size = os.path.getsize(src)\\\\n                except Exception: size = 0\\\\n                \\\\n                shutil.copy2(src, dst_path)\\\\n                created.append(dst_path)\\\\n                \\\\n                with open(log_file, \\\\\\\"a\\\\\\\", encoding=\\\\\\\"utf-8\\\\\\\") as f:\\\\n                    f.write(f\\\\\\\"å®Œæˆ: {src} -> {os.path.basename(dst_path)}\\\\\\\\n\\\\\\\")\\\\n                \\\\n                bytes_done += size\\\\n                update_status(\\\\\\\"è§†é¢‘\\\\\\\")\\\\n                \\\\n                # æ›´æ–°æ—¥å¿—ï¼ˆé™ä½é¢‘ç‡ï¼‰\\\\n                current_time = time.time()\\\\n                if current_time - last_preview_update > 2:  # è§†é¢‘æ›´æ–°é¢‘ç‡æ›´ä½\\\\n                    root.after(0, lambda dst=dst_path: log_add(self.log_widget, f\\\\\\\"å¤åˆ¶è§†é¢‘ï¼š{os.path.basename(dst)}\\\\\\\"))\\\\n                    last_preview_update = current_time\\\\n                    \\\\n            except Exception as e:\\\\n                with open(log_file, \\\\\\\"a\\\\\\\", encoding=\\\\\\\"utf-8\\\\\\\") as f:\\\\n                    f.write(f\\\\\\\"é”™è¯¯: {src} | {e}\\\\\\\\n\\\\\\\")\\\\n        \\\\n        # 3. æå–æ˜Ÿæ ‡ç…§ç‰‡\\\\n        if extract_star and not self.stop_event.is_set():\\\\n            root.after(0, lambda: log_add(self.log_widget, \\\\\\\"å¼€å§‹æå–æ˜Ÿæ ‡ç…§ç‰‡â€¦\\\\\\\"))\\\\n            star_count = 0\\\\n            \\\\n            for src, base, ext in plan:\\\\n                if self.stop_event.is_set():\\\\n                    return\\\\n                \\\\n                try:\\\\n                    if is_starred_file(src):\\\\n                        src_copied_path = final_map.get(src, src)\\\\n                        if is_jpg_ext(ext):\\\\n                            dst_star = unique_path(star_jpg, os.path.basename(src_copied_path))\\\\n                        else:\\\\n                            dst_star = unique_path(star_raw, os.path.basename(src_copied_path))\\\\n                        \\\\n                        shutil.copy2(src_copied_path, dst_star)\\\\n                        created.append(dst_star)\\\\n                        star_count += 1\\\\n                        \\\\n                        # å¶å°”æ›´æ–°æ—¥å¿—\\\\n                        if star_count % 5 == 0:\\\\n                            root.after(0, lambda cnt=star_count: log_add(self.log_widget, f\\\\\\\"å·²æå– {cnt} ä¸ªæ˜Ÿæ ‡ç…§ç‰‡\\\\\\\"))\\\\n                            \\\\n                except Exception as e:\\\\n                    with open(log_file, \\\\\\\"a\\\\\\\", encoding=\\\\\\\"utf-8\\\\\\\") as f:\\\\n                        f.write(f\\\\\\\"æ˜Ÿæ ‡å¤åˆ¶é”™è¯¯: {src} | {e}\\\\\\\\n\\\\\\\")\\\\n            \\\\n            root.after(0, lambda cnt=star_count: log_add(self.log_widget, f\\\\\\\"æ˜Ÿæ ‡æå–å®Œæˆï¼Œå…± {cnt} ä¸ªæ–‡ä»¶\\\\\\\"))\\\\n        \\\\n        # æ›´æ–°è¿›åº¦åˆ°100%\\\\n        root.after(0, lambda: self.progress_var.set(100))\\\\n        root.after(0, lambda: self.status_var.set(\\\\\\\"å®Œæˆ\\\\\\\"))\\\\n        \\\\n        # ä¿å­˜åˆ›å»ºçš„æ–‡ä»¶åˆ—è¡¨\\\\n        self.created_files = created\\\\n    \\\\n    def _show_finish_window(self, root, target_dir):\\\\n        \\\\\\\"\\\\\\\"\\\\\\\"æ˜¾ç¤ºå®Œæˆçª—å£\\\\\\\"\\\\\\\"\\\\\\\"\\\\n        win = tk.Toplevel(root)\\\\n        win.title(\\\\\\\"å®Œæˆ\\\\\\\")\\\\n        win.resizable(False, False)\\\\n        win.transient(root)      # ç½®äºçˆ¶çª—å£ä¸Šæ–¹\\\\n        win.grab_set()           # è·å–ç„¦ç‚¹\\\\n        \\\\n        # åŠ è½½é…ç½®å¹¶åº”ç”¨ä¸»é¢˜\\\\n        try:\\\\n            theme_key = load_config().get(\\\\\\\"theme\\\\\\\", \\\\\\\"light\\\\\\\")\\\\n            ThemeManager.apply_theme(win, theme_key)\\\\n        except Exception:\\\\n            pass\\\\n        \\\\n        # çª—å£æ ·å¼\\\\n        P = ThemeManager.THEMES[\\\\\\\"dark\\\\\\\" if theme_key == \\\\\\\"dark\\\\\\\" else \\\\\\\"light\\\\\\\"]\\\\n        win.configure(bg=P[\\\\\\\"BG\\\\\\\"])\\\\n        \\\\n        # æ·»åŠ å¡ç‰‡æ•ˆæœï¼ˆé€šè¿‡Frameå®ç°ï¼‰\\\\n        card = ttk.Frame(win, style=\\\\\\\"Modern.Card.TFrame\\\\\\\", padding=24)\\\\n        card.pack(padx=10, pady=10, fill=tk.BOTH, expand=True)\\\\n        \\\\n        # æ ‡é¢˜\\\\n        ttk.Label(card, text=\\\\\\\"å¯¼å…¥å®Œæˆ\\\\\\\", style=\\\\\\\"Modern.Title.TLabel\\\\\\\").pack(anchor=\\\\\\\"w\\\\\\\", pady=(0, 16))\\\\n        \\\\n        # ä¿¡æ¯\\\\n        info_frame = ttk.Frame(card, style=\\\\\\\"Modern.Frame.TFrame\\\\\\\")\\\\n        info_frame.pack(fill=tk.X, pady=(0, 24))\\\\n        \\\\n        ttk.Label(info_frame, text=\\\\\\\"è¾“å‡ºç›®å½•ï¼š\\\\\\\", style=\\\\\\\"Modern.Body.TLabel\\\\\\\").grid(row=0, column=0, sticky=\\\\\\\"w\\\\\\\", pady=(0, 4))\\\\n        ttk.Label(info_frame, text=target_dir, style=\\\\\\\"Modern.Secondary.TLabel\\\\\\\").grid(row=0, column=1, sticky=\\\\\\\"w\\\\\\\", pady=(0, 4))\\\\n        \\\\n        # æŒ‰é’®åŒºåŸŸ\\\\n        btn_frame = ttk.Frame(card, style=\\\\\\\"Modern.Frame.TFrame\\\\\\\")\\\\n        btn_frame.pack(fill=tk.X, anchor=\\\\\\\"e\\\\\\\")\\\\n        \\\\n        def open_folder():\\\\n            _open_folder(target_dir)\\\\n            win.destroy()\\\\n        \\\\n        def undo():\\\\n            removed = 0\\\\n            for p in self.created_files:\\\\n                try:\\\\n                    if os.path.isfile(p):\\\\n                        os.remove(p); removed += 1\\\\n                except Exception:\\\\n                    pass\\\\n            \\\\n            # æ¸…ç†ç©ºç›®å½•\\\\n            for sub in [\\\\\\\"RAW\\\\\\\", \\\\\\\"JPG\\\\\\\", \\\\\\\"VIDEO\\\\\\\", \\\\\\\"å·²æ˜Ÿæ ‡ç…§ç‰‡\\\\\\\", \\\\\\\"å·²æ˜Ÿæ ‡ç…§ç‰‡\\\\\\\\\\\\\\\\å·²æ˜Ÿæ ‡JPG\\\\\\\", \\\\\\\"å·²æ˜Ÿæ ‡ç…§ç‰‡\\\\\\\\\\\\\\\\å·²æ˜Ÿæ ‡RAW\\\\\\\"]:\\\\n                d = os.path.join(target_dir, sub)\\\\n                try:\\\\n                    if os.path.isdir(d) and not os.listdir(d):\\\\n                        os.rmdir(d)\\\\n                except Exception:\\\\n                    pass\\\\n            \\\\n            try:\\\\n                if os.path.isdir(target_dir) and not os.listdir(target_dir):\\\\n                    os.rmdir(target_dir)\\\\n            except Exception:\\\\n                pass\\\\n            \\\\n            messagebox.showinfo(\\\\\\\"æ’¤é”€å®Œæˆ\\\\\\\", f\\\\\\\"å·²åˆ é™¤æœ¬æ¬¡å¯¼å…¥ç”Ÿæˆçš„ {removed} ä¸ªæ–‡ä»¶ã€‚\\\\\\\")\\\\n            win.destroy()\\\\n        \\\\n        # åˆ›å»ºæŒ‰é’®\\\\n        ttk.Button(btn_frame, text=\\\\\\\"å…³é—­\\\\\\\", style=\\\\\\\"Modern.Secondary.TButton\\\\\\\", command=win.destroy).pack(side=tk.RIGHT, padx=(0, 8))\\\\n        ttk.Button(btn_frame, text=\\\\\\\"æ’¤é”€æœ¬æ¬¡å¯¼å…¥\\\\\\\", style=\\\\\\\"Modern.Secondary.TButton\\\\\\\", command=undo).pack(side=tk.RIGHT, padx=(0, 8))\\\\n        ttk.Button(btn_frame, text=\\\\\\\"æ‰“å¼€è¾“å‡ºæ–‡ä»¶å¤¹\\\\\\\", style=\\\\\\\"Modern.Primary.TButton\\\\\\\", command=open_folder).pack(side=tk.RIGHT)\\\\n        \\\\n        # è®¡ç®—å°ºå¯¸åå±…ä¸­åˆ°çˆ¶çª—å£\\\\n        win.update_idletasks()\\\\n        self._center_on_parent(win, root)\\\\n    \\\\n    def _center_on_parent(self, child: tk.Toplevel, parent: tk.Tk):\\\\n        \\\\\\\"\\\\\\\"\\\\\\\"æŠŠå­çª—å£å±…ä¸­åˆ°çˆ¶çª—å£\\\\\\\"\\\\\\\"\\\\\\\"\\\\n        parent.update_idletasks()\\\\n        child.update_idletasks()\\\\n        \\\\n        pw, ph = parent.winfo_width(), parent.winfo_height()\\\\n        px, py = parent.winfo_rootx(), parent.winfo_rooty()\\\\n        cw, ch = child.winfo_width(), child.winfo_height()\\\\n        \\\\n        x = px + max((pw - cw) // 2, 0)\\\\n        y = py + max((ph - ch) // 2, 0)\\\\n        \\\\n        child.geometry(f\\\\\\\"+{x}+{y}\\\\\\\")\\\\n\\\\n# ---------- ä¸»åº”ç”¨ç±» ----------\\\\nclass ModernPhotoSorterApp:\\\\n    \\\\\\\"\\\\\\\"\\\\\\\"ç°ä»£UIç‰ˆæœ¬çš„å½±åƒç®¡ç†åŠ©æ‰‹åº”ç”¨ç¨‹åº\\\\\\\"\\\\\\\"\\\\\\\"\\\\n    \\\\n    def __init__(self):\\\\n        # åŠ è½½é…ç½®\\\\n        self.cfg = load_config()\\\\n        self.theme_key = self.cfg.get(\\\\\\\"theme\\\\\\\", \\\\\\\"light\\\\\\\")\\\\n        self.sash_ratio = float(self.cfg.get(\\\\\\\"sash_ratio\\\\\\\", 0.55))\\\\n        \\\\n        # åˆ›å»ºä¸»çª—å£\\\\n        self.root = tk.Tk()\\\\n        self.root.title(f\\\\\\\"é™ˆåŒå­¦å½±åƒç®¡ç†åŠ©æ‰‹  {VERSION}\\\\\\\")\\\\n        \\\\n        # æ¢å¤çª—å£ä½ç½®å’Œå¤§å°\\\\n        pos = self.cfg.get(\\\\\\\"window_pos\\\\\\\", {\\\\\\\"x\\\\\\\": 100, \\\\\\\"y\\\\\\\": 100})\\\\n        size = self.cfg.get(\\\\\\\"window_size\\\\\\\", {\\\\\\\"width\\\\\\\": 1000, \\\\\\\"height\\\\\\\": 720})\\\\n        self.root.geometry(f\\\\\\\"{size[\\\\'width\\\\']}x{size[\\\\'height\\\\']}+{pos[\\\\'x\\\\']}+{pos[\\\\'y\\\\']}\\\\\\\")\\\\n        self.root.minsize(900, 650)\\\\n        \\\\n        # åº”ç”¨ä¸»é¢˜\\\\n        self.theme_manager = ThemeManager\\\\n        self.theme_manager.apply_theme(self.root, self.theme_key)\\\\n        \\\\n        # åˆ›å»ºUIç»„ä»¶\\\\n        self._create_ui()\\\\n        \\\\n        # åˆå§‹åŒ–æ•°æ®\\\\n        self._initialize_data()\\\\n        \\\\n        # ç»‘å®šäº‹ä»¶\\\\n        self._bind_events()\\\\n    \\\\n    def _create_ui(self):\\\\n        \\\\\\\"\\\\\\\"\\\\\\\"åˆ›å»ºç”¨æˆ·ç•Œé¢\\\\\\\"\\\\\\\"\\\\\\\"\\\\n        # é¡¶éƒ¨æ \\\\n        header = ttk.Frame(self.root, style=\\\\\\\"Modern.Frame.TFrame\\\\\\\")\\\\n        header.pack(fill=tk.X, padx=24, pady=(16, 0))\\\\n        \\\\n        # æ ‡é¢˜å’Œä¸»é¢˜é€‰æ‹©\\\\n        title_frame = ttk.Frame(header, style=\\\\\\\"Modern.Frame.TFrame\\\\\\\")\\\\n        title_frame.pack(fill=tk.X)\\\\n        \\\\n        ttk.Label(title_frame, text=\\\\\\\"ç…§ç‰‡/è§†é¢‘å¯¼å…¥ä¸åˆ†ç±»\\\\\\\", style=\\\\\\\"Modern.Title.TLabel\\\\\\\").pack(side=tk.LEFT)\\\\n        \\\\n        theme_frame = ttk.Frame(title_frame, style=\\\\\\\"Modern.Frame.TFrame\\\\\\\")\\\\n        theme_frame.pack(side=tk.RIGHT, pady=8)\\\\n        \\\\n        ttk.Label(theme_frame, text=\\\\\\\"ä¸»é¢˜:\\\\\\\", style=\\\\\\\"Modern.Body.TLabel\\\\\\\").pack(side=tk.LEFT, padx=(0, 8))\\\\n        \\\\n        self.theme_box = ttk.Combobox(\\\\n            theme_frame, \\\\n            state=\\\\\\\"readonly\\\\\\\", \\\\n            values=THEMES, \\\\n            width=8,\\\\n            style=\\\\\\\"Modern.TCombobox\\\\\\\"\\\\n        )\\\\n        self.theme_box.pack(side=tk.LEFT)\\\\n        self.theme_box.set(\\\\\\\"æ—¥é—´\\\\\\\" if self.theme_key == \\\\\\\"light\\\\\\\" else \\\\\\\"æš—é»‘\\\\\\\")\\\\n        \\\\n        # ä¸»å†…å®¹åŒºåŸŸ - ä½¿ç”¨PanedWindowå®ç°å¯æ‹–åŠ¨åˆ†å‰²\\\\n        self.paned = ttk.Panedwindow(self.root, orient=\\\\\\\"vertical\\\\\\\")\\\\n        self.paned.pack(fill=tk.BOTH, expand=True, padx=24, pady=(16, 8))\\\\n        \\\\n        # ä¸Šéƒ¨ï¼šè®¾ç½®åŒºåŸŸ\\\\n        self.top_frame = ttk.Frame(self.paned, style=\\\\\\\"Modern.Frame.TFrame\\\\\\\")\\\\n        self.paned.add(self.top_frame, weight=3)\\\\n        \\\\n        # ä¸‹éƒ¨ï¼šæ—¥å¿—å’Œé¢„è§ˆåŒºåŸŸ\\\\n        self.bottom_frame = ttk.Frame(self.paned, style=\\\\\\\"Modern.Frame.TFrame\\\\\\\")\\\\n        self.paned.add(self.bottom_frame, weight=5)\\\\n        \\\\n        # ----- ä¸Šéƒ¨è®¾ç½®åŒºåŸŸ ----- #\\\\n        # å¯¼å…¥è®¾ç½®å¡ç‰‡\\\\n        import_card = ttk.Frame(self.top_frame, style=\\\\\\\"Modern.Card.TFrame\\\\\\\", padding=20)\\\\n        import_card.pack(fill=tk.X, pady=(0, 12))\\\\n        \\\\n        ttk.Label(import_card, text=\\\\\\\"å¯¼å…¥è®¾ç½®\\\\\\\", style=\\\\\\\"Modern.Subtitle.TLabel\\\\\\\").pack(anchor=\\\\\\\"w\\\\\\\", pady=(0, 16))\\\\n        \\\\n        # è¡¨å•å¸ƒå±€\\\\n        form_frame = ttk.Frame(import_card, style=\\\\\\\"Modern.Frame.TFrame\\\\\\\")\\\\n        form_frame.pack(fill=tk.X)\\\\n        \\\\n        # ç´ æç›˜é€‰æ‹©\\\\n        self._create_form_row(form_frame, \\\\\\\"é€‰æ‹©ç´ æç›˜\\\\\\\", 0)\\\\n        \\\\n        self.combo_src = ttk.Combobox(\\\\n            form_frame,\\\\n            state=\\\\\\\"readonly\\\\\\\",\\\\n            width=60,\\\\n            style=\\\\\\\"Modern.TCombobox\\\\\\\"\\\\n        )\\\\n        self.combo_src.grid(row=0, column=1, sticky=\\\\\\\"ew\\\\\\\", padx=(8, 12))\\\\n        \\\\n        self.btn_refresh_src = ttk.Button(\\\\n            form_frame,\\\\n            text=\\\\\\\"åˆ·æ–°\\\\\\\",\\\\n            style=\\\\\\\"Modern.Secondary.TButton\\\\\\\",\\\\n            command=lambda: self.refresh_sources(auto_pick=True)\\\\n        )\\\\n        self.btn_refresh_src.grid(row=0, column=2, padx=(0, 8))\\\\n        \\\\n        # ç›®æ ‡ç›˜é€‰æ‹©\\\\n        self._create_form_row(form_frame, \\\\\\\"æ‹·å…¥åˆ°\\\\\\\", 1)\\\\n        \\\\n        self.combo_dst = ttk.Combobox(\\\\n            form_frame,\\\\n            state=\\\\\\\"readonly\\\\\\\",\\\\n            width=60,\\\\n            style=\\\\\\\"Modern.TCombobox\\\\\\\"\\\\n        )\\\\n        self.combo_dst.grid(row=1, column=1, sticky=\\\\\\\"ew\\\\\\\", padx=(8, 12), pady=(12, 0))\\\\n        \\\\n        self.btn_refresh_dst = ttk.Button(\\\\n            form_frame,\\\\n            text=\\\\\\\"åˆ·æ–°\\\\\\\",\\\\n            style=\\\\\\\"Modern.Secondary.TButton\\\\\\\",\\\\n            command=self.refresh_dests\\\\n        )\\\\n        self.btn_refresh_dst.grid(row=1, column=2, padx=(0, 8), pady=(12, 0))\\\\n        \\\\n        # æ‹æ‘„ç±»å‹å’Œæ˜Ÿæ ‡é€‰é¡¹\\\\n        self._create_form_row(form_frame, \\\\\\\"æ‹æ‘„ç±»å‹\\\\\\\", 2)\\\\n        \\\\n        self.combo_cat = ttk.Combobox(\\\\n            form_frame,\\\\n            state=\\\\\\\"readonly\\\\\\\",\\\\n            values=CATEGORIES,\\\\n            width=20,\\\\n            style=\\\\\\\"Modern.TCombobox\\\\\\\"\\\\n        )\\\\n        self.combo_cat.grid(row=2, column=1, sticky=\\\\\\\"w\\\\\\\", padx=(8, 12), pady=(12, 0))\\\\n        self.combo_cat.current(0)\\\\n        \\\\n        self.star_var = tk.BooleanVar(value=False)\\\\n        self.chk_star = ttk.Checkbutton(\\\\n            form_frame,\\\\n            text=\\\\\\\"æå–æ˜Ÿæ ‡ç…§ç‰‡\\\\\\\",\\\\n            variable=self.star_var,\\\\n            style=\\\\\\\"Modern.TCheckbutton\\\\\\\"\\\\n        )\\\\n        self.chk_star.grid(row=2, column=2, sticky=\\\\\\\"w\\\\\\\", padx=(0, 8), pady=(12, 0))\\\\n        \\\\n        # é…ç½®åˆ—æƒé‡\\\\n        form_frame.columnconfigure(1, weight=1)\\\\n        \\\\n        # æ“ä½œåŒºåŸŸå¡ç‰‡\\\\n        action_card = ttk.Frame(self.top_frame, style=\\\\\\\"Modern.Card.TFrame\\\\\\\", padding=20)\\\\n        action_card.pack(fill=tk.X)\\\\n        \\\\n        # è¿›åº¦æ¡\\\\n        self.progress_var = tk.DoubleVar(value=0)\\\\n        self.progress_bar = ttk.Progressbar(\\\\n            action_card,\\\\n            variable=self.progress_var,\\\\n            style=\\\\\\\"Modern.Horizontal.TProgressbar\\\\\\\",\\\\n            orient=\\\\\\\"horizontal\\\\\\\",\\\\n            length=0,  # ç”±fill=tk.Xè‡ªåŠ¨å¡«å……\\\\n            mode=\\\\\\\"determinate\\\\\\\"\\\\n        )\\\\n        self.progress_bar.pack(fill=tk.X, pady=(0, 8))\\\\n        \\\\n        # çŠ¶æ€æ ‡ç­¾\\\\n        self.status_var = tk.StringVar(value=\\\\\\\"å¾…æœº\\\\\\\")\\\\n        self.status_label = ttk.Label(\\\\n            action_card,\\\\n            textvariable=self.status_var,\\\\n            style=\\\\\\\"Modern.Secondary.TLabel\\\\\\\"\\\\n        )\\\\n        self.status_label.pack(anchor=\\\\\\\"w\\\\\\\", pady=(0, 16))\\\\n        \\\\n        # æŒ‰é’®åŒºåŸŸ\\\\n        btn_frame = ttk.Frame(action_card, style=\\\\\\\"Modern.Frame.TFrame\\\\\\\")\\\\n        btn_frame.pack(fill=tk.X, anchor=\\\\\\\"e\\\\\\\")\\\\n        \\\\n        self.btn_exit = ttk.Button(\\\\n            btn_frame,\\\\n            text=\\\\\\\"é€€å‡º\\\\\\\",\\\\n            style=\\\\\\\"Modern.Secondary.TButton\\\\\\\",\\\\n            command=self.root.destroy\\\\n        )\\\\n        self.btn_exit.pack(side=tk.RIGHT, padx=(0, 8))\\\\n        \\\\n        self.btn_stop = ttk.Button(\\\\n            btn_frame,\\\\n            text=\\\\\\\"åœæ­¢\\\\\\\",\\\\n            style=\\\\\\\"Modern.Secondary.TButton\\\\\\\",\\\\n            command=self.stop_action,\\\\n            state=tk.DISABLED\\\\n        )\\\\n        self.btn_stop.pack(side=tk.RIGHT, padx=(0, 8))\\\\n        \\\\n        self.btn_start = ttk.Button(\\\\n            btn_frame,\\\\n            text=\\\\\\\"å¼€å§‹åˆ†ç±»\\\\\\\",\\\\n            style=\\\\\\\"Modern.Primary.TButton\\\\\\\",\\\\n            command=self.start_action\\\\n        )\\\\n        self.btn_start.pack(side=tk.RIGHT)\\\\n        \\\\n        # ----- ä¸‹éƒ¨æ—¥å¿—å’Œé¢„è§ˆåŒºåŸŸ ----- #\\\\n        # åˆ›å»ºæ°´å¹³åˆ†å‰²çš„é¢æ¿\\\\n        self.bottom_paned = ttk.Panedwindow(self.bottom_frame, orient=\\\\\\\"horizontal\\\\\\\")\\\\n        self.bottom_paned.pack(fill=tk.BOTH, expand=True)\\\\n        \\\\n        # å·¦ä¾§ï¼šé¢„è§ˆåŒºåŸŸ\\\\n        preview_frame = ttk.Frame(self.bottom_paned, style=\\\\\\\"Modern.Frame.TFrame\\\\\\\")\\\\n        self.bottom_paned.add(preview_frame, weight=1)\\\\n        \\\\n        # é¢„è§ˆå¡ç‰‡\\\\n        preview_card = ttk.Frame(preview_frame, style=\\\\\\\"Modern.Card.TFrame\\\\\\\", padding=16)\\\\n        preview_card.pack(fill=tk.BOTH, expand=True, pady=(0, 12))\\\\n        \\\\n        ttk.Label(preview_card, text=\\\\\\\"å›¾åƒé¢„è§ˆ\\\\\\\", style=\\\\\\\"Modern.Subtitle.TLabel\\\\\\\").pack(anchor=\\\\\\\"w\\\\\\\", pady=(0, 12))\\\\n        \\\\n        # é¢„è§ˆç”»å¸ƒ\\\\n        self.preview_canvas = tk.Canvas(\\\\n            preview_card,\\\\n            relief=\\\\\\\"flat\\\\\\\",\\\\n            highlightthickness=0\\\\n        )\\\\n        self.preview_canvas.pack(fill=tk.BOTH, expand=True)\\\\n        \\\\n        # å³ä¾§ï¼šæ—¥å¿—åŒºåŸŸ\\\\n        log_frame = ttk.Frame(self.bottom_paned, style=\\\\\\\"Modern.Frame.TFrame\\\\\\\")\\\\n        self.bottom_paned.add(log_frame, weight=1)\\\\n        \\\\n        # æ—¥å¿—å¡ç‰‡\\\\n        log_card = ttk.Frame(log_frame, style=\\\\\\\"Modern.Card.TFrame\\\\\\\", padding=16)\\\\n        log_card.pack(fill=tk.BOTH, expand=True, pady=(0, 12))\\\\n        \\\\n        ttk.Label(log_card, text=\\\\\\\"ä¿¡æ¯æ—¥å¿—\\\\\\\", style=\\\\\\\"Modern.Subtitle.TLabel\\\\\\\").pack(anchor=\\\\\\\"w\\\\\\\", pady=(0, 12))\\\\n        \\\\n        # æ—¥å¿—æ–‡æœ¬æ¡†\\\\n        self.info_box = tk.Text(\\\\n            log_card,\\\\n            wrap=\\\\\\\"word\\\\\\\",\\\\n            bd=0,\\\\n            relief=\\\\\\\"flat\\\\\\\",\\\\n            state=\\\\\\\"disabled\\\\\\\",\\\\n            highlightthickness=0\\\\n        )\\\\n        self.info_box.pack(fill=tk.BOTH, expand=True, side=tk.LEFT)\\\\n        \\\\n        # æ»šåŠ¨æ¡\\\\n        self.log_scrollbar = ttk.Scrollbar(\\\\n            log_card,\\\\n            command=self.info_box.yview\\\\n        )\\\\n        self.log_scrollbar.pack(side=tk.RIGHT, fill=tk.Y)\\\\n        \\\\n        self.info_box.configure(yscrollcommand=self.log_scrollbar.set)\\\\n        \\\\n        # åº•éƒ¨ç‰ˆæƒä¿¡æ¯\\\\n        footer = ttk.Label(\\\\n            self.root,\\\\n            text=\\\\\\\"æ­¤è½¯ä»¶å®Œå…¨å…è´¹ï¼Œè¯·å‹¿å€’å–ï¼ by: æŠ–éŸ³@æ‘„å½±å¸ˆé™ˆåŒå­¦\\\\\\\",\\\\n            style=\\\\\\\"Modern.Secondary.TLabel\\\\\\\",\\\\n            anchor=\\\\\\\"center\\\\\\\"\\\\n        )\\\\n        footer.pack(fill=tk.X, pady=(0, 12))\\\\n    \\\\n    def _create_form_row(self, parent, label_text, row):\\\\n        \\\\\\\"\\\\\\\"\\\\\\\"åˆ›å»ºè¡¨å•è¡Œ\\\\\\\"\\\\\\\"\\\\\\\"\\\\n        ttk.Label(\\\\n            parent,\\\\n            text=label_text,\\\\n            style=\\\\\\\"Modern.Body.TLabel\\\\\\\"\\\\n        ).grid(row=row, column=0, sticky=\\\\\\\"e\\\\\\\", pady=(row > 0 and 12 or 0, 0))\\\\n    \\\\n    def _initialize_data(self):\\\\n        \\\\\\\"\\\\\\\"\\\\\\\"åˆå§‹åŒ–æ•°æ®\\\\\\\"\\\\\\\"\\\\\\\"\\\\n        # åˆ›å»ºå›¾åƒé¢„è§ˆç®¡ç†å™¨\\\\n        self.preview_manager = ImagePreviewManager(self.preview_canvas, self.theme_manager)\\\\n        self.preview_manager.clear_preview()\\\\n        \\\\n        # åˆ›å»ºå¤åˆ¶ç®¡ç†å™¨\\\\n        self.copy_manager = CopyManager(\\\\n            self.info_box,\\\\n            self.status_var,\\\\n            self.progress_var,\\\\n            self.preview_manager\\\\n        )\\\\n        \\\\n        # åˆå§‹åŒ–é©±åŠ¨å™¨åˆ—è¡¨\\\\n        self.refresh_sources(auto_pick=True)\\\\n    \\\\n    def _bind_events(self):\\\\n        \\\\\\\"\\\\\\\"\\\\\\\"ç»‘å®šäº‹ä»¶å¤„ç†ç¨‹åº\\\\\\\"\\\\\\\"\\\\\\\"\\\\n        # ä¸»é¢˜åˆ‡æ¢\\\\n        self.theme_box.bind(\\\\\\\"<<ComboboxSelected>>\\\\\\\", self.on_theme_change)\\\\n        \\\\n        # çª—å£å…³é—­äº‹ä»¶\\\\n        self.root.protocol(\\\\\\\"WM_DELETE_WINDOW\\\\\\\", self.on_window_close)\\\\n        \\\\n        # åˆ†å‰²çª—æ‹–åŠ¨äº‹ä»¶\\\\n        self.paned.bind(\\\\\\\"<ButtonRelease-1>\\\\\\\", self.remember_sash)\\\\n        self.root.bind(\\\\\\\"<Configure>\\\\\\\", lambda e: self.root.after(50, self.remember_sash))\\\\n        \\\\n        # åº”ç”¨åˆ†å‰²æ¯”ä¾‹\\\\n        self.root.after(300, self.apply_sash_ratio_later)\\\\n        \\\\n        # ç‰ˆæƒæç¤º\\\\n        self.root.after(500, self.show_copyright)\\\\n    \\\\n    def refresh_sources(self, auto_pick=False):\\\\n        \\\\\\\"\\\\\\\"\\\\\\\"åˆ·æ–°æºé©±åŠ¨å™¨åˆ—è¡¨\\\\\\\"\\\\\\\"\\\\\\\"\\\\n        all_drives = list_drives()\\\\n        removable = []; src_vals = []\\\\n        \\\\n        for d in all_drives:\\\\n            tname = drive_type_name(get_drive_type_code(d))\\\\n            if get_drive_type_code(d) == 2: removable.append(d)\\\\n            tag = \\\\\\\"(ç³»ç»Ÿ)\\\\\\\" if is_system_drive(d) else \\\\\\\"\\\\\\\"\\\\n            src_vals.append(f\\\\\\\"{d}  |  åç§°: {get_drive_label(d)}  |  ç±»å‹: {tname}{tag}\\\\\\\")\\\\n        \\\\n        self.combo_src[\\\\\\\"values\\\\\\\"] = src_vals\\\\n        \\\\n        if auto_pick and removable:\\\\n            pick = removable[0]\\\\n            for i, s in enumerate(src_vals):\\\\n                if s.startswith(pick): \\\\n                    self.combo_src.current(i)\\\\n                    break\\\\n        \\\\n        log_init_if_empty(self.info_box, \\\\\\\"æ—¥å¿—å·²å¯åŠ¨\\\\\\\")\\\\n        \\\\n        if removable:\\\\n            log_add(self.info_box, f\\\\\\\"å‘ç°ç§»åŠ¨ç›˜ï¼š{\\\\', \\\\'.join(removable)}\\\\\\\")\\\\n        else:\\\\n            log_add(self.info_box, \\\\\\\"æœªæ£€æµ‹åˆ°ç§»åŠ¨ç›˜\\\\\\\")\\\\n    \\\\n    def refresh_dests(self):\\\\n        \\\\\\\"\\\\\\\"\\\\\\\"åˆ·æ–°ç›®æ ‡é©±åŠ¨å™¨åˆ—è¡¨\\\\\\\"\\\\\\\"\\\\\\\"\\\\n        vals = []\\\\n        for p in psutil.disk_partitions(all=False):\\\\n            letter = p.device.rstrip(\\\\\\\"\\\\\\\\\\\\\\\\\\\\\\\")\\\\n            if get_drive_type_code(letter) != 3: continue\\\\n            \\\\n            total, free = get_drive_usage_bytes(letter + \\\\\\\"\\\\\\\\\\\\\\\\\\\\\\\")\\\\n            label = get_drive_label(letter)\\\\n            vals.append(f\\\\\\\"{letter} {label}ï¼ˆ{bytes_to_human(free)} / {bytes_to_human(total)}ï¼‰\\\\\\\")\\\\n        \\\\n        self.combo_dst[\\\\\\\"values\\\\\\\"] = vals\\\\n        log_add(self.info_box, \\\\\\\"å·²åˆ·æ–°ç›®æ ‡å›ºå®šç£ç›˜åˆ—è¡¨\\\\\\\")\\\\n    \\\\n    def start_action(self):\\\\n        \\\\\\\"\\\\\\\"\\\\\\\"å¼€å§‹åˆ†ç±»æ“ä½œ\\\\\\\"\\\\\\\"\\\\\\\"\\\\n        # æ£€æŸ¥æºè®¾å¤‡\\\\n        sv = self.combo_src.get()\\\\n        if not sv:\\\\n            messagebox.showwarning(\\\\\\\"æç¤º\\\\\\\", \\\\\\\"è¯·å…ˆé€‰æ‹©ç´ æç›˜ã€‚\\\\\\\")\\\\n            return\\\\n        \\\\n        src_drive = sv.split(\\\\\\\"|\\\\\\\", 1)[0].strip()\\\\n        \\\\n        # æ£€æŸ¥æºè®¾å¤‡ç±»å‹\\\\n        dtype = drive_type_name(get_drive_type_code(src_drive))\\\\n        \\\\n        # ç³»ç»Ÿç›˜è­¦å‘Š\\\\n        if is_system_drive(src_drive):\\\\n            if not messagebox.askyesno(\\\\\\\"é«˜é£é™©ç¡®è®¤\\\\\\\", f\\\\\\\"{src_drive} æ˜¯ç³»ç»Ÿç›˜ï¼Œä¸å»ºè®®ä½œä¸ºç´ æç›˜æºã€‚ç»§ç»­ï¼Ÿ\\\\\\\"):\\\\n                return\\\\n            if not messagebox.askyesno(\\\\\\\"äºŒæ¬¡ç¡®è®¤\\\\\\\", \\\\\\\"å†æ¬¡ç¡®è®¤ä»ç³»ç»Ÿç›˜ä½œä¸ºç›¸æœºæºå¤åˆ¶ï¼Ÿ\\\\\\\"):\\\\n                return\\\\n        elif get_drive_type_code(src_drive) != 2:\\\\n            if not messagebox.askyesno(\\\\\\\"å›ºå®šç£ç›˜è­¦å‘Š\\\\\\\", f\\\\\\\"{src_drive} ä¸ºå›ºå®šç›˜ï¼Œé€šå¸¸åº”é€‰ç§»åŠ¨ç›˜ã€‚ç»§ç»­ï¼Ÿ\\\\\\\"):\\\\n                return\\\\n        \\\\n        # è·å–ç›®æ ‡é©±åŠ¨å™¨\\\\n        dst_letter = \\\\\\\"\\\\\\\"\\\\n        if self.combo_dst.get():\\\\n            dst_letter = self.combo_dst.get().split(\\\\\\\" \\\\\\\", 1)[0].strip().rstrip(\\\\\\\"\\\\\\\\\\\\\\\\\\\\\\\")\\\\n        \\\\n        # æ›´æ–°æŒ‰é’®çŠ¶æ€\\\\n        self.btn_start.config(state=tk.DISABLED)\\\\n        self.btn_stop.config(state=tk.NORMAL)\\\\n        \\\\n        # å¯åŠ¨å¤åˆ¶çº¿ç¨‹\\\\n        copy_thread = self.copy_manager.start_copy(\\\\n            src_drive,\\\\n            dst_letter,\\\\n            self.cfg,\\\\n            self.root,\\\\n            self.combo_cat.get().strip(),\\\\n            extract_star=self.star_var.get()\\\\n        )\\\\n        \\\\n        # ç›‘æ§çº¿ç¨‹å®Œæˆ\\\\n        def check_thread():\\\\n            if copy_thread.is_alive():\\\\n                self.root.after(500, check_thread)\\\\n            else:\\\\n                # æ¢å¤æŒ‰é’®çŠ¶æ€\\\\n                self.btn_start.config(state=tk.NORMAL)\\\\n                self.btn_stop.config(state=tk.DISABLED)\\\\n        \\\\n        self.root.after(500, check_thread)\\\\n    \\\\n    def stop_action(self):\\\\n        \\\\\\\"\\\\\\\"\\\\\\\"åœæ­¢æ“ä½œ\\\\\\\"\\\\\\\"\\\\\\\"\\\\n        self.copy_manager.stop_copy()\\\\n        self.status_var.set(\\\\\\\"æ­£åœ¨åœæ­¢...\\\\\\\")\\\\n    \\\\n    def on_theme_change(self, event=None):\\\\n        \\\\\\\"\\\\\\\"\\\\\\\"ä¸»é¢˜åˆ‡æ¢å¤„ç†\\\\\\\"\\\\\\\"\\\\\\\"\\\\n        sel = self.theme_box.get()\\\\n        key = \\\\\\\"light\\\\\\\" if sel == \\\\\\\"æ—¥é—´\\\\\\\" else \\\\\\\"dark\\\\\\\"\\\\n        \\\\n        self.cfg[\\\\\\\"theme\\\\\\\"] = key\\\\n        save_config(self.cfg)\\\\n        \\\\n        # åº”ç”¨æ–°ä¸»é¢˜\\\\n        self.theme_manager.apply_theme(\\\\n            self.root,\\\\n            key,\\\\n            widgets={\\\\n                \\\\\\\"text\\\\\\\": [self.info_box],\\\\n                \\\\\\\"canvas\\\\\\\": [self.preview_canvas]\\\\n            }\\\\n        )\\\\n    \\\\n    def remember_sash(self, event=None):\\\\n        \\\\\\\"\\\\\\\"\\\\\\\"è®°ä½åˆ†å‰²çª—å£ä½ç½®\\\\\\\"\\\\\\\"\\\\\\\"\\\\n        try:\\\\n            self.root.update_idletasks()\\\\n            total_h = self.paned.winfo_height()\\\\n            pos = self.paned.sashpos(0)\\\\n            ratio = round(pos / max(total_h, 1), 4)\\\\n            \\\\n            self.cfg[\\\\\\\"sash_ratio\\\\\\\"] = max(0.15, min(0.85, ratio))\\\\n            save_config(self.cfg)\\\\n        except Exception:\\\\n            pass\\\\n    \\\\n    def apply_sash_ratio_later(self):\\\\n        \\\\\\\"\\\\\\\"\\\\\\\"å»¶è¿Ÿåº”ç”¨åˆ†å‰²æ¯”ä¾‹\\\\\\\"\\\\\\\"\\\\\\\"\\\\n        try:\\\\n            self.root.update_idletasks()\\\\n            total_h = self.paned.winfo_height()\\\\n            \\\\n            if total_h <= 0:\\\\n                self.root.after(100, self.apply_sash_ratio_later)\\\\n                return\\\\n            \\\\n            pos = int(total_h * self.sash_ratio)\\\\n            self.paned.sashpos(0, pos)\\\\n        except Exception:\\\\n            pass\\\\n    \\\\n    def show_copyright(self):\\\\n        \\\\\\\"\\\\\\\"\\\\\\\"æ˜¾ç¤ºç‰ˆæƒä¿¡æ¯\\\\\\\"\\\\\\\"\\\\\\\"\\\\n        log_add(self.info_box, \\\\\\\"=== é™ˆåŒå­¦å½±åƒç®¡ç†åŠ©æ‰‹ v2.0.0 ===\\\\\\\")\\\\n        log_add(self.info_box, \\\\\\\"å®Œå…¨å…è´¹ï¼Œç¦æ­¢å•†ç”¨æˆ–å€’å–ï¼\\\\\\\")\\\\n        log_add(self.info_box, \\\\\\\"ä½œè€…ï¼šæŠ–éŸ³@æ‘„å½±å¸ˆé™ˆåŒå­¦\\\\\\\")\\\\n    \\\\n    def on_window_close(self):\\\\n        \\\\\\\"\\\\\\\"\\\\\\\"çª—å£å…³é—­äº‹ä»¶å¤„ç†\\\\\\\"\\\\\\\"\\\\\\\"\\\\n        # ä¿å­˜çª—å£ä½ç½®å’Œå¤§å°\\\\n        pos = {\\\\n            \\\\\\\"x\\\\\\\": self.root.winfo_x(),\\\\n            \\\\\\\"y\\\\\\\": self.root.winfo_y()\\\\n        }\\\\n        \\\\n        size = {\\\\n            \\\\\\\"width\\\\\\\": self.root.winfo_width(),\\\\n            \\\\\\\"height\\\\\\\": self.root.winfo_height()\\\\n        }\\\\n        \\\\n        self.cfg[\\\\\\\"window_pos\\\\\\\"] = pos\\\\n        self.cfg[\\\\\\\"window_size\\\\\\\"] = size\\\\n        save_config(self.cfg)\\\\n        \\\\n        # æ£€æŸ¥æ˜¯å¦æ­£åœ¨å¤åˆ¶\\\\n        if hasattr(self, \\\\\\\"copy_manager\\\\\\\") and self.copy_manager.stop_event.is_set():\\\\n            if messagebox.askyesnocancel(\\\\\\\"ç¡®è®¤é€€å‡º\\\\\\\", \\\\\\\"æ­£åœ¨è¿›è¡Œå¤åˆ¶æ“ä½œï¼Œç¡®å®šè¦é€€å‡ºå—ï¼Ÿ\\\\\\\"):\\\\n                self.copy_manager.stop_copy()\\\\n                self.root.destroy()\\\\n        else:\\\\n            self.root.destroy()\\\\n    \\\\n    def run(self):\\\\n        \\\\\\\"\\\\\\\"\\\\\\\"è¿è¡Œåº”ç”¨\\\\\\\"\\\\\\\"\\\\\\\"\\\\n        self.root.mainloop()\\\\n\\\\n# ---------- åº”ç”¨å…¥å£ ----------\\\\nif __name__ == \\\\\\\"__main__\\\\\\\":\\\\n    # è®¾ç½®ä¸­æ–‡å­—ä½“æ”¯æŒ\\\\n    if platform.system() == \\\\\\\"Windows\\\\\\\":\\\\n        os.environ[\\\\\\\"TCL_LIBRARY\\\\\\\"] = r\\\\\\\"C:\\\\\\\\Program Files\\\\\\\\Python38\\\\\\\\tcl\\\\\\\\tcl8.6\\\\\\\"\\\\n        os.environ[\\\\\\\"TK_LIBRARY\\\\\\\"] = r\\\\\\\"C:\\\\\\\\Program Files\\\\\\\\Python38\\\\\\\\tcl\\\\\\\\tk8.6\\\\\\\"\\\\n    \\\\n    # åˆ›å»ºå¹¶è¿è¡Œåº”ç”¨\\\\n    app = ModernPhotoSorterApp()\\\\n    app.run()\",\"originAcceptText\":\"# é™ˆåŒå­¦å½±åƒç®¡ç†åŠ©æ‰‹ v2.0.0\\n# ç°ä»£UIç‰ˆæœ¬ - ä¿ç•™æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼Œå¢å¼ºè§†è§‰ä½“éªŒå’Œäº¤äº’æ€§\\n\\nimport os, sys, json, time, shutil, platform, subprocess, re\\nimport tkinter as tk\\nfrom tkinter import ttk, messagebox, filedialog, simpledialog\\nfrom datetime import datetime\\nimport threading\\nfrom PIL import Image, ImageTk, ExifTags\\nimport psutil\\nimport exifread\\nfrom typing import Dict, List, Tuple, Optional, Set\\n\\nVERSION = \\\"v2.0.0\\\"\\nCONFIG_FILE = \\\"photo_sorter_config.json\\\"\\nCATEGORIES = [\\\"å©šç¤¼\\\", \\\"å†™çœŸ\\\", \\\"æ—¥å¸¸è®°å½•\\\", \\\"æ—…æ¸¸è®°å½•\\\", \\\"å•†ä¸šæ´»åŠ¨æ‹æ‘„\\\"]\\nTHEMES = [\\\"æ—¥é—´\\\", \\\"æš—é»‘\\\"]\\n\\n# æ”¯æŒçš„æ–‡ä»¶ç±»å‹\\ndef is_raw_ext(e): return e.lower() in {\\\"cr2\\\", \\\"cr3\\\", \\\"nef\\\", \\\"nrw\\\", \\\"arw\\\", \\\"srf\\\", \\\"sr2\\\", \\\"raf\\\", \\\"rw2\\\", \\\"orf\\\", \\\"dng\\\", \\\"pef\\\", \\\"raw\\\"}\\ndef is_jpg_ext(e): return e.lower() in {\\\"jpg\\\", \\\"jpeg\\\", \\\"jpe\\\"}\\ndef is_video_ext(e): return e.lower() in {\\\"mp4\\\", \\\"mov\\\", \\\"avi\\\", \\\"mkv\\\", \\\"wmv\\\"}\\ndef is_image_ext(e): return is_raw_ext(e) or is_jpg_ext(e)\\n\\n# æç¤ºéŸ³åŠŸèƒ½\\ntry:\\n    import winsound\\n    def beep_start(): winsound.MessageBeep(winsound.MB_ICONASTERISK)\\n    def beep_done():  winsound.MessageBeep(winsound.MB_ICONEXCLAMATION)\\nexcept Exception:\\n    def beep_start(): pass\\n    def beep_done():  pass\\n\\n# ---------- å·¥å…·å‡½æ•° ----------\\ndef ts(): return datetime.now().strftime(\\\"%H:%M:%S\\\")\\n\\ndef bytes_to_human(n) -> str:\\n    try: n = int(n)\\n    except Exception: return \\\"N/A\\\"\\n    units = [\\\"B\\\", \\\"KB\\\", \\\"MB\\\", \\\"GB\\\", \\\"TB\\\", \\\"PB\\\", \\\"EB\\\"]\\n    i = 0; v = float(n)\\n    while v >= 1024.0 and i < len(units) - 1:\\n        v /= 1024.0; i += 1\\n    return f\\\"{v:.2f} {units[i]}\\\"\\n\\ndef get_drive_type_code(letter):\\n    import ctypes\\n    try: return ctypes.windll.kernel32.GetDriveTypeW(letter + \\\"\\\\\\\\\\\")\\n    except Exception: return 0\\n\\ndef drive_type_name(code): return {2:\\\"ç§»åŠ¨\\\",3:\\\"å›ºå®š\\\",4:\\\"ç½‘ç»œ\\\",5:\\\"å…‰é©±\\\",6:\\\"RAM\\\"}.get(code,\\\"æœªçŸ¥\\\")\\ndef is_system_drive(letter): return letter.upper().startswith(os.environ.get(\\\"SystemDrive\\\",\\\"C:\\\").upper())\\ndef list_drives(): return [p.device for p in psutil.disk_partitions(all=True) if os.path.exists(p.mountpoint)]\\n\\ndef get_drive_label(letter):\\n    import ctypes\\n    try:\\n        vn=ctypes.create_unicode_buffer(1024); fs=ctypes.create_unicode_buffer(1024)\\n        sn=ctypes.c_ulong(); mcl=ctypes.c_ulong(); fl=ctypes.c_ulong()\\n        ctypes.windll.kernel32.GetVolumeInformationW(letter+\\\"\\\\\\\\\\\",vn,1024,ctypes.byref(sn),ctypes.byref(mcl),ctypes.byref(fl),fs,1024)\\n        name=vn.value.strip()\\n    except Exception: name=\\\"\\\"\\n    if not name and get_drive_type_code(letter)==2: return \\\"Uç›˜\\\"\\n    return name or \\\"(æ— åç§°)\\\"\\n\\ndef get_drive_usage_bytes(root):\\n    u=psutil.disk_usage(root); return u.total,u.free\\n\\ndef load_config():\\n    if os.path.exists(CONFIG_FILE):\\n        with open(CONFIG_FILE,\\\"r\\\",encoding=\\\"utf-8\\\") as f:\\n            cfg = json.load(f)\\n            # ç¡®ä¿é…ç½®é¡¹å­˜åœ¨\\n            if \\\"theme\\\" not in cfg: cfg[\\\"theme\\\"] = \\\"light\\\"\\n            if \\\"sash_ratio\\\" not in cfg: cfg[\\\"sash_ratio\\\"] = 0.55\\n            if \\\"window_pos\\\" not in cfg: cfg[\\\"window_pos\\\"] = {\\\"x\\\": 100, \\\"y\\\": 100}\\n            if \\\"window_size\\\" not in cfg: cfg[\\\"window_size\\\"] = {\\\"width\\\": 1000, \\\"height\\\": 720}\\n            return cfg\\n    return {\\\"last_target_root\\\": \\\"\\\", \\\"theme\\\": \\\"light\\\", \\\"sash_ratio\\\": 0.55, \\\"window_pos\\\": {\\\"x\\\": 100, \\\"y\\\": 100}, \\\"window_size\\\": {\\\"width\\\": 1000, \\\"height\\\": 720}}\\n\\ndef save_config(cfg):\\n    with open(CONFIG_FILE,\\\"w\\\",encoding=\\\"utf-8\\\") as f: json.dump(cfg,f,ensure_ascii=False,indent=2)\\n\\n# ---------- EXIF / XMPå¤„ç† ----------\\ndef _parse_exif_str(s):\\n    s=s.strip()\\n    if len(s)>=19 and s[4]==\\\":\\\" and s[7]==\\\":\\\" and s[10]==\\\" \\\" and s[13]==\\\":\\\" and s[16]==\\\":\\\" :\\n        return datetime.strptime(s[:19],\\\"%Y:%m:%d %H:%M:%S\\\")\\n    return None\\n\\ndef _exif_dt_from_jpg(p):\\n    try:\\n        im=Image.open(p); exif=im._getexif()\\n        if not exif: return None\\n        tag={ExifTags.TAGS.get(k,k):v for k,v in exif.items()}\\n        for k in(\\\"DateTimeOriginal\\\",\\\"DateTimeDigitized\\\",\\\"DateTime\\\"):\\n            v=tag.get(k)\\n            if isinstance(v,str):\\n                dt=_parse_exif_str(v)\\n                if dt: return dt\\n    except Exception: pass\\n    return None\\n\\ndef _exif_dt_from_any(p):\\n    try:\\n        with open(p,\\\"rb\\\") as f: tags=exifread.process_file(f,stop_tag=\\\"EXIF DateTimeOriginal\\\",details=False)\\n        for k in(\\\"EXIF DateTimeOriginal\\\",\\\"Image DateTime\\\",\\\"EXIF DateTimeDigitized\\\"):\\n            if k in tags:\\n                dt=_parse_exif_str(str(tags[k]))\\n                if dt: return dt\\n    except Exception: pass\\n    return None\\n\\ndef get_capture_dt(p):\\n    ext=p.rsplit(\\\".\\\",1)[-1].lower() if \\\".\\\" in p else \\\"\\\"\\n    if is_jpg_ext(ext): dt=_exif_dt_from_jpg(p) or _exif_dt_from_any(p)\\n    elif is_raw_ext(ext): dt=_exif_dt_from_any(p)\\n    else: dt=None\\n    if dt: return dt\\n    try: return datetime.fromtimestamp(os.path.getmtime(p))\\n    except Exception: return datetime.now()\\n\\n# ---------- æ˜Ÿæ ‡æ£€æµ‹ ----------\\n_XMP_RATING_PATTERNS = [\\n    re.compile(rb\\\"<xmp:Rating>\\\\s*(-?\\\\d+)\\\\s*</xmp:Rating>\\\", re.I),\\n    re.compile(rb\\\"Rating=\\\\\\\"\\\\s*(-?\\\\d+)\\\\s*\\\\\\\"\\\", re.I),\\n]\\n\\ndef _find_rating_in_bytes(b: bytes) -> int:\\n    for pat in _XMP_RATING_PATTERNS:\\n        m = pat.search(b)\\n        if m:\\n            try: return int(m.group(1))\\n            except Exception: pass\\n    return 0\\n\\ndef is_starred_file(path: str) -> bool:\\n    stem, _ = os.path.splitext(path)\\n    sidecar = stem + \\\".xmp\\\"\\n    try:\\n        if os.path.isfile(sidecar):\\n            with open(sidecar, \\\"rb\\\") as f:\\n                rating = _find_rating_in_bytes(f.read(512*1024))\\n                return rating >= 1\\n    except Exception:\\n        pass\\n    try:\\n        with open(path, \\\"rb\\\") as f:\\n            rating = _find_rating_in_bytes(f.read(1024*1024))\\n            return rating >= 1\\n    except Exception:\\n        return False\\n\\n# ---------- å…¶ä»–å·¥å…· ----------\\ndef unique_path(d, f):\\n    n, e = os.path.splitext(f); c = os.path.join(d, f); i = 1\\n    while os.path.exists(c):\\n        c = os.path.join(d, f\\\"{n}({i}){e}\\\"); i += 1\\n    return c\\n\\ndef _open_folder(p):\\n    try:\\n        if platform.system() == \\\"Windows\\\": os.startfile(p)\\n        elif platform.system() == \\\"Darwin\\\": subprocess.Popen([\\\"open\\\", p])\\n        else: subprocess.Popen([\\\"xdg-open\\\", p])\\n    except Exception:\\n        pass\\n\\n# ---------- æ—¥å¿—å¤„ç† ----------\\ndef log_init_if_empty(text_widget, line):\\n    if float(text_widget.index(\\\"end-1c\\\")) == 1.0:\\n        text_widget.configure(state=\\\"normal\\\")\\n        text_widget.insert(\\\"end\\\", f\\\"[{ts()}] {line}\\\\n\\\")\\n        text_widget.configure(state=\\\"disabled\\\")\\n\\ndef log_add(text_widget, line):\\n    text_widget.configure(state=\\\"normal\\\")\\n    text_widget.insert(\\\"end\\\", f\\\"[{ts()}] {line}\\\\n\\\")\\n    text_widget.see(\\\"end\\\")\\n    text_widget.configure(state=\\\"disabled\\\")\\n\\n# ---------- æ‰«æ/è®¡åˆ’ ----------\\ndef preflight_scan(src_root):\\n    counts = {\\\"RAW\\\": 0, \\\"JPG\\\": 0, \\\"VIDEO\\\": 0};\\n    sizes = {\\\"RAW\\\": 0, \\\"JPG\\\": 0, \\\"VIDEO\\\": 0}\\n    files = {\\\"RAW\\\": [], \\\"JPG\\\": [], \\\"VIDEO\\\": []}\\n    \\n    for root, _, fs in os.walk(src_root):\\n        for f in fs:\\n            ext = f.rsplit('.', 1)[-1].lower() if '.' in f else \\\"\\\"\\n            full = os.path.join(root, f)\\n            try: sz = os.path.getsize(full)\\n            except Exception: sz = 0\\n            \\n            if is_raw_ext(ext): \\n                counts[\\\"RAW\\\"] += 1; sizes[\\\"RAW\\\"] += sz; files[\\\"RAW\\\"].append(full)\\n            elif is_jpg_ext(ext): \\n                counts[\\\"JPG\\\"] += 1; sizes[\\\"JPG\\\"] += sz; files[\\\"JPG\\\"].append(full)\\n            elif is_video_ext(ext): \\n                counts[\\\"VIDEO\\\"] += 1; sizes[\\\"VIDEO\\\"] += sz; files[\\\"VIDEO\\\"].append(full)\\n    \\n    return counts, sizes, files\\n\\ndef build_seq_plan(photo_files, mmdd_str):\\n    entries = []\\n    for p in photo_files:\\n        ext = p.rsplit(\\\".\\\", 1)[-1].lower() if \\\".\\\" in p else \\\"\\\"\\n        stem = os.path.splitext(os.path.basename(p))[0]\\n        dt = get_capture_dt(p)\\n        entries.append({\\\"path\\\": p, \\\"ext\\\": ext, \\\"stem\\\": stem, \\\"dt\\\": dt})\\n    \\n    entries.sort(key=lambda x: (x[\\\"dt\\\"], x[\\\"stem\\\"], x[\\\"ext\\\"]))\\n    stem_to_idx = {}; seq = 0; plan = []\\n    \\n    for e in entries:\\n        if e[\\\"stem\\\"] in stem_to_idx: idx = stem_to_idx[e[\\\"stem\\\"]]\\n        else: seq += 1; idx = seq; stem_to_idx[e[\\\"stem\\\"]] = idx\\n        plan.append((e[\\\"path\\\"], f\\\"{mmdd_str}-{idx:04d}\\\", e[\\\"ext\\\"]))\\n    \\n    return plan\\n\\n# ---------- ä¸»é¢˜ç®¡ç† ----------\\nclass ThemeManager:\\n    \\\"\\\"\\\"ä¸»é¢˜ç®¡ç†å™¨ - æä¾›ç°ä»£UIçš„ä¸»é¢˜æ”¯æŒ\\\"\\\"\\\"\\n    \\n    THEMES = {\\n        \\\"light\\\": {\\n            \\\"BG\\\": \\\"#F8FAFC\\\",\\n            \\\"CARD\\\": \\\"#FFFFFF\\\",\\n            \\\"TEXT\\\": \\\"#1E293B\\\",\\n            \\\"TEXT_SECONDARY\\\": \\\"#64748B\\\",\\n            \\\"BORDER\\\": \\\"#E2E8F0\\\",\\n            \\\"PRIMARY\\\": \\\"#3B82F6\\\",  # è“è‰²ä¸»é¢˜\\n            \\\"PRIMARY_HOVER\\\": \\\"#2563EB\\\",\\n            \\\"SUCCESS\\\": \\\"#10B981\\\",  # ç»¿è‰²\\n            \\\"WARNING\\\": \\\"#F59E0B\\\",  # é»„è‰²\\n            \\\"DANGER\\\": \\\"#EF4444\\\",   # çº¢è‰²\\n            \\\"INPUT_BG\\\": \\\"#FFFFFF\\\",\\n            \\\"INPUT_FG\\\": \\\"#1E293B\\\",\\n            \\\"PROGRESS_BG\\\": \\\"#E2E8F0\\\",\\n            \\\"LOG_BG\\\": \\\"#F1F5F9\\\",\\n            \\\"SHADOW\\\": \\\"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)\\\"\\n        },\\n        \\\"dark\\\": {\\n            \\\"BG\\\": \\\"#0F172A\\\",\\n            \\\"CARD\\\": \\\"#1E293B\\\",\\n            \\\"TEXT\\\": \\\"#F8FAFC\\\",\\n            \\\"TEXT_SECONDARY\\\": \\\"#94A3B8\\\",\\n            \\\"BORDER\\\": \\\"#334155\\\",\\n            \\\"PRIMARY\\\": \\\"#3B82F6\\\",\\n            \\\"PRIMARY_HOVER\\\": \\\"#60A5FA\\\",\\n            \\\"SUCCESS\\\": \\\"#10B981\\\",\\n            \\\"WARNING\\\": \\\"#F59E0B\\\",\\n            \\\"DANGER\\\": \\\"#EF4444\\\",\\n            \\\"INPUT_BG\\\": \\\"#334155\\\",\\n            \\\"INPUT_FG\\\": \\\"#F8FAFC\\\",\\n            \\\"PROGRESS_BG\\\": \\\"#334155\\\",\\n            \\\"LOG_BG\\\": \\\"#0F172A\\\",\\n            \\\"SHADOW\\\": \\\"0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2)\\\"\\n        }\\n    }\\n    \\n    @staticmethod\\n    def apply_theme(root, theme_key, widgets=None):\\n        \\\"\\\"\\\"åº”ç”¨ä¸»é¢˜åˆ°æ ¹çª—å£å’ŒæŒ‡å®šæ§ä»¶\\\"\\\"\\\"\\n        style = ttk.Style()\\n        try: style.theme_use(\\\"clam\\\")\\n        except Exception: pass\\n        \\n        P = ThemeManager.THEMES[\\\"dark\\\" if theme_key == \\\"dark\\\" else \\\"light\\\"]\\n        \\n        # é…ç½®æ ¹çª—å£\\n        root.configure(bg=P[\\\"BG\\\"])\\n        \\n        # é…ç½®ttkæ ·å¼\\n        # æ ‡é¢˜æ ‡ç­¾\\n        style.configure(\\n            \\\"Modern.Title.TLabel\\\",\\n            background=P[\\\"BG\\\"],\\n            foreground=P[\\\"TEXT\\\"],\\n            font=(\\\"Microsoft YaHei UI\\\", 20, \\\"bold\\\"),\\n            padding=(0, 10)\\n        )\\n        \\n        # å‰¯æ ‡é¢˜æ ‡ç­¾\\n        style.configure(\\n            \\\"Modern.Subtitle.TLabel\\\",\\n            background=P[\\\"BG\\\"],\\n            foreground=P[\\\"TEXT\\\"],\\n            font=(\\\"Microsoft YaHei UI\\\", 14, \\\"bold\\\"),\\n            padding=(0, 8)\\n        )\\n        \\n        # æ­£æ–‡æ ‡ç­¾\\n        style.configure(\\n            \\\"Modern.Body.TLabel\\\",\\n            background=P[\\\"BG\\\"],\\n            foreground=P[\\\"TEXT\\\"],\\n            font=(\\\"Microsoft YaHei UI\\\", 12),\\n            padding=(0, 4)\\n        )\\n        \\n        # æ¬¡è¦æ–‡æœ¬æ ‡ç­¾\\n        style.configure(\\n            \\\"Modern.Secondary.TLabel\\\",\\n            background=P[\\\"BG\\\"],\\n            foreground=P[\\\"TEXT_SECONDARY\\\"],\\n            font=(\\\"Microsoft YaHei UI\\\", 11),\\n            padding=(0, 4)\\n        )\\n        \\n        # æ¡†æ¶æ ·å¼\\n        style.configure(\\n            \\\"Modern.Frame.TFrame\\\",\\n            background=P[\\\"BG\\\"],\\n            borderwidth=0\\n        )\\n        \\n        # å¡ç‰‡æ ·å¼\\n        style.configure(\\n            \\\"Modern.Card.TFrame\\\",\\n            background=P[\\\"CARD\\\"],\\n            borderwidth=1,\\n            relief=\\\"flat\\\",\\n            bordercolor=P[\\\"BORDER\\\"]\\n        )\\n        \\n        # ä¸»æŒ‰é’®\\n        style.configure(\\n            \\\"Modern.Primary.TButton\\\",\\n            background=P[\\\"PRIMARY\\\"],\\n            foreground=\\\"#FFFFFF\\\",\\n            font=(\\\"Microsoft YaHei UI\\\", 12, \\\"bold\\\"),\\n            padding=(12, 6),\\n            borderwidth=0,\\n            focuscolor=\\\"none\\\"\\n        )\\n        style.map(\\n            \\\"Modern.Primary.TButton\\\",\\n            background=[(\\\"active\\\", P[\\\"PRIMARY_HOVER\\\"])],\\n            relief=[(\\\"pressed\\\", \\\"flat\\\")]\\n        )\\n        \\n        # æ¬¡è¦æŒ‰é’®\\n        style.configure(\\n            \\\"Modern.Secondary.TButton\\\",\\n            background=P[\\\"BORDER\\\"],\\n            foreground=P[\\\"TEXT\\\"],\\n            font=(\\\"Microsoft YaHei UI\\\", 12),\\n            padding=(12, 6),\\n            borderwidth=0\\n        )\\n        style.map(\\n            \\\"Modern.Secondary.TButton\\\",\\n            background=[(\\\"active\\\", P[\\\"CARD\\\"])],\\n            relief=[(\\\"pressed\\\", \\\"flat\\\")]\\n        )\\n        \\n        # è¿›åº¦æ¡\\n        style.configure(\\n            \\\"Modern.Horizontal.TProgressbar\\\",\\n            troughcolor=P[\\\"PROGRESS_BG\\\"],\\n            background=P[\\\"PRIMARY\\\"],\\n            bordercolor=P[\\\"PROGRESS_BG\\\"],\\n            lightcolor=P[\\\"PRIMARY\\\"],\\n            darkcolor=P[\\\"PRIMARY\\\"],\\n            borderwidth=0\\n        )\\n        \\n        # ä¸‹æ‹‰æ¡†\\n        style.configure(\\n            \\\"Modern.TCombobox\\\",\\n            fieldbackground=P[\\\"INPUT_BG\\\"],\\n            background=P[\\\"INPUT_BG\\\"],\\n            foreground=P[\\\"INPUT_FG\\\"],\\n            bordercolor=P[\\\"BORDER\\\"],\\n            arrowcolor=P[\\\"TEXT\\\"],\\n            font=(\\\"Microsoft YaHei UI\\\", 11),\\n            padding=(6, 4)\\n        )\\n        style.map(\\n            \\\"Modern.TCombobox\\\",\\n            fieldbackground=[(\\\"readonly\\\", P[\\\"INPUT_BG\\\"])],\\n            foreground=[(\\\"readonly\\\", P[\\\"INPUT_FG\\\"])],\\n            background=[(\\\"readonly\\\", P[\\\"INPUT_BG\\\"])],\\n            arrowcolor=[(\\\"active\\\", P[\\\"PRIMARY\\\"])]\\n        )\\n        \\n        # å¤é€‰æ¡†\\n        style.configure(\\n            \\\"Modern.TCheckbutton\\\",\\n            background=P[\\\"BG\\\"],\\n            foreground=P[\\\"TEXT\\\"],\\n            font=(\\\"Microsoft YaHei UI\\\", 11)\\n        )\\n        style.map(\\n            \\\"Modern.TCheckbutton\\\",\\n            background=[(\\\"active\\\", P[\\\"BG\\\"])]\\n        )\\n        \\n        # é…ç½®è‡ªå®šä¹‰æ§ä»¶\\n        if widgets:\\n            for widget_type, widget_list in widgets.items():\\n                if widget_type == \\\"text\\\":\\n                    for text_widget in widget_list:\\n                        text_widget.configure(\\n                            bg=P[\\\"LOG_BG\\\"],\\n                            fg=P[\\\"TEXT\\\"],\\n                            insertbackground=P[\\\"TEXT\\\"],\\n                            font=(\\\"Microsoft YaHei UI\\\", 10)\\n                        )\\n                elif widget_type == \\\"canvas\\\":\\n                    for canvas in widget_list:\\n                        canvas.configure(bg=P[\\\"CARD\\\"])\\n\\n# ---------- å›¾åƒé¢„è§ˆç®¡ç†å™¨ ----------\\nclass ImagePreviewManager:\\n    \\\"\\\"\\\"å›¾åƒé¢„è§ˆç®¡ç†å™¨ - è´Ÿè´£å¤„ç†å’Œæ˜¾ç¤ºå›¾åƒé¢„è§ˆ\\\"\\\"\\\"\\n    \\n    def __init__(self, canvas, theme_manager):\\n        self.canvas = canvas\\n        self.theme_manager = theme_manager\\n        self.current_image = None\\n        self.current_thumb = None\\n        self.current_info = None\\n        \\n        # ç»‘å®šç”»å¸ƒè°ƒæ•´äº‹ä»¶\\n        self.canvas.bind(\\\"<Configure>\\\", self._on_canvas_resize)\\n    \\n    def _on_canvas_resize(self, event):\\n        \\\"\\\"\\\"ç”»å¸ƒå¤§å°æ”¹å˜æ—¶é‡æ–°æ˜¾ç¤ºé¢„è§ˆ\\\"\\\"\\\"\\n        if self.current_image:\\n            self.show_preview(self.current_image, self.current_info)\\n    \\n    def show_preview(self, image_path, info=None):\\n        \\\"\\\"\\\"æ˜¾ç¤ºå›¾åƒé¢„è§ˆ\\\"\\\"\\\"\\n        self.current_image = image_path\\n        self.current_info = info\\n        \\n        try:\\n            # æ¸…ç©ºç”»å¸ƒ\\n            self.canvas.delete(\\\"all\\\")\\n            \\n            # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”ä¸ºå›¾åƒ\\n            if not os.path.exists(image_path) or not is_image_ext(image_path.split(\\\".\\\")[-1]):\\n                self._show_placeholder(\\\"ä¸æ”¯æŒé¢„è§ˆæ­¤æ–‡ä»¶ç±»å‹\\\")\\n                return\\n            \\n            # å°è¯•æ‰“å¼€å›¾åƒ\\n            with Image.open(image_path) as img:\\n                # è·å–ç”»å¸ƒå°ºå¯¸\\n                canvas_width = self.canvas.winfo_width()\\n                canvas_height = self.canvas.winfo_height()\\n                \\n                if canvas_width <= 10 or canvas_height <= 10:  # ç”»å¸ƒå°šæœªæ¸²æŸ“\\n                    return\\n                \\n                # è®¡ç®—ç¼©æ”¾æ¯”ä¾‹\\n                max_size = (canvas_width - 40, canvas_height - 80)  # ç•™å‡ºè¾¹è·\\n                img.thumbnail(max_size, Image.Resampling.LANCZOS)\\n                \\n                # åˆ›å»ºç¼©ç•¥å›¾\\n                self.current_thumb = ImageTk.PhotoImage(img)\\n                \\n                # æ˜¾ç¤ºå›¾åƒï¼ˆå±…ä¸­ï¼‰\\n                x = (canvas_width - self.current_thumb.width()) // 2\\n                y = (canvas_height - self.current_thumb.height() - 40) // 2  # ç•™å‡ºåº•éƒ¨ä¿¡æ¯ç©ºé—´\\n                self.canvas.create_image(x, y, anchor=tk.CENTER, image=self.current_thumb)\\n                \\n                # ç»˜åˆ¶æ–‡ä»¶å\\n                filename = os.path.basename(image_path)\\n                self.canvas.create_text(\\n                    canvas_width // 2, \\n                    canvas_height - 50, \\n                    text=filename, \\n                    fill=self.theme_manager.THEMES[\\\"light\\\"][\\\"TEXT\\\"],  # ç®€åŒ–å¤„ç†ï¼Œå®é™…åº”æ ¹æ®å½“å‰ä¸»é¢˜è·å–\\n                    font=(\\\"Microsoft YaHei UI\\\", 10, \\\"bold\\\"),\\n                    width=canvas_width - 40\\n                )\\n                \\n                # ç»˜åˆ¶æ–‡ä»¶ä¿¡æ¯\\n                if info:\\n                    self.canvas.create_text(\\n                        canvas_width // 2, \\n                        canvas_height - 25, \\n                        text=info, \\n                        fill=self.theme_manager.THEMES[\\\"light\\\"][\\\"TEXT_SECONDARY\\\"],\\n                        font=(\\\"Microsoft YaHei UI\\\", 9),\\n                        width=canvas_width - 40\\n                    )\\n        \\n        except Exception as e:\\n            self._show_placeholder(\\\"æ— æ³•é¢„è§ˆå›¾åƒ\\\")\\n    \\n    def _show_placeholder(self, text):\\n        \\\"\\\"\\\"æ˜¾ç¤ºå ä½ç¬¦\\\"\\\"\\\"\\n        self.canvas.delete(\\\"all\\\")\\n        canvas_width = self.canvas.winfo_width()\\n        canvas_height = self.canvas.winfo_height()\\n        \\n        # ç»˜åˆ¶å ä½ç¬¦å›¾æ ‡ï¼ˆç®€åŒ–ä¸ºæ–‡æœ¬ï¼‰\\n        self.canvas.create_text(\\n            canvas_width // 2, \\n            canvas_height // 2, \\n            text=\\\"ğŸ“·\\\", \\n            font=(\\\"Arial\\\", 48)\\n        )\\n        \\n        # ç»˜åˆ¶æç¤ºæ–‡æœ¬\\n        self.canvas.create_text(\\n            canvas_width // 2, \\n            canvas_height // 2 + 40, \\n            text=text, \\n            fill=self.theme_manager.THEMES[\\\"light\\\"][\\\"TEXT_SECONDARY\\\"],\\n            font=(\\\"Microsoft YaHei UI\\\", 11)\\n        )\\n    \\n    def clear_preview(self):\\n        \\\"\\\"\\\"æ¸…é™¤é¢„è§ˆ\\\"\\\"\\\"\\n        self.canvas.delete(\\\"all\\\")\\n        self.current_image = None\\n        self.current_thumb = None\\n        self.current_info = None\\n        self._show_placeholder(\\\"ç­‰å¾…é¢„è§ˆ\\\")\\n\\n# ---------- å¤åˆ¶ç®¡ç†å™¨ ----------\\nclass CopyManager:\\n    \\\"\\\"\\\"å¤åˆ¶ç®¡ç†å™¨ - å¤„ç†æ–‡ä»¶å¤åˆ¶é€»è¾‘ï¼Œæ”¯æŒè¿›åº¦æŠ¥å‘Šå’Œé¢„è§ˆæ›´æ–°\\\"\\\"\\\"\\n    \\n    def __init__(self, log_widget, status_var, progress_var, preview_manager=None):\\n        self.log_widget = log_widget\\n        self.status_var = status_var\\n        self.progress_var = progress_var\\n        self.preview_manager = preview_manager\\n        self.stop_event = threading.Event()\\n        self.created_files = []\\n    \\n    def start_copy(self, src_drive, dst_letter, cfg, root, category, extract_star=False):\\n        \\\"\\\"\\\"å¼€å§‹å¤åˆ¶è¿‡ç¨‹\\\"\\\"\\\"\\n        # é‡ç½®çŠ¶æ€\\n        self.stop_event.clear()\\n        self.created_files = []\\n        \\n        # åˆ›å»ºå¹¶å¯åŠ¨çº¿ç¨‹\\n        copy_thread = threading.Thread(\\n            target=self._copy_thread,\\n            args=(src_drive, dst_letter, cfg, root, category, extract_star)\\n        )\\n        copy_thread.daemon = True\\n        copy_thread.start()\\n        \\n        return copy_thread\\n    \\n    def stop_copy(self):\\n        \\\"\\\"\\\"åœæ­¢å¤åˆ¶è¿‡ç¨‹\\\"\\\"\\\"\\n        self.stop_event.set()\\n    \\n    def _copy_thread(self, src_drive, dst_letter, cfg, root, category, extract_star):\\n        \\\"\\\"\\\"å¤åˆ¶çº¿ç¨‹å‡½æ•°\\\"\\\"\\\"\\n        try:\\n            # 1. æ”¶é›†ä¿¡æ¯å’Œåˆ›å»ºç›®å½•\\n            log_add(self.log_widget, f\\\"ç´ æç›˜ï¼š{src_drive}ï¼ˆ{get_drive_label(src_drive)} | {drive_type_name(get_drive_type_code(src_drive))}ï¼‰\\\")\\n            \\n            # 2. è·å–æ‹æ‘„åç§°\\n            shoot_name = None\\n            def ask_name():\\n                nonlocal shoot_name\\n                shoot_name = simpledialog.askstring(\\\"æœ¬æ¬¡æ‹æ‘„åç§°\\\", \\\"è¾“å…¥æ‹æ‘„åœ°ç‚¹æˆ–ä¸»é¢˜ï¼ˆå¯ä¸­æ–‡ï¼‰ï¼š\\\", parent=root)\\n            root.after(0, ask_name)\\n            \\n            # ç­‰å¾…ç”¨æˆ·è¾“å…¥\\n            while shoot_name is None and not self.stop_event.is_set():\\n                time.sleep(0.1)\\n            \\n            if self.stop_event.is_set() or not shoot_name:\\n                root.after(0, lambda: log_add(self.log_widget, \\\"ç”¨æˆ·å–æ¶ˆæ“ä½œ\\\"))\\n                return\\n            \\n            # 3. é¢„æ£€æ–‡ä»¶\\n            root.after(0, lambda: log_add(self.log_widget, \\\"å¼€å§‹é¢„æ£€æºæ–‡ä»¶â€¦\\\"))\\n            counts, sizes, files = preflight_scan(src_drive)\\n            total_files = counts[\\\"RAW\\\"] + counts[\\\"JPG\\\"] + counts[\\\"VIDEO\\\"]\\n            total_size = sizes[\\\"RAW\\\"] + sizes[\\\"JPG\\\"] + sizes[\\\"VIDEO\\\"]\\n            \\n            root.after(0, lambda: log_add(self.log_widget, \\n                f\\\"é¢„æ£€å®Œæˆ RAW:{counts['RAW']} JPG:{counts['JPG']} VIDEO:{counts['VIDEO']} åˆè®¡:{total_files} | ä½“ç§¯ {bytes_to_human(total_size)}\\\"))\\n            \\n            # 4. ç¡®è®¤å¯¹è¯æ¡†\\n            confirm = False\\n            def show_confirm():\\n                nonlocal confirm\\n                confirm = messagebox.askyesno(\\n                    \\\"ç¡®è®¤å¤åˆ¶\\\",\\n                    f\\\"é¢„æ£€å®Œæˆï¼š\\\\n\\\"\\n                f\\\"RAWï¼š{counts['RAW']}ï¼ˆ{bytes_to_human(sizes['RAW'])}ï¼‰\\\\n\\\"\\n                f\\\"JPGï¼š{counts['JPG']}ï¼ˆ{bytes_to_human(sizes['JPG'])}ï¼‰\\\\n\\\"\\n                f\\\"VIDEOï¼š{counts['VIDEO']}ï¼ˆ{bytes_to_human(sizes['VIDEO'])}ï¼‰\\\\n\\\"\\n                f\\\"åˆè®¡ï¼š{total_files}ï¼ˆ{bytes_to_human(total_size)}ï¼‰\\\\n\\\\n\\\"\\n                f\\\"å°†å¤åˆ¶åˆ°ï¼šå¹´/æ‹æ‘„ç±»å‹/MMæœˆ/MM.DD_æ‹æ‘„å/ï¼ˆRAW,JPG,VIDEOï¼ŒåŠå¯é€‰å·²æ˜Ÿæ ‡ç…§ç‰‡ï¼‰\\\\n\\\"\\n                f\\\"ç…§ç‰‡é‡å‘½åï¼šMMDD-0001 èµ·ï¼›è§†é¢‘ä¿ç•™åŸåã€‚\\\"\\n                )\\n            root.after(0, show_confirm)\\n            \\n            # ç­‰å¾…ç”¨æˆ·ç¡®è®¤\\n            while confirm is None and not self.stop_event.is_set():\\n                time.sleep(0.1)\\n            \\n            if self.stop_event.is_set() or not confirm:\\n                root.after(0, lambda: log_add(self.log_widget, \\\"ç”¨æˆ·å–æ¶ˆå¤åˆ¶\\\"))\\n                return\\n            \\n            # 5. ç¡®å®šç›®æ ‡ç›®å½•\\n            if dst_letter:\\n                target_root = dst_letter + \\\"\\\\\\\\\\\"\\n            else:\\n                target_root = cfg.get(\\\"last_target_root\\\", \\\"\\\")\\n                if not os.path.exists(target_root):\\n                    def ask_dir():\\n                        nonlocal target_root\\n                        target_root = filedialog.askdirectory(title=\\\"é€‰æ‹©ç›®æ ‡ç¡¬ç›˜æ–‡ä»¶å¤¹ï¼ˆå»ºè®®ä¸ºå¤–ç½®ç¡¬ç›˜æ ¹ç›®å½•ï¼‰\\\")\\n                    root.after(0, ask_dir)\\n                    \\n                    while target_root is None and not self.stop_event.is_set():\\n                        time.sleep(0.1)\\n                    \\n                    if self.stop_event.is_set() or not target_root:\\n                        root.after(0, lambda: log_add(self.log_widget, \\\"ç”¨æˆ·å–æ¶ˆæ“ä½œ\\\"))\\n                        return\\n            \\n            cfg[\\\"last_target_root\\\"] = target_root\\n            save_config(cfg)\\n            \\n            # æ£€æŸ¥ç›®æ ‡ç›˜ä¸æºç›˜æ˜¯å¦ç›¸åŒ\\n            if os.path.splitdrive(target_root)[0].upper() == os.path.splitdrive(src_drive)[0].upper():\\n                same_drive = False\\n                def ask_same_drive():\\n                    nonlocal same_drive\\n                    same_drive = messagebox.askyesno(\\\"é£é™©æç¤º\\\", \\\"ç›®æ ‡ç›˜ä¸ç´ æç›˜ç›¸åŒç›˜ç¬¦ï¼Œå»ºè®®ä¸åŒç‰©ç†ç›˜ã€‚ç»§ç»­ï¼Ÿ\\\")\\n                root.after(0, ask_same_drive)\\n                \\n                while same_drive is None and not self.stop_event.is_set():\\n                    time.sleep(0.1)\\n                \\n                if self.stop_event.is_set() or not same_drive:\\n                    root.after(0, lambda: log_add(self.log_widget, \\\"ç”¨æˆ·å–æ¶ˆæ“ä½œ\\\"))\\n                    return\\n            \\n            # 6. åˆ›å»ºç›®æ ‡ç›®å½•ç»“æ„\\n            today = datetime.now()\\n            year_dir = os.path.join(target_root, str(today.year))\\n            cat_dir = os.path.join(year_dir, category)\\n            month_dir = os.path.join(cat_dir, f\\\"{today.month:02d}æœˆ\\\")\\n            day_folder = f\\\"{today.month:02d}.{today.day:02d}_{shoot_name}\\\"\\n            target_dir = os.path.join(month_dir, day_folder)\\n            \\n            os.makedirs(target_dir, exist_ok=True)\\n            root.after(0, lambda: log_add(self.log_widget, f\\\"ç›®æ ‡ç›®å½•ï¼š{target_dir}\\\"))\\n            \\n            # 7. æ£€æŸ¥ç›®æ ‡ç©ºé—´\\n            try:\\n                _, dst_free = get_drive_usage_bytes(os.path.splitdrive(target_root)[0] + \\\"\\\\\\\\\\\")\\n                if dst_free < total_size:\\n                    root.after(0, lambda: log_add(self.log_widget, \\n                        f\\\"ç›®æ ‡å‰©ä½™ {bytes_to_human(dst_free)} < éœ€è¦ {bytes_to_human(total_size)}\\\"))\\n                    \\n                    space_ok = False\\n                    def ask_space():\\n                        nonlocal space_ok\\n                        space_ok = messagebox.askretrycancel(\\n                            \\\"ç©ºé—´ä¸è¶³\\\",\\n                            f\\\"ç›®æ ‡å‰©ä½™ {bytes_to_human(dst_free)}ï¼Œé¢„è®¡éœ€è¦ {bytes_to_human(total_size)}ã€‚æ¸…ç†åé‡è¯•ã€‚\\\"\\n                        )\\n                    root.after(0, ask_space)\\n                    \\n                    while space_ok is None and not self.stop_event.is_set():\\n                        time.sleep(0.1)\\n                    \\n                    if self.stop_event.is_set() or not space_ok:\\n                        root.after(0, lambda: log_add(self.log_widget, \\\"ç©ºé—´ä¸è¶³ï¼Œå–æ¶ˆæ“ä½œ\\\"))\\n                        return\\n            except Exception:\\n                pass\\n            \\n            # 8. å‡†å¤‡å¤åˆ¶\\n            log_file = os.path.join(target_dir, \\\"copy_log.txt\\\")\\n            mmdd_str = f\\\"{today.month:02d}{today.day:02d}\\\"\\n            \\n            # åˆå§‹åŒ–è¿›åº¦æ¡\\n            root.after(0, lambda: self.progress_var.set(0))\\n            root.after(0, lambda: self.status_var.set(\\\"å‡†å¤‡å¤åˆ¶â€¦\\\"))\\n            \\n            # å¼€å§‹æç¤ºéŸ³\\n            beep_start()\\n            root.after(0, lambda: log_add(self.log_widget, \\\"å¼€å§‹å¤åˆ¶â€¦\\\"))\\n            \\n            # 9. æ‰§è¡Œå¤åˆ¶\\n            self._copy_files(files, target_dir, log_file, mmdd_str, total_size, extract_star, root)\\n            \\n            # 10. å®Œæˆæ“ä½œ\\n            if not self.stop_event.is_set():\\n                root.after(0, lambda: log_add(self.log_widget, f\\\"å¤åˆ¶å®Œæˆ å…± {len(self.created_files)} ä¸ªç›®æ ‡æ–‡ä»¶\\\"))\\n                root.after(0, lambda: self.status_var.set(\\\"å¤åˆ¶å®Œæˆ\\\"))\\n                \\n                # åˆ›å»ºæ¸…å•æ–‡ä»¶\\n                ts2 = datetime.now().strftime(\\\"%Y%m%d_%H%M%S\\\")\\n                manifest = {\\n                    \\\"version\\\": VERSION,\\n                    \\\"created_at\\\": ts2,\\n                    \\\"source_drive\\\": src_drive,\\n                    \\\"target_dir\\\": target_dir,\\n                    \\\"files\\\": self.created_files\\n                }\\n                \\n                try:\\n                    with open(os.path.join(target_dir, f\\\"import_manifest_{ts2}.json\\\"), \\\"w\\\", encoding=\\\"utf-8\\\") as f:\\n                        json.dump(manifest, f, ensure_ascii=False, indent=2)\\n                except Exception:\\n                    pass\\n                \\n                # å®Œæˆæç¤ºéŸ³\\n                beep_done()\\n                \\n                # æ˜¾ç¤ºå®Œæˆçª—å£\\n                root.after(0, lambda: self._show_finish_window(root, target_dir))\\n            else:\\n                root.after(0, lambda: self.status_var.set(\\\"å·²åœæ­¢\\\"))\\n                root.after(0, lambda: log_add(self.log_widget, \\\"å¤åˆ¶å·²åœæ­¢\\\"))\\n        \\n        except Exception as e:\\n            root.after(0, lambda: log_add(self.log_widget, f\\\"é”™è¯¯ï¼š{str(e)}\\\"))\\n            root.after(0, lambda: self.status_var.set(\\\"é”™è¯¯\\\"))\\n    \\n    def _copy_files(self, src_files, dst, log_file, mmdd_str, total_bytes, extract_star, root):\\n        \\\"\\\"\\\"æ‰§è¡Œæ–‡ä»¶å¤åˆ¶ï¼Œæ˜¾ç¤ºè¿›åº¦å’Œé¢„è§ˆ\\\"\\\"\\\"\\n        created = []; done = set()\\n        \\n        # è¯»å–å·²å®Œæˆçš„æ–‡ä»¶\\n        if os.path.exists(log_file):\\n            try:\\n                with open(log_file, \\\"r\\\", encoding=\\\"utf-8\\\") as f:\\n                    for line in f:\\n                        if line.startswith(\\\"å®Œæˆ: \\\"):\\n                            done.add(line.split(\\\"å®Œæˆ: \\\", 1)[1].split(\\\" -> \\\", 1)[0].strip())\\n            except Exception:\\n                pass\\n        \\n        # å‡†å¤‡ç›®æ ‡ç›®å½•\\n        photo_files = src_files[\\\"RAW\\\"] + src_files[\\\"JPG\\\"]\\n        video_files = src_files[\\\"VIDEO\\\"]\\n        \\n        raw_dir = os.path.join(dst, \\\"RAW\\\")\\n        jpg_dir = os.path.join(dst, \\\"JPG\\\")\\n        vid_dir = os.path.join(dst, \\\"VIDEO\\\")\\n        \\n        os.makedirs(raw_dir, exist_ok=True)\\n        os.makedirs(jpg_dir, exist_ok=True)\\n        os.makedirs(vid_dir, exist_ok=True)\\n        \\n        # å‡†å¤‡æ˜Ÿæ ‡ç›®å½•\\n        star_root = os.path.join(dst, \\\"å·²æ˜Ÿæ ‡ç…§ç‰‡\\\")\\n        star_jpg = os.path.join(star_root, \\\"å·²æ˜Ÿæ ‡JPG\\\")\\n        star_raw = os.path.join(star_root, \\\"å·²æ˜Ÿæ ‡RAW\\\")\\n        \\n        if extract_star:\\n            os.makedirs(star_jpg, exist_ok=True)\\n            os.makedirs(star_raw, exist_ok=True)\\n        \\n        # æ„å»ºç…§ç‰‡é‡å‘½åè®¡åˆ’\\n        plan = build_seq_plan(photo_files, mmdd_str)\\n        final_map = {}\\n        \\n        bytes_done = 0\\n        t0 = time.time()\\n        last_preview_update = 0\\n        \\n        # æ›´æ–°çŠ¶æ€å‡½æ•°\\n        def update_status(label_text):\\n            elapsed = max(time.time() - t0, 1e-6)\\n            speed_mb = bytes_done / elapsed / (1024 * 1024)\\n            pct = (bytes_done / total_bytes * 100) if total_bytes > 0 else 0\\n            \\n            root.after(0, lambda: self.progress_var.set(min(max(pct, 0), 100)))\\n            root.after(0, lambda: self.status_var.set(\\n                f\\\"{label_text} | {bytes_to_human(bytes_done)} / {bytes_to_human(total_bytes)} | é€Ÿåº¦ {speed_mb:.2f} MB/s\\\"\\n            ))\\n        \\n        # 1. å¤åˆ¶ç…§ç‰‡\\n        for src, base, ext in plan:\\n            if self.stop_event.is_set():\\n                return\\n            \\n            if src in done:\\n                update_status(\\\"ç…§ç‰‡\\\")\\n                continue\\n            \\n            td = raw_dir if is_raw_ext(ext) else jpg_dir\\n            dst_path = unique_path(td, f\\\"{base}.{ext}\\\")\\n            \\n            try:\\n                size = 0\\n                try: size = os.path.getsize(src)\\n                except Exception: size = 0\\n                \\n                shutil.copy2(src, dst_path)\\n                created.append(dst_path)\\n                final_map[src] = dst_path\\n                \\n                with open(log_file, \\\"a\\\", encoding=\\\"utf-8\\\") as f:\\n                    f.write(f\\\"å®Œæˆ: {src} -> {os.path.basename(dst_path)}\\\\n\\\")\\n                \\n                bytes_done += size\\n                update_status(\\\"ç…§ç‰‡\\\")\\n                \\n                # æ›´æ–°æ—¥å¿—å’Œé¢„è§ˆï¼ˆé™ä½é¢‘ç‡ï¼‰\\n                current_time = time.time()\\n                if current_time - last_preview_update > 1:  # æ¯ç§’æœ€å¤šæ›´æ–°ä¸€æ¬¡é¢„è§ˆ\\n                    root.after(0, lambda dst=dst_path: log_add(self.log_widget, f\\\"å¤åˆ¶ï¼š{os.path.basename(dst)}\\\"))\\n                    \\n                    if self.preview_manager and is_jpg_ext(ext):  # åªé¢„è§ˆJPGä»¥æé«˜æ€§èƒ½\\n                        file_info = f\\\"{bytes_to_human(size)} | {os.path.basename(dst)}\\\"\\n                        root.after(0, lambda src=src, info=file_info: self.preview_manager.show_preview(src, info))\\n                    \\n                    last_preview_update = current_time\\n                    \\n            except Exception as e:\\n                with open(log_file, \\\"a\\\", encoding=\\\"utf-8\\\") as f:\\n                    f.write(f\\\"é”™è¯¯: {src} | {e}\\\\n\\\")\\n        \\n        # 2. å¤åˆ¶è§†é¢‘\\n        for src in video_files:\\n            if self.stop_event.is_set():\\n                return\\n            \\n            if src in done:\\n                update_status(\\\"è§†é¢‘\\\")\\n                continue\\n            \\n            dst_path = unique_path(vid_dir, os.path.basename(src))\\n            \\n            try:\\n                size = 0\\n                try: size = os.path.getsize(src)\\n                except Exception: size = 0\\n                \\n                shutil.copy2(src, dst_path)\\n                created.append(dst_path)\\n                \\n                with open(log_file, \\\"a\\\", encoding=\\\"utf-8\\\") as f:\\n                    f.write(f\\\"å®Œæˆ: {src} -> {os.path.basename(dst_path)}\\\\n\\\")\\n                \\n                bytes_done += size\\n                update_status(\\\"è§†é¢‘\\\")\\n                \\n                # æ›´æ–°æ—¥å¿—ï¼ˆé™ä½é¢‘ç‡ï¼‰\\n                current_time = time.time()\\n                if current_time - last_preview_update > 2:  # è§†é¢‘æ›´æ–°é¢‘ç‡æ›´ä½\\n                    root.after(0, lambda dst=dst_path: log_add(self.log_widget, f\\\"å¤åˆ¶è§†é¢‘ï¼š{os.path.basename(dst)}\\\"))\\n                    last_preview_update = current_time\\n                    \\n            except Exception as e:\\n                with open(log_file, \\\"a\\\", encoding=\\\"utf-8\\\") as f:\\n                    f.write(f\\\"é”™è¯¯: {src} | {e}\\\\n\\\")\\n        \\n        # 3. æå–æ˜Ÿæ ‡ç…§ç‰‡\\n        if extract_star and not self.stop_event.is_set():\\n            root.after(0, lambda: log_add(self.log_widget, \\\"å¼€å§‹æå–æ˜Ÿæ ‡ç…§ç‰‡â€¦\\\"))\\n            star_count = 0\\n            \\n            for src, base, ext in plan:\\n                if self.stop_event.is_set():\\n                    return\\n                \\n                try:\\n                    if is_starred_file(src):\\n                        src_copied_path = final_map.get(src, src)\\n                        if is_jpg_ext(ext):\\n                            dst_star = unique_path(star_jpg, os.path.basename(src_copied_path))\\n                        else:\\n                            dst_star = unique_path(star_raw, os.path.basename(src_copied_path))\\n                        \\n                        shutil.copy2(src_copied_path, dst_star)\\n                        created.append(dst_star)\\n                        star_count += 1\\n                        \\n                        # å¶å°”æ›´æ–°æ—¥å¿—\\n                        if star_count % 5 == 0:\\n                            root.after(0, lambda cnt=star_count: log_add(self.log_widget, f\\\"å·²æå– {cnt} ä¸ªæ˜Ÿæ ‡ç…§ç‰‡\\\"))\\n                            \\n                except Exception as e:\\n                    with open(log_file, \\\"a\\\", encoding=\\\"utf-8\\\") as f:\\n                        f.write(f\\\"æ˜Ÿæ ‡å¤åˆ¶é”™è¯¯: {src} | {e}\\\\n\\\")\\n            \\n            root.after(0, lambda cnt=star_count: log_add(self.log_widget, f\\\"æ˜Ÿæ ‡æå–å®Œæˆï¼Œå…± {cnt} ä¸ªæ–‡ä»¶\\\"))\\n        \\n        # æ›´æ–°è¿›åº¦åˆ°100%\\n        root.after(0, lambda: self.progress_var.set(100))\\n        root.after(0, lambda: self.status_var.set(\\\"å®Œæˆ\\\"))\\n        \\n        # ä¿å­˜åˆ›å»ºçš„æ–‡ä»¶åˆ—è¡¨\\n        self.created_files = created\\n    \\n    def _show_finish_window(self, root, target_dir):\\n        \\\"\\\"\\\"æ˜¾ç¤ºå®Œæˆçª—å£\\\"\\\"\\\"\\n        win = tk.Toplevel(root)\\n        win.title(\\\"å®Œæˆ\\\")\\n        win.resizable(False, False)\\n        win.transient(root)      # ç½®äºçˆ¶çª—å£ä¸Šæ–¹\\n        win.grab_set()           # è·å–ç„¦ç‚¹\\n        \\n        # åŠ è½½é…ç½®å¹¶åº”ç”¨ä¸»é¢˜\\n        try:\\n            theme_key = load_config().get(\\\"theme\\\", \\\"light\\\")\\n            ThemeManager.apply_theme(win, theme_key)\\n        except Exception:\\n            pass\\n        \\n        # çª—å£æ ·å¼\\n        P = ThemeManager.THEMES[\\\"dark\\\" if theme_key == \\\"dark\\\" else \\\"light\\\"]\\n        win.configure(bg=P[\\\"BG\\\"])\\n        \\n        # æ·»åŠ å¡ç‰‡æ•ˆæœï¼ˆé€šè¿‡Frameå®ç°ï¼‰\\n        card = ttk.Frame(win, style=\\\"Modern.Card.TFrame\\\", padding=24)\\n        card.pack(padx=10, pady=10, fill=tk.BOTH, expand=True)\\n        \\n        # æ ‡é¢˜\\n        ttk.Label(card, text=\\\"å¯¼å…¥å®Œæˆ\\\", style=\\\"Modern.Title.TLabel\\\").pack(anchor=\\\"w\\\", pady=(0, 16))\\n        \\n        # ä¿¡æ¯\\n        info_frame = ttk.Frame(card, style=\\\"Modern.Frame.TFrame\\\")\\n        info_frame.pack(fill=tk.X, pady=(0, 24))\\n        \\n        ttk.Label(info_frame, text=\\\"è¾“å‡ºç›®å½•ï¼š\\\", style=\\\"Modern.Body.TLabel\\\").grid(row=0, column=0, sticky=\\\"w\\\", pady=(0, 4))\\n        ttk.Label(info_frame, text=target_dir, style=\\\"Modern.Secondary.TLabel\\\").grid(row=0, column=1, sticky=\\\"w\\\", pady=(0, 4))\\n        \\n        # æŒ‰é’®åŒºåŸŸ\\n        btn_frame = ttk.Frame(card, style=\\\"Modern.Frame.TFrame\\\")\\n        btn_frame.pack(fill=tk.X, anchor=\\\"e\\\")\\n        \\n        def open_folder():\\n            _open_folder(target_dir)\\n            win.destroy()\\n        \\n        def undo():\\n            removed = 0\\n            for p in self.created_files:\\n                try:\\n                    if os.path.isfile(p):\\n                        os.remove(p); removed += 1\\n                except Exception:\\n                    pass\\n            \\n            # æ¸…ç†ç©ºç›®å½•\\n            for sub in [\\\"RAW\\\", \\\"JPG\\\", \\\"VIDEO\\\", \\\"å·²æ˜Ÿæ ‡ç…§ç‰‡\\\", \\\"å·²æ˜Ÿæ ‡ç…§ç‰‡\\\\\\\\å·²æ˜Ÿæ ‡JPG\\\", \\\"å·²æ˜Ÿæ ‡ç…§ç‰‡\\\\\\\\å·²æ˜Ÿæ ‡RAW\\\"]:\\n                d = os.path.join(target_dir, sub)\\n                try:\\n                    if os.path.isdir(d) and not os.listdir(d):\\n                        os.rmdir(d)\\n                except Exception:\\n                    pass\\n            \\n            try:\\n                if os.path.isdir(target_dir) and not os.listdir(target_dir):\\n                    os.rmdir(target_dir)\\n            except Exception:\\n                pass\\n            \\n            messagebox.showinfo(\\\"æ’¤é”€å®Œæˆ\\\", f\\\"å·²åˆ é™¤æœ¬æ¬¡å¯¼å…¥ç”Ÿæˆçš„ {removed} ä¸ªæ–‡ä»¶ã€‚\\\")\\n            win.destroy()\\n        \\n        # åˆ›å»ºæŒ‰é’®\\n        ttk.Button(btn_frame, text=\\\"å…³é—­\\\", style=\\\"Modern.Secondary.TButton\\\", command=win.destroy).pack(side=tk.RIGHT, padx=(0, 8))\\n        ttk.Button(btn_frame, text=\\\"æ’¤é”€æœ¬æ¬¡å¯¼å…¥\\\", style=\\\"Modern.Secondary.TButton\\\", command=undo).pack(side=tk.RIGHT, padx=(0, 8))\\n        ttk.Button(btn_frame, text=\\\"æ‰“å¼€è¾“å‡ºæ–‡ä»¶å¤¹\\\", style=\\\"Modern.Primary.TButton\\\", command=open_folder).pack(side=tk.RIGHT)\\n        \\n        # è®¡ç®—å°ºå¯¸åå±…ä¸­åˆ°çˆ¶çª—å£\\n        win.update_idletasks()\\n        self._center_on_parent(win, root)\\n    \\n    def _center_on_parent(self, child: tk.Toplevel, parent: tk.Tk):\\n        \\\"\\\"\\\"æŠŠå­çª—å£å±…ä¸­åˆ°çˆ¶çª—å£\\\"\\\"\\\"\\n        parent.update_idletasks()\\n        child.update_idletasks()\\n        \\n        pw, ph = parent.winfo_width(), parent.winfo_height()\\n        px, py = parent.winfo_rootx(), parent.winfo_rooty()\\n        cw, ch = child.winfo_width(), child.winfo_height()\\n        \\n        x = px + max((pw - cw) // 2, 0)\\n        y = py + max((ph - ch) // 2, 0)\\n        \\n        child.geometry(f\\\"+{x}+{y}\\\")\\n\\n# ---------- ä¸»åº”ç”¨ç±» ----------\\nclass ModernPhotoSorterApp:\\n    \\\"\\\"\\\"ç°ä»£UIç‰ˆæœ¬çš„å½±åƒç®¡ç†åŠ©æ‰‹åº”ç”¨ç¨‹åº\\\"\\\"\\\"\\n    \\n    def __init__(self):\\n        # åŠ è½½é…ç½®\\n        self.cfg = load_config()\\n        self.theme_key = self.cfg.get(\\\"theme\\\", \\\"light\\\")\\n        self.sash_ratio = float(self.cfg.get(\\\"sash_ratio\\\", 0.55))\\n        \\n        # åˆ›å»ºä¸»çª—å£\\n        self.root = tk.Tk()\\n        self.root.title(f\\\"é™ˆåŒå­¦å½±åƒç®¡ç†åŠ©æ‰‹  {VERSION}\\\")\\n        \\n        # æ¢å¤çª—å£ä½ç½®å’Œå¤§å°\\n        pos = self.cfg.get(\\\"window_pos\\\", {\\\"x\\\": 100, \\\"y\\\": 100})\\n        size = self.cfg.get(\\\"window_size\\\", {\\\"width\\\": 1000, \\\"height\\\": 720})\\n        self.root.geometry(f\\\"{size['width']}x{size['height']}+{pos['x']}+{pos['y']}\\\")\\n        self.root.minsize(900, 650)\\n        \\n        # åº”ç”¨ä¸»é¢˜\\n        self.theme_manager = ThemeManager\\n        self.theme_manager.apply_theme(self.root, self.theme_key)\\n        \\n        # åˆ›å»ºUIç»„ä»¶\\n        self._create_ui()\\n        \\n        # åˆå§‹åŒ–æ•°æ®\\n        self._initialize_data()\\n        \\n        # ç»‘å®šäº‹ä»¶\\n        self._bind_events()\\n    \\n    def _create_ui(self):\\n        \\\"\\\"\\\"åˆ›å»ºç”¨æˆ·ç•Œé¢\\\"\\\"\\\"\\n        # é¡¶éƒ¨æ \\n        header = ttk.Frame(self.root, style=\\\"Modern.Frame.TFrame\\\")\\n        header.pack(fill=tk.X, padx=24, pady=(16, 0))\\n        \\n        # æ ‡é¢˜å’Œä¸»é¢˜é€‰æ‹©\\n        title_frame = ttk.Frame(header, style=\\\"Modern.Frame.TFrame\\\")\\n        title_frame.pack(fill=tk.X)\\n        \\n        ttk.Label(title_frame, text=\\\"ç…§ç‰‡/è§†é¢‘å¯¼å…¥ä¸åˆ†ç±»\\\", style=\\\"Modern.Title.TLabel\\\").pack(side=tk.LEFT)\\n        \\n        theme_frame = ttk.Frame(title_frame, style=\\\"Modern.Frame.TFrame\\\")\\n        theme_frame.pack(side=tk.RIGHT, pady=8)\\n        \\n        ttk.Label(theme_frame, text=\\\"ä¸»é¢˜:\\\", style=\\\"Modern.Body.TLabel\\\").pack(side=tk.LEFT, padx=(0, 8))\\n        \\n        self.theme_box = ttk.Combobox(\\n            theme_frame, \\n            state=\\\"readonly\\\", \\n            values=THEMES, \\n            width=8,\\n            style=\\\"Modern.TCombobox\\\"\\n        )\\n        self.theme_box.pack(side=tk.LEFT)\\n        self.theme_box.set(\\\"æ—¥é—´\\\" if self.theme_key == \\\"light\\\" else \\\"æš—é»‘\\\")\\n        \\n        # ä¸»å†…å®¹åŒºåŸŸ - ä½¿ç”¨PanedWindowå®ç°å¯æ‹–åŠ¨åˆ†å‰²\\n        self.paned = ttk.Panedwindow(self.root, orient=\\\"vertical\\\")\\n        self.paned.pack(fill=tk.BOTH, expand=True, padx=24, pady=(16, 8))\\n        \\n        # ä¸Šéƒ¨ï¼šè®¾ç½®åŒºåŸŸ\\n        self.top_frame = ttk.Frame(self.paned, style=\\\"Modern.Frame.TFrame\\\")\\n        self.paned.add(self.top_frame, weight=3)\\n        \\n        # ä¸‹éƒ¨ï¼šæ—¥å¿—å’Œé¢„è§ˆåŒºåŸŸ\\n        self.bottom_frame = ttk.Frame(self.paned, style=\\\"Modern.Frame.TFrame\\\")\\n        self.paned.add(self.bottom_frame, weight=5)\\n        \\n        # ----- ä¸Šéƒ¨è®¾ç½®åŒºåŸŸ ----- #\\n        # å¯¼å…¥è®¾ç½®å¡ç‰‡\\n        import_card = ttk.Frame(self.top_frame, style=\\\"Modern.Card.TFrame\\\", padding=20)\\n        import_card.pack(fill=tk.X, pady=(0, 12))\\n        \\n        ttk.Label(import_card, text=\\\"å¯¼å…¥è®¾ç½®\\\", style=\\\"Modern.Subtitle.TLabel\\\").pack(anchor=\\\"w\\\", pady=(0, 16))\\n        \\n        # è¡¨å•å¸ƒå±€\\n        form_frame = ttk.Frame(import_card, style=\\\"Modern.Frame.TFrame\\\")\\n        form_frame.pack(fill=tk.X)\\n        \\n        # ç´ æç›˜é€‰æ‹©\\n        self._create_form_row(form_frame, \\\"é€‰æ‹©ç´ æç›˜\\\", 0)\\n        \\n        self.combo_src = ttk.Combobox(\\n            form_frame,\\n            state=\\\"readonly\\\",\\n            width=60,\\n            style=\\\"Modern.TCombobox\\\"\\n        )\\n        self.combo_src.grid(row=0, column=1, sticky=\\\"ew\\\", padx=(8, 12))\\n        \\n        self.btn_refresh_src = ttk.Button(\\n            form_frame,\\n            text=\\\"åˆ·æ–°\\\",\\n            style=\\\"Modern.Secondary.TButton\\\",\\n            command=lambda: self.refresh_sources(auto_pick=True)\\n        )\\n        self.btn_refresh_src.grid(row=0, column=2, padx=(0, 8))\\n        \\n        # ç›®æ ‡ç›˜é€‰æ‹©\\n        self._create_form_row(form_frame, \\\"æ‹·å…¥åˆ°\\\", 1)\\n        \\n        self.combo_dst = ttk.Combobox(\\n            form_frame,\\n            state=\\\"readonly\\\",\\n            width=60,\\n            style=\\\"Modern.TCombobox\\\"\\n        )\\n        self.combo_dst.grid(row=1, column=1, sticky=\\\"ew\\\", padx=(8, 12), pady=(12, 0))\\n        \\n        self.btn_refresh_dst = ttk.Button(\\n            form_frame,\\n            text=\\\"åˆ·æ–°\\\",\\n            style=\\\"Modern.Secondary.TButton\\\",\\n            command=self.refresh_dests\\n        )\\n        self.btn_refresh_dst.grid(row=1, column=2, padx=(0, 8), pady=(12, 0))\\n        \\n        # æ‹æ‘„ç±»å‹å’Œæ˜Ÿæ ‡é€‰é¡¹\\n        self._create_form_row(form_frame, \\\"æ‹æ‘„ç±»å‹\\\", 2)\\n        \\n        self.combo_cat = ttk.Combobox(\\n            form_frame,\\n            state=\\\"readonly\\\",\\n            values=CATEGORIES,\\n            width=20,\\n            style=\\\"Modern.TCombobox\\\"\\n        )\\n        self.combo_cat.grid(row=2, column=1, sticky=\\\"w\\\", padx=(8, 12), pady=(12, 0))\\n        self.combo_cat.current(0)\\n        \\n        self.star_var = tk.BooleanVar(value=False)\\n        self.chk_star = ttk.Checkbutton(\\n            form_frame,\\n            text=\\\"æå–æ˜Ÿæ ‡ç…§ç‰‡\\\",\\n            variable=self.star_var,\\n            style=\\\"Modern.TCheckbutton\\\"\\n        )\\n        self.chk_star.grid(row=2, column=2, sticky=\\\"w\\\", padx=(0, 8), pady=(12, 0))\\n        \\n        # é…ç½®åˆ—æƒé‡\\n        form_frame.columnconfigure(1, weight=1)\\n        \\n        # æ“ä½œåŒºåŸŸå¡ç‰‡\\n        action_card = ttk.Frame(self.top_frame, style=\\\"Modern.Card.TFrame\\\", padding=20)\\n        action_card.pack(fill=tk.X)\\n        \\n        # è¿›åº¦æ¡\\n        self.progress_var = tk.DoubleVar(value=0)\\n        self.progress_bar = ttk.Progressbar(\\n            action_card,\\n            variable=self.progress_var,\\n            style=\\\"Modern.Horizontal.TProgressbar\\\",\\n            orient=\\\"horizontal\\\",\\n            length=0,  # ç”±fill=tk.Xè‡ªåŠ¨å¡«å……\\n            mode=\\\"determinate\\\"\\n        )\\n        self.progress_bar.pack(fill=tk.X, pady=(0, 8))\\n        \\n        # çŠ¶æ€æ ‡ç­¾\\n        self.status_var = tk.StringVar(value=\\\"å¾…æœº\\\")\\n        self.status_label = ttk.Label(\\n            action_card,\\n            textvariable=self.status_var,\\n            style=\\\"Modern.Secondary.TLabel\\\"\\n        )\\n        self.status_label.pack(anchor=\\\"w\\\", pady=(0, 16))\\n        \\n        # æŒ‰é’®åŒºåŸŸ\\n        btn_frame = ttk.Frame(action_card, style=\\\"Modern.Frame.TFrame\\\")\\n        btn_frame.pack(fill=tk.X, anchor=\\\"e\\\")\\n        \\n        self.btn_exit = ttk.Button(\\n            btn_frame,\\n            text=\\\"é€€å‡º\\\",\\n            style=\\\"Modern.Secondary.TButton\\\",\\n            command=self.root.destroy\\n        )\\n        self.btn_exit.pack(side=tk.RIGHT, padx=(0, 8))\\n        \\n        self.btn_stop = ttk.Button(\\n            btn_frame,\\n            text=\\\"åœæ­¢\\\",\\n            style=\\\"Modern.Secondary.TButton\\\",\\n            command=self.stop_action,\\n            state=tk.DISABLED\\n        )\\n        self.btn_stop.pack(side=tk.RIGHT, padx=(0, 8))\\n        \\n        self.btn_start = ttk.Button(\\n            btn_frame,\\n            text=\\\"å¼€å§‹åˆ†ç±»\\\",\\n            style=\\\"Modern.Primary.TButton\\\",\\n            command=self.start_action\\n        )\\n        self.btn_start.pack(side=tk.RIGHT)\\n        \\n        # ----- ä¸‹éƒ¨æ—¥å¿—å’Œé¢„è§ˆåŒºåŸŸ ----- #\\n        # åˆ›å»ºæ°´å¹³åˆ†å‰²çš„é¢æ¿\\n        self.bottom_paned = ttk.Panedwindow(self.bottom_frame, orient=\\\"horizontal\\\")\\n        self.bottom_paned.pack(fill=tk.BOTH, expand=True)\\n        \\n        # å·¦ä¾§ï¼šé¢„è§ˆåŒºåŸŸ\\n        preview_frame = ttk.Frame(self.bottom_paned, style=\\\"Modern.Frame.TFrame\\\")\\n        self.bottom_paned.add(preview_frame, weight=1)\\n        \\n        # é¢„è§ˆå¡ç‰‡\\n        preview_card = ttk.Frame(preview_frame, style=\\\"Modern.Card.TFrame\\\", padding=16)\\n        preview_card.pack(fill=tk.BOTH, expand=True, pady=(0, 12))\\n        \\n        ttk.Label(preview_card, text=\\\"å›¾åƒé¢„è§ˆ\\\", style=\\\"Modern.Subtitle.TLabel\\\").pack(anchor=\\\"w\\\", pady=(0, 12))\\n        \\n        # é¢„è§ˆç”»å¸ƒ\\n        self.preview_canvas = tk.Canvas(\\n            preview_card,\\n            relief=\\\"flat\\\",\\n            highlightthickness=0\\n        )\\n        self.preview_canvas.pack(fill=tk.BOTH, expand=True)\\n        \\n        # å³ä¾§ï¼šæ—¥å¿—åŒºåŸŸ\\n        log_frame = ttk.Frame(self.bottom_paned, style=\\\"Modern.Frame.TFrame\\\")\\n        self.bottom_paned.add(log_frame, weight=1)\\n        \\n        # æ—¥å¿—å¡ç‰‡\\n        log_card = ttk.Frame(log_frame, style=\\\"Modern.Card.TFrame\\\", padding=16)\\n        log_card.pack(fill=tk.BOTH, expand=True, pady=(0, 12))\\n        \\n        ttk.Label(log_card, text=\\\"ä¿¡æ¯æ—¥å¿—\\\", style=\\\"Modern.Subtitle.TLabel\\\").pack(anchor=\\\"w\\\", pady=(0, 12))\\n        \\n        # æ—¥å¿—æ–‡æœ¬æ¡†\\n        self.info_box = tk.Text(\\n            log_card,\\n            wrap=\\\"word\\\",\\n            bd=0,\\n            relief=\\\"flat\\\",\\n            state=\\\"disabled\\\",\\n            highlightthickness=0\\n        )\\n        self.info_box.pack(fill=tk.BOTH, expand=True, side=tk.LEFT)\\n        \\n        # æ»šåŠ¨æ¡\\n        self.log_scrollbar = ttk.Scrollbar(\\n            log_card,\\n            command=self.info_box.yview\\n        )\\n        self.log_scrollbar.pack(side=tk.RIGHT, fill=tk.Y)\\n        \\n        self.info_box.configure(yscrollcommand=self.log_scrollbar.set)\\n        \\n        # åº•éƒ¨ç‰ˆæƒä¿¡æ¯\\n        footer = ttk.Label(\\n            self.root,\\n            text=\\\"æ­¤è½¯ä»¶å®Œå…¨å…è´¹ï¼Œè¯·å‹¿å€’å–ï¼ by: æŠ–éŸ³@æ‘„å½±å¸ˆé™ˆåŒå­¦\\\",\\n            style=\\\"Modern.Secondary.TLabel\\\",\\n            anchor=\\\"center\\\"\\n        )\\n        footer.pack(fill=tk.X, pady=(0, 12))\\n    \\n    def _create_form_row(self, parent, label_text, row):\\n        \\\"\\\"\\\"åˆ›å»ºè¡¨å•è¡Œ\\\"\\\"\\\"\\n        ttk.Label(\\n            parent,\\n            text=label_text,\\n            style=\\\"Modern.Body.TLabel\\\"\\n        ).grid(row=row, column=0, sticky=\\\"e\\\", pady=(row > 0 and 12 or 0, 0))\\n    \\n    def _initialize_data(self):\\n        \\\"\\\"\\\"åˆå§‹åŒ–æ•°æ®\\\"\\\"\\\"\\n        # åˆ›å»ºå›¾åƒé¢„è§ˆç®¡ç†å™¨\\n        self.preview_manager = ImagePreviewManager(self.preview_canvas, self.theme_manager)\\n        self.preview_manager.clear_preview()\\n        \\n        # åˆ›å»ºå¤åˆ¶ç®¡ç†å™¨\\n        self.copy_manager = CopyManager(\\n            self.info_box,\\n            self.status_var,\\n            self.progress_var,\\n            self.preview_manager\\n        )\\n        \\n        # åˆå§‹åŒ–é©±åŠ¨å™¨åˆ—è¡¨\\n        self.refresh_sources(auto_pick=True)\\n    \\n    def _bind_events(self):\\n        \\\"\\\"\\\"ç»‘å®šäº‹ä»¶å¤„ç†ç¨‹åº\\\"\\\"\\\"\\n        # ä¸»é¢˜åˆ‡æ¢\\n        self.theme_box.bind(\\\"<<ComboboxSelected>>\\\", self.on_theme_change)\\n        \\n        # çª—å£å…³é—­äº‹ä»¶\\n        self.root.protocol(\\\"WM_DELETE_WINDOW\\\", self.on_window_close)\\n        \\n        # åˆ†å‰²çª—æ‹–åŠ¨äº‹ä»¶\\n        self.paned.bind(\\\"<ButtonRelease-1>\\\", self.remember_sash)\\n        self.root.bind(\\\"<Configure>\\\", lambda e: self.root.after(50, self.remember_sash))\\n        \\n        # åº”ç”¨åˆ†å‰²æ¯”ä¾‹\\n        self.root.after(300, self.apply_sash_ratio_later)\\n        \\n        # ç‰ˆæƒæç¤º\\n        self.root.after(500, self.show_copyright)\\n    \\n    def refresh_sources(self, auto_pick=False):\\n        \\\"\\\"\\\"åˆ·æ–°æºé©±åŠ¨å™¨åˆ—è¡¨\\\"\\\"\\\"\\n        all_drives = list_drives()\\n        removable = []; src_vals = []\\n        \\n        for d in all_drives:\\n            tname = drive_type_name(get_drive_type_code(d))\\n            if get_drive_type_code(d) == 2: removable.append(d)\\n            tag = \\\"(ç³»ç»Ÿ)\\\" if is_system_drive(d) else \\\"\\\"\\n            src_vals.append(f\\\"{d}  |  åç§°: {get_drive_label(d)}  |  ç±»å‹: {tname}{tag}\\\")\\n        \\n        self.combo_src[\\\"values\\\"] = src_vals\\n        \\n        if auto_pick and removable:\\n            pick = removable[0]\\n            for i, s in enumerate(src_vals):\\n                if s.startswith(pick): \\n                    self.combo_src.current(i)\\n                    break\\n        \\n        log_init_if_empty(self.info_box, \\\"æ—¥å¿—å·²å¯åŠ¨\\\")\\n        \\n        if removable:\\n            log_add(self.info_box, f\\\"å‘ç°ç§»åŠ¨ç›˜ï¼š{', '.join(removable)}\\\")\\n        else:\\n            log_add(self.info_box, \\\"æœªæ£€æµ‹åˆ°ç§»åŠ¨ç›˜\\\")\\n    \\n    def refresh_dests(self):\\n        \\\"\\\"\\\"åˆ·æ–°ç›®æ ‡é©±åŠ¨å™¨åˆ—è¡¨\\\"\\\"\\\"\\n        vals = []\\n        for p in psutil.disk_partitions(all=False):\\n            letter = p.device.rstrip(\\\"\\\\\\\\\\\")\\n            if get_drive_type_code(letter) != 3: continue\\n            \\n            total, free = get_drive_usage_bytes(letter + \\\"\\\\\\\\\\\")\\n            label = get_drive_label(letter)\\n            vals.append(f\\\"{letter} {label}ï¼ˆ{bytes_to_human(free)} / {bytes_to_human(total)}ï¼‰\\\")\\n        \\n        self.combo_dst[\\\"values\\\"] = vals\\n        log_add(self.info_box, \\\"å·²åˆ·æ–°ç›®æ ‡å›ºå®šç£ç›˜åˆ—è¡¨\\\")\\n    \\n    def start_action(self):\\n        \\\"\\\"\\\"å¼€å§‹åˆ†ç±»æ“ä½œ\\\"\\\"\\\"\\n        # æ£€æŸ¥æºè®¾å¤‡\\n        sv = self.combo_src.get()\\n        if not sv:\\n            messagebox.showwarning(\\\"æç¤º\\\", \\\"è¯·å…ˆé€‰æ‹©ç´ æç›˜ã€‚\\\")\\n            return\\n        \\n        src_drive = sv.split(\\\"|\\\", 1)[0].strip()\\n        \\n        # æ£€æŸ¥æºè®¾å¤‡ç±»å‹\\n        dtype = drive_type_name(get_drive_type_code(src_drive))\\n        \\n        # ç³»ç»Ÿç›˜è­¦å‘Š\\n        if is_system_drive(src_drive):\\n            if not messagebox.askyesno(\\\"é«˜é£é™©ç¡®è®¤\\\", f\\\"{src_drive} æ˜¯ç³»ç»Ÿç›˜ï¼Œä¸å»ºè®®ä½œä¸ºç´ æç›˜æºã€‚ç»§ç»­ï¼Ÿ\\\"):\\n                return\\n            if not messagebox.askyesno(\\\"äºŒæ¬¡ç¡®è®¤\\\", \\\"å†æ¬¡ç¡®è®¤ä»ç³»ç»Ÿç›˜ä½œä¸ºç›¸æœºæºå¤åˆ¶ï¼Ÿ\\\"):\\n                return\\n        elif get_drive_type_code(src_drive) != 2:\\n            if not messagebox.askyesno(\\\"å›ºå®šç£ç›˜è­¦å‘Š\\\", f\\\"{src_drive} ä¸ºå›ºå®šç›˜ï¼Œé€šå¸¸åº”é€‰ç§»åŠ¨ç›˜ã€‚ç»§ç»­ï¼Ÿ\\\"):\\n                return\\n        \\n        # è·å–ç›®æ ‡é©±åŠ¨å™¨\\n        dst_letter = \\\"\\\"\\n        if self.combo_dst.get():\\n            dst_letter = self.combo_dst.get().split(\\\" \\\", 1)[0].strip().rstrip(\\\"\\\\\\\\\\\")\\n        \\n        # æ›´æ–°æŒ‰é’®çŠ¶æ€\\n        self.btn_start.config(state=tk.DISABLED)\\n        self.btn_stop.config(state=tk.NORMAL)\\n        \\n        # å¯åŠ¨å¤åˆ¶çº¿ç¨‹\\n        copy_thread = self.copy_manager.start_copy(\\n            src_drive,\\n            dst_letter,\\n            self.cfg,\\n            self.root,\\n            self.combo_cat.get().strip(),\\n            extract_star=self.star_var.get()\\n        )\\n        \\n        # ç›‘æ§çº¿ç¨‹å®Œæˆ\\n        def check_thread():\\n            if copy_thread.is_alive():\\n                self.root.after(500, check_thread)\\n            else:\\n                # æ¢å¤æŒ‰é’®çŠ¶æ€\\n                self.btn_start.config(state=tk.NORMAL)\\n                self.btn_stop.config(state=tk.DISABLED)\\n        \\n        self.root.after(500, check_thread)\\n    \\n    def stop_action(self):\\n        \\\"\\\"\\\"åœæ­¢æ“ä½œ\\\"\\\"\\\"\\n        self.copy_manager.stop_copy()\\n        self.status_var.set(\\\"æ­£åœ¨åœæ­¢...\\\")\\n    \\n    def on_theme_change(self, event=None):\\n        \\\"\\\"\\\"ä¸»é¢˜åˆ‡æ¢å¤„ç†\\\"\\\"\\\"\\n        sel = self.theme_box.get()\\n        key = \\\"light\\\" if sel == \\\"æ—¥é—´\\\" else \\\"dark\\\"\\n        \\n        self.cfg[\\\"theme\\\"] = key\\n        save_config(self.cfg)\\n        \\n        # åº”ç”¨æ–°ä¸»é¢˜\\n        self.theme_manager.apply_theme(\\n            self.root,\\n            key,\\n            widgets={\\n                \\\"text\\\": [self.info_box],\\n                \\\"canvas\\\": [self.preview_canvas]\\n            }\\n        )\\n    \\n    def remember_sash(self, event=None):\\n        \\\"\\\"\\\"è®°ä½åˆ†å‰²çª—å£ä½ç½®\\\"\\\"\\\"\\n        try:\\n            self.root.update_idletasks()\\n            total_h = self.paned.winfo_height()\\n            pos = self.paned.sashpos(0)\\n            ratio = round(pos / max(total_h, 1), 4)\\n            \\n            self.cfg[\\\"sash_ratio\\\"] = max(0.15, min(0.85, ratio))\\n            save_config(self.cfg)\\n        except Exception:\\n            pass\\n    \\n    def apply_sash_ratio_later(self):\\n        \\\"\\\"\\\"å»¶è¿Ÿåº”ç”¨åˆ†å‰²æ¯”ä¾‹\\\"\\\"\\\"\\n        try:\\n            self.root.update_idletasks()\\n            total_h = self.paned.winfo_height()\\n            \\n            if total_h <= 0:\\n                self.root.after(100, self.apply_sash_ratio_later)\\n                return\\n            \\n            pos = int(total_h * self.sash_ratio)\\n            self.paned.sashpos(0, pos)\\n        except Exception:\\n            pass\\n    \\n    def show_copyright(self):\\n        \\\"\\\"\\\"æ˜¾ç¤ºç‰ˆæƒä¿¡æ¯\\\"\\\"\\\"\\n        log_add(self.info_box, \\\"=== é™ˆåŒå­¦å½±åƒç®¡ç†åŠ©æ‰‹ v2.0.0 ===\\\")\\n        log_add(self.info_box, \\\"å®Œå…¨å…è´¹ï¼Œç¦æ­¢å•†ç”¨æˆ–å€’å–ï¼\\\")\\n        log_add(self.info_box, \\\"ä½œè€…ï¼šæŠ–éŸ³@æ‘„å½±å¸ˆé™ˆåŒå­¦\\\")\\n    \\n    def on_window_close(self):\\n        \\\"\\\"\\\"çª—å£å…³é—­äº‹ä»¶å¤„ç†\\\"\\\"\\\"\\n        # ä¿å­˜çª—å£ä½ç½®å’Œå¤§å°\\n        pos = {\\n            \\\"x\\\": self.root.winfo_x(),\\n            \\\"y\\\": self.root.winfo_y()\\n        }\\n        \\n        size = {\\n            \\\"width\\\": self.root.winfo_width(),\\n            \\\"height\\\": self.root.winfo_height()\\n        }\\n        \\n        self.cfg[\\\"window_pos\\\"] = pos\\n        self.cfg[\\\"window_size\\\"] = size\\n        save_config(self.cfg)\\n        \\n        # æ£€æŸ¥æ˜¯å¦æ­£åœ¨å¤åˆ¶\\n        if hasattr(self, \\\"copy_manager\\\") and self.copy_manager.stop_event.is_set():\\n            if messagebox.askyesnocancel(\\\"ç¡®è®¤é€€å‡º\\\", \\\"æ­£åœ¨è¿›è¡Œå¤åˆ¶æ“ä½œï¼Œç¡®å®šè¦é€€å‡ºå—ï¼Ÿ\\\"):\\n                self.copy_manager.stop_copy()\\n                self.root.destroy()\\n        else:\\n            self.root.destroy()\\n    \\n    def run(self):\\n        \\\"\\\"\\\"è¿è¡Œåº”ç”¨\\\"\\\"\\\"\\n        self.root.mainloop()\\n\\n# ---------- åº”ç”¨å…¥å£ ----------\\nif __name__ == \\\"__main__\\\":\\n    # è®¾ç½®ä¸­æ–‡å­—ä½“æ”¯æŒ\\n    if platform.system() == \\\"Windows\\\":\\n        os.environ[\\\"TCL_LIBRARY\\\"] = r\\\"C:\\\\Program Files\\\\Python38\\\\tcl\\\\tcl8.6\\\"\\n        os.environ[\\\"TK_LIBRARY\\\"] = r\\\"C:\\\\Program Files\\\\Python38\\\\tcl\\\\tk8.6\\\"\\n    \\n    # åˆ›å»ºå¹¶è¿è¡Œåº”ç”¨\\n    app = ModernPhotoSorterApp()\\n    app.run()\",\"originTextLength\":52471,\"aiScene\":\"builder\",\"behaviorType\":\"accept\",\"updateTime\":1761281556214},{\"originRange\":{\"start\":{\"line\":594,\"character\":0},\"end\":{\"line\":599,\"character\":48}},\"modifyRange\":{\"start\":{\"line\":594,\"character\":0},\"end\":{\"line\":599,\"character\":48}},\"action\":\"None\",\"isLine\":false,\"originText\":\"                    f\\\\\\\"RAWï¼š{counts[\\\\'RAW\\\\']}ï¼ˆ{bytes_to_human(sizes[\\\\'RAW\\\\'])}ï¼‰\\\\\\\\n\\\\\\\"\\\\n                    f\\\\\\\"JPGï¼š{counts[\\\\'JPG\\\\']}ï¼ˆ{bytes_to_human(sizes[\\\\'JPG\\\\'])}ï¼‰\\\\\\\\n\\\\\\\"\\\\n                    f\\\\\\\"VIDEOï¼š{counts[\\\\'VIDEO\\\\']}ï¼ˆ{bytes_to_human(sizes[\\\\'VIDEO\\\\'])}ï¼‰\\\\\\\\n\\\\\\\"\\\\n                    f\\\\\\\"åˆè®¡ï¼š{total_files}ï¼ˆ{bytes_to_human(total_size)}ï¼‰\\\\\\\\n\\\\\\\\n\\\\\\\"\\\\n                    f\\\\\\\"å°†å¤åˆ¶åˆ°ï¼šå¹´/æ‹æ‘„ç±»å‹/MMæœˆ/MM.DD_æ‹æ‘„å/ï¼ˆRAW,JPG,VIDEOï¼ŒåŠå¯é€‰å·²æ˜Ÿæ ‡ç…§ç‰‡ï¼‰\\\\\\\\n\\\\\\\"\\\\n                    f\\\\\\\"ç…§ç‰‡é‡å‘½åï¼šMMDD-0001 èµ·ï¼›è§†é¢‘ä¿ç•™åŸåã€‚\\\\\\\"\",\"originAcceptText\":\"                    f\\\"RAWï¼š{counts['RAW']}ï¼ˆ{bytes_to_human(sizes['RAW'])}ï¼‰\\\\n\\\"\\n                    f\\\"JPGï¼š{counts['JPG']}ï¼ˆ{bytes_to_human(sizes['JPG'])}ï¼‰\\\\n\\\"\\n                    f\\\"VIDEOï¼š{counts['VIDEO']}ï¼ˆ{bytes_to_human(sizes['VIDEO'])}ï¼‰\\\\n\\\"\\n                    f\\\"åˆè®¡ï¼š{total_files}ï¼ˆ{bytes_to_human(total_size)}ï¼‰\\\\n\\\\n\\\"\\n                    f\\\"å°†å¤åˆ¶åˆ°ï¼šå¹´/æ‹æ‘„ç±»å‹/MMæœˆ/MM.DD_æ‹æ‘„å/ï¼ˆRAW,JPG,VIDEOï¼ŒåŠå¯é€‰å·²æ˜Ÿæ ‡ç…§ç‰‡ï¼‰\\\\n\\\"\\n                    f\\\"ç…§ç‰‡é‡å‘½åï¼šMMDD-0001 èµ·ï¼›è§†é¢‘ä¿ç•™åŸåã€‚\\\"\",\"originTextLength\":435,\"aiScene\":\"builder\",\"behaviorType\":\"accept\",\"updateTime\":1761281648314},{\"originRange\":{\"start\":{\"line\":1479,\"character\":0},\"end\":{\"line\":1479,\"character\":0}},\"modifyRange\":{\"start\":{\"line\":1479,\"character\":0},\"end\":{\"line\":1479,\"character\":0}},\"action\":\"None\",\"isLine\":false,\"originText\":\"\",\"originAcceptText\":\"\",\"originTextLength\":0,\"aiScene\":\"builder\",\"behaviorType\":\"accept\",\"updateTime\":1761281648326}]"
}
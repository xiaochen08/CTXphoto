"use strict";var fp=Object.create;var Cs=Object.defineProperty;var hp=Object.getOwnPropertyDescriptor;var mp=Object.getOwnPropertyNames;var vp=Object.getPrototypeOf,gp=Object.prototype.hasOwnProperty;var De=(s,e)=>()=>(s&&(e=s(s=0)),e);var X=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),nn=(s,e)=>{for(var r in e)Cs(s,r,{get:e[r],enumerable:!0})},Ho=(s,e,r,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of mp(e))!gp.call(s,t)&&t!==r&&Cs(s,t,{get:()=>e[t],enumerable:!(a=hp(e,t))||a.enumerable});return s};var z=(s,e,r)=>(r=s!=null?fp(vp(s)):{},Ho(e||!s||!s.__esModule?Cs(r,"default",{value:s,enumerable:!0}):r,s)),yp=s=>Ho(Cs({},"__esModule",{value:!0}),s);function Oe(){return Go.workspace.getConfiguration("chatgpt")}var Go,Jo,Qo,Ko,$t=De(()=>{"use strict";Go=z(require("vscode")),Jo="apiEndpoint",Qo="logLevel",Ko="useExperimentalMcpLspServer"});var ks=De(()=>{"use strict"});function As(s){return Xo[s]<=Xo[Pp]}function xp(){let s=Yo.window.createOutputChannel("Codex",{log:!0});return{trace:(r,...a)=>{As("trace")&&s.trace(r,...a)},debug:(r,...a)=>{As("debug")&&s.debug(r,...a)},info:(r,...a)=>{As("info")&&s.info(r,...a)},error:(r,...a)=>{s.error(r,...a)},warn:(r,...a)=>{As("warning")&&s.warn(r,...a)},dispose:()=>s.dispose()}}var Yo,bp,Pp,Xo,R,we=De(()=>{"use strict";$t();ks();Yo=z(require("vscode")),bp="warning",Pp=Oe().get(Qo)??bp,Xo={error:0,warning:1,info:2,debug:3,trace:4};R=xp()});var hc=X((va,fc)=>{(function(s,e){typeof va=="object"&&typeof fc<"u"?e(va):typeof define=="function"&&define.amd?define(["exports"],e):e(s.URI=s.URI||{})})(va,function(s){"use strict";function e(){for(var y=arguments.length,f=Array(y),P=0;P<y;P++)f[P]=arguments[P];if(f.length>1){f[0]=f[0].slice(0,-1);for(var w=f.length-1,_=1;_<w;++_)f[_]=f[_].slice(1,-1);return f[w]=f[w].slice(1),f.join("")}else return f[0]}function r(y){return"(?:"+y+")"}function a(y){return y===void 0?"undefined":y===null?"null":Object.prototype.toString.call(y).split(" ").pop().split("]").shift().toLowerCase()}function t(y){return y.toUpperCase()}function n(y){return y!=null?y instanceof Array?y:typeof y.length!="number"||y.split||y.setInterval||y.call?[y]:Array.prototype.slice.call(y):[]}function o(y,f){var P=y;if(f)for(var w in f)P[w]=f[w];return P}function i(y){var f="[A-Za-z]",P="[\\x0D]",w="[0-9]",_="[\\x22]",j=e(w,"[A-Fa-f]"),re="[\\x0A]",ie="[\\x20]",de=r(r("%[EFef]"+j+"%"+j+j+"%"+j+j)+"|"+r("%[89A-Fa-f]"+j+"%"+j+j)+"|"+r("%"+j+j)),Te="[\\:\\/\\?\\#\\[\\]\\@]",ne="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",ye=e(Te,ne),ke=y?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]",ve=y?"[\\uE000-\\uF8FF]":"[]",le=e(f,w,"[\\-\\.\\_\\~]",ke),be=r(f+e(f,w,"[\\+\\-\\.]")+"*"),pe=r(r(de+"|"+e(le,ne,"[\\:]"))+"*"),Kt=r(r("25[0-5]")+"|"+r("2[0-4]"+w)+"|"+r("1"+w+w)+"|"+r("[1-9]"+w)+"|"+w),Je=r(r("25[0-5]")+"|"+r("2[0-4]"+w)+"|"+r("1"+w+w)+"|"+r("0?[1-9]"+w)+"|0?0?"+w),et=r(Je+"\\."+Je+"\\."+Je+"\\."+Je),fe=r(j+"{1,4}"),Qe=r(r(fe+"\\:"+fe)+"|"+et),tt=r(r(fe+"\\:")+"{6}"+Qe),mt=r("\\:\\:"+r(fe+"\\:")+"{5}"+Qe),Xt=r(r(fe)+"?\\:\\:"+r(fe+"\\:")+"{4}"+Qe),Et=r(r(r(fe+"\\:")+"{0,1}"+fe)+"?\\:\\:"+r(fe+"\\:")+"{3}"+Qe),Kr=r(r(r(fe+"\\:")+"{0,2}"+fe)+"?\\:\\:"+r(fe+"\\:")+"{2}"+Qe),Es=r(r(r(fe+"\\:")+"{0,3}"+fe)+"?\\:\\:"+fe+"\\:"+Qe),Ss=r(r(r(fe+"\\:")+"{0,4}"+fe)+"?\\:\\:"+Qe),_r=r(r(r(fe+"\\:")+"{0,5}"+fe)+"?\\:\\:"+fe),Er=r(r(r(fe+"\\:")+"{0,6}"+fe)+"?\\:\\:"),St=r([tt,mt,Xt,Et,Kr,Es,Ss,_r,Er].join("|")),Sr=r(r(le+"|"+de)+"+"),sn=r(St+"\\%25"+Sr),Yt=r(St+r("\\%25|\\%(?!"+j+"{2})")+Sr),op=r("[vV]"+j+"+\\."+e(le,ne,"[\\:]")+"+"),ip=r("\\["+r(Yt+"|"+St+"|"+op)+"\\]"),jo=r(r(de+"|"+e(le,ne))+"*"),Xr=r(ip+"|"+et+"(?!"+jo+")|"+jo),Yr=r(w+"*"),qo=r(r(pe+"@")+"?"+Xr+r("\\:"+Yr)+"?"),es=r(de+"|"+e(le,ne,"[\\:\\@]")),cp=r(es+"*"),Uo=r(es+"+"),lp=r(r(de+"|"+e(le,ne,"[\\@]"))+"+"),Rt=r(r("\\/"+cp)+"*"),Rr=r("\\/"+r(Uo+Rt)+"?"),an=r(lp+Rt),Rs=r(Uo+Rt),Cr="(?!"+es+")",Tg=r(Rt+"|"+Rr+"|"+an+"|"+Rs+"|"+Cr),Tr=r(r(es+"|"+e("[\\/\\?]",ve))+"*"),ts=r(r(es+"|[\\/\\?]")+"*"),Vo=r(r("\\/\\/"+qo+Rt)+"|"+Rr+"|"+Rs+"|"+Cr),up=r(be+"\\:"+Vo+r("\\?"+Tr)+"?"+r("\\#"+ts)+"?"),dp=r(r("\\/\\/"+qo+Rt)+"|"+Rr+"|"+an+"|"+Cr),pp=r(dp+r("\\?"+Tr)+"?"+r("\\#"+ts)+"?"),kg=r(up+"|"+pp),Ag=r(be+"\\:"+Vo+r("\\?"+Tr)+"?"),Ig="^("+be+")\\:"+r(r("\\/\\/("+r("("+pe+")@")+"?("+Xr+")"+r("\\:("+Yr+")")+"?)")+"?("+Rt+"|"+Rr+"|"+Rs+"|"+Cr+")")+r("\\?("+Tr+")")+"?"+r("\\#("+ts+")")+"?$",Og="^(){0}"+r(r("\\/\\/("+r("("+pe+")@")+"?("+Xr+")"+r("\\:("+Yr+")")+"?)")+"?("+Rt+"|"+Rr+"|"+an+"|"+Cr+")")+r("\\?("+Tr+")")+"?"+r("\\#("+ts+")")+"?$",$g="^("+be+")\\:"+r(r("\\/\\/("+r("("+pe+")@")+"?("+Xr+")"+r("\\:("+Yr+")")+"?)")+"?("+Rt+"|"+Rr+"|"+Rs+"|"+Cr+")")+r("\\?("+Tr+")")+"?$",Dg="^"+r("\\#("+ts+")")+"?$",Ng="^"+r("("+pe+")@")+"?("+Xr+")"+r("\\:("+Yr+")")+"?$";return{NOT_SCHEME:new RegExp(e("[^]",f,w,"[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(e("[^\\%\\:]",le,ne),"g"),NOT_HOST:new RegExp(e("[^\\%\\[\\]\\:]",le,ne),"g"),NOT_PATH:new RegExp(e("[^\\%\\/\\:\\@]",le,ne),"g"),NOT_PATH_NOSCHEME:new RegExp(e("[^\\%\\/\\@]",le,ne),"g"),NOT_QUERY:new RegExp(e("[^\\%]",le,ne,"[\\:\\@\\/\\?]",ve),"g"),NOT_FRAGMENT:new RegExp(e("[^\\%]",le,ne,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(e("[^]",le,ne),"g"),UNRESERVED:new RegExp(le,"g"),OTHER_CHARS:new RegExp(e("[^\\%]",le,ye),"g"),PCT_ENCODED:new RegExp(de,"g"),IPV4ADDRESS:new RegExp("^("+et+")$"),IPV6ADDRESS:new RegExp("^\\[?("+St+")"+r(r("\\%25|\\%(?!"+j+"{2})")+"("+Sr+")")+"?\\]?$")}}var l=i(!1),u=i(!0),p=function(){function y(f,P){var w=[],_=!0,j=!1,re=void 0;try{for(var ie=f[Symbol.iterator](),de;!(_=(de=ie.next()).done)&&(w.push(de.value),!(P&&w.length===P));_=!0);}catch(Te){j=!0,re=Te}finally{try{!_&&ie.return&&ie.return()}finally{if(j)throw re}}return w}return function(f,P){if(Array.isArray(f))return f;if(Symbol.iterator in Object(f))return y(f,P);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=function(y){if(Array.isArray(y)){for(var f=0,P=Array(y.length);f<y.length;f++)P[f]=y[f];return P}else return Array.from(y)},m=2147483647,d=36,v=1,b=26,g=38,x=700,S=72,E=128,C="-",I=/^xn--/,O=/[^\0-\x7E]/,B=/[\x2E\u3002\uFF0E\uFF61]/g,V={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},$=d-v,H=Math.floor,U=String.fromCharCode;function q(y){throw new RangeError(V[y])}function k(y,f){for(var P=[],w=y.length;w--;)P[w]=f(y[w]);return P}function D(y,f){var P=y.split("@"),w="";P.length>1&&(w=P[0]+"@",y=P[1]),y=y.replace(B,".");var _=y.split("."),j=k(_,f).join(".");return w+j}function M(y){for(var f=[],P=0,w=y.length;P<w;){var _=y.charCodeAt(P++);if(_>=55296&&_<=56319&&P<w){var j=y.charCodeAt(P++);(j&64512)==56320?f.push(((_&1023)<<10)+(j&1023)+65536):(f.push(_),P--)}else f.push(_)}return f}var Z=function(f){return String.fromCodePoint.apply(String,h(f))},N=function(f){return f-48<10?f-22:f-65<26?f-65:f-97<26?f-97:d},J=function(f,P){return f+22+75*(f<26)-((P!=0)<<5)},te=function(f,P,w){var _=0;for(f=w?H(f/x):f>>1,f+=H(f/P);f>$*b>>1;_+=d)f=H(f/$);return H(_+($+1)*f/(f+g))},G=function(f){var P=[],w=f.length,_=0,j=E,re=S,ie=f.lastIndexOf(C);ie<0&&(ie=0);for(var de=0;de<ie;++de)f.charCodeAt(de)>=128&&q("not-basic"),P.push(f.charCodeAt(de));for(var Te=ie>0?ie+1:0;Te<w;){for(var ne=_,ye=1,ke=d;;ke+=d){Te>=w&&q("invalid-input");var ve=N(f.charCodeAt(Te++));(ve>=d||ve>H((m-_)/ye))&&q("overflow"),_+=ve*ye;var le=ke<=re?v:ke>=re+b?b:ke-re;if(ve<le)break;var be=d-le;ye>H(m/be)&&q("overflow"),ye*=be}var pe=P.length+1;re=te(_-ne,pe,ne==0),H(_/pe)>m-j&&q("overflow"),j+=H(_/pe),_%=pe,P.splice(_++,0,j)}return String.fromCodePoint.apply(String,P)},Pe=function(f){var P=[];f=M(f);var w=f.length,_=E,j=0,re=S,ie=!0,de=!1,Te=void 0;try{for(var ne=f[Symbol.iterator](),ye;!(ie=(ye=ne.next()).done);ie=!0){var ke=ye.value;ke<128&&P.push(U(ke))}}catch(Yt){de=!0,Te=Yt}finally{try{!ie&&ne.return&&ne.return()}finally{if(de)throw Te}}var ve=P.length,le=ve;for(ve&&P.push(C);le<w;){var be=m,pe=!0,Kt=!1,Je=void 0;try{for(var et=f[Symbol.iterator](),fe;!(pe=(fe=et.next()).done);pe=!0){var Qe=fe.value;Qe>=_&&Qe<be&&(be=Qe)}}catch(Yt){Kt=!0,Je=Yt}finally{try{!pe&&et.return&&et.return()}finally{if(Kt)throw Je}}var tt=le+1;be-_>H((m-j)/tt)&&q("overflow"),j+=(be-_)*tt,_=be;var mt=!0,Xt=!1,Et=void 0;try{for(var Kr=f[Symbol.iterator](),Es;!(mt=(Es=Kr.next()).done);mt=!0){var Ss=Es.value;if(Ss<_&&++j>m&&q("overflow"),Ss==_){for(var _r=j,Er=d;;Er+=d){var St=Er<=re?v:Er>=re+b?b:Er-re;if(_r<St)break;var Sr=_r-St,sn=d-St;P.push(U(J(St+Sr%sn,0))),_r=H(Sr/sn)}P.push(U(J(_r,0))),re=te(j,tt,le==ve),j=0,++le}}}catch(Yt){Xt=!0,Et=Yt}finally{try{!mt&&Kr.return&&Kr.return()}finally{if(Xt)throw Et}}++j,++_}return P.join("")},Me=function(f){return D(f,function(P){return I.test(P)?G(P.slice(4).toLowerCase()):P})},qe=function(f){return D(f,function(P){return O.test(P)?"xn--"+Pe(P):P})},ce={version:"2.1.0",ucs2:{decode:M,encode:Z},decode:G,encode:Pe,toASCII:qe,toUnicode:Me},Re={};function Ie(y){var f=y.charCodeAt(0),P=void 0;return f<16?P="%0"+f.toString(16).toUpperCase():f<128?P="%"+f.toString(16).toUpperCase():f<2048?P="%"+(f>>6|192).toString(16).toUpperCase()+"%"+(f&63|128).toString(16).toUpperCase():P="%"+(f>>12|224).toString(16).toUpperCase()+"%"+(f>>6&63|128).toString(16).toUpperCase()+"%"+(f&63|128).toString(16).toUpperCase(),P}function Ue(y){for(var f="",P=0,w=y.length;P<w;){var _=parseInt(y.substr(P+1,2),16);if(_<128)f+=String.fromCharCode(_),P+=3;else if(_>=194&&_<224){if(w-P>=6){var j=parseInt(y.substr(P+4,2),16);f+=String.fromCharCode((_&31)<<6|j&63)}else f+=y.substr(P,6);P+=6}else if(_>=224){if(w-P>=9){var re=parseInt(y.substr(P+4,2),16),ie=parseInt(y.substr(P+7,2),16);f+=String.fromCharCode((_&15)<<12|(re&63)<<6|ie&63)}else f+=y.substr(P,9);P+=9}else f+=y.substr(P,3),P+=3}return f}function It(y,f){function P(w){var _=Ue(w);return _.match(f.UNRESERVED)?_:w}return y.scheme&&(y.scheme=String(y.scheme).replace(f.PCT_ENCODED,P).toLowerCase().replace(f.NOT_SCHEME,"")),y.userinfo!==void 0&&(y.userinfo=String(y.userinfo).replace(f.PCT_ENCODED,P).replace(f.NOT_USERINFO,Ie).replace(f.PCT_ENCODED,t)),y.host!==void 0&&(y.host=String(y.host).replace(f.PCT_ENCODED,P).toLowerCase().replace(f.NOT_HOST,Ie).replace(f.PCT_ENCODED,t)),y.path!==void 0&&(y.path=String(y.path).replace(f.PCT_ENCODED,P).replace(y.scheme?f.NOT_PATH:f.NOT_PATH_NOSCHEME,Ie).replace(f.PCT_ENCODED,t)),y.query!==void 0&&(y.query=String(y.query).replace(f.PCT_ENCODED,P).replace(f.NOT_QUERY,Ie).replace(f.PCT_ENCODED,t)),y.fragment!==void 0&&(y.fragment=String(y.fragment).replace(f.PCT_ENCODED,P).replace(f.NOT_FRAGMENT,Ie).replace(f.PCT_ENCODED,t)),y}function wt(y){return y.replace(/^0*(.*)/,"$1")||"0"}function Ce(y,f){var P=y.match(f.IPV4ADDRESS)||[],w=p(P,2),_=w[1];return _?_.split(".").map(wt).join("."):y}function xe(y,f){var P=y.match(f.IPV6ADDRESS)||[],w=p(P,3),_=w[1],j=w[2];if(_){for(var re=_.toLowerCase().split("::").reverse(),ie=p(re,2),de=ie[0],Te=ie[1],ne=Te?Te.split(":").map(wt):[],ye=de.split(":").map(wt),ke=f.IPV4ADDRESS.test(ye[ye.length-1]),ve=ke?7:8,le=ye.length-ve,be=Array(ve),pe=0;pe<ve;++pe)be[pe]=ne[pe]||ye[le+pe]||"";ke&&(be[ve-1]=Ce(be[ve-1],f));var Kt=be.reduce(function(tt,mt,Xt){if(!mt||mt==="0"){var Et=tt[tt.length-1];Et&&Et.index+Et.length===Xt?Et.length++:tt.push({index:Xt,length:1})}return tt},[]),Je=Kt.sort(function(tt,mt){return mt.length-tt.length})[0],et=void 0;if(Je&&Je.length>1){var fe=be.slice(0,Je.index),Qe=be.slice(Je.index+Je.length);et=fe.join(":")+"::"+Qe.join(":")}else et=be.join(":");return j&&(et+="%"+j),et}else return y}var Gt=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,Fe="".match(/(){0}/)[1]===void 0;function ue(y){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},P={},w=f.iri!==!1?u:l;f.reference==="suffix"&&(y=(f.scheme?f.scheme+":":"")+"//"+y);var _=y.match(Gt);if(_){Fe?(P.scheme=_[1],P.userinfo=_[3],P.host=_[4],P.port=parseInt(_[5],10),P.path=_[6]||"",P.query=_[7],P.fragment=_[8],isNaN(P.port)&&(P.port=_[5])):(P.scheme=_[1]||void 0,P.userinfo=y.indexOf("@")!==-1?_[3]:void 0,P.host=y.indexOf("//")!==-1?_[4]:void 0,P.port=parseInt(_[5],10),P.path=_[6]||"",P.query=y.indexOf("?")!==-1?_[7]:void 0,P.fragment=y.indexOf("#")!==-1?_[8]:void 0,isNaN(P.port)&&(P.port=y.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?_[4]:void 0)),P.host&&(P.host=xe(Ce(P.host,w),w)),P.scheme===void 0&&P.userinfo===void 0&&P.host===void 0&&P.port===void 0&&!P.path&&P.query===void 0?P.reference="same-document":P.scheme===void 0?P.reference="relative":P.fragment===void 0?P.reference="absolute":P.reference="uri",f.reference&&f.reference!=="suffix"&&f.reference!==P.reference&&(P.error=P.error||"URI is not a "+f.reference+" reference.");var j=Re[(f.scheme||P.scheme||"").toLowerCase()];if(!f.unicodeSupport&&(!j||!j.unicodeSupport)){if(P.host&&(f.domainHost||j&&j.domainHost))try{P.host=ce.toASCII(P.host.replace(w.PCT_ENCODED,Ue).toLowerCase())}catch(re){P.error=P.error||"Host's domain name can not be converted to ASCII via punycode: "+re}It(P,l)}else It(P,w);j&&j.parse&&j.parse(P,f)}else P.error=P.error||"URI can not be parsed.";return P}function Ot(y,f){var P=f.iri!==!1?u:l,w=[];return y.userinfo!==void 0&&(w.push(y.userinfo),w.push("@")),y.host!==void 0&&w.push(xe(Ce(String(y.host),P),P).replace(P.IPV6ADDRESS,function(_,j,re){return"["+j+(re?"%25"+re:"")+"]"})),(typeof y.port=="number"||typeof y.port=="string")&&(w.push(":"),w.push(String(y.port))),w.length?w.join(""):void 0}var _t=/^\.\.?\//,Jt=/^\/\.(\/|$)/,Qt=/^\/\.\.(\/|$)/,$e=/^\/?(?:.|\n)*?(?=\/|$)/;function Ye(y){for(var f=[];y.length;)if(y.match(_t))y=y.replace(_t,"");else if(y.match(Jt))y=y.replace(Jt,"/");else if(y.match(Qt))y=y.replace(Qt,"/"),f.pop();else if(y==="."||y==="..")y="";else{var P=y.match($e);if(P){var w=P[0];y=y.slice(w.length),f.push(w)}else throw new Error("Unexpected dot segment condition")}return f.join("")}function We(y){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},P=f.iri?u:l,w=[],_=Re[(f.scheme||y.scheme||"").toLowerCase()];if(_&&_.serialize&&_.serialize(y,f),y.host&&!P.IPV6ADDRESS.test(y.host)){if(f.domainHost||_&&_.domainHost)try{y.host=f.iri?ce.toUnicode(y.host):ce.toASCII(y.host.replace(P.PCT_ENCODED,Ue).toLowerCase())}catch(ie){y.error=y.error||"Host's domain name can not be converted to "+(f.iri?"Unicode":"ASCII")+" via punycode: "+ie}}It(y,P),f.reference!=="suffix"&&y.scheme&&(w.push(y.scheme),w.push(":"));var j=Ot(y,f);if(j!==void 0&&(f.reference!=="suffix"&&w.push("//"),w.push(j),y.path&&y.path.charAt(0)!=="/"&&w.push("/")),y.path!==void 0){var re=y.path;!f.absolutePath&&(!_||!_.absolutePath)&&(re=Ye(re)),j===void 0&&(re=re.replace(/^\/\//,"/%2F")),w.push(re)}return y.query!==void 0&&(w.push("?"),w.push(y.query)),y.fragment!==void 0&&(w.push("#"),w.push(y.fragment)),w.join("")}function Ve(y,f){var P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},w=arguments[3],_={};return w||(y=ue(We(y,P),P),f=ue(We(f,P),P)),P=P||{},!P.tolerant&&f.scheme?(_.scheme=f.scheme,_.userinfo=f.userinfo,_.host=f.host,_.port=f.port,_.path=Ye(f.path||""),_.query=f.query):(f.userinfo!==void 0||f.host!==void 0||f.port!==void 0?(_.userinfo=f.userinfo,_.host=f.host,_.port=f.port,_.path=Ye(f.path||""),_.query=f.query):(f.path?(f.path.charAt(0)==="/"?_.path=Ye(f.path):((y.userinfo!==void 0||y.host!==void 0||y.port!==void 0)&&!y.path?_.path="/"+f.path:y.path?_.path=y.path.slice(0,y.path.lastIndexOf("/")+1)+f.path:_.path=f.path,_.path=Ye(_.path)),_.query=f.query):(_.path=y.path,f.query!==void 0?_.query=f.query:_.query=y.query),_.userinfo=y.userinfo,_.host=y.host,_.port=y.port),_.scheme=y.scheme),_.fragment=f.fragment,_}function ft(y,f,P){var w=o({scheme:"null"},P);return We(Ve(ue(y,w),ue(f,w),w,!0),w)}function Ge(y,f){return typeof y=="string"?y=We(ue(y,f),f):a(y)==="object"&&(y=ue(We(y,f),f)),y}function _s(y,f,P){return typeof y=="string"?y=We(ue(y,P),P):a(y)==="object"&&(y=We(y,P)),typeof f=="string"?f=We(ue(f,P),P):a(f)==="object"&&(f=We(f,P)),y===f}function tn(y,f){return y&&y.toString().replace(!f||!f.iri?l.ESCAPE:u.ESCAPE,Ie)}function it(y,f){return y&&y.toString().replace(!f||!f.iri?l.PCT_ENCODED:u.PCT_ENCODED,Ue)}var Jr={scheme:"http",domainHost:!0,parse:function(f,P){return f.host||(f.error=f.error||"HTTP URIs must have a host."),f},serialize:function(f,P){var w=String(f.scheme).toLowerCase()==="https";return(f.port===(w?443:80)||f.port==="")&&(f.port=void 0),f.path||(f.path="/"),f}},Io={scheme:"https",domainHost:Jr.domainHost,parse:Jr.parse,serialize:Jr.serialize};function Oo(y){return typeof y.secure=="boolean"?y.secure:String(y.scheme).toLowerCase()==="wss"}var Qr={scheme:"ws",domainHost:!0,parse:function(f,P){var w=f;return w.secure=Oo(w),w.resourceName=(w.path||"/")+(w.query?"?"+w.query:""),w.path=void 0,w.query=void 0,w},serialize:function(f,P){if((f.port===(Oo(f)?443:80)||f.port==="")&&(f.port=void 0),typeof f.secure=="boolean"&&(f.scheme=f.secure?"wss":"ws",f.secure=void 0),f.resourceName){var w=f.resourceName.split("?"),_=p(w,2),j=_[0],re=_[1];f.path=j&&j!=="/"?j:void 0,f.query=re,f.resourceName=void 0}return f.fragment=void 0,f}},$o={scheme:"wss",domainHost:Qr.domainHost,parse:Qr.parse,serialize:Qr.serialize},Gd={},Jd=!0,Do="[A-Za-z0-9\\-\\.\\_\\~"+(Jd?"\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF":"")+"]",ht="[0-9A-Fa-f]",Qd=r(r("%[EFef]"+ht+"%"+ht+ht+"%"+ht+ht)+"|"+r("%[89A-Fa-f]"+ht+"%"+ht+ht)+"|"+r("%"+ht+ht)),Kd="[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]",Xd="[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",Yd=e(Xd,'[\\"\\\\]'),ep="[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]",tp=new RegExp(Do,"g"),wr=new RegExp(Qd,"g"),rp=new RegExp(e("[^]",Kd,"[\\.]",'[\\"]',Yd),"g"),No=new RegExp(e("[^]",Do,ep),"g"),sp=No;function rn(y){var f=Ue(y);return f.match(tp)?f:y}var Mo={scheme:"mailto",parse:function(f,P){var w=f,_=w.to=w.path?w.path.split(","):[];if(w.path=void 0,w.query){for(var j=!1,re={},ie=w.query.split("&"),de=0,Te=ie.length;de<Te;++de){var ne=ie[de].split("=");switch(ne[0]){case"to":for(var ye=ne[1].split(","),ke=0,ve=ye.length;ke<ve;++ke)_.push(ye[ke]);break;case"subject":w.subject=it(ne[1],P);break;case"body":w.body=it(ne[1],P);break;default:j=!0,re[it(ne[0],P)]=it(ne[1],P);break}}j&&(w.headers=re)}w.query=void 0;for(var le=0,be=_.length;le<be;++le){var pe=_[le].split("@");if(pe[0]=it(pe[0]),P.unicodeSupport)pe[1]=it(pe[1],P).toLowerCase();else try{pe[1]=ce.toASCII(it(pe[1],P).toLowerCase())}catch(Kt){w.error=w.error||"Email address's domain name can not be converted to ASCII via punycode: "+Kt}_[le]=pe.join("@")}return w},serialize:function(f,P){var w=f,_=n(f.to);if(_){for(var j=0,re=_.length;j<re;++j){var ie=String(_[j]),de=ie.lastIndexOf("@"),Te=ie.slice(0,de).replace(wr,rn).replace(wr,t).replace(rp,Ie),ne=ie.slice(de+1);try{ne=P.iri?ce.toUnicode(ne):ce.toASCII(it(ne,P).toLowerCase())}catch(le){w.error=w.error||"Email address's domain name can not be converted to "+(P.iri?"Unicode":"ASCII")+" via punycode: "+le}_[j]=Te+"@"+ne}w.path=_.join(",")}var ye=f.headers=f.headers||{};f.subject&&(ye.subject=f.subject),f.body&&(ye.body=f.body);var ke=[];for(var ve in ye)ye[ve]!==Gd[ve]&&ke.push(ve.replace(wr,rn).replace(wr,t).replace(No,Ie)+"="+ye[ve].replace(wr,rn).replace(wr,t).replace(sp,Ie));return ke.length&&(w.query=ke.join("&")),w}},ap=/^([^\:]+)\:(.*)/,Fo={scheme:"urn",parse:function(f,P){var w=f.path&&f.path.match(ap),_=f;if(w){var j=P.scheme||_.scheme||"urn",re=w[1].toLowerCase(),ie=w[2],de=j+":"+(P.nid||re),Te=Re[de];_.nid=re,_.nss=ie,_.path=void 0,Te&&(_=Te.parse(_,P))}else _.error=_.error||"URN can not be parsed.";return _},serialize:function(f,P){var w=P.scheme||f.scheme||"urn",_=f.nid,j=w+":"+(P.nid||_),re=Re[j];re&&(f=re.serialize(f,P));var ie=f,de=f.nss;return ie.path=(_||P.nid)+":"+de,ie}},np=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,Lo={scheme:"urn:uuid",parse:function(f,P){var w=f;return w.uuid=w.nss,w.nss=void 0,!P.tolerant&&(!w.uuid||!w.uuid.match(np))&&(w.error=w.error||"UUID is not valid."),w},serialize:function(f,P){var w=f;return w.nss=(f.uuid||"").toLowerCase(),w}};Re[Jr.scheme]=Jr,Re[Io.scheme]=Io,Re[Qr.scheme]=Qr,Re[$o.scheme]=$o,Re[Mo.scheme]=Mo,Re[Fo.scheme]=Fo,Re[Lo.scheme]=Lo,s.SCHEMES=Re,s.pctEncChar=Ie,s.pctDecChars=Ue,s.parse=ue,s.removeDotSegments=Ye,s.serialize=We,s.resolveComponents=Ve,s.resolve=ft,s.normalize=Ge,s.equal=_s,s.escapeComponent=tn,s.unescapeComponent=it,Object.defineProperty(s,"__esModule",{value:!0})})});var ga=X((gP,mc)=>{"use strict";mc.exports=function s(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var a,t,n;if(Array.isArray(e)){if(a=e.length,a!=r.length)return!1;for(t=a;t--!==0;)if(!s(e[t],r[t]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(n=Object.keys(e),a=n.length,a!==Object.keys(r).length)return!1;for(t=a;t--!==0;)if(!Object.prototype.hasOwnProperty.call(r,n[t]))return!1;for(t=a;t--!==0;){var o=n[t];if(!s(e[o],r[o]))return!1}return!0}return e!==e&&r!==r}});var gc=X((yP,vc)=>{"use strict";vc.exports=function(e){for(var r=0,a=e.length,t=0,n;t<a;)r++,n=e.charCodeAt(t++),n>=55296&&n<=56319&&t<a&&(n=e.charCodeAt(t),(n&64512)==56320&&t++);return r}});var gr=X((bP,Pc)=>{"use strict";Pc.exports={copy:ym,checkDataType:zn,checkDataTypes:bm,coerceToTypes:Pm,toHash:Zn,getProperty:Gn,escapeQuotes:Jn,equal:ga(),ucs2length:gc(),varOccurences:_m,varReplace:Em,schemaHasRules:Sm,schemaHasRulesExcept:Rm,schemaUnknownRules:Cm,toQuotedString:Bn,getPathExpr:Tm,getPath:km,getData:Om,unescapeFragment:$m,unescapeJsonPointer:Kn,escapeFragment:Dm,escapeJsonPointer:Qn};function ym(s,e){e=e||{};for(var r in s)e[r]=s[r];return e}function zn(s,e,r,a){var t=a?" !== ":" === ",n=a?" || ":" && ",o=a?"!":"",i=a?"":"!";switch(s){case"null":return e+t+"null";case"array":return o+"Array.isArray("+e+")";case"object":return"("+o+e+n+"typeof "+e+t+'"object"'+n+i+"Array.isArray("+e+"))";case"integer":return"(typeof "+e+t+'"number"'+n+i+"("+e+" % 1)"+n+e+t+e+(r?n+o+"isFinite("+e+")":"")+")";case"number":return"(typeof "+e+t+'"'+s+'"'+(r?n+o+"isFinite("+e+")":"")+")";default:return"typeof "+e+t+'"'+s+'"'}}function bm(s,e,r){switch(s.length){case 1:return zn(s[0],e,r,!0);default:var a="",t=Zn(s);t.array&&t.object&&(a=t.null?"(":"(!"+e+" || ",a+="typeof "+e+' !== "object")',delete t.null,delete t.array,delete t.object),t.number&&delete t.integer;for(var n in t)a+=(a?" && ":"")+zn(n,e,r,!0);return a}}var yc=Zn(["string","number","integer","boolean","null"]);function Pm(s,e){if(Array.isArray(e)){for(var r=[],a=0;a<e.length;a++){var t=e[a];(yc[t]||s==="array"&&t==="array")&&(r[r.length]=t)}if(r.length)return r}else{if(yc[e])return[e];if(s==="array"&&e==="array")return["array"]}}function Zn(s){for(var e={},r=0;r<s.length;r++)e[s[r]]=!0;return e}var xm=/^[a-z$_][a-z$_0-9]*$/i,wm=/'|\\/g;function Gn(s){return typeof s=="number"?"["+s+"]":xm.test(s)?"."+s:"['"+Jn(s)+"']"}function Jn(s){return s.replace(wm,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}function _m(s,e){e+="[^0-9]";var r=s.match(new RegExp(e,"g"));return r?r.length:0}function Em(s,e,r){return e+="([^0-9])",r=r.replace(/\$/g,"$$$$"),s.replace(new RegExp(e,"g"),r+"$1")}function Sm(s,e){if(typeof s=="boolean")return!s;for(var r in s)if(e[r])return!0}function Rm(s,e,r){if(typeof s=="boolean")return!s&&r!="not";for(var a in s)if(a!=r&&e[a])return!0}function Cm(s,e){if(typeof s!="boolean"){for(var r in s)if(!e[r])return r}}function Bn(s){return"'"+Jn(s)+"'"}function Tm(s,e,r,a){var t=r?"'/' + "+e+(a?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):a?"'[' + "+e+" + ']'":"'[\\'' + "+e+" + '\\']'";return bc(s,t)}function km(s,e,r){var a=Bn(r?"/"+Qn(e):Gn(e));return bc(s,a)}var Am=/^\/(?:[^~]|~0|~1)*$/,Im=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function Om(s,e,r){var a,t,n,o;if(s==="")return"rootData";if(s[0]=="/"){if(!Am.test(s))throw new Error("Invalid JSON-pointer: "+s);t=s,n="rootData"}else{if(o=s.match(Im),!o)throw new Error("Invalid JSON-pointer: "+s);if(a=+o[1],t=o[2],t=="#"){if(a>=e)throw new Error("Cannot access property/index "+a+" levels up, current level is "+e);return r[e-a]}if(a>e)throw new Error("Cannot access data "+a+" levels up, current level is "+e);if(n="data"+(e-a||""),!t)return n}for(var i=n,l=t.split("/"),u=0;u<l.length;u++){var p=l[u];p&&(n+=Gn(Kn(p)),i+=" && "+n)}return i}function bc(s,e){return s=='""'?e:(s+" + "+e).replace(/([^\\])' \+ '/g,"$1")}function $m(s){return Kn(decodeURIComponent(s))}function Dm(s){return encodeURIComponent(Qn(s))}function Qn(s){return s.replace(/~/g,"~0").replace(/\//g,"~1")}function Kn(s){return s.replace(/~1/g,"/").replace(/~0/g,"~")}});var Xn=X((PP,xc)=>{"use strict";var Nm=gr();xc.exports=Mm;function Mm(s){Nm.copy(s,this)}});var _c=X((xP,wc)=>{"use strict";var Vt=wc.exports=function(s,e,r){typeof e=="function"&&(r=e,e={}),r=e.cb||r;var a=typeof r=="function"?r:r.pre||function(){},t=r.post||function(){};ya(e,a,t,s,"",s)};Vt.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0};Vt.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};Vt.propsKeywords={definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};Vt.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function ya(s,e,r,a,t,n,o,i,l,u){if(a&&typeof a=="object"&&!Array.isArray(a)){e(a,t,n,o,i,l,u);for(var p in a){var h=a[p];if(Array.isArray(h)){if(p in Vt.arrayKeywords)for(var m=0;m<h.length;m++)ya(s,e,r,h[m],t+"/"+p+"/"+m,n,t,p,a,m)}else if(p in Vt.propsKeywords){if(h&&typeof h=="object")for(var d in h)ya(s,e,r,h[d],t+"/"+p+"/"+Fm(d),n,t,p,a,d)}else(p in Vt.keywords||s.allKeys&&!(p in Vt.skipKeywords))&&ya(s,e,r,h,t+"/"+p,n,t,p,a)}r(a,t,n,o,i,l,u)}}function Fm(s){return s.replace(/~/g,"~0").replace(/\//g,"~1")}});var Ea=X((wP,Cc)=>{"use strict";var ms=hc(),Ec=ga(),wa=gr(),ba=Xn(),Lm=_c();Cc.exports=Wt;Wt.normalizeId=Ht;Wt.fullPath=Pa;Wt.url=xa;Wt.ids=Hm;Wt.inlineRef=Yn;Wt.schema=_a;function Wt(s,e,r){var a=this._refs[r];if(typeof a=="string")if(this._refs[a])a=this._refs[a];else return Wt.call(this,s,e,a);if(a=a||this._schemas[r],a instanceof ba)return Yn(a.schema,this._opts.inlineRefs)?a.schema:a.validate||this._compile(a);var t=_a.call(this,e,r),n,o,i;return t&&(n=t.schema,e=t.root,i=t.baseId),n instanceof ba?o=n.validate||s.call(this,n.schema,e,void 0,i):n!==void 0&&(o=Yn(n,this._opts.inlineRefs)?n:s.call(this,n,e,void 0,i)),o}function _a(s,e){var r=ms.parse(e),a=Rc(r),t=Pa(this._getId(s.schema));if(Object.keys(s.schema).length===0||a!==t){var n=Ht(a),o=this._refs[n];if(typeof o=="string")return jm.call(this,s,o,r);if(o instanceof ba)o.validate||this._compile(o),s=o;else if(o=this._schemas[n],o instanceof ba){if(o.validate||this._compile(o),n==Ht(e))return{schema:o,root:s,baseId:t};s=o}else return;if(!s.schema)return;t=Pa(this._getId(s.schema))}return Sc.call(this,r,t,s.schema,s)}function jm(s,e,r){var a=_a.call(this,s,e);if(a){var t=a.schema,n=a.baseId;s=a.root;var o=this._getId(t);return o&&(n=xa(n,o)),Sc.call(this,r,n,t,s)}}var qm=wa.toHash(["properties","patternProperties","enum","dependencies","definitions"]);function Sc(s,e,r,a){if(s.fragment=s.fragment||"",s.fragment.slice(0,1)=="/"){for(var t=s.fragment.split("/"),n=1;n<t.length;n++){var o=t[n];if(o){if(o=wa.unescapeFragment(o),r=r[o],r===void 0)break;var i;if(!qm[o]&&(i=this._getId(r),i&&(e=xa(e,i)),r.$ref)){var l=xa(e,r.$ref),u=_a.call(this,a,l);u&&(r=u.schema,a=u.root,e=u.baseId)}}}if(r!==void 0&&r!==a.schema)return{schema:r,root:a,baseId:e}}}var Um=wa.toHash(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum"]);function Yn(s,e){if(e===!1)return!1;if(e===void 0||e===!0)return eo(s);if(e)return to(s)<=e}function eo(s){var e;if(Array.isArray(s)){for(var r=0;r<s.length;r++)if(e=s[r],typeof e=="object"&&!eo(e))return!1}else for(var a in s)if(a=="$ref"||(e=s[a],typeof e=="object"&&!eo(e)))return!1;return!0}function to(s){var e=0,r;if(Array.isArray(s)){for(var a=0;a<s.length;a++)if(r=s[a],typeof r=="object"&&(e+=to(r)),e==1/0)return 1/0}else for(var t in s){if(t=="$ref")return 1/0;if(Um[t])e++;else if(r=s[t],typeof r=="object"&&(e+=to(r)+1),e==1/0)return 1/0}return e}function Pa(s,e){e!==!1&&(s=Ht(s));var r=ms.parse(s);return Rc(r)}function Rc(s){return ms.serialize(s).split("#")[0]+"#"}var Vm=/#\/?$/;function Ht(s){return s?s.replace(Vm,""):""}function xa(s,e){return e=Ht(e),ms.resolve(s,e)}function Hm(s){var e=Ht(this._getId(s)),r={"":e},a={"":Pa(e,!1)},t={},n=this;return Lm(s,{allKeys:!0},function(o,i,l,u,p,h,m){if(i!==""){var d=n._getId(o),v=r[u],b=a[u]+"/"+p;if(m!==void 0&&(b+="/"+(typeof m=="number"?m:wa.escapeFragment(m))),typeof d=="string"){d=v=Ht(v?ms.resolve(v,d):d);var g=n._refs[d];if(typeof g=="string"&&(g=n._refs[g]),g&&g.schema){if(!Ec(o,g.schema))throw new Error('id "'+d+'" resolves to more than one schema')}else if(d!=Ht(b))if(d[0]=="#"){if(t[d]&&!Ec(o,t[d]))throw new Error('id "'+d+'" resolves to more than one schema');t[d]=o}else n._refs[d]=b}r[i]=v,a[i]=b}}),t}});var Sa=X((_P,kc)=>{"use strict";var ro=Ea();kc.exports={Validation:Tc(Wm),MissingRef:Tc(so)};function Wm(s){this.message="validation failed",this.errors=s,this.ajv=this.validation=!0}so.message=function(s,e){return"can't resolve reference "+e+" from id "+s};function so(s,e,r){this.message=r||so.message(s,e),this.missingRef=ro.url(s,e),this.missingSchema=ro.normalizeId(ro.fullPath(this.missingRef))}function Tc(s){return s.prototype=Object.create(Error.prototype),s.prototype.constructor=s,s}});var ao=X((EP,Ac)=>{"use strict";Ac.exports=function(s,e){e||(e={}),typeof e=="function"&&(e={cmp:e});var r=typeof e.cycles=="boolean"?e.cycles:!1,a=e.cmp&&function(n){return function(o){return function(i,l){var u={key:i,value:o[i]},p={key:l,value:o[l]};return n(u,p)}}}(e.cmp),t=[];return function n(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var i,l;if(Array.isArray(o)){for(l="[",i=0;i<o.length;i++)i&&(l+=","),l+=n(o[i])||"null";return l+"]"}if(o===null)return"null";if(t.indexOf(o)!==-1){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var u=t.push(o)-1,p=Object.keys(o).sort(a&&a(o));for(l="",i=0;i<p.length;i++){var h=p[i],m=n(o[h]);m&&(l&&(l+=","),l+=JSON.stringify(h)+":"+m)}return t.splice(u,1),"{"+l+"}"}}(s)}});var no=X((SP,Ic)=>{"use strict";Ic.exports=function(e,r,a){var t="",n=e.schema.$async===!0,o=e.util.schemaHasRulesExcept(e.schema,e.RULES.all,"$ref"),i=e.self._getId(e.schema);if(e.opts.strictKeywords){var l=e.util.schemaUnknownRules(e.schema,e.RULES.keywords);if(l){var u="unknown keyword: "+l;if(e.opts.strictKeywords==="log")e.logger.warn(u);else throw new Error(u)}}if(e.isTop&&(t+=" var validate = ",n&&(e.async=!0,t+="async "),t+="function(data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ",i&&(e.opts.sourceCode||e.opts.processCode)&&(t+=" "+("/*# sourceURL="+i+" */")+" ")),typeof e.schema=="boolean"||!(o||e.schema.$ref)){var r="false schema",p=e.level,h=e.dataLevel,m=e.schema[r],d=e.schemaPath+e.util.getProperty(r),v=e.errSchemaPath+"/"+r,I=!e.opts.allErrors,V,b="data"+(h||""),C="valid"+p;if(e.schema===!1){e.isTop?I=!0:t+=" var "+C+" = false; ";var g=g||[];g.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(V||"false schema")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(v)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: 'boolean schema is false' "),e.opts.verbose&&(t+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+b+" "),t+=" } "):t+=" {} ";var x=t;t=g.pop(),!e.compositeRule&&I?e.async?t+=" throw new ValidationError(["+x+"]); ":t+=" validate.errors = ["+x+"]; return false; ":t+=" var err = "+x+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else e.isTop?n?t+=" return data; ":t+=" validate.errors = null; return true; ":t+=" var "+C+" = true; ";return e.isTop&&(t+=" }; return validate; "),t}if(e.isTop){var S=e.isTop,p=e.level=0,h=e.dataLevel=0,b="data";if(e.rootId=e.resolve.fullPath(e.self._getId(e.root.schema)),e.baseId=e.baseId||e.rootId,delete e.isTop,e.dataPathArr=[""],e.schema.default!==void 0&&e.opts.useDefaults&&e.opts.strictDefaults){var E="default is ignored in the schema root";if(e.opts.strictDefaults==="log")e.logger.warn(E);else throw new Error(E)}t+=" var vErrors = null; ",t+=" var errors = 0;     ",t+=" if (rootData === undefined) rootData = data; "}else{var p=e.level,h=e.dataLevel,b="data"+(h||"");if(i&&(e.baseId=e.resolve.url(e.baseId,i)),n&&!e.async)throw new Error("async schema in sync schema");t+=" var errs_"+p+" = errors;"}var C="valid"+p,I=!e.opts.allErrors,O="",B="",V,$=e.schema.type,H=Array.isArray($);if($&&e.opts.nullable&&e.schema.nullable===!0&&(H?$.indexOf("null")==-1&&($=$.concat("null")):$!="null"&&($=[$,"null"],H=!0)),H&&$.length==1&&($=$[0],H=!1),e.schema.$ref&&o){if(e.opts.extendRefs=="fail")throw new Error('$ref: validation keywords used in schema at path "'+e.errSchemaPath+'" (see option extendRefs)');e.opts.extendRefs!==!0&&(o=!1,e.logger.warn('$ref: keywords ignored in schema at path "'+e.errSchemaPath+'"'))}if(e.schema.$comment&&e.opts.$comment&&(t+=" "+e.RULES.all.$comment.code(e,"$comment")),$){if(e.opts.coerceTypes)var U=e.util.coerceToTypes(e.opts.coerceTypes,$);var q=e.RULES.types[$];if(U||H||q===!0||q&&!$e(q)){var d=e.schemaPath+".type",v=e.errSchemaPath+"/type",d=e.schemaPath+".type",v=e.errSchemaPath+"/type",k=H?"checkDataTypes":"checkDataType";if(t+=" if ("+e.util[k]($,b,e.opts.strictNumbers,!0)+") { ",U){var D="dataType"+p,M="coerced"+p;t+=" var "+D+" = typeof "+b+"; var "+M+" = undefined; ",e.opts.coerceTypes=="array"&&(t+=" if ("+D+" == 'object' && Array.isArray("+b+") && "+b+".length == 1) { "+b+" = "+b+"[0]; "+D+" = typeof "+b+"; if ("+e.util.checkDataType(e.schema.type,b,e.opts.strictNumbers)+") "+M+" = "+b+"; } "),t+=" if ("+M+" !== undefined) ; ";var Z=U;if(Z)for(var N,J=-1,te=Z.length-1;J<te;)N=Z[J+=1],N=="string"?t+=" else if ("+D+" == 'number' || "+D+" == 'boolean') "+M+" = '' + "+b+"; else if ("+b+" === null) "+M+" = ''; ":N=="number"||N=="integer"?(t+=" else if ("+D+" == 'boolean' || "+b+" === null || ("+D+" == 'string' && "+b+" && "+b+" == +"+b+" ",N=="integer"&&(t+=" && !("+b+" % 1)"),t+=")) "+M+" = +"+b+"; "):N=="boolean"?t+=" else if ("+b+" === 'false' || "+b+" === 0 || "+b+" === null) "+M+" = false; else if ("+b+" === 'true' || "+b+" === 1) "+M+" = true; ":N=="null"?t+=" else if ("+b+" === '' || "+b+" === 0 || "+b+" === false) "+M+" = null; ":e.opts.coerceTypes=="array"&&N=="array"&&(t+=" else if ("+D+" == 'string' || "+D+" == 'number' || "+D+" == 'boolean' || "+b+" == null) "+M+" = ["+b+"]; ");t+=" else {   ";var g=g||[];g.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(V||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(v)+" , params: { type: '",H?t+=""+$.join(","):t+=""+$,t+="' } ",e.opts.messages!==!1&&(t+=" , message: 'should be ",H?t+=""+$.join(","):t+=""+$,t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+d+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+b+" "),t+=" } "):t+=" {} ";var x=t;t=g.pop(),!e.compositeRule&&I?e.async?t+=" throw new ValidationError(["+x+"]); ":t+=" validate.errors = ["+x+"]; return false; ":t+=" var err = "+x+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } if ("+M+" !== undefined) {  ";var G=h?"data"+(h-1||""):"parentData",Pe=h?e.dataPathArr[h]:"parentDataProperty";t+=" "+b+" = "+M+"; ",h||(t+="if ("+G+" !== undefined)"),t+=" "+G+"["+Pe+"] = "+M+"; } "}else{var g=g||[];g.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(V||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(v)+" , params: { type: '",H?t+=""+$.join(","):t+=""+$,t+="' } ",e.opts.messages!==!1&&(t+=" , message: 'should be ",H?t+=""+$.join(","):t+=""+$,t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+d+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+b+" "),t+=" } "):t+=" {} ";var x=t;t=g.pop(),!e.compositeRule&&I?e.async?t+=" throw new ValidationError(["+x+"]); ":t+=" validate.errors = ["+x+"]; return false; ":t+=" var err = "+x+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}t+=" } "}}if(e.schema.$ref&&!o)t+=" "+e.RULES.all.$ref.code(e,"$ref")+" ",I&&(t+=" } if (errors === ",S?t+="0":t+="errs_"+p,t+=") { ",B+="}");else{var Me=e.RULES;if(Me){for(var q,qe=-1,ce=Me.length-1;qe<ce;)if(q=Me[qe+=1],$e(q)){if(q.type&&(t+=" if ("+e.util.checkDataType(q.type,b,e.opts.strictNumbers)+") { "),e.opts.useDefaults){if(q.type=="object"&&e.schema.properties){var m=e.schema.properties,Re=Object.keys(m),Ie=Re;if(Ie)for(var Ue,It=-1,wt=Ie.length-1;It<wt;){Ue=Ie[It+=1];var Ce=m[Ue];if(Ce.default!==void 0){var xe=b+e.util.getProperty(Ue);if(e.compositeRule){if(e.opts.strictDefaults){var E="default is ignored for: "+xe;if(e.opts.strictDefaults==="log")e.logger.warn(E);else throw new Error(E)}}else t+=" if ("+xe+" === undefined ",e.opts.useDefaults=="empty"&&(t+=" || "+xe+" === null || "+xe+" === '' "),t+=" ) "+xe+" = ",e.opts.useDefaults=="shared"?t+=" "+e.useDefault(Ce.default)+" ":t+=" "+JSON.stringify(Ce.default)+" ",t+="; "}}}else if(q.type=="array"&&Array.isArray(e.schema.items)){var Gt=e.schema.items;if(Gt){for(var Ce,J=-1,Fe=Gt.length-1;J<Fe;)if(Ce=Gt[J+=1],Ce.default!==void 0){var xe=b+"["+J+"]";if(e.compositeRule){if(e.opts.strictDefaults){var E="default is ignored for: "+xe;if(e.opts.strictDefaults==="log")e.logger.warn(E);else throw new Error(E)}}else t+=" if ("+xe+" === undefined ",e.opts.useDefaults=="empty"&&(t+=" || "+xe+" === null || "+xe+" === '' "),t+=" ) "+xe+" = ",e.opts.useDefaults=="shared"?t+=" "+e.useDefault(Ce.default)+" ":t+=" "+JSON.stringify(Ce.default)+" ",t+="; "}}}}var ue=q.rules;if(ue){for(var Ot,_t=-1,Jt=ue.length-1;_t<Jt;)if(Ot=ue[_t+=1],Ye(Ot)){var Qt=Ot.code(e,Ot.keyword,q.type);Qt&&(t+=" "+Qt+" ",I&&(O+="}"))}}if(I&&(t+=" "+O+" ",O=""),q.type&&(t+=" } ",$&&$===q.type&&!U)){t+=" else { ";var d=e.schemaPath+".type",v=e.errSchemaPath+"/type",g=g||[];g.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(V||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(v)+" , params: { type: '",H?t+=""+$.join(","):t+=""+$,t+="' } ",e.opts.messages!==!1&&(t+=" , message: 'should be ",H?t+=""+$.join(","):t+=""+$,t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+d+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+b+" "),t+=" } "):t+=" {} ";var x=t;t=g.pop(),!e.compositeRule&&I?e.async?t+=" throw new ValidationError(["+x+"]); ":t+=" validate.errors = ["+x+"]; return false; ":t+=" var err = "+x+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } "}I&&(t+=" if (errors === ",S?t+="0":t+="errs_"+p,t+=") { ",B+="}")}}}I&&(t+=" "+B+" "),S?(n?(t+=" if (errors === 0) return data;           ",t+=" else throw new ValidationError(vErrors); "):(t+=" validate.errors = vErrors; ",t+=" return errors === 0;       "),t+=" }; return validate;"):t+=" var "+C+" = errors === errs_"+p+";";function $e(Ve){for(var ft=Ve.rules,Ge=0;Ge<ft.length;Ge++)if(Ye(ft[Ge]))return!0}function Ye(Ve){return e.schema[Ve.keyword]!==void 0||Ve.implements&&We(Ve)}function We(Ve){for(var ft=Ve.implements,Ge=0;Ge<ft.length;Ge++)if(e.schema[ft[Ge]]!==void 0)return!0}return t}});var Mc=X((RP,Nc)=>{"use strict";var Ra=Ea(),Ta=gr(),$c=Sa(),zm=ao(),Oc=no(),Bm=Ta.ucs2length,Zm=ga(),Gm=$c.Validation;Nc.exports=oo;function oo(s,e,r,a){var t=this,n=this._opts,o=[void 0],i={},l=[],u={},p=[],h={},m=[];e=e||{schema:s,refVal:o,refs:i};var d=Jm.call(this,s,e,a),v=this._compilations[d.index];if(d.compiling)return v.callValidate=E;var b=this._formats,g=this.RULES;try{var x=C(s,e,r,a);v.validate=x;var S=v.callValidate;return S&&(S.schema=x.schema,S.errors=null,S.refs=x.refs,S.refVal=x.refVal,S.root=x.root,S.$async=x.$async,n.sourceCode&&(S.source=x.source)),x}finally{Qm.call(this,s,e,a)}function E(){var k=v.validate,D=k.apply(this,arguments);return E.errors=k.errors,D}function C(k,D,M,Z){var N=!D||D&&D.schema==k;if(D.schema!=e.schema)return oo.call(t,k,D,M,Z);var J=k.$async===!0,te=Oc({isTop:!0,schema:k,isRoot:N,baseId:Z,root:D,schemaPath:"",errSchemaPath:"#",errorPath:'""',MissingRefError:$c.MissingRef,RULES:g,validate:Oc,util:Ta,resolve:Ra,resolveRef:I,usePattern:H,useDefault:U,useCustomRule:q,opts:n,formats:b,logger:t.logger,self:t});te=Ca(o,Ym)+Ca(l,Km)+Ca(p,Xm)+Ca(m,ev)+te,n.processCode&&(te=n.processCode(te,k));var G;try{var Pe=new Function("self","RULES","formats","root","refVal","defaults","customRules","equal","ucs2length","ValidationError",te);G=Pe(t,g,b,e,o,p,m,Zm,Bm,Gm),o[0]=G}catch(Me){throw t.logger.error("Error compiling schema, function code:",te),Me}return G.schema=k,G.errors=null,G.refs=i,G.refVal=o,G.root=N?G:D,J&&(G.$async=!0),n.sourceCode===!0&&(G.source={code:te,patterns:l,defaults:p}),G}function I(k,D,M){D=Ra.url(k,D);var Z=i[D],N,J;if(Z!==void 0)return N=o[Z],J="refVal["+Z+"]",$(N,J);if(!M&&e.refs){var te=e.refs[D];if(te!==void 0)return N=e.refVal[te],J=O(D,N),$(N,J)}J=O(D);var G=Ra.call(t,C,e,D);if(G===void 0){var Pe=r&&r[D];Pe&&(G=Ra.inlineRef(Pe,n.inlineRefs)?Pe:oo.call(t,Pe,e,r,k))}if(G===void 0)B(D);else return V(D,G),$(G,J)}function O(k,D){var M=o.length;return o[M]=D,i[k]=M,"refVal"+M}function B(k){delete i[k]}function V(k,D){var M=i[k];o[M]=D}function $(k,D){return typeof k=="object"||typeof k=="boolean"?{code:D,schema:k,inline:!0}:{code:D,$async:k&&!!k.$async}}function H(k){var D=u[k];return D===void 0&&(D=u[k]=l.length,l[D]=k),"pattern"+D}function U(k){switch(typeof k){case"boolean":case"number":return""+k;case"string":return Ta.toQuotedString(k);case"object":if(k===null)return"null";var D=zm(k),M=h[D];return M===void 0&&(M=h[D]=p.length,p[M]=k),"default"+M}}function q(k,D,M,Z){if(t._opts.validateSchema!==!1){var N=k.definition.dependencies;if(N&&!N.every(function(Ie){return Object.prototype.hasOwnProperty.call(M,Ie)}))throw new Error("parent schema must have all required keywords: "+N.join(","));var J=k.definition.validateSchema;if(J){var te=J(D);if(!te){var G="keyword schema is invalid: "+t.errorsText(J.errors);if(t._opts.validateSchema=="log")t.logger.error(G);else throw new Error(G)}}}var Pe=k.definition.compile,Me=k.definition.inline,qe=k.definition.macro,ce;if(Pe)ce=Pe.call(t,D,M,Z);else if(qe)ce=qe.call(t,D,M,Z),n.validateSchema!==!1&&t.validateSchema(ce,!0);else if(Me)ce=Me.call(t,Z,k.keyword,D,M);else if(ce=k.definition.validate,!ce)return;if(ce===void 0)throw new Error('custom keyword "'+k.keyword+'"failed to compile');var Re=m.length;return m[Re]=ce,{code:"customRule"+Re,validate:ce}}}function Jm(s,e,r){var a=Dc.call(this,s,e,r);return a>=0?{index:a,compiling:!0}:(a=this._compilations.length,this._compilations[a]={schema:s,root:e,baseId:r},{index:a,compiling:!1})}function Qm(s,e,r){var a=Dc.call(this,s,e,r);a>=0&&this._compilations.splice(a,1)}function Dc(s,e,r){for(var a=0;a<this._compilations.length;a++){var t=this._compilations[a];if(t.schema==s&&t.root==e&&t.baseId==r)return a}return-1}function Km(s,e){return"var pattern"+s+" = new RegExp("+Ta.toQuotedString(e[s])+");"}function Xm(s){return"var default"+s+" = defaults["+s+"];"}function Ym(s,e){return e[s]===void 0?"":"var refVal"+s+" = refVal["+s+"];"}function ev(s){return"var customRule"+s+" = customRules["+s+"];"}function Ca(s,e){if(!s.length)return"";for(var r="",a=0;a<s.length;a++)r+=e(a,s);return r}});var Lc=X((CP,Fc)=>{"use strict";var ka=Fc.exports=function(){this._cache={}};ka.prototype.put=function(e,r){this._cache[e]=r};ka.prototype.get=function(e){return this._cache[e]};ka.prototype.del=function(e){delete this._cache[e]};ka.prototype.clear=function(){this._cache={}}});var Qc=X((TP,Jc)=>{"use strict";var tv=gr(),rv=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,sv=[0,31,28,31,30,31,30,31,31,30,31,30,31],av=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,jc=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,nv=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,ov=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,qc=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,Uc=/^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i,Vc=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,Hc=/^(?:\/(?:[^~/]|~0|~1)*)*$/,Wc=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,zc=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/;Jc.exports=Aa;function Aa(s){return s=s=="full"?"full":"fast",tv.copy(Aa[s])}Aa.fast={date:/^\d\d\d\d-[0-1]\d-[0-3]\d$/,time:/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,"date-time":/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,"uri-template":qc,url:Uc,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,hostname:jc,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:Gc,uuid:Vc,"json-pointer":Hc,"json-pointer-uri-fragment":Wc,"relative-json-pointer":zc};Aa.full={date:Bc,time:Zc,"date-time":lv,uri:dv,"uri-reference":ov,"uri-template":qc,url:Uc,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:jc,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:Gc,uuid:Vc,"json-pointer":Hc,"json-pointer-uri-fragment":Wc,"relative-json-pointer":zc};function iv(s){return s%4===0&&(s%100!==0||s%400===0)}function Bc(s){var e=s.match(rv);if(!e)return!1;var r=+e[1],a=+e[2],t=+e[3];return a>=1&&a<=12&&t>=1&&t<=(a==2&&iv(r)?29:sv[a])}function Zc(s,e){var r=s.match(av);if(!r)return!1;var a=r[1],t=r[2],n=r[3],o=r[5];return(a<=23&&t<=59&&n<=59||a==23&&t==59&&n==60)&&(!e||o)}var cv=/t|\s/i;function lv(s){var e=s.split(cv);return e.length==2&&Bc(e[0])&&Zc(e[1],!0)}var uv=/\/|:/;function dv(s){return uv.test(s)&&nv.test(s)}var pv=/[^\\]\\Z/;function Gc(s){if(pv.test(s))return!1;try{return new RegExp(s),!0}catch{return!1}}});var Xc=X((kP,Kc)=>{"use strict";Kc.exports=function(e,r,a){var t=" ",n=e.level,o=e.dataLevel,i=e.schema[r],l=e.errSchemaPath+"/"+r,u=!e.opts.allErrors,p="data"+(o||""),h="valid"+n,m,d;if(i=="#"||i=="#/")e.isRoot?(m=e.async,d="validate"):(m=e.root.schema.$async===!0,d="root.refVal[0]");else{var v=e.resolveRef(e.baseId,i,e.isRoot);if(v===void 0){var b=e.MissingRefError.message(e.baseId,i);if(e.opts.missingRefs=="fail"){e.logger.error(b);var g=g||[];g.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '$ref' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { ref: '"+e.util.escapeQuotes(i)+"' } ",e.opts.messages!==!1&&(t+=" , message: 'can\\'t resolve reference "+e.util.escapeQuotes(i)+"' "),e.opts.verbose&&(t+=" , schema: "+e.util.toQuotedString(i)+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),t+=" } "):t+=" {} ";var x=t;t=g.pop(),!e.compositeRule&&u?e.async?t+=" throw new ValidationError(["+x+"]); ":t+=" validate.errors = ["+x+"]; return false; ":t+=" var err = "+x+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",u&&(t+=" if (false) { ")}else if(e.opts.missingRefs=="ignore")e.logger.warn(b),u&&(t+=" if (true) { ");else throw new e.MissingRefError(e.baseId,i,b)}else if(v.inline){var S=e.util.copy(e);S.level++;var E="valid"+S.level;S.schema=v.schema,S.schemaPath="",S.errSchemaPath=i;var C=e.validate(S).replace(/validate\.schema/g,v.code);t+=" "+C+" ",u&&(t+=" if ("+E+") { ")}else m=v.$async===!0||e.async&&v.$async!==!1,d=v.code}if(d){var g=g||[];g.push(t),t="",e.opts.passContext?t+=" "+d+".call(this, ":t+=" "+d+"( ",t+=" "+p+", (dataPath || '')",e.errorPath!='""'&&(t+=" + "+e.errorPath);var I=o?"data"+(o-1||""):"parentData",O=o?e.dataPathArr[o]:"parentDataProperty";t+=" , "+I+" , "+O+", rootData)  ";var B=t;if(t=g.pop(),m){if(!e.async)throw new Error("async schema referenced by sync schema");u&&(t+=" var "+h+"; "),t+=" try { await "+B+"; ",u&&(t+=" "+h+" = true; "),t+=" } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ",u&&(t+=" "+h+" = false; "),t+=" } ",u&&(t+=" if ("+h+") { ")}else t+=" if (!"+B+") { if (vErrors === null) vErrors = "+d+".errors; else vErrors = vErrors.concat("+d+".errors); errors = vErrors.length; } ",u&&(t+=" else { ")}return t}});var el=X((AP,Yc)=>{"use strict";Yc.exports=function(e,r,a){var t=" ",n=e.schema[r],o=e.schemaPath+e.util.getProperty(r),i=e.errSchemaPath+"/"+r,l=!e.opts.allErrors,u=e.util.copy(e),p="";u.level++;var h="valid"+u.level,m=u.baseId,d=!0,v=n;if(v)for(var b,g=-1,x=v.length-1;g<x;)b=v[g+=1],(e.opts.strictKeywords?typeof b=="object"&&Object.keys(b).length>0||b===!1:e.util.schemaHasRules(b,e.RULES.all))&&(d=!1,u.schema=b,u.schemaPath=o+"["+g+"]",u.errSchemaPath=i+"/"+g,t+="  "+e.validate(u)+" ",u.baseId=m,l&&(t+=" if ("+h+") { ",p+="}"));return l&&(d?t+=" if (true) { ":t+=" "+p.slice(0,-1)+" "),t}});var rl=X((IP,tl)=>{"use strict";tl.exports=function(e,r,a){var t=" ",n=e.level,o=e.dataLevel,i=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,p=!e.opts.allErrors,h="data"+(o||""),m="valid"+n,d="errs__"+n,v=e.util.copy(e),b="";v.level++;var g="valid"+v.level,x=i.every(function(V){return e.opts.strictKeywords?typeof V=="object"&&Object.keys(V).length>0||V===!1:e.util.schemaHasRules(V,e.RULES.all)});if(x){var S=v.baseId;t+=" var "+d+" = errors; var "+m+" = false;  ";var E=e.compositeRule;e.compositeRule=v.compositeRule=!0;var C=i;if(C)for(var I,O=-1,B=C.length-1;O<B;)I=C[O+=1],v.schema=I,v.schemaPath=l+"["+O+"]",v.errSchemaPath=u+"/"+O,t+="  "+e.validate(v)+" ",v.baseId=S,t+=" "+m+" = "+m+" || "+g+"; if (!"+m+") { ",b+="}";e.compositeRule=v.compositeRule=E,t+=" "+b+" if (!"+m+") {   var err =   ",e.createErrors!==!1?(t+=" { keyword: 'anyOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: 'should match some schema in anyOf' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&p&&(e.async?t+=" throw new ValidationError(vErrors); ":t+=" validate.errors = vErrors; return false; "),t+=" } else {  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; } ",e.opts.allErrors&&(t+=" } ")}else p&&(t+=" if (true) { ");return t}});var al=X((OP,sl)=>{"use strict";sl.exports=function(e,r,a){var t=" ",n=e.schema[r],o=e.errSchemaPath+"/"+r,i=!e.opts.allErrors,l=e.util.toQuotedString(n);return e.opts.$comment===!0?t+=" console.log("+l+");":typeof e.opts.$comment=="function"&&(t+=" self._opts.$comment("+l+", "+e.util.toQuotedString(o)+", validate.root.schema);"),t}});var ol=X(($P,nl)=>{"use strict";nl.exports=function(e,r,a){var t=" ",n=e.level,o=e.dataLevel,i=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,p=!e.opts.allErrors,h="data"+(o||""),m="valid"+n,d=e.opts.$data&&i&&i.$data,v;d?(t+=" var schema"+n+" = "+e.util.getData(i.$data,o,e.dataPathArr)+"; ",v="schema"+n):v=i,d||(t+=" var schema"+n+" = validate.schema"+l+";"),t+="var "+m+" = equal("+h+", schema"+n+"); if (!"+m+") {   ";var b=b||[];b.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'const' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { allowedValue: schema"+n+" } ",e.opts.messages!==!1&&(t+=" , message: 'should be equal to constant' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ";var g=t;return t=b.pop(),!e.compositeRule&&p?e.async?t+=" throw new ValidationError(["+g+"]); ":t+=" validate.errors = ["+g+"]; return false; ":t+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" }",p&&(t+=" else { "),t}});var cl=X((DP,il)=>{"use strict";il.exports=function(e,r,a){var t=" ",n=e.level,o=e.dataLevel,i=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,p=!e.opts.allErrors,h="data"+(o||""),m="valid"+n,d="errs__"+n,v=e.util.copy(e),b="";v.level++;var g="valid"+v.level,x="i"+n,S=v.dataLevel=e.dataLevel+1,E="data"+S,C=e.baseId,I=e.opts.strictKeywords?typeof i=="object"&&Object.keys(i).length>0||i===!1:e.util.schemaHasRules(i,e.RULES.all);if(t+="var "+d+" = errors;var "+m+";",I){var O=e.compositeRule;e.compositeRule=v.compositeRule=!0,v.schema=i,v.schemaPath=l,v.errSchemaPath=u,t+=" var "+g+" = false; for (var "+x+" = 0; "+x+" < "+h+".length; "+x+"++) { ",v.errorPath=e.util.getPathExpr(e.errorPath,x,e.opts.jsonPointers,!0);var B=h+"["+x+"]";v.dataPathArr[S]=x;var V=e.validate(v);v.baseId=C,e.util.varOccurences(V,E)<2?t+=" "+e.util.varReplace(V,E,B)+" ":t+=" var "+E+" = "+B+"; "+V+" ",t+=" if ("+g+") break; }  ",e.compositeRule=v.compositeRule=O,t+=" "+b+" if (!"+g+") {"}else t+=" if ("+h+".length == 0) {";var $=$||[];$.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'contains' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: 'should contain a valid item' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ";var H=t;return t=$.pop(),!e.compositeRule&&p?e.async?t+=" throw new ValidationError(["+H+"]); ":t+=" validate.errors = ["+H+"]; return false; ":t+=" var err = "+H+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else { ",I&&(t+="  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; } "),e.opts.allErrors&&(t+=" } "),t}});var ul=X((NP,ll)=>{"use strict";ll.exports=function(e,r,a){var t=" ",n=e.level,o=e.dataLevel,i=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,p=!e.opts.allErrors,h="data"+(o||""),m="errs__"+n,d=e.util.copy(e),v="";d.level++;var b="valid"+d.level,g={},x={},S=e.opts.ownProperties;for(O in i)if(O!="__proto__"){var E=i[O],C=Array.isArray(E)?x:g;C[O]=E}t+="var "+m+" = errors;";var I=e.errorPath;t+="var missing"+n+";";for(var O in x)if(C=x[O],C.length){if(t+=" if ( "+h+e.util.getProperty(O)+" !== undefined ",S&&(t+=" && Object.prototype.hasOwnProperty.call("+h+", '"+e.util.escapeQuotes(O)+"') "),p){t+=" && ( ";var B=C;if(B)for(var V,$=-1,H=B.length-1;$<H;){V=B[$+=1],$&&(t+=" || ");var U=e.util.getProperty(V),q=h+U;t+=" ( ( "+q+" === undefined ",S&&(t+=" || ! Object.prototype.hasOwnProperty.call("+h+", '"+e.util.escapeQuotes(V)+"') "),t+=") && (missing"+n+" = "+e.util.toQuotedString(e.opts.jsonPointers?V:U)+") ) "}t+=")) {  ";var k="missing"+n,D="' + "+k+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(I,k,!0):I+" + "+k);var M=M||[];M.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { property: '"+e.util.escapeQuotes(O)+"', missingProperty: '"+D+"', depsCount: "+C.length+", deps: '"+e.util.escapeQuotes(C.length==1?C[0]:C.join(", "))+"' } ",e.opts.messages!==!1&&(t+=" , message: 'should have ",C.length==1?t+="property "+e.util.escapeQuotes(C[0]):t+="properties "+e.util.escapeQuotes(C.join(", ")),t+=" when property "+e.util.escapeQuotes(O)+" is present' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ";var Z=t;t=M.pop(),!e.compositeRule&&p?e.async?t+=" throw new ValidationError(["+Z+"]); ":t+=" validate.errors = ["+Z+"]; return false; ":t+=" var err = "+Z+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else{t+=" ) { ";var N=C;if(N)for(var V,J=-1,te=N.length-1;J<te;){V=N[J+=1];var U=e.util.getProperty(V),D=e.util.escapeQuotes(V),q=h+U;e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(I,V,e.opts.jsonPointers)),t+=" if ( "+q+" === undefined ",S&&(t+=" || ! Object.prototype.hasOwnProperty.call("+h+", '"+e.util.escapeQuotes(V)+"') "),t+=") {  var err =   ",e.createErrors!==!1?(t+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { property: '"+e.util.escapeQuotes(O)+"', missingProperty: '"+D+"', depsCount: "+C.length+", deps: '"+e.util.escapeQuotes(C.length==1?C[0]:C.join(", "))+"' } ",e.opts.messages!==!1&&(t+=" , message: 'should have ",C.length==1?t+="property "+e.util.escapeQuotes(C[0]):t+="properties "+e.util.escapeQuotes(C.join(", ")),t+=" when property "+e.util.escapeQuotes(O)+" is present' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}t+=" }   ",p&&(v+="}",t+=" else { ")}e.errorPath=I;var G=d.baseId;for(var O in g){var E=g[O];(e.opts.strictKeywords?typeof E=="object"&&Object.keys(E).length>0||E===!1:e.util.schemaHasRules(E,e.RULES.all))&&(t+=" "+b+" = true; if ( "+h+e.util.getProperty(O)+" !== undefined ",S&&(t+=" && Object.prototype.hasOwnProperty.call("+h+", '"+e.util.escapeQuotes(O)+"') "),t+=") { ",d.schema=E,d.schemaPath=l+e.util.getProperty(O),d.errSchemaPath=u+"/"+e.util.escapeFragment(O),t+="  "+e.validate(d)+" ",d.baseId=G,t+=" }  ",p&&(t+=" if ("+b+") { ",v+="}"))}return p&&(t+="   "+v+" if ("+m+" == errors) {"),t}});var pl=X((MP,dl)=>{"use strict";dl.exports=function(e,r,a){var t=" ",n=e.level,o=e.dataLevel,i=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,p=!e.opts.allErrors,h="data"+(o||""),m="valid"+n,d=e.opts.$data&&i&&i.$data,v;d?(t+=" var schema"+n+" = "+e.util.getData(i.$data,o,e.dataPathArr)+"; ",v="schema"+n):v=i;var b="i"+n,g="schema"+n;d||(t+=" var "+g+" = validate.schema"+l+";"),t+="var "+m+";",d&&(t+=" if (schema"+n+" === undefined) "+m+" = true; else if (!Array.isArray(schema"+n+")) "+m+" = false; else {"),t+=""+m+" = false;for (var "+b+"=0; "+b+"<"+g+".length; "+b+"++) if (equal("+h+", "+g+"["+b+"])) { "+m+" = true; break; }",d&&(t+="  }  "),t+=" if (!"+m+") {   ";var x=x||[];x.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'enum' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { allowedValues: schema"+n+" } ",e.opts.messages!==!1&&(t+=" , message: 'should be equal to one of the allowed values' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ";var S=t;return t=x.pop(),!e.compositeRule&&p?e.async?t+=" throw new ValidationError(["+S+"]); ":t+=" validate.errors = ["+S+"]; return false; ":t+=" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" }",p&&(t+=" else { "),t}});var hl=X((FP,fl)=>{"use strict";fl.exports=function(e,r,a){var t=" ",n=e.level,o=e.dataLevel,i=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,p=!e.opts.allErrors,h="data"+(o||"");if(e.opts.format===!1)return p&&(t+=" if (true) { "),t;var m=e.opts.$data&&i&&i.$data,d;m?(t+=" var schema"+n+" = "+e.util.getData(i.$data,o,e.dataPathArr)+"; ",d="schema"+n):d=i;var v=e.opts.unknownFormats,b=Array.isArray(v);if(m){var g="format"+n,x="isObject"+n,S="formatType"+n;t+=" var "+g+" = formats["+d+"]; var "+x+" = typeof "+g+" == 'object' && !("+g+" instanceof RegExp) && "+g+".validate; var "+S+" = "+x+" && "+g+".type || 'string'; if ("+x+") { ",e.async&&(t+=" var async"+n+" = "+g+".async; "),t+=" "+g+" = "+g+".validate; } if (  ",m&&(t+=" ("+d+" !== undefined && typeof "+d+" != 'string') || "),t+=" (",v!="ignore"&&(t+=" ("+d+" && !"+g+" ",b&&(t+=" && self._opts.unknownFormats.indexOf("+d+") == -1 "),t+=") || "),t+=" ("+g+" && "+S+" == '"+a+"' && !(typeof "+g+" == 'function' ? ",e.async?t+=" (async"+n+" ? await "+g+"("+h+") : "+g+"("+h+")) ":t+=" "+g+"("+h+") ",t+=" : "+g+".test("+h+"))))) {"}else{var g=e.formats[i];if(!g){if(v=="ignore")return e.logger.warn('unknown format "'+i+'" ignored in schema at path "'+e.errSchemaPath+'"'),p&&(t+=" if (true) { "),t;if(b&&v.indexOf(i)>=0)return p&&(t+=" if (true) { "),t;throw new Error('unknown format "'+i+'" is used in schema at path "'+e.errSchemaPath+'"')}var x=typeof g=="object"&&!(g instanceof RegExp)&&g.validate,S=x&&g.type||"string";if(x){var E=g.async===!0;g=g.validate}if(S!=a)return p&&(t+=" if (true) { "),t;if(E){if(!e.async)throw new Error("async format in sync schema");var C="formats"+e.util.getProperty(i)+".validate";t+=" if (!(await "+C+"("+h+"))) { "}else{t+=" if (! ";var C="formats"+e.util.getProperty(i);x&&(C+=".validate"),typeof g=="function"?t+=" "+C+"("+h+") ":t+=" "+C+".test("+h+") ",t+=") { "}}var I=I||[];I.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'format' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { format:  ",m?t+=""+d:t+=""+e.util.toQuotedString(i),t+="  } ",e.opts.messages!==!1&&(t+=` , message: 'should match format "`,m?t+="' + "+d+" + '":t+=""+e.util.escapeQuotes(i),t+=`"' `),e.opts.verbose&&(t+=" , schema:  ",m?t+="validate.schema"+l:t+=""+e.util.toQuotedString(i),t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ";var O=t;return t=I.pop(),!e.compositeRule&&p?e.async?t+=" throw new ValidationError(["+O+"]); ":t+=" validate.errors = ["+O+"]; return false; ":t+=" var err = "+O+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } ",p&&(t+=" else { "),t}});var vl=X((LP,ml)=>{"use strict";ml.exports=function(e,r,a){var t=" ",n=e.level,o=e.dataLevel,i=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,p=!e.opts.allErrors,h="data"+(o||""),m="valid"+n,d="errs__"+n,v=e.util.copy(e);v.level++;var b="valid"+v.level,g=e.schema.then,x=e.schema.else,S=g!==void 0&&(e.opts.strictKeywords?typeof g=="object"&&Object.keys(g).length>0||g===!1:e.util.schemaHasRules(g,e.RULES.all)),E=x!==void 0&&(e.opts.strictKeywords?typeof x=="object"&&Object.keys(x).length>0||x===!1:e.util.schemaHasRules(x,e.RULES.all)),C=v.baseId;if(S||E){var I;v.createErrors=!1,v.schema=i,v.schemaPath=l,v.errSchemaPath=u,t+=" var "+d+" = errors; var "+m+" = true;  ";var O=e.compositeRule;e.compositeRule=v.compositeRule=!0,t+="  "+e.validate(v)+" ",v.baseId=C,v.createErrors=!0,t+="  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; }  ",e.compositeRule=v.compositeRule=O,S?(t+=" if ("+b+") {  ",v.schema=e.schema.then,v.schemaPath=e.schemaPath+".then",v.errSchemaPath=e.errSchemaPath+"/then",t+="  "+e.validate(v)+" ",v.baseId=C,t+=" "+m+" = "+b+"; ",S&&E?(I="ifClause"+n,t+=" var "+I+" = 'then'; "):I="'then'",t+=" } ",E&&(t+=" else { ")):t+=" if (!"+b+") { ",E&&(v.schema=e.schema.else,v.schemaPath=e.schemaPath+".else",v.errSchemaPath=e.errSchemaPath+"/else",t+="  "+e.validate(v)+" ",v.baseId=C,t+=" "+m+" = "+b+"; ",S&&E?(I="ifClause"+n,t+=" var "+I+" = 'else'; "):I="'else'",t+=" } "),t+=" if (!"+m+") {   var err =   ",e.createErrors!==!1?(t+=" { keyword: 'if' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { failingKeyword: "+I+" } ",e.opts.messages!==!1&&(t+=` , message: 'should match "' + `+I+` + '" schema' `),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&p&&(e.async?t+=" throw new ValidationError(vErrors); ":t+=" validate.errors = vErrors; return false; "),t+=" }   ",p&&(t+=" else { ")}else p&&(t+=" if (true) { ");return t}});var yl=X((jP,gl)=>{"use strict";gl.exports=function(e,r,a){var t=" ",n=e.level,o=e.dataLevel,i=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,p=!e.opts.allErrors,h="data"+(o||""),m="valid"+n,d="errs__"+n,v=e.util.copy(e),b="";v.level++;var g="valid"+v.level,x="i"+n,S=v.dataLevel=e.dataLevel+1,E="data"+S,C=e.baseId;if(t+="var "+d+" = errors;var "+m+";",Array.isArray(i)){var I=e.schema.additionalItems;if(I===!1){t+=" "+m+" = "+h+".length <= "+i.length+"; ";var O=u;u=e.errSchemaPath+"/additionalItems",t+="  if (!"+m+") {   ";var B=B||[];B.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'additionalItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { limit: "+i.length+" } ",e.opts.messages!==!1&&(t+=" , message: 'should NOT have more than "+i.length+" items' "),e.opts.verbose&&(t+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ";var V=t;t=B.pop(),!e.compositeRule&&p?e.async?t+=" throw new ValidationError(["+V+"]); ":t+=" validate.errors = ["+V+"]; return false; ":t+=" var err = "+V+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } ",u=O,p&&(b+="}",t+=" else { ")}var $=i;if($){for(var H,U=-1,q=$.length-1;U<q;)if(H=$[U+=1],e.opts.strictKeywords?typeof H=="object"&&Object.keys(H).length>0||H===!1:e.util.schemaHasRules(H,e.RULES.all)){t+=" "+g+" = true; if ("+h+".length > "+U+") { ";var k=h+"["+U+"]";v.schema=H,v.schemaPath=l+"["+U+"]",v.errSchemaPath=u+"/"+U,v.errorPath=e.util.getPathExpr(e.errorPath,U,e.opts.jsonPointers,!0),v.dataPathArr[S]=U;var D=e.validate(v);v.baseId=C,e.util.varOccurences(D,E)<2?t+=" "+e.util.varReplace(D,E,k)+" ":t+=" var "+E+" = "+k+"; "+D+" ",t+=" }  ",p&&(t+=" if ("+g+") { ",b+="}")}}if(typeof I=="object"&&(e.opts.strictKeywords?typeof I=="object"&&Object.keys(I).length>0||I===!1:e.util.schemaHasRules(I,e.RULES.all))){v.schema=I,v.schemaPath=e.schemaPath+".additionalItems",v.errSchemaPath=e.errSchemaPath+"/additionalItems",t+=" "+g+" = true; if ("+h+".length > "+i.length+") {  for (var "+x+" = "+i.length+"; "+x+" < "+h+".length; "+x+"++) { ",v.errorPath=e.util.getPathExpr(e.errorPath,x,e.opts.jsonPointers,!0);var k=h+"["+x+"]";v.dataPathArr[S]=x;var D=e.validate(v);v.baseId=C,e.util.varOccurences(D,E)<2?t+=" "+e.util.varReplace(D,E,k)+" ":t+=" var "+E+" = "+k+"; "+D+" ",p&&(t+=" if (!"+g+") break; "),t+=" } }  ",p&&(t+=" if ("+g+") { ",b+="}")}}else if(e.opts.strictKeywords?typeof i=="object"&&Object.keys(i).length>0||i===!1:e.util.schemaHasRules(i,e.RULES.all)){v.schema=i,v.schemaPath=l,v.errSchemaPath=u,t+="  for (var "+x+" = 0; "+x+" < "+h+".length; "+x+"++) { ",v.errorPath=e.util.getPathExpr(e.errorPath,x,e.opts.jsonPointers,!0);var k=h+"["+x+"]";v.dataPathArr[S]=x;var D=e.validate(v);v.baseId=C,e.util.varOccurences(D,E)<2?t+=" "+e.util.varReplace(D,E,k)+" ":t+=" var "+E+" = "+k+"; "+D+" ",p&&(t+=" if (!"+g+") break; "),t+=" }"}return p&&(t+=" "+b+" if ("+d+" == errors) {"),t}});var io=X((qP,bl)=>{"use strict";bl.exports=function(e,r,a){var t=" ",n=e.level,o=e.dataLevel,i=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,p=!e.opts.allErrors,C,h="data"+(o||""),m=e.opts.$data&&i&&i.$data,d;m?(t+=" var schema"+n+" = "+e.util.getData(i.$data,o,e.dataPathArr)+"; ",d="schema"+n):d=i;var v=r=="maximum",b=v?"exclusiveMaximum":"exclusiveMinimum",g=e.schema[b],x=e.opts.$data&&g&&g.$data,S=v?"<":">",E=v?">":"<",C=void 0;if(!(m||typeof i=="number"||i===void 0))throw new Error(r+" must be number");if(!(x||g===void 0||typeof g=="number"||typeof g=="boolean"))throw new Error(b+" must be number or boolean");if(x){var I=e.util.getData(g.$data,o,e.dataPathArr),O="exclusive"+n,B="exclType"+n,V="exclIsNumber"+n,$="op"+n,H="' + "+$+" + '";t+=" var schemaExcl"+n+" = "+I+"; ",I="schemaExcl"+n,t+=" var "+O+"; var "+B+" = typeof "+I+"; if ("+B+" != 'boolean' && "+B+" != 'undefined' && "+B+" != 'number') { ";var C=b,U=U||[];U.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(C||"_exclusiveLimit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: '"+b+" should be boolean' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ";var q=t;t=U.pop(),!e.compositeRule&&p?e.async?t+=" throw new ValidationError(["+q+"]); ":t+=" validate.errors = ["+q+"]; return false; ":t+=" var err = "+q+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else if ( ",m&&(t+=" ("+d+" !== undefined && typeof "+d+" != 'number') || "),t+=" "+B+" == 'number' ? ( ("+O+" = "+d+" === undefined || "+I+" "+S+"= "+d+") ? "+h+" "+E+"= "+I+" : "+h+" "+E+" "+d+" ) : ( ("+O+" = "+I+" === true) ? "+h+" "+E+"= "+d+" : "+h+" "+E+" "+d+" ) || "+h+" !== "+h+") { var op"+n+" = "+O+" ? '"+S+"' : '"+S+"='; ",i===void 0&&(C=b,u=e.errSchemaPath+"/"+b,d=I,m=x)}else{var V=typeof g=="number",H=S;if(V&&m){var $="'"+H+"'";t+=" if ( ",m&&(t+=" ("+d+" !== undefined && typeof "+d+" != 'number') || "),t+=" ( "+d+" === undefined || "+g+" "+S+"= "+d+" ? "+h+" "+E+"= "+g+" : "+h+" "+E+" "+d+" ) || "+h+" !== "+h+") { "}else{V&&i===void 0?(O=!0,C=b,u=e.errSchemaPath+"/"+b,d=g,E+="="):(V&&(d=Math[v?"min":"max"](g,i)),g===(V?d:!0)?(O=!0,C=b,u=e.errSchemaPath+"/"+b,E+="="):(O=!1,H+="="));var $="'"+H+"'";t+=" if ( ",m&&(t+=" ("+d+" !== undefined && typeof "+d+" != 'number') || "),t+=" "+h+" "+E+" "+d+" || "+h+" !== "+h+") { "}}C=C||r;var U=U||[];U.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(C||"_limit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { comparison: "+$+", limit: "+d+", exclusive: "+O+" } ",e.opts.messages!==!1&&(t+=" , message: 'should be "+H+" ",m?t+="' + "+d:t+=""+d+"'"),e.opts.verbose&&(t+=" , schema:  ",m?t+="validate.schema"+l:t+=""+i,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ";var q=t;return t=U.pop(),!e.compositeRule&&p?e.async?t+=" throw new ValidationError(["+q+"]); ":t+=" validate.errors = ["+q+"]; return false; ":t+=" var err = "+q+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } ",p&&(t+=" else { "),t}});var co=X((UP,Pl)=>{"use strict";Pl.exports=function(e,r,a){var t=" ",n=e.level,o=e.dataLevel,i=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,p=!e.opts.allErrors,b,h="data"+(o||""),m=e.opts.$data&&i&&i.$data,d;if(m?(t+=" var schema"+n+" = "+e.util.getData(i.$data,o,e.dataPathArr)+"; ",d="schema"+n):d=i,!(m||typeof i=="number"))throw new Error(r+" must be number");var v=r=="maxItems"?">":"<";t+="if ( ",m&&(t+=" ("+d+" !== undefined && typeof "+d+" != 'number') || "),t+=" "+h+".length "+v+" "+d+") { ";var b=r,g=g||[];g.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(b||"_limitItems")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { limit: "+d+" } ",e.opts.messages!==!1&&(t+=" , message: 'should NOT have ",r=="maxItems"?t+="more":t+="fewer",t+=" than ",m?t+="' + "+d+" + '":t+=""+i,t+=" items' "),e.opts.verbose&&(t+=" , schema:  ",m?t+="validate.schema"+l:t+=""+i,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ";var x=t;return t=g.pop(),!e.compositeRule&&p?e.async?t+=" throw new ValidationError(["+x+"]); ":t+=" validate.errors = ["+x+"]; return false; ":t+=" var err = "+x+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+="} ",p&&(t+=" else { "),t}});var lo=X((VP,xl)=>{"use strict";xl.exports=function(e,r,a){var t=" ",n=e.level,o=e.dataLevel,i=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,p=!e.opts.allErrors,b,h="data"+(o||""),m=e.opts.$data&&i&&i.$data,d;if(m?(t+=" var schema"+n+" = "+e.util.getData(i.$data,o,e.dataPathArr)+"; ",d="schema"+n):d=i,!(m||typeof i=="number"))throw new Error(r+" must be number");var v=r=="maxLength"?">":"<";t+="if ( ",m&&(t+=" ("+d+" !== undefined && typeof "+d+" != 'number') || "),e.opts.unicode===!1?t+=" "+h+".length ":t+=" ucs2length("+h+") ",t+=" "+v+" "+d+") { ";var b=r,g=g||[];g.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(b||"_limitLength")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { limit: "+d+" } ",e.opts.messages!==!1&&(t+=" , message: 'should NOT be ",r=="maxLength"?t+="longer":t+="shorter",t+=" than ",m?t+="' + "+d+" + '":t+=""+i,t+=" characters' "),e.opts.verbose&&(t+=" , schema:  ",m?t+="validate.schema"+l:t+=""+i,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ";var x=t;return t=g.pop(),!e.compositeRule&&p?e.async?t+=" throw new ValidationError(["+x+"]); ":t+=" validate.errors = ["+x+"]; return false; ":t+=" var err = "+x+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+="} ",p&&(t+=" else { "),t}});var uo=X((HP,wl)=>{"use strict";wl.exports=function(e,r,a){var t=" ",n=e.level,o=e.dataLevel,i=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,p=!e.opts.allErrors,b,h="data"+(o||""),m=e.opts.$data&&i&&i.$data,d;if(m?(t+=" var schema"+n+" = "+e.util.getData(i.$data,o,e.dataPathArr)+"; ",d="schema"+n):d=i,!(m||typeof i=="number"))throw new Error(r+" must be number");var v=r=="maxProperties"?">":"<";t+="if ( ",m&&(t+=" ("+d+" !== undefined && typeof "+d+" != 'number') || "),t+=" Object.keys("+h+").length "+v+" "+d+") { ";var b=r,g=g||[];g.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(b||"_limitProperties")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { limit: "+d+" } ",e.opts.messages!==!1&&(t+=" , message: 'should NOT have ",r=="maxProperties"?t+="more":t+="fewer",t+=" than ",m?t+="' + "+d+" + '":t+=""+i,t+=" properties' "),e.opts.verbose&&(t+=" , schema:  ",m?t+="validate.schema"+l:t+=""+i,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ";var x=t;return t=g.pop(),!e.compositeRule&&p?e.async?t+=" throw new ValidationError(["+x+"]); ":t+=" validate.errors = ["+x+"]; return false; ":t+=" var err = "+x+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+="} ",p&&(t+=" else { "),t}});var El=X((WP,_l)=>{"use strict";_l.exports=function(e,r,a){var t=" ",n=e.level,o=e.dataLevel,i=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,p=!e.opts.allErrors,h="data"+(o||""),m=e.opts.$data&&i&&i.$data,d;if(m?(t+=" var schema"+n+" = "+e.util.getData(i.$data,o,e.dataPathArr)+"; ",d="schema"+n):d=i,!(m||typeof i=="number"))throw new Error(r+" must be number");t+="var division"+n+";if (",m&&(t+=" "+d+" !== undefined && ( typeof "+d+" != 'number' || "),t+=" (division"+n+" = "+h+" / "+d+", ",e.opts.multipleOfPrecision?t+=" Math.abs(Math.round(division"+n+") - division"+n+") > 1e-"+e.opts.multipleOfPrecision+" ":t+=" division"+n+" !== parseInt(division"+n+") ",t+=" ) ",m&&(t+="  )  "),t+=" ) {   ";var v=v||[];v.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'multipleOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { multipleOf: "+d+" } ",e.opts.messages!==!1&&(t+=" , message: 'should be multiple of ",m?t+="' + "+d:t+=""+d+"'"),e.opts.verbose&&(t+=" , schema:  ",m?t+="validate.schema"+l:t+=""+i,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ";var b=t;return t=v.pop(),!e.compositeRule&&p?e.async?t+=" throw new ValidationError(["+b+"]); ":t+=" validate.errors = ["+b+"]; return false; ":t+=" var err = "+b+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+="} ",p&&(t+=" else { "),t}});var Rl=X((zP,Sl)=>{"use strict";Sl.exports=function(e,r,a){var t=" ",n=e.level,o=e.dataLevel,i=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,p=!e.opts.allErrors,h="data"+(o||""),m="errs__"+n,d=e.util.copy(e);d.level++;var v="valid"+d.level;if(e.opts.strictKeywords?typeof i=="object"&&Object.keys(i).length>0||i===!1:e.util.schemaHasRules(i,e.RULES.all)){d.schema=i,d.schemaPath=l,d.errSchemaPath=u,t+=" var "+m+" = errors;  ";var b=e.compositeRule;e.compositeRule=d.compositeRule=!0,d.createErrors=!1;var g;d.opts.allErrors&&(g=d.opts.allErrors,d.opts.allErrors=!1),t+=" "+e.validate(d)+" ",d.createErrors=!0,g&&(d.opts.allErrors=g),e.compositeRule=d.compositeRule=b,t+=" if ("+v+") {   ";var x=x||[];x.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: 'should NOT be valid' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ";var S=t;t=x.pop(),!e.compositeRule&&p?e.async?t+=" throw new ValidationError(["+S+"]); ":t+=" validate.errors = ["+S+"]; return false; ":t+=" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else {  errors = "+m+"; if (vErrors !== null) { if ("+m+") vErrors.length = "+m+"; else vErrors = null; } ",e.opts.allErrors&&(t+=" } ")}else t+="  var err =   ",e.createErrors!==!1?(t+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: 'should NOT be valid' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",p&&(t+=" if (false) { ");return t}});var Tl=X((BP,Cl)=>{"use strict";Cl.exports=function(e,r,a){var t=" ",n=e.level,o=e.dataLevel,i=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,p=!e.opts.allErrors,h="data"+(o||""),m="valid"+n,d="errs__"+n,v=e.util.copy(e),b="";v.level++;var g="valid"+v.level,x=v.baseId,S="prevValid"+n,E="passingSchemas"+n;t+="var "+d+" = errors , "+S+" = false , "+m+" = false , "+E+" = null; ";var C=e.compositeRule;e.compositeRule=v.compositeRule=!0;var I=i;if(I)for(var O,B=-1,V=I.length-1;B<V;)O=I[B+=1],(e.opts.strictKeywords?typeof O=="object"&&Object.keys(O).length>0||O===!1:e.util.schemaHasRules(O,e.RULES.all))?(v.schema=O,v.schemaPath=l+"["+B+"]",v.errSchemaPath=u+"/"+B,t+="  "+e.validate(v)+" ",v.baseId=x):t+=" var "+g+" = true; ",B&&(t+=" if ("+g+" && "+S+") { "+m+" = false; "+E+" = ["+E+", "+B+"]; } else { ",b+="}"),t+=" if ("+g+") { "+m+" = "+S+" = true; "+E+" = "+B+"; }";return e.compositeRule=v.compositeRule=C,t+=""+b+"if (!"+m+") {   var err =   ",e.createErrors!==!1?(t+=" { keyword: 'oneOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { passingSchemas: "+E+" } ",e.opts.messages!==!1&&(t+=" , message: 'should match exactly one schema in oneOf' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&p&&(e.async?t+=" throw new ValidationError(vErrors); ":t+=" validate.errors = vErrors; return false; "),t+="} else {  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; }",e.opts.allErrors&&(t+=" } "),t}});var Al=X((ZP,kl)=>{"use strict";kl.exports=function(e,r,a){var t=" ",n=e.level,o=e.dataLevel,i=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,p=!e.opts.allErrors,h="data"+(o||""),m=e.opts.$data&&i&&i.$data,d;m?(t+=" var schema"+n+" = "+e.util.getData(i.$data,o,e.dataPathArr)+"; ",d="schema"+n):d=i;var v=m?"(new RegExp("+d+"))":e.usePattern(i);t+="if ( ",m&&(t+=" ("+d+" !== undefined && typeof "+d+" != 'string') || "),t+=" !"+v+".test("+h+") ) {   ";var b=b||[];b.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'pattern' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { pattern:  ",m?t+=""+d:t+=""+e.util.toQuotedString(i),t+="  } ",e.opts.messages!==!1&&(t+=` , message: 'should match pattern "`,m?t+="' + "+d+" + '":t+=""+e.util.escapeQuotes(i),t+=`"' `),e.opts.verbose&&(t+=" , schema:  ",m?t+="validate.schema"+l:t+=""+e.util.toQuotedString(i),t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ";var g=t;return t=b.pop(),!e.compositeRule&&p?e.async?t+=" throw new ValidationError(["+g+"]); ":t+=" validate.errors = ["+g+"]; return false; ":t+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+="} ",p&&(t+=" else { "),t}});var Ol=X((GP,Il)=>{"use strict";Il.exports=function(e,r,a){var t=" ",n=e.level,o=e.dataLevel,i=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,p=!e.opts.allErrors,h="data"+(o||""),m="errs__"+n,d=e.util.copy(e),v="";d.level++;var b="valid"+d.level,g="key"+n,x="idx"+n,S=d.dataLevel=e.dataLevel+1,E="data"+S,C="dataProperties"+n,I=Object.keys(i||{}).filter(J),O=e.schema.patternProperties||{},B=Object.keys(O).filter(J),V=e.schema.additionalProperties,$=I.length||B.length,H=V===!1,U=typeof V=="object"&&Object.keys(V).length,q=e.opts.removeAdditional,k=H||U||q,D=e.opts.ownProperties,M=e.baseId,Z=e.schema.required;if(Z&&!(e.opts.$data&&Z.$data)&&Z.length<e.opts.loopRequired)var N=e.util.toHash(Z);function J(it){return it!=="__proto__"}if(t+="var "+m+" = errors;var "+b+" = true;",D&&(t+=" var "+C+" = undefined;"),k){if(D?t+=" "+C+" = "+C+" || Object.keys("+h+"); for (var "+x+"=0; "+x+"<"+C+".length; "+x+"++) { var "+g+" = "+C+"["+x+"]; ":t+=" for (var "+g+" in "+h+") { ",$){if(t+=" var isAdditional"+n+" = !(false ",I.length)if(I.length>8)t+=" || validate.schema"+l+".hasOwnProperty("+g+") ";else{var te=I;if(te)for(var G,Pe=-1,Me=te.length-1;Pe<Me;)G=te[Pe+=1],t+=" || "+g+" == "+e.util.toQuotedString(G)+" "}if(B.length){var qe=B;if(qe)for(var ce,Re=-1,Ie=qe.length-1;Re<Ie;)ce=qe[Re+=1],t+=" || "+e.usePattern(ce)+".test("+g+") "}t+=" ); if (isAdditional"+n+") { "}if(q=="all")t+=" delete "+h+"["+g+"]; ";else{var Ue=e.errorPath,It="' + "+g+" + '";if(e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(e.errorPath,g,e.opts.jsonPointers)),H)if(q)t+=" delete "+h+"["+g+"]; ";else{t+=" "+b+" = false; ";var wt=u;u=e.errSchemaPath+"/additionalProperties";var Ce=Ce||[];Ce.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'additionalProperties' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { additionalProperty: '"+It+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is an invalid additional property":t+="should NOT have additional properties",t+="' "),e.opts.verbose&&(t+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ";var xe=t;t=Ce.pop(),!e.compositeRule&&p?e.async?t+=" throw new ValidationError(["+xe+"]); ":t+=" validate.errors = ["+xe+"]; return false; ":t+=" var err = "+xe+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",u=wt,p&&(t+=" break; ")}else if(U)if(q=="failing"){t+=" var "+m+" = errors;  ";var Gt=e.compositeRule;e.compositeRule=d.compositeRule=!0,d.schema=V,d.schemaPath=e.schemaPath+".additionalProperties",d.errSchemaPath=e.errSchemaPath+"/additionalProperties",d.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,g,e.opts.jsonPointers);var Fe=h+"["+g+"]";d.dataPathArr[S]=g;var ue=e.validate(d);d.baseId=M,e.util.varOccurences(ue,E)<2?t+=" "+e.util.varReplace(ue,E,Fe)+" ":t+=" var "+E+" = "+Fe+"; "+ue+" ",t+=" if (!"+b+") { errors = "+m+"; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete "+h+"["+g+"]; }  ",e.compositeRule=d.compositeRule=Gt}else{d.schema=V,d.schemaPath=e.schemaPath+".additionalProperties",d.errSchemaPath=e.errSchemaPath+"/additionalProperties",d.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,g,e.opts.jsonPointers);var Fe=h+"["+g+"]";d.dataPathArr[S]=g;var ue=e.validate(d);d.baseId=M,e.util.varOccurences(ue,E)<2?t+=" "+e.util.varReplace(ue,E,Fe)+" ":t+=" var "+E+" = "+Fe+"; "+ue+" ",p&&(t+=" if (!"+b+") break; ")}e.errorPath=Ue}$&&(t+=" } "),t+=" }  ",p&&(t+=" if ("+b+") { ",v+="}")}var Ot=e.opts.useDefaults&&!e.compositeRule;if(I.length){var _t=I;if(_t)for(var G,Jt=-1,Qt=_t.length-1;Jt<Qt;){G=_t[Jt+=1];var $e=i[G];if(e.opts.strictKeywords?typeof $e=="object"&&Object.keys($e).length>0||$e===!1:e.util.schemaHasRules($e,e.RULES.all)){var Ye=e.util.getProperty(G),Fe=h+Ye,We=Ot&&$e.default!==void 0;d.schema=$e,d.schemaPath=l+Ye,d.errSchemaPath=u+"/"+e.util.escapeFragment(G),d.errorPath=e.util.getPath(e.errorPath,G,e.opts.jsonPointers),d.dataPathArr[S]=e.util.toQuotedString(G);var ue=e.validate(d);if(d.baseId=M,e.util.varOccurences(ue,E)<2){ue=e.util.varReplace(ue,E,Fe);var Ve=Fe}else{var Ve=E;t+=" var "+E+" = "+Fe+"; "}if(We)t+=" "+ue+" ";else{if(N&&N[G]){t+=" if ( "+Ve+" === undefined ",D&&(t+=" || ! Object.prototype.hasOwnProperty.call("+h+", '"+e.util.escapeQuotes(G)+"') "),t+=") { "+b+" = false; ";var Ue=e.errorPath,wt=u,ft=e.util.escapeQuotes(G);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(Ue,G,e.opts.jsonPointers)),u=e.errSchemaPath+"/required";var Ce=Ce||[];Ce.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { missingProperty: '"+ft+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+ft+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ";var xe=t;t=Ce.pop(),!e.compositeRule&&p?e.async?t+=" throw new ValidationError(["+xe+"]); ":t+=" validate.errors = ["+xe+"]; return false; ":t+=" var err = "+xe+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",u=wt,e.errorPath=Ue,t+=" } else { "}else p?(t+=" if ( "+Ve+" === undefined ",D&&(t+=" || ! Object.prototype.hasOwnProperty.call("+h+", '"+e.util.escapeQuotes(G)+"') "),t+=") { "+b+" = true; } else { "):(t+=" if ("+Ve+" !== undefined ",D&&(t+=" &&   Object.prototype.hasOwnProperty.call("+h+", '"+e.util.escapeQuotes(G)+"') "),t+=" ) { ");t+=" "+ue+" } "}}p&&(t+=" if ("+b+") { ",v+="}")}}if(B.length){var Ge=B;if(Ge)for(var ce,_s=-1,tn=Ge.length-1;_s<tn;){ce=Ge[_s+=1];var $e=O[ce];if(e.opts.strictKeywords?typeof $e=="object"&&Object.keys($e).length>0||$e===!1:e.util.schemaHasRules($e,e.RULES.all)){d.schema=$e,d.schemaPath=e.schemaPath+".patternProperties"+e.util.getProperty(ce),d.errSchemaPath=e.errSchemaPath+"/patternProperties/"+e.util.escapeFragment(ce),D?t+=" "+C+" = "+C+" || Object.keys("+h+"); for (var "+x+"=0; "+x+"<"+C+".length; "+x+"++) { var "+g+" = "+C+"["+x+"]; ":t+=" for (var "+g+" in "+h+") { ",t+=" if ("+e.usePattern(ce)+".test("+g+")) { ",d.errorPath=e.util.getPathExpr(e.errorPath,g,e.opts.jsonPointers);var Fe=h+"["+g+"]";d.dataPathArr[S]=g;var ue=e.validate(d);d.baseId=M,e.util.varOccurences(ue,E)<2?t+=" "+e.util.varReplace(ue,E,Fe)+" ":t+=" var "+E+" = "+Fe+"; "+ue+" ",p&&(t+=" if (!"+b+") break; "),t+=" } ",p&&(t+=" else "+b+" = true; "),t+=" }  ",p&&(t+=" if ("+b+") { ",v+="}")}}}return p&&(t+=" "+v+" if ("+m+" == errors) {"),t}});var Dl=X((JP,$l)=>{"use strict";$l.exports=function(e,r,a){var t=" ",n=e.level,o=e.dataLevel,i=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,p=!e.opts.allErrors,h="data"+(o||""),m="errs__"+n,d=e.util.copy(e),v="";d.level++;var b="valid"+d.level;if(t+="var "+m+" = errors;",e.opts.strictKeywords?typeof i=="object"&&Object.keys(i).length>0||i===!1:e.util.schemaHasRules(i,e.RULES.all)){d.schema=i,d.schemaPath=l,d.errSchemaPath=u;var g="key"+n,x="idx"+n,S="i"+n,E="' + "+g+" + '",C=d.dataLevel=e.dataLevel+1,I="data"+C,O="dataProperties"+n,B=e.opts.ownProperties,V=e.baseId;B&&(t+=" var "+O+" = undefined; "),B?t+=" "+O+" = "+O+" || Object.keys("+h+"); for (var "+x+"=0; "+x+"<"+O+".length; "+x+"++) { var "+g+" = "+O+"["+x+"]; ":t+=" for (var "+g+" in "+h+") { ",t+=" var startErrs"+n+" = errors; ";var $=g,H=e.compositeRule;e.compositeRule=d.compositeRule=!0;var U=e.validate(d);d.baseId=V,e.util.varOccurences(U,I)<2?t+=" "+e.util.varReplace(U,I,$)+" ":t+=" var "+I+" = "+$+"; "+U+" ",e.compositeRule=d.compositeRule=H,t+=" if (!"+b+") { for (var "+S+"=startErrs"+n+"; "+S+"<errors; "+S+"++) { vErrors["+S+"].propertyName = "+g+"; }   var err =   ",e.createErrors!==!1?(t+=" { keyword: 'propertyNames' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { propertyName: '"+E+"' } ",e.opts.messages!==!1&&(t+=" , message: 'property name \\'"+E+"\\' is invalid' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&p&&(e.async?t+=" throw new ValidationError(vErrors); ":t+=" validate.errors = vErrors; return false; "),p&&(t+=" break; "),t+=" } }"}return p&&(t+=" "+v+" if ("+m+" == errors) {"),t}});var Ml=X((QP,Nl)=>{"use strict";Nl.exports=function(e,r,a){var t=" ",n=e.level,o=e.dataLevel,i=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,p=!e.opts.allErrors,h="data"+(o||""),m="valid"+n,d=e.opts.$data&&i&&i.$data,v;d?(t+=" var schema"+n+" = "+e.util.getData(i.$data,o,e.dataPathArr)+"; ",v="schema"+n):v=i;var b="schema"+n;if(!d)if(i.length<e.opts.loopRequired&&e.schema.properties&&Object.keys(e.schema.properties).length){var g=[],x=i;if(x)for(var S,E=-1,C=x.length-1;E<C;){S=x[E+=1];var I=e.schema.properties[S];I&&(e.opts.strictKeywords?typeof I=="object"&&Object.keys(I).length>0||I===!1:e.util.schemaHasRules(I,e.RULES.all))||(g[g.length]=S)}}else var g=i;if(d||g.length){var O=e.errorPath,B=d||g.length>=e.opts.loopRequired,V=e.opts.ownProperties;if(p)if(t+=" var missing"+n+"; ",B){d||(t+=" var "+b+" = validate.schema"+l+"; ");var $="i"+n,H="schema"+n+"["+$+"]",U="' + "+H+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(O,H,e.opts.jsonPointers)),t+=" var "+m+" = true; ",d&&(t+=" if (schema"+n+" === undefined) "+m+" = true; else if (!Array.isArray(schema"+n+")) "+m+" = false; else {"),t+=" for (var "+$+" = 0; "+$+" < "+b+".length; "+$+"++) { "+m+" = "+h+"["+b+"["+$+"]] !== undefined ",V&&(t+=" &&   Object.prototype.hasOwnProperty.call("+h+", "+b+"["+$+"]) "),t+="; if (!"+m+") break; } ",d&&(t+="  }  "),t+="  if (!"+m+") {   ";var q=q||[];q.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { missingProperty: '"+U+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+U+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ";var k=t;t=q.pop(),!e.compositeRule&&p?e.async?t+=" throw new ValidationError(["+k+"]); ":t+=" validate.errors = ["+k+"]; return false; ":t+=" var err = "+k+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else { "}else{t+=" if ( ";var D=g;if(D)for(var M,$=-1,Z=D.length-1;$<Z;){M=D[$+=1],$&&(t+=" || ");var N=e.util.getProperty(M),J=h+N;t+=" ( ( "+J+" === undefined ",V&&(t+=" || ! Object.prototype.hasOwnProperty.call("+h+", '"+e.util.escapeQuotes(M)+"') "),t+=") && (missing"+n+" = "+e.util.toQuotedString(e.opts.jsonPointers?M:N)+") ) "}t+=") {  ";var H="missing"+n,U="' + "+H+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(O,H,!0):O+" + "+H);var q=q||[];q.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { missingProperty: '"+U+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+U+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ";var k=t;t=q.pop(),!e.compositeRule&&p?e.async?t+=" throw new ValidationError(["+k+"]); ":t+=" validate.errors = ["+k+"]; return false; ":t+=" var err = "+k+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else { "}else if(B){d||(t+=" var "+b+" = validate.schema"+l+"; ");var $="i"+n,H="schema"+n+"["+$+"]",U="' + "+H+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(O,H,e.opts.jsonPointers)),d&&(t+=" if ("+b+" && !Array.isArray("+b+")) {  var err =   ",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { missingProperty: '"+U+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+U+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if ("+b+" !== undefined) { "),t+=" for (var "+$+" = 0; "+$+" < "+b+".length; "+$+"++) { if ("+h+"["+b+"["+$+"]] === undefined ",V&&(t+=" || ! Object.prototype.hasOwnProperty.call("+h+", "+b+"["+$+"]) "),t+=") {  var err =   ",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { missingProperty: '"+U+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+U+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ",d&&(t+="  }  ")}else{var te=g;if(te)for(var M,G=-1,Pe=te.length-1;G<Pe;){M=te[G+=1];var N=e.util.getProperty(M),U=e.util.escapeQuotes(M),J=h+N;e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(O,M,e.opts.jsonPointers)),t+=" if ( "+J+" === undefined ",V&&(t+=" || ! Object.prototype.hasOwnProperty.call("+h+", '"+e.util.escapeQuotes(M)+"') "),t+=") {  var err =   ",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { missingProperty: '"+U+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+U+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}e.errorPath=O}else p&&(t+=" if (true) {");return t}});var Ll=X((KP,Fl)=>{"use strict";Fl.exports=function(e,r,a){var t=" ",n=e.level,o=e.dataLevel,i=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,p=!e.opts.allErrors,h="data"+(o||""),m="valid"+n,d=e.opts.$data&&i&&i.$data,v;if(d?(t+=" var schema"+n+" = "+e.util.getData(i.$data,o,e.dataPathArr)+"; ",v="schema"+n):v=i,(i||d)&&e.opts.uniqueItems!==!1){d&&(t+=" var "+m+"; if ("+v+" === false || "+v+" === undefined) "+m+" = true; else if (typeof "+v+" != 'boolean') "+m+" = false; else { "),t+=" var i = "+h+".length , "+m+" = true , j; if (i > 1) { ";var b=e.schema.items&&e.schema.items.type,g=Array.isArray(b);if(!b||b=="object"||b=="array"||g&&(b.indexOf("object")>=0||b.indexOf("array")>=0))t+=" outer: for (;i--;) { for (j = i; j--;) { if (equal("+h+"[i], "+h+"[j])) { "+m+" = false; break outer; } } } ";else{t+=" var itemIndices = {}, item; for (;i--;) { var item = "+h+"[i]; ";var x="checkDataType"+(g?"s":"");t+=" if ("+e.util[x](b,"item",e.opts.strictNumbers,!0)+") continue; ",g&&(t+=` if (typeof item == 'string') item = '"' + item; `),t+=" if (typeof itemIndices[item] == 'number') { "+m+" = false; j = itemIndices[item]; break; } itemIndices[item] = i; } "}t+=" } ",d&&(t+="  }  "),t+=" if (!"+m+") {   ";var S=S||[];S.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'uniqueItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { i: i, j: j } ",e.opts.messages!==!1&&(t+=" , message: 'should NOT have duplicate items (items ## ' + j + ' and ' + i + ' are identical)' "),e.opts.verbose&&(t+=" , schema:  ",d?t+="validate.schema"+l:t+=""+i,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ";var E=t;t=S.pop(),!e.compositeRule&&p?e.async?t+=" throw new ValidationError(["+E+"]); ":t+=" validate.errors = ["+E+"]; return false; ":t+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } ",p&&(t+=" else { ")}else p&&(t+=" if (true) { ");return t}});var ql=X((XP,jl)=>{"use strict";jl.exports={$ref:Xc(),allOf:el(),anyOf:rl(),$comment:al(),const:ol(),contains:cl(),dependencies:ul(),enum:pl(),format:hl(),if:vl(),items:yl(),maximum:io(),minimum:io(),maxItems:co(),minItems:co(),maxLength:lo(),minLength:lo(),maxProperties:uo(),minProperties:uo(),multipleOf:El(),not:Rl(),oneOf:Tl(),pattern:Al(),properties:Ol(),propertyNames:Dl(),required:Ml(),uniqueItems:Ll(),validate:no()}});var Hl=X((YP,Vl)=>{"use strict";var Ul=ql(),po=gr().toHash;Vl.exports=function(){var e=[{type:"number",rules:[{maximum:["exclusiveMaximum"]},{minimum:["exclusiveMinimum"]},"multipleOf","format"]},{type:"string",rules:["maxLength","minLength","pattern","format"]},{type:"array",rules:["maxItems","minItems","items","contains","uniqueItems"]},{type:"object",rules:["maxProperties","minProperties","required","dependencies","propertyNames",{properties:["additionalProperties","patternProperties"]}]},{rules:["$ref","const","enum","not","anyOf","oneOf","allOf","if"]}],r=["type","$comment"],a=["$schema","$id","id","$data","$async","title","description","default","definitions","examples","readOnly","writeOnly","contentMediaType","contentEncoding","additionalItems","then","else"],t=["number","integer","string","array","object","boolean","null"];return e.all=po(r),e.types=po(t),e.forEach(function(n){n.rules=n.rules.map(function(o){var i;if(typeof o=="object"){var l=Object.keys(o)[0];i=o[l],o=l,i.forEach(function(p){r.push(p),e.all[p]=!0})}r.push(o);var u=e.all[o]={keyword:o,code:Ul[o],implements:i};return u}),e.all.$comment={keyword:"$comment",code:Ul.$comment},n.type&&(e.types[n.type]=n)}),e.keywords=po(r.concat(a)),e.custom={},e}});var Bl=X((ex,zl)=>{"use strict";var Wl=["multipleOf","maximum","exclusiveMaximum","minimum","exclusiveMinimum","maxLength","minLength","pattern","additionalItems","maxItems","minItems","uniqueItems","maxProperties","minProperties","required","additionalProperties","enum","format","const"];zl.exports=function(s,e){for(var r=0;r<e.length;r++){s=JSON.parse(JSON.stringify(s));var a=e[r].split("/"),t=s,n;for(n=1;n<a.length;n++)t=t[a[n]];for(n=0;n<Wl.length;n++){var o=Wl[n],i=t[o];i&&(t[o]={anyOf:[i,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]})}}return s}});var Jl=X((tx,Gl)=>{"use strict";var fv=Sa().MissingRef;Gl.exports=Zl;function Zl(s,e,r){var a=this;if(typeof this._opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");typeof e=="function"&&(r=e,e=void 0);var t=n(s).then(function(){var i=a._addSchema(s,void 0,e);return i.validate||o(i)});return r&&t.then(function(i){r(null,i)},r),t;function n(i){var l=i.$schema;return l&&!a.getSchema(l)?Zl.call(a,{$ref:l},!0):Promise.resolve()}function o(i){try{return a._compile(i)}catch(u){if(u instanceof fv)return l(u);throw u}function l(u){var p=u.missingSchema;if(d(p))throw new Error("Schema "+p+" is loaded but "+u.missingRef+" cannot be resolved");var h=a._loadingSchemas[p];return h||(h=a._loadingSchemas[p]=a._opts.loadSchema(p),h.then(m,m)),h.then(function(v){if(!d(p))return n(v).then(function(){d(p)||a.addSchema(v,p,void 0,e)})}).then(function(){return o(i)});function m(){delete a._loadingSchemas[p]}function d(v){return a._refs[v]||a._schemas[v]}}}}});var Kl=X((rx,Ql)=>{"use strict";Ql.exports=function(e,r,a){var t=" ",n=e.level,o=e.dataLevel,i=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,p=!e.opts.allErrors,h,m="data"+(o||""),d="valid"+n,v="errs__"+n,b=e.opts.$data&&i&&i.$data,g;b?(t+=" var schema"+n+" = "+e.util.getData(i.$data,o,e.dataPathArr)+"; ",g="schema"+n):g=i;var x=this,S="definition"+n,E=x.definition,C="",I,O,B,V,$;if(b&&E.$data){$="keywordValidate"+n;var H=E.validateSchema;t+=" var "+S+" = RULES.custom['"+r+"'].definition; var "+$+" = "+S+".validate;"}else{if(V=e.useCustomRule(x,i,e.schema,e),!V)return;g="validate.schema"+l,$=V.code,I=E.compile,O=E.inline,B=E.macro}var U=$+".errors",q="i"+n,k="ruleErr"+n,D=E.async;if(D&&!e.async)throw new Error("async keyword in sync schema");if(O||B||(t+=""+U+" = null;"),t+="var "+v+" = errors;var "+d+";",b&&E.$data&&(C+="}",t+=" if ("+g+" === undefined) { "+d+" = true; } else { ",H&&(C+="}",t+=" "+d+" = "+S+".validateSchema("+g+"); if ("+d+") { ")),O)E.statements?t+=" "+V.validate+" ":t+=" "+d+" = "+V.validate+"; ";else if(B){var M=e.util.copy(e),C="";M.level++;var Z="valid"+M.level;M.schema=V.validate,M.schemaPath="";var N=e.compositeRule;e.compositeRule=M.compositeRule=!0;var J=e.validate(M).replace(/validate\.schema/g,$);e.compositeRule=M.compositeRule=N,t+=" "+J}else{var te=te||[];te.push(t),t="",t+="  "+$+".call( ",e.opts.passContext?t+="this":t+="self",I||E.schema===!1?t+=" , "+m+" ":t+=" , "+g+" , "+m+" , validate.schema"+e.schemaPath+" ",t+=" , (dataPath || '')",e.errorPath!='""'&&(t+=" + "+e.errorPath);var G=o?"data"+(o-1||""):"parentData",Pe=o?e.dataPathArr[o]:"parentDataProperty";t+=" , "+G+" , "+Pe+" , rootData )  ";var Me=t;t=te.pop(),E.errors===!1?(t+=" "+d+" = ",D&&(t+="await "),t+=""+Me+"; "):D?(U="customErrors"+n,t+=" var "+U+" = null; try { "+d+" = await "+Me+"; } catch (e) { "+d+" = false; if (e instanceof ValidationError) "+U+" = e.errors; else throw e; } "):t+=" "+U+" = null; "+d+" = "+Me+"; "}if(E.modifying&&(t+=" if ("+G+") "+m+" = "+G+"["+Pe+"];"),t+=""+C,E.valid)p&&(t+=" if (true) { ");else{t+=" if ( ",E.valid===void 0?(t+=" !",B?t+=""+Z:t+=""+d):t+=" "+!E.valid+" ",t+=") { ",h=x.keyword;var te=te||[];te.push(t),t="";var te=te||[];te.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(h||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { keyword: '"+x.keyword+"' } ",e.opts.messages!==!1&&(t+=` , message: 'should pass "`+x.keyword+`" keyword validation' `),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";var qe=t;t=te.pop(),!e.compositeRule&&p?e.async?t+=" throw new ValidationError(["+qe+"]); ":t+=" validate.errors = ["+qe+"]; return false; ":t+=" var err = "+qe+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";var ce=t;t=te.pop(),O?E.errors?E.errors!="full"&&(t+="  for (var "+q+"="+v+"; "+q+"<errors; "+q+"++) { var "+k+" = vErrors["+q+"]; if ("+k+".dataPath === undefined) "+k+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+k+".schemaPath === undefined) { "+k+'.schemaPath = "'+u+'"; } ',e.opts.verbose&&(t+=" "+k+".schema = "+g+"; "+k+".data = "+m+"; "),t+=" } "):E.errors===!1?t+=" "+ce+" ":(t+=" if ("+v+" == errors) { "+ce+" } else {  for (var "+q+"="+v+"; "+q+"<errors; "+q+"++) { var "+k+" = vErrors["+q+"]; if ("+k+".dataPath === undefined) "+k+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+k+".schemaPath === undefined) { "+k+'.schemaPath = "'+u+'"; } ',e.opts.verbose&&(t+=" "+k+".schema = "+g+"; "+k+".data = "+m+"; "),t+=" } } "):B?(t+="   var err =   ",e.createErrors!==!1?(t+=" { keyword: '"+(h||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { keyword: '"+x.keyword+"' } ",e.opts.messages!==!1&&(t+=` , message: 'should pass "`+x.keyword+`" keyword validation' `),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&p&&(e.async?t+=" throw new ValidationError(vErrors); ":t+=" validate.errors = vErrors; return false; ")):E.errors===!1?t+=" "+ce+" ":(t+=" if (Array.isArray("+U+")) { if (vErrors === null) vErrors = "+U+"; else vErrors = vErrors.concat("+U+"); errors = vErrors.length;  for (var "+q+"="+v+"; "+q+"<errors; "+q+"++) { var "+k+" = vErrors["+q+"]; if ("+k+".dataPath === undefined) "+k+".dataPath = (dataPath || '') + "+e.errorPath+";  "+k+'.schemaPath = "'+u+'";  ',e.opts.verbose&&(t+=" "+k+".schema = "+g+"; "+k+".data = "+m+"; "),t+=" } } else { "+ce+" } "),t+=" } ",p&&(t+=" else { ")}return t}});var fo=X((sx,hv)=>{hv.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}});var eu=X((ax,Yl)=>{"use strict";var Xl=fo();Yl.exports={$id:"https://github.com/ajv-validator/ajv/blob/master/lib/definition_schema.js",definitions:{simpleTypes:Xl.definitions.simpleTypes},type:"object",dependencies:{schema:["validate"],$data:["validate"],statements:["inline"],valid:{not:{required:["macro"]}}},properties:{type:Xl.properties.type,schema:{type:"boolean"},statements:{type:"boolean"},dependencies:{type:"array",items:{type:"string"}},metaSchema:{type:"object"},modifying:{type:"boolean"},valid:{type:"boolean"},$data:{type:"boolean"},async:{type:"boolean"},errors:{anyOf:[{type:"boolean"},{const:"full"}]}}}});var ru=X((nx,tu)=>{"use strict";var mv=/^[a-z_$][a-z0-9_$-]*$/i,vv=Kl(),gv=eu();tu.exports={add:yv,get:bv,remove:Pv,validate:ho};function yv(s,e){var r=this.RULES;if(r.keywords[s])throw new Error("Keyword "+s+" is already defined");if(!mv.test(s))throw new Error("Keyword "+s+" is not a valid identifier");if(e){this.validateKeyword(e,!0);var a=e.type;if(Array.isArray(a))for(var t=0;t<a.length;t++)o(s,a[t],e);else o(s,a,e);var n=e.metaSchema;n&&(e.$data&&this._opts.$data&&(n={anyOf:[n,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]}),e.validateSchema=this.compile(n,!0))}r.keywords[s]=r.all[s]=!0;function o(i,l,u){for(var p,h=0;h<r.length;h++){var m=r[h];if(m.type==l){p=m;break}}p||(p={type:l,rules:[]},r.push(p));var d={keyword:i,definition:u,custom:!0,code:vv,implements:u.implements};p.rules.push(d),r.custom[i]=d}return this}function bv(s){var e=this.RULES.custom[s];return e?e.definition:this.RULES.keywords[s]||!1}function Pv(s){var e=this.RULES;delete e.keywords[s],delete e.all[s],delete e.custom[s];for(var r=0;r<e.length;r++)for(var a=e[r].rules,t=0;t<a.length;t++)if(a[t].keyword==s){a.splice(t,1);break}return this}function ho(s,e){ho.errors=null;var r=this._validateKeyword=this._validateKeyword||this.compile(gv,!0);if(r(s))return!0;if(ho.errors=r.errors,e)throw new Error("custom keyword definition is invalid: "+this.errorsText(r.errors));return!1}});var su=X((ox,xv)=>{xv.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON Schema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}});var fu=X((ix,pu)=>{"use strict";var nu=Mc(),yr=Ea(),wv=Lc(),ou=Xn(),_v=ao(),Ev=Qc(),Sv=Hl(),iu=Bl(),cu=gr();pu.exports=_e;_e.prototype.validate=Cv;_e.prototype.compile=Tv;_e.prototype.addSchema=kv;_e.prototype.addMetaSchema=Av;_e.prototype.validateSchema=Iv;_e.prototype.getSchema=$v;_e.prototype.removeSchema=Nv;_e.prototype.addFormat=Hv;_e.prototype.errorsText=Vv;_e.prototype._addSchema=Mv;_e.prototype._compile=Fv;_e.prototype.compileAsync=Jl();var $a=ru();_e.prototype.addKeyword=$a.add;_e.prototype.getKeyword=$a.get;_e.prototype.removeKeyword=$a.remove;_e.prototype.validateKeyword=$a.validate;var lu=Sa();_e.ValidationError=lu.Validation;_e.MissingRefError=lu.MissingRef;_e.$dataMetaSchema=iu;var Oa="http://json-schema.org/draft-07/schema",au=["removeAdditional","useDefaults","coerceTypes","strictDefaults"],Rv=["/properties"];function _e(s){if(!(this instanceof _e))return new _e(s);s=this._opts=cu.copy(s)||{},Jv(this),this._schemas={},this._refs={},this._fragments={},this._formats=Ev(s.format),this._cache=s.cache||new wv,this._loadingSchemas={},this._compilations=[],this.RULES=Sv(),this._getId=Lv(s),s.loopRequired=s.loopRequired||1/0,s.errorDataPath=="property"&&(s._errorDataPathProperty=!0),s.serialize===void 0&&(s.serialize=_v),this._metaOpts=Gv(this),s.formats&&Bv(this),s.keywords&&Zv(this),Wv(this),typeof s.meta=="object"&&this.addMetaSchema(s.meta),s.nullable&&this.addKeyword("nullable",{metaSchema:{type:"boolean"}}),zv(this)}function Cv(s,e){var r;if(typeof s=="string"){if(r=this.getSchema(s),!r)throw new Error('no schema with key or ref "'+s+'"')}else{var a=this._addSchema(s);r=a.validate||this._compile(a)}var t=r(e);return r.$async!==!0&&(this.errors=r.errors),t}function Tv(s,e){var r=this._addSchema(s,void 0,e);return r.validate||this._compile(r)}function kv(s,e,r,a){if(Array.isArray(s)){for(var t=0;t<s.length;t++)this.addSchema(s[t],void 0,r,a);return this}var n=this._getId(s);if(n!==void 0&&typeof n!="string")throw new Error("schema id must be string");return e=yr.normalizeId(e||n),du(this,e),this._schemas[e]=this._addSchema(s,r,a,!0),this}function Av(s,e,r){return this.addSchema(s,e,r,!0),this}function Iv(s,e){var r=s.$schema;if(r!==void 0&&typeof r!="string")throw new Error("$schema must be a string");if(r=r||this._opts.defaultMeta||Ov(this),!r)return this.logger.warn("meta-schema not available"),this.errors=null,!0;var a=this.validate(r,s);if(!a&&e){var t="schema is invalid: "+this.errorsText();if(this._opts.validateSchema=="log")this.logger.error(t);else throw new Error(t)}return a}function Ov(s){var e=s._opts.meta;return s._opts.defaultMeta=typeof e=="object"?s._getId(e)||e:s.getSchema(Oa)?Oa:void 0,s._opts.defaultMeta}function $v(s){var e=uu(this,s);switch(typeof e){case"object":return e.validate||this._compile(e);case"string":return this.getSchema(e);case"undefined":return Dv(this,s)}}function Dv(s,e){var r=yr.schema.call(s,{schema:{}},e);if(r){var a=r.schema,t=r.root,n=r.baseId,o=nu.call(s,a,t,void 0,n);return s._fragments[e]=new ou({ref:e,fragment:!0,schema:a,root:t,baseId:n,validate:o}),o}}function uu(s,e){return e=yr.normalizeId(e),s._schemas[e]||s._refs[e]||s._fragments[e]}function Nv(s){if(s instanceof RegExp)return Ia(this,this._schemas,s),Ia(this,this._refs,s),this;switch(typeof s){case"undefined":return Ia(this,this._schemas),Ia(this,this._refs),this._cache.clear(),this;case"string":var e=uu(this,s);return e&&this._cache.del(e.cacheKey),delete this._schemas[s],delete this._refs[s],this;case"object":var r=this._opts.serialize,a=r?r(s):s;this._cache.del(a);var t=this._getId(s);t&&(t=yr.normalizeId(t),delete this._schemas[t],delete this._refs[t])}return this}function Ia(s,e,r){for(var a in e){var t=e[a];!t.meta&&(!r||r.test(a))&&(s._cache.del(t.cacheKey),delete e[a])}}function Mv(s,e,r,a){if(typeof s!="object"&&typeof s!="boolean")throw new Error("schema should be object or boolean");var t=this._opts.serialize,n=t?t(s):s,o=this._cache.get(n);if(o)return o;a=a||this._opts.addUsedSchema!==!1;var i=yr.normalizeId(this._getId(s));i&&a&&du(this,i);var l=this._opts.validateSchema!==!1&&!e,u;l&&!(u=i&&i==yr.normalizeId(s.$schema))&&this.validateSchema(s,!0);var p=yr.ids.call(this,s),h=new ou({id:i,schema:s,localRefs:p,cacheKey:n,meta:r});return i[0]!="#"&&a&&(this._refs[i]=h),this._cache.put(n,h),l&&u&&this.validateSchema(s,!0),h}function Fv(s,e){if(s.compiling)return s.validate=t,t.schema=s.schema,t.errors=null,t.root=e||t,s.schema.$async===!0&&(t.$async=!0),t;s.compiling=!0;var r;s.meta&&(r=this._opts,this._opts=this._metaOpts);var a;try{a=nu.call(this,s.schema,e,s.localRefs)}catch(n){throw delete s.validate,n}finally{s.compiling=!1,s.meta&&(this._opts=r)}return s.validate=a,s.refs=a.refs,s.refVal=a.refVal,s.root=a.root,a;function t(){var n=s.validate,o=n.apply(this,arguments);return t.errors=n.errors,o}}function Lv(s){switch(s.schemaId){case"auto":return Uv;case"id":return jv;default:return qv}}function jv(s){return s.$id&&this.logger.warn("schema $id ignored",s.$id),s.id}function qv(s){return s.id&&this.logger.warn("schema id ignored",s.id),s.$id}function Uv(s){if(s.$id&&s.id&&s.$id!=s.id)throw new Error("schema $id is different from id");return s.$id||s.id}function Vv(s,e){if(s=s||this.errors,!s)return"No errors";e=e||{};for(var r=e.separator===void 0?", ":e.separator,a=e.dataVar===void 0?"data":e.dataVar,t="",n=0;n<s.length;n++){var o=s[n];o&&(t+=a+o.dataPath+" "+o.message+r)}return t.slice(0,-r.length)}function Hv(s,e){return typeof e=="string"&&(e=new RegExp(e)),this._formats[s]=e,this}function Wv(s){var e;if(s._opts.$data&&(e=su(),s.addMetaSchema(e,e.$id,!0)),s._opts.meta!==!1){var r=fo();s._opts.$data&&(r=iu(r,Rv)),s.addMetaSchema(r,Oa,!0),s._refs["http://json-schema.org/schema"]=Oa}}function zv(s){var e=s._opts.schemas;if(e)if(Array.isArray(e))s.addSchema(e);else for(var r in e)s.addSchema(e[r],r)}function Bv(s){for(var e in s._opts.formats){var r=s._opts.formats[e];s.addFormat(e,r)}}function Zv(s){for(var e in s._opts.keywords){var r=s._opts.keywords[e];s.addKeyword(e,r)}}function du(s,e){if(s._schemas[e]||s._refs[e])throw new Error('schema with key or id "'+e+'" already exists')}function Gv(s){for(var e=cu.copy(s._opts),r=0;r<au.length;r++)delete e[au[r]];return e}function Jv(s){var e=s._opts.logger;if(e===!1)s.logger={log:mo,warn:mo,error:mo};else{if(e===void 0&&(e=console),!(typeof e=="object"&&e.log&&e.warn&&e.error))throw new Error("logger must implement log, warn and error methods");s.logger=e}}function mo(){}});function nd(s){return Object.prototype.hasOwnProperty.call(Qa,s)?s:null}var sd,Zr,Qa,ad,od,id,bs,cd,ld,ud,dd,pd,br=De(()=>{"use strict";sd=require("crypto"),Zr=z(require("vscode")),Qa={content:{category:"queryGet",version:1},ping:{category:"queryGet",version:1},selections:{category:"queryGet",version:1},reload:{category:"queryGet",version:1},markForReload:{category:"queryPost",version:1},removeHighlights:{category:"mutationPost",version:1},highlightLines:{category:"mutationPost",version:1},highlight:{category:"mutationPost",version:1},setContent:{category:"mutationPost",version:1},replaceSelection:{category:"mutationPost",version:1}},ad=Object.fromEntries(Object.entries(Qa).map(([s,e])=>[s,e.version]));od=`oai_pwai ${Zr.env.appName}`,id=Zr.workspace.name??Zr.env.appName,bs=Zr.env.appName+"-"+(0,sd.randomUUID)(),cd="com.microsoft.VSCode",ld="com.microsoft.VSCodeInsiders",ud="com.vscodium",dd="com.todesktop.230313mzl4w4u92",pd="com.exafunction.windsurf"});function zt(s){return Eo().find(a=>a.document.fileName===s)||null}function hd(){return Eo().map((e,r)=>{let a=e.selection.isEmpty?null:e.document.getText(e.selection),t=e.selection.isEmpty?null:e.selection.start.line;return a!=null&&t!=null?{selectedText:a,selectionLine:t}:null}).filter(e=>!!e)}function md(){return Eo().map((e,r)=>{let a=e.document.getText(),t=e.document.fileName,n=e.selection.isEmpty?null:e.document.getText(e.selection),o=e.document.offsetAt(e.selection.start),i=e.document.offsetAt(e.selection.end),l=e.selection.isEmpty?null:e.selection.start.line,u=e.selection.isEmpty?null:{location:o,length:i-o};return n===a&&(n=null),{id:t,content:a,filename:t,selectedText:n,selectionRange:u,selectionLine:l}}).filter(e=>!!e)}function Eo(){return fd.window.visibleTextEditors.filter(e=>e.viewColumn!==void 0)}var fd,Ka=De(()=>{"use strict";fd=z(require("vscode"))});function Bt(s){throw new Error(`No editor for id ${s} found`)}var So=De(()=>{"use strict"});async function vd(s,e){let r=zt(e);r||Bt(e);let a=r.document,t=new Gr.Range(a.positionAt(0),a.positionAt(a.getText().length));await r.edit(o=>{o.replace(t,s)});let n=r.document.positionAt(s.length);r.selection=new Gr.Selection(n,n)}async function gd(s,e){let r=zt(e);r||Bt(e);let a=r.selection,t=new Gr.Range(a.start,a.end);await r.edit(n=>{n.replace(t,s)}),r.selection=new Gr.Selection(t.start,t.start)}var Gr,yd=De(()=>{"use strict";Ka();So();Gr=z(require("vscode"))});async function Pd(s,e){let r=zt(e);r||Bt(e);let a=s.map(t=>{let n=new Xe.Range(t,0,t,r.document.lineAt(t).range.end.character);return xd(n,e)});await Promise.all(a)}function hg(s){return new Promise(e=>setTimeout(e,s))}async function xd(s,e){let r=zt(e);r||Bt(e),r.revealRange(s,Xe.TextEditorRevealType.InCenterIfOutsideViewport);let a=Xe.window.createTextEditorDecorationType({backgroundColor:`rgba(255, 255, 0, ${bd})`,isWholeLine:!0});r.setDecorations(a,[s]);let t=Xe.workspace.onDidChangeTextDocument(n=>{n.document===r.document&&(a.dispose(),Pr[e]=[],t.dispose())});Pr[e]||(Pr[e]=[]),Pr[e].push({range:s,decoration:a})}async function wd(s,e){let r=zt(s);r||Bt(s),Ps[s]||(Ps[s]=1);let a=++Ps[s];if(e){let o=(Pr[s]||[]).map(async i=>{let l=i.decoration,u=10,h=500/u;try{for(let m=0;m<=u&&a===Ps[s];m++){let d=m/u,v=bd*(1-d),b=Xe.window.createTextEditorDecorationType({backgroundColor:`rgba(255, 255, 0, ${v})`,isWholeLine:!0});r.setDecorations(b,[i.range]),l?.dispose(),l=b,await hg(h)}}finally{l?.dispose()}});await Promise.all(o)}let t=Pr[s];t&&a===Ps[s]&&(t.forEach(n=>n.decoration.dispose()),delete Pr[s])}async function _d(s,e,r){let a=zt(r);a||Bt(r);let t=mg(s,e,a.document);t&&await xd(t,r)}function mg(s,e,r){let a=0,t=0,n=0,o=0,i=0;for(let l=0;l<r.lineCount;l++){let p=r.lineAt(l).text.length+1;if(a<=s&&a+p>s&&(t=l,o=s-a),a<=e&&a+p>e){n=l,i=e-a;break}a+=p}if(t>=0&&n>=0){let l=new Xe.Position(t,o),u=new Xe.Position(n,i);return new Xe.Range(l,u)}return null}var Xe,Pr,Ps,bd,Ed=De(()=>{"use strict";Ka();So();Xe=z(require("vscode")),Pr={},Ps={},bd=.2});async function Cd(s,e){switch(s){case"removeHighlights":try{let{textfieldID:r,animated:a}=e;return await wd(r,a),{status:"success",message:"Removed highlight"}}catch(r){return{status:400,error:JSON.stringify(r)}}case"highlightLines":try{let{lines:r,textfieldID:a}=e;return await Pd(r,a),{status:"success",message:"Text highlighted successfully"}}catch(r){return{status:400,error:JSON.stringify(r)}}case"highlight":try{let{startChar:r,endChar:a,textfieldID:t}=e;return await _d(r,a,t),{status:"success",message:"Text highlighted successfully"}}catch(r){return{status:400,error:JSON.stringify(r)}}case"setContent":try{let{content:r,textfieldID:a}=e;return await vd(r,a),{status:"success",message:"Set content successfully"}}catch(r){return{status:400,error:JSON.stringify(r)}}case"replaceSelection":try{let{content:r,textfieldID:a}=e;return await gd(r,a),{status:"success",message:"Replaced selection successfully"}}catch(r){return{status:400,error:JSON.stringify(r)}}}}var Td=De(()=>{"use strict";br();yd();Ed()});async function kd(s,e){let r=Buffer.alloc(0),a=null;s.on("data",async t=>{if(r=Buffer.concat([r,t]),a==null&&r.length>=4&&(a=r.readUInt32LE(0),r=r.subarray(4)),a!=null&&r.length>=a){let n=r.subarray(0,a).toString();r=r.subarray(a),a=null,await e(s,n)}}),s.on("end",()=>{R.debug("Desktop bridge: client disconnected")}),s.on("error",t=>{R.error("Desktop bridge socket error:",t)})}function xs(s,e){let r=JSON.stringify(e),a=Buffer.alloc(4),t=Buffer.byteLength(r);a.writeUInt32LE(t,0);let n=Buffer.from(r,"utf-8");s.write(a),s.write(n),s.end()}var Ro=De(()=>{"use strict";we()});function Co(){return Ya.join(Id.homedir(),"Library","Application Support","com.openai.chat","app_pairing_extensions",bs)}function gg(s){let e=Co();if(Ae.existsSync(e)){let r=Ae.watch(e,a=>{Ae.existsSync(e)||(s(),r.close())})}else R.warn("Desktop bridge: session path does not exist, cannot watch file.")}var Ae,Ad,Id,Ya,Xa,Od=De(()=>{"use strict";we();br();Ro();Ae=z(require("fs")),Ad=z(require("net")),Id=z(require("os")),Ya=z(require("path"));Xa=class{getSessionSocketPath(){return`/tmp/${bs}.sock`}async deregister(){let e=Co();R.info("Desktop bridge deregister",e),Ae.existsSync(e)&&Ae.unlinkSync(e),Ae.existsSync(this.getSessionSocketPath())&&Ae.unlinkSync(this.getSessionSocketPath())}async register(e,r){let a=Co(),t=Ya.dirname(a);Ae.existsSync(t)||Ae.mkdirSync(t,{recursive:!0}),Ae.writeFileSync(a,JSON.stringify(e),"utf8"),R.info(`Desktop bridge wrote payload to ${a}`);let n=this.getSessionSocketPath();Ae.existsSync(n)?Ae.chmodSync(n,384):R.warn("Desktop bridge: socket file does not exist"),gg(r)}startServer(e,r){let a=this.getSessionSocketPath();Ae.existsSync(a)&&Ae.unlinkSync(a);let t=Ad.createServer(n=>{R.debug("Desktop bridge: client connected"),kd(n,r)});t.listen(a,()=>{R.info(`Desktop bridge listening on UNIX socket: ${a}`)}),e.subscriptions.push({dispose:()=>{t.close(),this.deregister()}})}}});function yg(){if($d.platform()!=="darwin")throw new Error("Unsupported platform");return new Xa}var $d,xr,To=De(()=>{"use strict";Od();$d=z(require("os"));xr=yg()});function Nd(){switch(Dd.env.appName){case"Visual Studio Code":return cd;case"Visual Studio Code - Insiders":return ld;case"VSCodium":return ud;case"Cursor":return dd;case"Windsurf":return pd;default:return null}}var Dd,Md=De(()=>{"use strict";br();Dd=z(require("vscode"))});var bg,ws,ko=De(()=>{"use strict";bg="0.0.1731016154",ws={name:"openai.chatgpt",version:bg,isInstalled:!0}});function Ld(s){Fd=s,xr.deregister(),en()}function en(){let s=Nd();if(!s)return;let e=xr.getSessionSocketPath(),r={appName:Zt.env.appName,bundleID:s,extensionVersion:ws.version,marketplaceID:ws.name,extensionName:od,workspaceName:id,id:bs,capabilities:ad,needsReload:Fd,socketPath:e,timestamp:Date.now()};xr.register(r,()=>{let a=Zt.l10n.t("Reregister"),t=Zt.l10n.t("Dismiss");Zt.window.showWarningMessage(Zt.l10n.t("The ChatGPT extension cannot find its registration file"),a,t).then(n=>{n===a&&en()})})}var Zt,Fd,Ao=De(()=>{"use strict";Md();br();To();ko();Zt=z(require("vscode")),Fd=!1});function qd(s){switch(s){case"ping":{let{name:e,version:r}=ws;return{status:"success",version:r,name:e}}case"content":{let e=md();return e!=null?{status:"success",textfields:e}:{status:400,error:"No active editor found"}}case"selections":{let e=hd();return e!=null?{status:"success",selections:e}:{status:400,error:"No active editor found"}}case"reload":return jd.commands.executeCommand("workbench.action.reloadWindow"),{status:"success"}}}async function Ud(s){switch(s){case"markForReload":return Ld(!0),{status:"success",message:"Marked for reload"}}}var jd,Vd=De(()=>{"use strict";br();Ka();Ao();ko();jd=z(require("vscode"))});var Bd={};nn(Bd,{activate:()=>xg,deactivate:()=>wg,respondToCompleteMessage:()=>zd});function xg(s){Pg==="darwin"&&(R.info("ChatGPT desktop bridge active"),xr.startServer(s,zd),en(),R.info("Desktop bridge registered"))}function wg(){xr.deregister()}async function zd(s,e){try{let r=JSON.parse(e),a=nd(r.command);if(!a){xs(s,{status:404,error:"Unknown endpoint"});return}if(!Wd.workspace.isTrusted&&a!=="ping"){R.warn("Desktop bridge: untrusted workspace"),xs(s,{status:405,error:"The workspace must be trusted for the extension to read content."});return}let t=await _g(a,r.payload);t.status===400&&R.error("Desktop bridge error for command:",r.command),xs(s,t)}catch(r){R.error("Desktop bridge: error processing message:",r),xs(s,{success:!1,error:"Error handling message"})}}async function _g(s,e){let{category:r}=Qa[s];switch(r){case"queryGet":return qd(s);case"queryPost":return Ud(s);case"mutationPost":return Cd(s,e)}}var Hd,Wd,Pg,Zd=De(()=>{"use strict";br();Td();To();Vd();Ao();Ro();we();Hd=z(require("os")),Wd=z(require("vscode")),Pg=Hd.platform()});var Cg={};nn(Cg,{activate:()=>Sg});module.exports=yp(Cg);var Wo=z(require("path")),Ts=z(require("vscode"));function zo(s){let e=Ts.window.activeTextEditor;if(!e)return;let r=e.document.uri;if(r.scheme!=="file")return;let a=e.selection.start.line+1,t=e.selection.end.line+1;e.selection.end.character===0&&e.selection.end.line>e.selection.start.line&&t--;let n=r.fsPath,o=Wo.basename(n),i=a!=null?`${o}:${a}`+(t!=null&&t!==a?`:${t}`:""):o;s.addContextFile({label:i,path:Ts.workspace.asRelativePath(n),fsPath:n,startLine:a,endLine:t})}var Bo=require("crypto"),on=class s{constructor(e){this.mcpConnection=e;let r=this.mcpConnection.registerProvider(s.providerName,{onNotification:a=>this.handleNotification(a),onResult:a=>this.handleResult(a)});this.disposables.push(r)}static providerName="auth";disposables=[];pending=new Map;async getToken({refreshToken:e}){let r=(0,Bo.randomUUID)(),a=new Promise((t,n)=>{this.pending.set(r,{resolve:t,reject:n})});return this.mcpConnection.sendRequest(s.providerName,r,"getAuthStatus",{includeToken:!0,refreshToken:e}),a}resolve(e,r){let a=this.pending.get(e);a&&(this.pending.delete(e),a.resolve(r))}reject(e,r){let a=this.pending.get(e);a&&(this.pending.delete(e),a.reject(r))}handleResult(e){if(typeof e.id!="string")return;if(e.error){this.reject(e.id,e.error);return}let r=e.result??null;this.resolve(e.id,r?.authToken??null)}handleNotification(e){e.method==="codex/event/auth_status_change"&&this.getToken({refreshToken:!1})}dispose(){for(let e of this.disposables)e.dispose();this.disposables.length=0,this.pending.clear()}};function Zo(s){return new on(s)}we();var cn=z(require("path")),ln=z(require("vscode")),kr="openai-codex";function ei(s){let{scheme:e,fsPath:r}=s;if(e!==kr)return R.error(`Invalid conversation URI scheme: expected ${kr}, got ${e}`),null;switch(s.authority){case"thread":return wp(s.fsPath);case"new":return{type:"untitled",untitledId:cn.basename(r)};default:return R.error(`Unknown conversation URI authority in: ${s}`),null}}function wp(s){let e=/^\/[a-zA-Z]:\\/.test(s)?s.slice(1):s,r=cn.basename(e),a=r.match(/([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})\.jsonl$/);return a?{type:"persisted",rolloutPath:e,conversationId:a[1]}:(R.error(`Invalid persisted conversation URI format: could not extract conversation ID from filename ${r}`),null)}function Is(s){return ln.Uri.file(s).with({scheme:kr,authority:"thread"})}function ti(s){return ln.Uri.parse(`${kr}://new/${encodeURIComponent(s)}`)}var un=z(require("vscode")),ri="codex.chatSessionProvider";var Os=class{constructor(e){this.codexAppServer=e;let r={onResult:this.onAppServerResult.bind(this)};e.registerProvider(ri,r)}_onDidChangeChatSessionItems=new un.EventEmitter;onDidChangeChatSessionItems=this._onDidChangeChatSessionItems.event;_onDidCommitChatSessionItem=new un.EventEmitter;onDidCommitChatSessionItem=this._onDidCommitChatSessionItem.event;nextRequestId=0;requestToCallback=new Map;onAppServerResult(e){let r=this.requestToCallback.get(e.id);r&&(this.requestToCallback.delete(e.id),r(e))}async provideChatSessionItems(e){let r=String(this.nextRequestId++),a=new Promise((t,n)=>{this.requestToCallback.set(r,o=>{if(o.error){n(new Error(o.error.message));return}else if(o.result==null){n(new Error("No result in response"));return}let l=o.result.items.map(u=>{let{path:p,conversationId:h,preview:m,timestamp:d}=u,v=Is(p),b=d!=null?{startTime:new Date(d).getTime()}:void 0;return{id:String(h),resource:v,label:m,timing:b}});t(l)})});return this.codexAppServer.sendRequest(ri,r,"listConversations",{pageSize:20,cursor:null}),a}};$t();var _p="http://localhost:8000/api",Ep="https://chatgpt.com/backend-api";function Sp(){switch(Oe().get(Jo)){case"localhost":return _p;case"production":default:return Ep}}function dn(s){return s.startsWith("data:")||s.startsWith("http")?s:`${Sp()}/${s.replace(/^\//,"")}`}we();function Rp(s){let e=s.split(/\r?\n/),r,a=[];for(let n of e)n.startsWith("event:")?r=n.slice(6).trim():n.startsWith("data:")&&a.push(n.slice(5).trim());if(a.length===0)return null;let t=a.join(`
`);try{return{event:r,data:JSON.parse(t)}}catch{return null}}function Cp(s){let e=s.indexOf(`\r
\r
`),r=s.indexOf(`

`);return e===-1&&r===-1?[-1,0]:e===-1?[r,2]:r===-1?[e,4]:e<r?[e,4]:[r,2]}function Tp(s,e){return{async next(){if(e.aborted)return{done:!0,value:void 0};let{value:r,done:a}=await s.read();return a||r==null?{done:!0,value:void 0}:{done:!1,value:r}},[Symbol.asyncIterator](){return this}}}async function*si(s,e){let r=s.getReader(),a=new TextDecoder,t="",n=Tp(r,e);try{for await(let o of n){t+=a.decode(o,{stream:!0});let i,l;for(;[i,l]=Cp(t),i>=0;){let u=t.slice(0,i);t=t.slice(i+l);let p=Rp(u);!p||p.event==="heartbeat"||(yield p)}}}finally{r.releaseLock()}}function ai(s){return!!s&&typeof s=="object"&&s.name==="AbortError"}function ss(s){return new Promise(e=>setTimeout(e,s))}var Ir="codex_vscode",ni="vscode://codex/",Ar=3,kp=300,Ap=2e3,$s=class{constructor(e,r,a){this.authProvider=e;this.extensionFetchHandler=r;this.userAgentProvider=a}abortSignals=new Map;streamControllers=new Map;shouldRetryStatus(e){return e===408||e===425||e===429||e>=500&&e<=599}backoffDelay(e){let r=Math.min(Ap,kp*2**e),a=r*.2*(Math.random()-.5)*2;return Math.max(0,Math.floor(r+a))}buildHeaders(e,r,a){let t={...e??{}},n=i=>Object.keys(t).some(l=>l.toLowerCase()===i);if(a.attachAuth&&r&&!n("authorization")){t.Authorization=`Bearer ${r}`;try{let i=JSON.parse(Buffer.from(r.split(".")[1],"base64url").toString("utf8"))["https://api.openai.com/auth"]?.chatgpt_account_id;i&&(t["ChatGPT-Account-Id"]=i)}catch{}}a.method!=="GET"&&!n("content-type")&&(t["Content-Type"]="application/json"),n("originator")||(t.originator=Ir);let o=this.userAgentProvider.getUserAgent();return o&&!n("user-agent")&&(t["User-Agent"]=o),t}shouldAttachAuth(e){let a=new URL(e).host.toLowerCase();return a==="localhost:8000"||a==="localhost"||a.endsWith(".openai.com")||a==="openai.com"||a==="chatgpt.com"||a.endsWith(".chatgpt.com")&&!a.startsWith("ab.")}async fetch(e){try{let r=new AbortController;if(this.abortSignals.set(e.requestId,r),r.signal.addEventListener("abort",()=>({type:"fetch-response",responseType:"error",error:"Request cancelled",requestId:e.requestId,status:499})),e.url.startsWith(ni)){let i=await this.extensionFetchHandler.handleVSCodeRequest(e.url.slice(ni.length),e.body?JSON.parse(e.body):void 0);return{type:"fetch-response",responseType:"success",requestId:e.requestId,status:200,headers:{},bodyJsonString:JSON.stringify(i)}}let a=dn(e.url),t=await this.authProvider.getToken({refreshToken:!1}),n=this.shouldAttachAuth(a),o=async(i,l)=>{if(n&&!Ip(l))return{type:"fetch-response",responseType:"error",requestId:e.requestId,status:401,error:`Cannot fetch ${e.url} without ChatGPT auth.`};let u=this.buildHeaders(e.headers,l,{method:e.method,attachAuth:n}),p=Object.keys(u).some(h=>h.toLowerCase()==="authorization");try{let h=e.body,m=Object.keys(u).find(g=>g.toLowerCase()==="x-codex-base64");if(m&&u[m]==="1"){if(e.body)try{h=Buffer.from(e.body,"base64")}catch{h=e.body}delete u[m]}let v=await fetch(a,{method:e.method,headers:u,body:h,signal:r.signal});if(v.status>=200&&v.status<300){let g=v.headers.get("content-type")||"",x;if(g.includes("application/json")){let E=await v.json();x=JSON.stringify(E)}else{let E=await v.arrayBuffer(),C=Buffer.from(E).toString("base64");x=JSON.stringify({base64:C,contentType:g})}this.abortSignals.delete(e.requestId);let S={};return v.headers.forEach((E,C)=>{C!=="authorization"&&(S[C]=E)}),{type:"fetch-response",responseType:"success",requestId:e.requestId,status:v.status,headers:S,bodyJsonString:x}}if(v.status===401&&p&&i<Ar){let g=await this.authProvider.getToken({refreshToken:!0});if(g&&g!==l)return o(i+1,g)}if(this.shouldRetryStatus(v.status)&&i<Ar){let g=this.backoffDelay(i);return await ss(g),o(i+1,l)}let b=v.headers.get("cf-ray");return v.status===404?R.info(`Error fetching ${e.url}: ${v.status} ${v.statusText} (${b})`):R.error(`Error fetching ${e.url}: ${v.status} ${v.statusText} (${b})`),{type:"fetch-response",responseType:"error",requestId:e.requestId,status:v.status,error:v.statusText}}catch(h){if(r.signal.aborted)return{type:"fetch-response",responseType:"error",error:"Request cancelled",requestId:e.requestId,status:499};if(i<Ar){let m=this.backoffDelay(i);return await ss(m),o(i+1,l)}return R.error(`Error fetching ${e.url}: ${String(h)}`),{type:"fetch-response",responseType:"error",requestId:e.requestId,status:500,error:h instanceof Error?h.message:"Unknown error"}}};return o(0,t)}catch(r){return R.error(`Error fetching ${e.url}: ${r}`),{type:"fetch-response",responseType:"error",requestId:e.requestId,status:500,error:r instanceof Error?r.message:"Unknown error"}}finally{this.abortSignals.delete(e.requestId)}}async stream(e,r){let a=new AbortController;this.streamControllers.set(e.requestId,a);let t=dn(e.url),n=await this.authProvider.getToken({refreshToken:!1}),o=this.shouldAttachAuth(t),i=async(l,u)=>{let p=this.buildHeaders(e.headers,u,{method:e.method,attachAuth:o}),h=Object.keys(p).some(m=>m.toLowerCase()==="authorization");try{let m=await fetch(t,{method:e.method,headers:p,body:e.body,signal:a.signal});if(m.status===200&&m.body!=null){for await(let d of si(m.body,a.signal))r({type:"fetch-stream-event",requestId:e.requestId,event:d.event,data:d.data});r({type:"fetch-stream-complete",requestId:e.requestId});return}if(m.status===401&&h&&l<Ar){let d=await this.authProvider.getToken({refreshToken:!0});if(d&&d!==u){await i(l+1,d);return}}if(this.shouldRetryStatus(m.status)&&l<Ar){let d=this.backoffDelay(l);await ss(d),await i(l+1,u);return}r({type:"fetch-stream-error",requestId:e.requestId,error:`${m.status} ${m.statusText}`})}catch(m){if(a.signal.aborted||ai(m)){r({type:"fetch-stream-complete",requestId:e.requestId});return}if(l<Ar){let d=this.backoffDelay(l);await ss(d),await i(l+1,u);return}r({type:"fetch-stream-error",requestId:e.requestId,error:m instanceof Error?m.message:"Unknown error"})}};try{await i(0,n)}finally{this.streamControllers.delete(e.requestId)}}cancel(e){let r=this.abortSignals.get(e);r&&(r.abort(),this.abortSignals.delete(e))}cancelStream(e){let r=this.streamControllers.get(e);r&&(r.abort(),this.streamControllers.delete(e))}};function Ip(s){return s?/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+$/.test(s):!1}we();$t();ks();function Or(s){if(!0){let e,r,{arch:a}=process,{platform:t}=process;switch(s&&(t=s),t){case"win32":e="windows";break;case"darwin":e="macos";break;case"aix":case"android":case"freebsd":case"haiku":case"linux":case"openbsd":case"sunos":case"cygwin":case"netbsd":e="linux";break}switch(a){case"x64":r="x86_64";break;case"arm64":r="aarch64";break;case"arm":case"ia32":case"loong64":case"mips":case"mipsel":case"ppc64":case"riscv64":case"s390x":throw new Error(`unrecognized architecture: ${a}`)}return`bin/${`${e}-${r}`}`}return"bin"}we();$t();we();var fn=require("child_process");var ct={CLI_EXECUTABLE:"cliExecutable",COMMENT_CODELENS_ENABLED:"commentCodeLensEnabled",OPEN_ON_STARTUP:"openOnStartup",RUN_CODEX_IN_WSL:"preferWsl",USE_COPILOT_FOR_CODEX_LOGIN:"useCopilotForCodexLogin"};var as={HAS_PROBABLY_SEEN_2025_08_27_NUX:"hasProbablySeen2025-08-27-nux",NUX_2025_09_15:"viewed2025-09-15-nux",NUX_2025_09_15_FULL_CHATGPT_AUTH_VIEWED:"viewed2025-09-15-full-chatgpt-auth-nux",NUX_2025_09_15_APIKEY_AUTH_VIEWED:"viewed2025-09-15-apikey-auth-nux",WINDOWS_WSL_REMINDER_DISMISSED_AT:"windows-wsl-reminder-dismissed-date",UPSELL_BANNER_CODEX_REMOTE_DISMISSED_AT:"upsell-banner-codex-remote-dismissed-at"};var oi=z(require("vscode")),Op=[{command:"wsl.exe",args:["--status"]}];function lt(){return Oe().get(ct.RUN_CODEX_IN_WSL)??!1?mn()&&!hn():!1}function hn(){return oi.env.remoteName==="wsl"}var ns=null;function mn(){let s=process.platform;return ns!=null?(R.info(`[detectHasWsl] cachedHasWsl: ${ns}`),ns):(ns=$p(s),ns)}function $p(s){if(R.info(`[detectHasWsl] platform: ${s}`),s!=="win32")return!1;for(let{command:e,args:r}of Op)try{let a=(0,fn.spawnSync)(e,r,{windowsHide:!0,stdio:"ignore"});if(a.error){if(R.warn(`[detectHasWsl] result.error: ${a.error}`),a.error?.code==="ENOENT")return!1;continue}if(a.status===0)return!0}catch(a){if(R.warn(`[detectHasWsl] command exception: ${a}`),a?.code==="ENOENT")return!1}return!1}function vt(s){if(/^(\\\\|\/\/)[Ww][Ss][Ll]\$/.test(s)){let a=s.replace(/^((\\\\|\/\/)wsl\$[\\/]+)/i,"").split(/[\\/]/);a.shift();let t=a.join("/").replace(/\\/g,"/");return t.length===0?"/":t.startsWith("/")?t:`/${t}`}if(s.startsWith("/"))return s;let e=s.match(/^([a-zA-Z]):[\\/](.*)$/);if(e){let r=e[1].toLowerCase(),a=e[2].replace(/\\/g,"/");return`/mnt/${r}/${a}`}return s.replace(/\\/g,"/")}function vn(s){let e=s.match(/^\/mnt\/([a-zA-Z])\/(.*)$/);if(e){let t=e[1].toUpperCase(),n=e[2].replace(/\//g,"\\");return`${t}:\\${n}`}let r=s.match(/^\\{1,2}[Mm][Nn][Tt]\\([a-zA-Z])\\(.*)$/i);if(r){let t=r[1].toUpperCase(),n=r[2].replace(/[\\/]/g,"\\");return`${t}:\\${n}`}let a=s.match(/^C:\\mnt\\c(.*)$/i);return a?`C:\\${a[1].replace(/^([\\/])+/,"").replace(/[\\/]/g,"\\")}`:s.replace(/\//g,"\\")}function ii(){let s=Dp();if(!s)return;if(Mp(s))return pn(s);if(Fp(s))return pn(vn(s));let e=Np(s);if(e)return e;R.warn(`[resolveCodexHomeFromWsl] Unable to translate Linux path "${s}" to a Windows path`)}function Dp(){return ci(["/usr/bin/env","bash","-lc",'printf %s "${CODEX_HOME:-$HOME/.codex}"'],"readCodexHomePathFromWslEnv")}function Np(s){let e=ci(["wslpath","-w",s],`resolveCodexHomeFromWsl:wslpath(${s})`);return e?pn(e):void 0}function pn(s){return s.replace(/\//g,"\\")}function Mp(s){return!!(/^[a-zA-Z]:[\\/]/.test(s)||/^\\\\/.test(s))}function Fp(s){return/^\/mnt\/[a-zA-Z]\//.test(s)?!0:/^\\{1,2}mnt\\[a-zA-Z]\\/.test(s)}function ci(s,e){try{let r=(0,fn.spawnSync)("wsl.exe",s,{encoding:"utf8",windowsHide:!0});if(r.error){R.warn(`[${e}] command error: ${String(r.error)}`);return}if(r.status!==0){R.warn(`[${e}] non-zero exit (${r.status}): ${r.stderr?.toString()??""}`);return}let a=r.stdout?.toString().trim();if(!a){R.warn(`[${e}] command returned empty output`);return}return a}catch(r){R.warn(`[${e}] unexpected error: ${String(r)}`);return}}var gn=require("child_process");var $r=z(require("vscode"));function li(s,e){let r=process.platform==="win32";if(lt())return R.info("[spawnCodexProcess] spawning codex process inside WSL"),Lp(s,e);let a=Or(),t=Ds(s),n=r?";":":",o=process.env.PATH+n+$r.Uri.joinPath(s,a).fsPath,i=(0,gn.spawn)(t,[e],{stdio:["pipe","pipe","pipe"],env:{...process.env,PATH:o,RUST_LOG:"warn",CODEX_INTERNAL_ORIGINATOR_OVERRIDE:Ir}});if(i.pid==null)throw new Error(`Failed to spawn codex mcp process at ${t}`);return i}function Ds(s,e){let r=Oe().get(ct.CLI_EXECUTABLE);if(r&&r.trim().length>0)return r;{let a=Or(e),t=(e??process.platform)==="win32"?"codex.exe":"codex";return $r.Uri.joinPath(s,`${a}/${t}`).fsPath}}function Lp(s,e){let r=Or("linux"),a=vt(Ds(s,"linux")),t=$r.Uri.joinPath(s,r).fsPath,n=vt(t),o=$r.workspace.workspaceFolders?.[0]?.uri.fsPath,i=o?vt(o):void 0,l=[`PATH=${n}:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin`,"RUST_LOG=warn",`CODEX_INTERNAL_ORIGINATOR_OVERRIDE=${Ir}`],u=[];return i&&u.push("--cd",i),u.push("--","/usr/bin/env",...l,a,e),(0,gn.spawn)("wsl.exe",u,{stdio:["pipe","pipe","pipe"],env:{...process.env}})}var di=z(require("readline")),Dr=z(require("vscode")),ui="1",Ns=class{constructor(e,r){this.extensionUri=e;this.userAgentProvider=r;this.extensionUri=e}providers=new Map;initialized=!1;proc=null;rl=null;mostRecentErrorMessage=null;startCodexProcess(){this.proc&&this.isProcessAlive(this.proc)&&(R.info("[startCodexProcess] tearing down existing codex mcp process"),this.teardownProcess());let e;try{if(R.info("[startCodexProcess] spawning codex app-server"),e=li(this.extensionUri,"app-server"),e.pid==null)return R.error("Failed to spawn Codex process"),this.broadcastFatalError("Failed to spawn Codex process"),{success:!1,errorMessage:"Failed to spawn Codex process"}}catch(a){let t=a instanceof Error?a.message:String(a);return R.error(`Failed to spawn Codex process: ${t}`),this.broadcastFatalError(`Failed to spawn Codex process: ${t}`),{success:!1,errorMessage:t}}this.proc=e,this.initialized=!1,e.on("error",a=>{R.error(`Codex process error: ${a}`)}),e.on("exit",(a,t)=>{a!==0?(R.error(`Codex app-server process exited with code ${a} and signal ${t}`),this.broadcastFatalError(`Codex app-server process exited with code ${a} and signal ${t}.
Most recent error message:
${this.mostRecentErrorMessage??"None"}`)):R.info("codex app-server process exited successfully."),this.teardownProcess()}),e.stderr&&e.stderr.on("data",a=>{let t=jp(a.toString().trim());if(t){let{level:n,message:o}=qp(t),i="CLI:";switch(n){case"trace":case"debug":case"info":R.info(`${i} ${o}`);break;case"warn":R.warn(`${i} ${o}`);break;case"error":R.error(`${i} ${o}`),this.mostRecentErrorMessage=o;break}}});let r=di.createInterface({input:e.stdout});this.rl=r,r.on("line",a=>{let t=a.trim(),n;try{n=JSON.parse(t)}catch(o){R.error(`unable to parse stdout from codex app-server: ${o}`);return}if(!this.initialized){if("id"in n&&("result"in n||"error"in n)&&n.id===ui){if("error"in n&&n.error){let o=new Error(`Failed to initialize local agent: ${JSON.stringify(n.error)}`);R.error(o.message),this.broadcastFatalError(o.message)}else{let o=n.result;this.userAgentProvider.setUserAgent(o.userAgent??Ir),this.initialized=!0}return}R.warn(`Dropping MCP message received before initialization: ${t}`);return}this.routeIncomingMessage(n)});{let a={id:ui,method:"initialize",params:{clientInfo:{name:Up(),title:"Codex Extension",version:yn()}}};e.stdin.destroyed?R.warn(`Attempted to send app-server initialize request but stdin is destroyed: ${JSON.stringify(a)}`):e.stdin.write(JSON.stringify(a)+`
`)}return{success:!0}}teardownProcess(){this.rl&&(this.rl.removeAllListeners(),this.rl.close(),this.rl=null),this.proc&&(this.proc.removeAllListeners(),!this.proc.killed&&this.proc.exitCode==null&&this.proc.kill(),this.proc=null),this.initialized=!1}isProcessAlive(e){return e.killed||e.exitCode!=null||e.signalCode!=null?!1:!e.stdin.destroyed}registerProvider(e,r){if(this.providers.has(e))throw new Error(`Provider already registered: ${e}`);return this.providers.set(e,r),new Dr.Disposable(()=>{this.providers.delete(e)})}sendRequest(e,r,a,t){let o={id:`${e}:${r}`,method:a,params:t};this.sendMessage(o)}sendNotification(e,r){let a={method:e,params:r};this.sendMessage(a)}sendResponse(e,r){let a={id:e,result:r};this.sendMessage(a)}sendMessage(e){this.proc&&!this.proc.stdin.destroyed?this.proc.stdin.write(JSON.stringify(e)+`
`):R.warn(`Attempted to send app-server message but stdin is destroyed: ${JSON.stringify(e)}`)}routeIncomingMessage(e){if(this.isMcpResponseMessage(e)){let r=e.id;if(typeof r=="string"&&r.includes(":")){let[a,...t]=r.split(":"),n=t.join(":"),o=this.providers.get(a);if(o?.onResult){let i={...e,id:n};o.onResult(i)}return}R.warn(`Received MCP response with id=${JSON.stringify(r)} but no provider namespace`);return}if(this.isMcpRequestMessage(e)){for(let[,r]of this.providers)r.onRequest?.(e);return}if(typeof e.method=="string"){let{method:r,params:a}=e;for(let[,t]of this.providers)t.onNotification?.({method:r,params:a});return}R.error(`Received unknown MCP message: ${JSON.stringify(e)}`)}isMcpResponseMessage(e){return"id"in e&&("result"in e||"error"in e)}isMcpRequestMessage(e){return typeof e.method=="string"&&"id"in e&&e.id!=null}broadcastFatalError(e){for(let[,r]of this.providers)r.onFatalError?.(e)}dispose(){this.teardownProcess()}};function jp(s){return s.replace(/\x1b\[[0-9;]*m/g,"")}function qp(s){let e=s.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d+Z\s+(\w+)\s+(.+)$/);if(e){let r=e[1].toLowerCase();return r==="trace"||r==="debug"||r==="info"||r==="warn"||r==="error"?{level:r,message:e[2]}:{level:"error",message:e[2]}}return{level:"error",message:s}}function Up(){let s=Dr.env.appName??"",e=s.toLowerCase();return e.includes("cursor")?"Cursor":e.includes("windsurf")?"Windsurf":e.includes("visual studio code")||e==="code"||e.startsWith("code ")||e.endsWith(" code")||e.includes("vscode")?"VS Code":s||"VS Code"}function yn(){let e=Dr.extensions.getExtension("openai.chatgpt")?.packageJSON?.version;return typeof e=="string"&&e.trim().length>0?e:"0.0.0"}we();var bn=z(require("os")),Pn=z(require("path"));function Ms(){if(lt()){let s=ii();return s||(R.info("[getPathToCodexHome] Falling back to host home directory because WSL CODEX_HOME could not be resolved"),Pn.join(bn.homedir(),".codex"))}return Pn.join(bn.homedir(),".codex")}we();var xn=z(require("vscode"));async function Dt(){try{await xn.commands.executeCommand("workbench.view.extension.codexViewContainer"),await xn.commands.executeCommand(`${Nt.viewType}.focus`)}catch(s){R.error(`Failed to focus Codex view: ${s instanceof Error?s.message:String(s)}`)}}ks();we();var Fs=require("fs"),fi=z(require("path")),oe=z(require("vscode")),Vp=5173,Hp=`http://localhost:${Vp}`,Wp="/src/main.tsx",Nt=class s{constructor(e,r,a,t){this.extensionUri=e;this.codexMcpConnection=r;this.fetchWrapper=a;this.ideContextConnection=t;this.subscriptions.push(oe.commands.registerCommand("chatgpt.implementTodo",async({line:o,fileName:i,comment:l})=>{await Dt();let u={fileName:i,line:o,comment:l};this.sidebarView&&this.sidebarWebviewReady?this.postMessageToWebview(this.sidebarView.webview,{type:"implement-todo",...u}):this.pendingImplementTodo=u})),this.subscriptions.push(oe.workspace.onDidChangeWorkspaceFolders(()=>{this.broadcastToAllViews({type:"workspace-roots-updated"})})),this.subscriptions.push(this.ideContextConnection.onIdeContextChange(()=>{this.broadcastToAllViews({type:"ide-context-updated"})}));let n=this.codexMcpConnection.registerProvider(s.providerName,{onResult:o=>{this.deliverMcpResponseToOrigin(o)},onRequest:o=>{this.broadcastToAllViews({type:"mcp-request",request:o})},onNotification:o=>{let{method:i,params:l}=o;this.broadcastToAllViews({type:"mcp-notification",method:i,params:l})},onFatalError:o=>{this.broadcastToAllViews({type:"codex-app-server-fatal-error",errorMessage:o})}});this.subscriptions.push(n)}static viewType="chatgpt.sidebarView";static panelViewType="chatgpt.panelView";static providerName="webview";static customEditorViewType="chatgpt.conversationEditor";nextNewThreadId=1;sidebarView;sidebarWebviewReady=!1;editorPanels=new Map;subscriptions=[];pendingImplementTodo=null;pendingContextFiles=[];pendingNavigationRoutes=[];pendingMcpRequests=new Map;focusedView;diffPanel;diffPanelOwnerWebview;diffPanelPromise;async resolveWebviewView(e,r,a){this.sidebarView=e;let{webview:t}=e;await this.initializeWebview(t,"sidebar"),this.subscriptions.push(e.onDidDispose(()=>{this.clearPendingMcpRequestsForWebview(t),this.sidebarView=void 0,this.sidebarWebviewReady=!1,this.focusedView?.kind==="sidebar"&&(this.focusedView=this.getActivePanelFocusedView()??void 0)})),this.subscriptions.push(e.onDidChangeVisibility(()=>{oe.commands.executeCommand("setContext","chatgpt.sidebarView.visible",e.visible),!e.visible&&this.focusedView?.kind==="sidebar"&&(this.focusedView=this.getActivePanelFocusedView()??void 0)}))}triggerNewChatViaWebview(){this.sidebarView&&this.sidebarWebviewReady&&this.postMessageToWebview(this.sidebarView.webview,{type:"new-chat"})}postMessageToWebview(e,r){let a=JSON.stringify(r);e.postMessage(a)}openCustomDocument(e,r,a){return new wn(e)}async resolveCustomEditor(e,r,a){let t=ei(e.uri);if(t==null)throw new Error(`Invalid Codex conversation URI: ${e.uri.toString()}`);let n,o;switch(t.type){case"untitled":o="New Codex thread";break;case"persisted":o="Codex",n={path:t.rolloutPath,overrides:null};break}r.title=o,r.iconPath={light:oe.Uri.joinPath(this.extensionUri,"resources","blossom-black.svg"),dark:oe.Uri.joinPath(this.extensionUri,"resources","blossom-white.svg")},this.editorPanels.set(r,{ready:!1,pendingMessages:[],resumeParams:n}),this.subscriptions.push(r.onDidDispose(()=>{this.clearPendingRequestsForWebview(r.webview),this.removePanel(r),this.focusedView?.kind==="panel"&&this.focusedView.panel===r&&(this.focusedView=this.getActivePanelFocusedView()??(this.sidebarView?.visible?{kind:"sidebar"}:void 0))})),await this.initializeWebview(r.webview,"panel",()=>{this.onPanelReady(r)})}addContextFile(e){let r={type:"add-context-file",file:e},a=this.focusedView;if(a?.kind==="panel"&&this.isPanelAlive(a.panel)){this.sendMessageToPanel(a.panel,r);return}this.sidebarView&&this.sidebarWebviewReady?this.postMessageToWebview(this.sidebarView.webview,r):this.pendingContextFiles.push(e)}navigateToRoute(e,r){let a={type:"navigate-to-route",path:e,state:r};this.sidebarView&&this.sidebarWebviewReady?this.postMessageToWebview(this.sidebarView.webview,a):this.pendingNavigationRoutes.push({path:e,state:r})}postMessageToSidebar(e){this.sidebarView&&this.postMessageToWebview(this.sidebarView.webview,e)}broadcastToAllViews(e){this.postMessageToSidebar(e),this.broadcastToPanels(e)}removePanel(e){this.editorPanels.delete(e),this.diffPanel===e&&(this.diffPanel=void 0,this.diffPanelOwnerWebview=void 0)}clearPendingRequestsForWebview(e){if(e)for(let[r,a]of this.pendingMcpRequests.entries())a===e&&this.pendingMcpRequests.delete(r)}getWebviewForPanel(e){if(e)try{return e.webview}catch{this.removePanel(e);return}}getPanelViewColumn(e){if(e)try{return e.viewColumn}catch{this.removePanel(e);return}}isPanelAlive(e){return!e||!this.editorPanels.has(e)?!1:this.getWebviewForPanel(e)!=null}setFocusedViewForWebview(e){if(this.sidebarView?.webview===e){this.focusedView={kind:"sidebar"};return}let r=this.findPanelByWebview(e);if(r){if(r===this.diffPanel)return;this.focusedView={kind:"panel",panel:r}}}findPanelByWebview(e){for(let r of Array.from(this.editorPanels.keys())){let a=this.getWebviewForPanel(r);if(a&&a===e)return r}}async initializeWebview(e,r,a){let t=oe.Uri.joinPath(this.extensionUri,"webview");e.options={enableScripts:!0,enableCommandUris:!1,localResourceRoots:[t]};let n=e.onDidReceiveMessage(o=>{if(o.type==="ready"){if(r==="sidebar"){if(this.sidebarWebviewReady=!0,this.pendingImplementTodo&&(this.postMessageToWebview(e,{type:"implement-todo",...this.pendingImplementTodo}),this.pendingImplementTodo=null),this.pendingContextFiles.length>0){for(let i of this.pendingContextFiles)this.postMessageToWebview(e,{type:"add-context-file",file:i});this.pendingContextFiles=[]}if(this.pendingNavigationRoutes.length>0){for(let{path:i,state:l}of this.pendingNavigationRoutes)this.postMessageToWebview(e,{type:"navigate-to-route",path:i,state:l});this.pendingNavigationRoutes=[]}}a?.()}this.handleMessage(e,o)});this.subscriptions.push(n),e.html=await this.getWebviewContent(e)}onPanelReady(e){let r=this.editorPanels.get(e);if(!r)return;r.ready=!0;let a=this.getWebviewForPanel(e);if(!a)return;let t=r.pendingMessages;r.pendingMessages=[];for(let n of t)this.postMessageToWebview(a,n);r.resumeParams&&(this.postMessageToWebview(a,{type:"resume-conversation",params:r.resumeParams}),r.resumeParams=null)}sendMessageToPanel(e,r){let a=this.editorPanels.get(e);if(!a)return;let t=this.getWebviewForPanel(e);t&&(a.ready?this.postMessageToWebview(t,r):a.pendingMessages.push(r))}broadcastToPanels(e){for(let[r,a]of Array.from(this.editorPanels.entries())){let t=this.getWebviewForPanel(r);if(t){if(!a.ready){a.pendingMessages.push(e);continue}this.postMessageToWebview(t,e)}}}getActivePanelFocusedView(){for(let e of Array.from(this.editorPanels.keys()))if(this.isPanelAlive(e)&&e.active)return{kind:"panel",panel:e}}async createEditorPanel(e){let r=oe.Uri.joinPath(this.extensionUri,"webview"),a=oe.window.createWebviewPanel(s.panelViewType,e?.title??"Codex",{viewColumn:e?.viewColumn??oe.window.activeTextEditor?.viewColumn??oe.ViewColumn.Active,preserveFocus:e?.preserveFocus??!1},{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[r]}),t=a.webview;return this.editorPanels.set(a,{ready:!1,pendingMessages:[]}),this.subscriptions.push(a.onDidDispose(()=>{this.clearPendingRequestsForWebview(t),this.removePanel(a),this.focusedView?.kind==="panel"&&this.focusedView.panel===a&&(this.focusedView=this.getActivePanelFocusedView()??(this.sidebarView?.visible?{kind:"sidebar"}:void 0))})),await this.initializeWebview(a.webview,"panel",()=>{this.onPanelReady(a)}),a}async ensurePrimaryEditorPanel(){return Array.from(this.editorPanels.keys()).find(r=>this.isPanelAlive(r))??this.createEditorPanel()}async ensureDiffPanel(e){return this.isPanelAlive(this.diffPanel)?this.diffPanel:this.diffPanelPromise?this.diffPanelPromise:(this.diffPanelOwnerWebview=void 0,this.diffPanelPromise=(async()=>{try{let r=await this.createEditorPanel({viewColumn:e,title:"Codex Diff"});return this.diffPanel=r,r}finally{this.diffPanelPromise=void 0}})(),this.diffPanelPromise)}async handleMessage(e,r){switch(r.type){case"ready":break;case"codex-app-server-restart":{oe.commands.executeCommand("workbench.action.reloadWindow");break}case"view-focused":{this.setFocusedViewForWebview(e);break}case"mcp-request":{let{id:a,method:t,params:n}=r.request;this.pendingMcpRequests.set(String(a),e),this.codexMcpConnection.sendRequest(s.providerName,String(a),t,n);break}case"mcp-notification":{let{method:a,params:t}=r.request;this.codexMcpConnection.sendNotification(a,t);break}case"mcp-response":{let{id:a,result:t}=r.response;this.codexMcpConnection.sendResponse(a,t);break}case"open-in-browser":{oe.env.openExternal(oe.Uri.parse(r.url));break}case"open-extension-settings":{oe.commands.executeCommand("workbench.action.openSettings","@ext:openai.chatgpt");break}case"open-keyboard-shortcuts":{oe.commands.executeCommand("workbench.action.openGlobalKeybindings","chatgpt");break}case"open-config-toml":{let a=Ms(),t=fi.join(a,"config.toml");await Fs.promises.mkdir(a,{recursive:!0});try{await Fs.promises.access(t)}catch(n){let o=n;if("code"in o&&o.code==="ENOENT")await Fs.promises.writeFile(t,"");else throw n}await oe.commands.executeCommand("vscode.open",oe.Uri.file(t));break}case"show-diff":{this.showDiff({unifiedDiff:r.unifiedDiff},e);break}case"update-diff-if-open":{this.isPanelAlive(this.diffPanel)&&this.diffPanelOwnerWebview===e&&this.sendMessageToPanel(this.diffPanel,{type:"navigate-to-route",path:"/diff",state:{unifiedDiff:r.unifiedDiff}});break}case"fetch":{let a=await this.fetchWrapper.fetch(r);this.postMessageToWebview(e,a);break}case"cancel-fetch":{this.fetchWrapper.cancel(r.requestId);break}case"fetch-stream":{this.fetchWrapper.stream(r,a=>{this.postMessageToWebview(e,a)});break}case"cancel-fetch-stream":{this.fetchWrapper.cancelStream(r.requestId);break}case"log-message":{let{level:a,message:t}=r;switch(a){case"trace":R.trace(t);break;case"debug":R.debug(t);break;case"info":R.info(t);break;case"warning":R.warn(t);break;case"error":R.error(t);break}break}}}async getWebviewContent(e){return this.getWebviewContentProduction(e)}async getWebviewContentProduction(e){let r=oe.Uri.joinPath(this.extensionUri,"webview"),a=oe.Uri.joinPath(r,"index.html"),t=await oe.workspace.fs.readFile(a),n=new TextDecoder("utf-8").decode(t),o=e.asWebviewUri(r).toString()+"/",i=pi(o),l=["default-src 'none'",`img-src ${e.cspSource} https: data: blob:`,`script-src ${e.cspSource}`,`style-src ${e.cspSource} 'unsafe-inline'`,`font-src ${e.cspSource}`,`connect-src ${e.cspSource}`].join("; ")+";",u=pi(l);return n.replace("<!-- PROD_BASE_TAG_HERE -->",`<base href="${i}">`).replace("<!-- PROD_CSP_TAG_HERE -->",`<meta http-equiv="Content-Security-Policy" content="${u}">`)}getWebviewContentDevelopment(){return`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="${oe.Uri.parse(Hp).toString()}">

    <!-- Hot reloading code from Vite -->
    <script type="module">
        import RefreshRuntime from "/@react-refresh"
        RefreshRuntime.injectIntoGlobalHook(window)
        window.$RefreshReg$ = () => {}
        window.$RefreshSig$ = () => (type) => type
        window.__vite_plugin_react_preamble_installed__ = true
    </script>
    <script type="module" src="/@vite/client"></script>
    <script type="module" src="${Wp}"></script>
    <script src="http://localhost:8097"></script>
</head>
<body tabindex="0" style="outline: none">
    <div id="root"></div>
</body>
</html>`}dispose(){this.subscriptions.forEach(e=>e.dispose()),this.isPanelAlive(this.diffPanel)&&this.diffPanel.dispose(),this.diffPanel=void 0,this.diffPanelOwnerWebview=void 0,this.editorPanels.clear(),this.focusedView=void 0}async showDiff(e,r){let a=r??this.sidebarView?.webview;if(!a){let l=await this.ensurePrimaryEditorPanel(),u=this.getPanelViewColumn(l)??oe.ViewColumn.Active,p=this.getWebviewForPanel(l),h=await this.ensureDiffPanel(u),m=this.getPanelViewColumn(h)??this.getPanelViewColumn(l)??oe.ViewColumn.Active;h.reveal(m),this.diffPanelOwnerWebview=p,this.sendMessageToPanel(h,{type:"navigate-to-route",path:"/diff",state:{unifiedDiff:e.unifiedDiff}});return}let t=this.findPanelByWebview(a),n=this.getPanelViewColumn(t)??oe.ViewColumn.Active,o=await this.ensureDiffPanel(n),i=this.getPanelViewColumn(o)??this.getPanelViewColumn(t)??oe.ViewColumn.Active;o.reveal(i),this.diffPanelOwnerWebview=a,this.sendMessageToPanel(o,{type:"navigate-to-route",path:"/diff",state:{unifiedDiff:e.unifiedDiff}})}async createNewPanel(e){let r;if(e?.path!=null)r=Is(e.path);else{let t=`thread-${this.nextNewThreadId++}`;r=ti(t)}let a=e?.viewColumn??oe.window.activeTextEditor?.viewColumn??oe.ViewColumn.Active;await oe.commands.executeCommand("vscode.openWith",r,s.customEditorViewType,{viewColumn:a,preserveFocus:e?.preserveFocus??!1,preview:!1})}deliverMcpResponseToOrigin(e){let r=String(e.id),a=this.pendingMcpRequests.get(r);if(!a){R.warn(`Received MCP response for unknown request id: ${r}`);return}this.pendingMcpRequests.delete(r),this.postMessageToWebview(a,{type:"mcp-response",message:e})}clearPendingMcpRequestsForWebview(e){for(let[r,a]of this.pendingMcpRequests.entries())a===e&&this.pendingMcpRequests.delete(r)}},wn=class{constructor(e){this.uri=e}dispose(){}};function pi(s){return s.replace(/["<&]/g,e=>{switch(e){case'"':return"&quot;";case"<":return"&lt;";case"&":return"&amp;";default:return e}})}$t();we();var os=class{constructor(e,r=[],a=[],t){this.child=e;this.stdoutChunks=r;this.stderrChunks=a;this.promise=t.then(({code:n,signal:o})=>({type:"resolve",code:n,signal:o}),n=>({type:"reject",error:n}))}result=null;promise;check(){return this.wait().then(({stdout:e,stderr:r,code:a,signal:t})=>{if(a===0)return{stdout:e,stderr:r};throw new Error(`process exited with code ${a}, signal ${t}`)})}wait(){return this.promise.then(e=>{switch(e.type){case"resolve":{let{code:r,signal:a}=e;return{stdout:Buffer.concat(this.stdoutChunks).toString("utf8"),stderr:Buffer.concat(this.stderrChunks).toString("utf8"),code:r,signal:a}}case"reject":throw e.error}})}getStdout(){return Buffer.concat(this.stdoutChunks)}getStderr(){return Buffer.concat(this.stderrChunks)}getExitCode(){return this.result?.type==="resolve"?this.result.code:null}isDone(){return this.result!=null}kill(){this.child.kill()}};var _n=require("child_process");function Ke({args:s,cwd:e}){if(lt())return R.info("[spawnCodexProcess] spawning codex process inside WSL"),zp(s,e);let r=s[0],a=s.slice(1),t={cwd:e,env:{...process.env},stdio:["ignore","pipe","pipe"]},n=(0,_n.spawn)(r,a,t);if(!n.pid)throw new Error(`failed to start process from ${e}: \`${s.join(" ")}\``);let o=[],i=[],l=new Promise((u,p)=>{n.stdout?.on("data",h=>{o.push(h)}),n.stderr?.on("data",h=>{i.push(h)}),n.on("exit",(h,m)=>{u({code:h,signal:m})}),n.on("error",h=>{p(h)})});return new os(n,o,i,l)}function zp(s,e){let r=e?vt(e):".",a=["RUST_LOG=warn"],t=[];r&&t.push("--cd",r),t.push("--exec","/usr/bin/env",...a,...s);let n={env:{...process.env},stdio:["ignore","pipe","pipe"]};R.info(`[spawnAsyncInsideWsl] spawning process inside WSL: wsl.exe ${t.join(" ")}`);let o=(0,_n.spawn)("wsl.exe",t,n);if(!o.pid)throw new Error(`failed to start process from ${e}: \`${s.join(" ")}\``);let i=[],l=[],u=new Promise((p,h)=>{o.stdout?.on("data",m=>{i.push(m)}),o.stderr?.on("data",m=>{l.push(m)}),o.on("exit",(m,d)=>{p({code:m,signal:d})}),o.on("error",m=>{h(m)})});return new os(o,i,l,u)}we();async function Ls(s){try{let e=Ke({args:["git","rev-parse","--show-toplevel"],cwd:s}),{stdout:r,code:a}=await e.wait();if(a===0)return r.trim()}catch(e){R.warn("git rev-parse --show-toplevel failed: ",e),R.error(`getGitRoot: ${s} is not a git repository`)}return null}we();function hi(s,e){let r=new Set,a=new Set,t=new Set,n=null,o=[s,e].filter(Boolean).join(`
`),i=(M,Z)=>{let N=(Z??"").trim();if(!N)return;let J=N.charAt(0),te=N.charAt(N.length-1),G=N;(J==="'"||J==='"')&&te===J&&N.length>=2&&(G=N.slice(1,-1)),G&&M.add(G)},l=(M,Z)=>{for(let N of Z)if(M[N])return M[N]},u=/^(?:Applied patch(?: to)?\s+(?:(["'])(?<qpath>.+?)\1|(?<path>.+?))\s+cleanly\.?)$/i,p=/^(?:Applied patch(?: to)?\s+(?:(["'])(?<qpath>.+?)\1|(?<path>.+?))\s+with conflicts\.?)$/i,h=/^(?:Applying patch\s+(?:(["'])(?<qpath>.+?)\1|(?<path>.+?))\s+with\s+\d+\s+rejects?\.{0,3})$/i,m=/^(?:Checking patch\s+(?:(["'])(?<qpath>.+?)\1|(?<path>.+?))\.\.\.)$/i,d=/^(?:Performing three-way merge|Falling back to three-way merge)\.\.\.$/i,v=/^Failed to perform three-way merge\.\.\.$/i,b=/^Falling back to direct application\.\.\.$/i,g=/^U\s+(?<path>.+)$/,x=/^error:\s+patch failed:\s+(?<path>.+?)(?::\d+)?(?:\s|$)/i,S=/^error:\s+(?<path>.+?):\s+patch does not apply$/i,E=/^(?:error: )?repository lacks the necessary blob to (?:perform|fall back on) 3-?way merge\.?$/i,C=/^error:\s+(?<path>.+?):\s+does not match index\b/i,I=/^error:\s+(?<path>.+?):\s+does not exist in index\b/i,O=/^error:\s+(?<path>.+?)\s+already exists in (?:the )?working directory\b/i,B=/^error:\s+patch failed:\s+(?<path>.+?)\s+File exists/i,V=/^error:\s+path\s+(?<path>.+?)\s+has been renamed\/deleted/i,$=/^error:\s+cannot apply binary patch to\s+['"]?(?<path>.+?)['"]?\s+without full index line$/i,H=/^error:\s+binary patch does not apply to\s+['"]?(?<path>.+?)['"]?$/i,U=/^error:\s+binary patch to\s+['"]?(?<path>.+?)['"]?\s+creates incorrect result\b/i,q=/^error:\s+cannot read the current contents of\s+['"]?(?<path>.+?)['"]?$/i,k=/^Skipped patch\s+['"]?(?<path>.+?)['"]\.$/i,D=/^warning:\s*Cannot merge binary files:\s+(?<path>.+?)\s+\(ours\s+vs\.\s+theirs\)/i;for(let M of o.split(/\r?\n/)){let Z=M.trim();if(!Z)continue;let N;if(N=Z.match(u)){let J=l(N.groups??{},["qpath","path"]);i(r,J),n=J??n,t.delete(J??""),a.delete(J??"");continue}if(N=Z.match(p)){let J=l(N.groups??{},["qpath","path"]);i(t,J),n=J??n,r.delete(J??""),a.delete(J??"");continue}if(N=Z.match(h)){let J=l(N.groups??{},["qpath","path"]);i(t,J),n=J??n,r.delete(J??""),a.delete(J??"");continue}if(N=Z.match(g)){i(t,N.groups?.path),n=N.groups?.path??n,r.delete(N.groups?.path??""),a.delete(N.groups?.path??"");continue}if(N=Z.match(m)){n=l(N.groups??{},["qpath","path"])??n;continue}if((N=Z.match(x))||(N=Z.match(S))){i(a,N.groups?.path),n=N.groups?.path??n;continue}if(!(d.test(Z)||b.test(Z))){if(v.test(Z)){n&&(i(a,n),r.delete(n),t.delete(n));continue}if(E.test(Z)){n&&(i(a,n),r.delete(n),t.delete(n));continue}if((N=Z.match(C))||(N=Z.match(I))||(N=Z.match(O))||(N=Z.match(B))||(N=Z.match(V))||(N=Z.match($))||(N=Z.match(H))||(N=Z.match(U))||(N=Z.match(q))||(N=Z.match(k))){i(a,N.groups?.path),n=N.groups?.path??n,r.delete(N.groups?.path??""),t.delete(N.groups?.path??"");continue}if(N=Z.match(D)){i(t,N.groups?.path),n=N.groups?.path??n,r.delete(N.groups?.path??""),a.delete(N.groups?.path??"");continue}}}for(let M of t)r.delete(M),a.delete(M);for(let M of r)a.delete(M);return{appliedPaths:Array.from(r).sort(),skippedPaths:Array.from(a).sort(),conflictedPaths:Array.from(t).sort()}}var Mt=z(require("fs/promises")),mi=z(require("os")),js=z(require("path"));async function vi({cwd:s,diff:e,revert:r}){let a=await Ls(s);if(!a)throw new Error(`${s} is not a git repository`);let t=await Mt.mkdtemp(js.join(mi.tmpdir(),"codex-apply-")),n=js.join(t,"patch.diff");await Mt.writeFile(n,e,"utf8"),r&&await Bp(a,e),lt()&&(n=vt(n));let o=["git","apply",r?"-R":null,"--3way",n].filter(Boolean),i=Ke({args:o,cwd:a}),{code:l,stdout:u,stderr:p}=await i.wait();R.info(`applyPatch revert: ${r}, code: ${l}, stdout: ${u}, stderr: ${p}`);let{appliedPaths:h,skippedPaths:m,conflictedPaths:d}=hi(u,p);return await Mt.rm(t,{recursive:!0,force:!0}),{status:l===0?"success":l===1?"partial-success":"error",appliedPaths:h,skippedPaths:m,conflictedPaths:d}}async function Bp(s,e){let r=Zp(e),a=(await Promise.all(r.map(async t=>{try{let n=js.join(s,t);return lt()&&(R.info(`Converting path ${n} to Windows path`),n=vn(n)),R.info(`[stageFiles] checking ${n}`),await Mt.access(n),t}catch(n){return R.error(`Error accessing path ${t}: `,n),R.info(`Skipping staging ${t} because it does not exist in the working tree`),null}}))).filter(t=>!!t);if(a.length>0){let t=["git","add","--",...a],o=await Ke({args:t,cwd:s}).wait();R.info(`Staged ${a.length} files: ${o.code}`)}}function Zp(s){let e=new Set,r=/^diff --git a\/(.*?) b\/(.*)$/gm,a;for(;(a=r.exec(s))!=null;){let[t,n,o]=a;n&&n!=="/dev/null"&&e.add(n),o&&o!=="/dev/null"&&e.add(o)}return Array.from(e)}$t();we();we();var gi=z(require("fs")),Nr=z(require("path")),er=z(require("vscode"));async function yi(s,e=10){let r=er.workspace.workspaceFolders??[];if(s.trim().length===0||r.length===0)return[];let a=[],t=`**/*${Gp(s)}*`,n=Jp();for(let o of r){if(a.length>=e)break;try{let l=Ke({args:[n??"rg","--files","--iglob",t],cwd:o.uri.fsPath}),{stdout:u,code:p}=await l.wait();if(p!==0)return[];let h=u.split(/\r?\n/).map(m=>m.trim()).filter(Boolean);for(let m of h){if(a.length>=e)break;let d=Nr.isAbsolute(m)?m:Nr.join(o.uri.fsPath,m),v=Nr.basename(d).replace(/\\/g,"/"),b=er.workspace.asRelativePath(d).replace(/\\/g,"/");a.push({label:v,path:b,fsPath:d})}}catch(i){R.warn(`rg search failed in ${o.uri.fsPath}: ${String(i)}`)}}return a}function Gp(s){let e=["*","?","[","]","{","}","!","\\"],r="";for(let a of s)r+=e.includes(a)?"\\"+a:a;return r}function Jp(){try{let s=er.extensions.getExtension("openai.chatgpt");if(!s)return null;let e=process.platform==="win32"?"rg.exe":"rg",r=Or(),a=er.Uri.joinPath(s.extensionUri,r,e).fsPath;return gi.existsSync(a)?a:null}catch{return null}}var Pi=require("child_process"),Us=z(require("fs")),Vs=z(require("fs/promises")),xi=z(require("os")),Mr=z(require("path")),Qp=200*1024*1024;async function wi(s,e){let r=Kp(s),a=Mr.basename(r)||"repo";await rf(r,Qp);let t=await qs(r,["rev-parse","HEAD"]),n=await qs(r,["rev-parse","--abbrev-ref","HEAD"]),o=n&&n!=="HEAD"?n:null,i=await qs(r,["remote","-v"]),l=tf(i),u=`${a}-snapshot-${Date.now()}.tar.gz`,p=Mr.join(xi.tmpdir(),u);if(e)await Yp(r,p,e);else{let m=await Xp(r);await ef(r,p,m)}let h=await Vs.stat(p);return{tarballPath:p,tarballFilename:u,tarballSize:h.size,repoName:a,branch:o,snapshotBranch:e??o??t,commitSha:t,remotes:l,contentType:"application/gzip"}}async function _i({tarballPath:s,uploadUrl:e,contentLength:r,contentType:a}){let t=Us.createReadStream(s);try{let n=await fetch(e,{method:"PUT",headers:{"Content-Type":a,"Content-Length":r.toString(),"x-ms-blob-type":"BlockBlob"},body:t,duplex:"half"});if(!n.ok){let o=await n.text().catch(()=>"");throw new Error(`Snapshot upload failed with status ${n.status} ${n.statusText}${o?`: ${o}`:""}`)}}finally{t.destroy(),await Vs.unlink(s).catch(()=>{})}}function Kp(s){let e=Mr.resolve(s);if(!Us.existsSync(e))throw new Error(`Git root does not exist: ${e}`);return e}async function En(s,e){let r=Ke({args:["git",...e],cwd:s}),{stdout:a,stderr:t,code:n}=await r.wait();return{stdout:a,stderr:t,code:n}}async function qs(s,e){let{stdout:r,stderr:a,code:t}=await En(s,e);if(t!==0){let n=a.trim()||r.trim();throw new Error(`git ${e.join(" ")} failed${n?`: ${n}`:""}`)}return r.trim()}async function Xp(s){let{stdout:e,stderr:r,code:a}=await En(s,["ls-files","--cached","--others","--exclude-standard","-z"]);if(a!==0){let t=r.trim();throw new Error(`git ls-files failed${t?`: ${t}`:""}`)}return e?e.split("\0").map(t=>t.trim()).filter(t=>t.length>0):[]}async function Yp(s,e,r){await En(s,["archive","--format=tar.gz","-o",e,r])}async function ef(s,e,r){await new Promise((a,t)=>{let o=(0,Pi.spawn)("tar",["--null","-czf",e,"-C",s,"--files-from","-"],{stdio:["pipe","ignore","pipe"]}),i="";if(o.stderr?.setEncoding("utf8"),o.stderr?.on("data",l=>{i+=l}),o.on("error",l=>t(l)),o.on("close",l=>{l===0?a():t(new Error(`tar exited with code ${l}${i?`: ${i.trim()}`:""}`))}),o.stdin){if(r.length>0){let l=`${r.join("\0")}\0`;o.stdin.write(l,"utf8",u=>{u&&t(u)})}o.stdin.end()}})}function tf(s){let e={};for(let r of s.split(/\r?\n/)){let a=r.trim();if(!a)continue;let t=a.split(/\s+/);if(t.length<3)continue;let[n,o,i]=t;i==="(push)"&&e[n]==null&&(e[n]=o)}return e}async function rf(s,e){let r=await qs(s,["count-objects","-v"]),a=sf(r),n=((a.get("size")??0)+(a.get("size-pack")??0))*1024;if(n>e)throw new Error(`Repository is too large (${bi(n)}). Maximum allowed size is ${bi(e)}.`)}function sf(s){let e=new Map;for(let r of s.split(/\r?\n/)){let a=r.trim();if(!a)continue;let[t,n]=a.split(":");if(!t||n==null)continue;let o=Number.parseInt(n.trim(),10);Number.isFinite(o)&&e.set(t,o)}return e}function bi(s){if(s<1024)return`${s} B`;let e=["KB","MB","GB","TB"],r=s/1024,a=0;for(;r>=1024&&a<e.length-1;)r/=1024,a+=1;return`${r.toFixed(1)} ${e[a]}`}var Sn=z(require("os")),Ei=z(require("path"));var Ee=z(require("vscode")),Hs=class{constructor(e,r,a,t){this.authProvider=e;this.ideContextConnection=r;this.globalState=a;this.modelProxyManager=t}handlers={"workspace-roots":async()=>{let e=Ee.workspace.workspaceFolders?.map(a=>a.uri.fsPath)??[];return{roots:lt()?e.map(vt):e}},"has-custom-cli-executable":async()=>({hasCustomCliExecutable:(Oe().get(ct.CLI_EXECUTABLE)??"").trim().length>0}),"account-info":async()=>{let e=await this.authProvider.getToken({refreshToken:!1});if(!e)return{accountId:null,userId:null,plan:null,email:null};try{let r=JSON.parse(Buffer.from(e.split(".")[1],"base64url").toString("utf8")),a=r["https://api.openai.com/auth"]??{},t=r["https://api.openai.com/profile"]??{},n=a?.chatgpt_account_id??null,o=a?.chatgpt_user_id??null,i=a?.chatgpt_plan_type??null,l=t.email??null;if(n&&o&&i)return{accountId:n,userId:o,plan:i,email:l}}catch{R.error("Unable to extract account id and plan from auth token.")}return{accountId:null,userId:null,plan:null,email:null}},"extension-info":async()=>({version:yn()}),"os-info":async()=>({platform:process.platform,hasWsl:mn(),isVsCodeRunningInsideWsl:hn()}),"openai-api-key":async()=>({value:process.env.OPENAI_API_KEY??null}),"find-files":async({query:e})=>({files:await yi(e,10)??[]}),"ide-context":async()=>({ideContext:this.ideContextConnection.getIdeContext()}),"apply-patch":async e=>vi(e),"open-file":async({path:e,line:r,column:a})=>{let t=typeof r=="number"?r:void 0,n=typeof a=="number"?a:1,o=e.replace(/^([ab])[\\/]/,""),i=Ee.workspace.workspaceFolders??[],l=async h=>{try{let m=await Ee.workspace.openTextDocument(h),d=t!=null?new Ee.Range(new Ee.Position(Math.max(0,t-1),Math.max(0,n-1)),new Ee.Position(Math.max(0,t-1),Math.max(0,n-1))):void 0;return await Ee.window.showTextDocument(m,d?{preview:!1,selection:d}:void 0),!0}catch{return!1}};if(Ei.isAbsolute(o)){let h=await l(Ee.Uri.file(o));return h||R.error(`Failed to open absolute path: ${o}`),{success:h}}let u=o.split(/[\\/]+/).filter(Boolean),p=!1;for(let h of i){if(p)break;let m=Ee.Uri.joinPath(h.uri,...u);if(await l(m)){p=!0;break}let d=u.indexOf(h.name);if(d!==-1){let v=Ee.Uri.joinPath(h.uri,...u.slice(d+1));if(await l(v)){p=!0;break}}}if(!p&&o.length>0)try{let h=`**/${o.replace(/\\/g,"/")}`,m=await Ee.workspace.findFiles(h,void 0,1);m.length>0&&(p=await l(m[0]))}catch{}if(!p){let h=i.map(m=>m.uri.fsPath).join(", ");R.error(`Failed to resolve and open file from path "${e}" (normalized: "${o}") in workspaces: [${h}]`)}return{success:p}},"git-origins":async()=>{let e=Ee.workspace.workspaceFolders??[],r=[],a=new Set,t=Sn.homedir();return await Promise.all(e.map(async n=>{let o=n.uri.fsPath;try{let i=Ke({args:["git","rev-parse","--show-toplevel"],cwd:n.uri.fsPath}),{stdout:l,code:u}=await i.wait();u===0&&(o=l.trim())}catch{}try{let i=Ke({args:["git","config","--get","remote.origin.url"],cwd:o}),{stdout:l,code:u}=await i.wait(),p=u===0?l.trim():null;a.has(o)||(r.push({root:o,originUrl:p}),a.add(o))}catch{a.has(o)||(r.push({root:o,originUrl:null}),a.add(o))}})),{origins:r,homeDir:t}},"git-roots":async()=>{let e=Ee.workspace.workspaceFolders??[],r=Sn.homedir();return{roots:(await Promise.all(e.map(t=>Ls(t.uri.fsPath)))).filter(t=>t!=null),homeDir:r}},"git-current-branch":async({gitRoot:e})=>{let r=Ee.workspace.workspaceFolders??[],a=e??r[0]?.uri.fsPath;if(!a)return{branch:null};try{let t=Ke({args:["git","rev-parse","--abbrev-ref","HEAD"],cwd:a}),{stdout:n,code:o}=await t.wait();if(o===0){let i=n.trim();return{branch:i&&i!=="HEAD"?i:null}}}catch{}return{branch:null}},"prepare-worktree-snapshot":async({gitRoot:e,snapshotBranch:r})=>wi(e,r),"upload-worktree-snapshot":async({tarballPath:e,uploadUrl:r,contentLength:a,contentType:t})=>{try{await _i({tarballPath:e,uploadUrl:r,contentLength:a,contentType:t})}catch(n){return R.error(`Failed to upload worktree snapshot: ${n}`),{success:!1}}return{success:!0}},"get-configuration":async({key:e})=>({value:Oe().get(e)}),"set-configuration":async({key:e,value:r})=>(await Oe().update(e,r),{success:!0}),"get-global-state":async({key:e})=>({value:await this.globalState.get(e)}),"set-global-state":async({key:e,value:r})=>{try{return await this.globalState.update(e,r),{success:!0}}catch{return{success:!1}}},"set-vs-context":async({key:e,value:r})=>(await Ee.commands.executeCommand("setContext",e,r),{success:!0}),"is-copilot-api-available":()=>Promise.resolve({available:this.modelProxyManager.isProxyAvailable()})};handleVSCodeRequest(e,r){return this.handlers[e](r)}};we();var Si=z(require("fs/promises")),Ri=z(require("path"));var Ws=class{constructor(e){this.context=e}async get(e){let r=this.context.globalState.get(e);if(e===as.HAS_PROBABLY_SEEN_2025_08_27_NUX&&r==null){let a=Ms(),t=Ri.join(a,"sessions"),n;try{n=(await Si.stat(t)).isDirectory(),n&&this.update(as.HAS_PROBABLY_SEEN_2025_08_27_NUX,!0)}catch{n=!1}return n}return r}async update(e,r){await this.context.globalState.update(e,r)}async dumpNuxState(){let e=Object.entries(as);for(let[r,a]of e){let t=this.context.globalState.get(a);R.info(`Global state ${r} (${a}): ${t}`)}}async resetNuxState(){R.info("Resetting NUX state"),await Promise.all(Object.values(as).map(e=>this.context.globalState.update(e,void 0)))}};var gt=z(require("vscode"));function af(s){return s.path.split("/").pop()??""}function Rn(){return gt.window.tabGroups.all.flatMap(s=>s.tabs.filter(e=>e.input?.uri?.scheme==="file").map(e=>({label:e.label,path:gt.workspace.asRelativePath(e.input?.uri?.fsPath),fsPath:e.input?.uri?.fsPath})))}function Cn(s){return{label:af(s.document.uri),path:gt.workspace.asRelativePath(s.document.uri.fsPath),fsPath:s.document.uri.fsPath,selection:s.selection,activeSelectionContent:s.document.getText(s.selection),selections:s.selections.map(e=>({start:e.start,end:e.end}))}}var zs=class{onIdeContextChangeEmitter=new gt.EventEmitter;listeners=[];ideContext={activeFile:void 0,openTabs:[]};constructor(){this.listeners.push(gt.window.onDidChangeActiveTextEditor(e=>this.onChangeActiveTextEditor(e))),this.listeners.push(gt.window.onDidChangeTextEditorSelection(e=>{this.onChangeTextEditorSelection(e)})),this.initIdeContext()}get onIdeContextChange(){return this.onIdeContextChangeEmitter.event}getIdeContext(){return this.ideContext}initIdeContext(){let e=gt.window.activeTextEditor;this.ideContext={activeFile:e?Cn(e):void 0,openTabs:Rn()},this.onIdeContextChangeEmitter.fire(this.ideContext)}onChangeActiveTextEditor(e){this.ideContext={...this.ideContext,activeFile:e?Cn(e):void 0,openTabs:Rn()},this.onIdeContextChangeEmitter.fire(this.ideContext)}onChangeTextEditorSelection(e){e.textEditor.document.uri.scheme==="file"&&(this.ideContext={...this.ideContext,activeFile:Cn(e.textEditor),openTabs:Rn()},this.onIdeContextChangeEmitter.fire(this.ideContext))}dispose(){this.listeners.forEach(e=>e.dispose())}};we();we();var Ut=z(require("path")),Se=z(require("vscode"));var c={};nn(c,{BRAND:()=>If,DIRTY:()=>tr,EMPTY_PATH:()=>lf,INVALID:()=>Q,NEVER:()=>mh,OK:()=>Le,ParseStatus:()=>Ne,Schema:()=>ee,ZodAny:()=>jt,ZodArray:()=>At,ZodBigInt:()=>sr,ZodBoolean:()=>ar,ZodBranded:()=>cs,ZodCatch:()=>mr,ZodDate:()=>nr,ZodDefault:()=>hr,ZodDiscriminatedUnion:()=>Gs,ZodEffects:()=>at,ZodEnum:()=>pr,ZodError:()=>ze,ZodFirstPartyTypeKind:()=>A,ZodFunction:()=>Qs,ZodIntersection:()=>lr,ZodIssueCode:()=>T,ZodLazy:()=>ur,ZodLiteral:()=>dr,ZodMap:()=>Vr,ZodNaN:()=>Wr,ZodNativeEnum:()=>fr,ZodNever:()=>ut,ZodNull:()=>ir,ZodNullable:()=>Pt,ZodNumber:()=>rr,ZodObject:()=>Be,ZodOptional:()=>rt,ZodParsedType:()=>L,ZodPipeline:()=>ls,ZodPromise:()=>qt,ZodReadonly:()=>vr,ZodRecord:()=>Js,ZodSchema:()=>ee,ZodSet:()=>Hr,ZodString:()=>Lt,ZodSymbol:()=>qr,ZodTransformer:()=>at,ZodTuple:()=>bt,ZodType:()=>ee,ZodUndefined:()=>or,ZodUnion:()=>cr,ZodUnknown:()=>kt,ZodVoid:()=>Ur,addIssueToContext:()=>F,any:()=>qf,array:()=>Wf,bigint:()=>Nf,boolean:()=>Fi,coerce:()=>hh,custom:()=>Di,date:()=>Mf,datetimeRegex:()=>Oi,defaultErrorMap:()=>Ct,discriminatedUnion:()=>Gf,effect:()=>oh,enum:()=>sh,function:()=>eh,getErrorMap:()=>Fr,getParsedType:()=>yt,instanceof:()=>$f,intersection:()=>Jf,isAborted:()=>Bs,isAsync:()=>Lr,isDirty:()=>Zs,isValid:()=>Ft,late:()=>Of,lazy:()=>th,literal:()=>rh,makeIssue:()=>is,map:()=>Xf,nan:()=>Df,nativeEnum:()=>ah,never:()=>Vf,null:()=>jf,nullable:()=>ch,number:()=>Mi,object:()=>zf,objectUtil:()=>Tn,oboolean:()=>fh,onumber:()=>ph,optional:()=>ih,ostring:()=>dh,pipeline:()=>uh,preprocess:()=>lh,promise:()=>nh,quotelessJson:()=>nf,record:()=>Kf,set:()=>Yf,setErrorMap:()=>cf,strictObject:()=>Bf,string:()=>Ni,symbol:()=>Ff,transformer:()=>oh,tuple:()=>Qf,undefined:()=>Lf,union:()=>Zf,unknown:()=>Uf,util:()=>se,void:()=>Hf});var se;(function(s){s.assertEqual=t=>{};function e(t){}s.assertIs=e;function r(t){throw new Error}s.assertNever=r,s.arrayToEnum=t=>{let n={};for(let o of t)n[o]=o;return n},s.getValidEnumValues=t=>{let n=s.objectKeys(t).filter(i=>typeof t[t[i]]!="number"),o={};for(let i of n)o[i]=t[i];return s.objectValues(o)},s.objectValues=t=>s.objectKeys(t).map(function(n){return t[n]}),s.objectKeys=typeof Object.keys=="function"?t=>Object.keys(t):t=>{let n=[];for(let o in t)Object.prototype.hasOwnProperty.call(t,o)&&n.push(o);return n},s.find=(t,n)=>{for(let o of t)if(n(o))return o},s.isInteger=typeof Number.isInteger=="function"?t=>Number.isInteger(t):t=>typeof t=="number"&&Number.isFinite(t)&&Math.floor(t)===t;function a(t,n=" | "){return t.map(o=>typeof o=="string"?`'${o}'`:o).join(n)}s.joinValues=a,s.jsonStringifyReplacer=(t,n)=>typeof n=="bigint"?n.toString():n})(se||(se={}));var Tn;(function(s){s.mergeShapes=(e,r)=>({...e,...r})})(Tn||(Tn={}));var L=se.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),yt=s=>{switch(typeof s){case"undefined":return L.undefined;case"string":return L.string;case"number":return Number.isNaN(s)?L.nan:L.number;case"boolean":return L.boolean;case"function":return L.function;case"bigint":return L.bigint;case"symbol":return L.symbol;case"object":return Array.isArray(s)?L.array:s===null?L.null:s.then&&typeof s.then=="function"&&s.catch&&typeof s.catch=="function"?L.promise:typeof Map<"u"&&s instanceof Map?L.map:typeof Set<"u"&&s instanceof Set?L.set:typeof Date<"u"&&s instanceof Date?L.date:L.object;default:return L.unknown}};var T=se.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),nf=s=>JSON.stringify(s,null,2).replace(/"([^"]+)":/g,"$1:"),ze=class s extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=a=>{this.issues=[...this.issues,a]},this.addIssues=(a=[])=>{this.issues=[...this.issues,...a]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(n){return n.message},a={_errors:[]},t=n=>{for(let o of n.issues)if(o.code==="invalid_union")o.unionErrors.map(t);else if(o.code==="invalid_return_type")t(o.returnTypeError);else if(o.code==="invalid_arguments")t(o.argumentsError);else if(o.path.length===0)a._errors.push(r(o));else{let i=a,l=0;for(;l<o.path.length;){let u=o.path[l];l===o.path.length-1?(i[u]=i[u]||{_errors:[]},i[u]._errors.push(r(o))):i[u]=i[u]||{_errors:[]},i=i[u],l++}}};return t(this),a}static assert(e){if(!(e instanceof s))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,se.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},a=[];for(let t of this.issues)if(t.path.length>0){let n=t.path[0];r[n]=r[n]||[],r[n].push(e(t))}else a.push(e(t));return{formErrors:a,fieldErrors:r}}get formErrors(){return this.flatten()}};ze.create=s=>new ze(s);var of=(s,e)=>{let r;switch(s.code){case T.invalid_type:s.received===L.undefined?r="Required":r=`Expected ${s.expected}, received ${s.received}`;break;case T.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(s.expected,se.jsonStringifyReplacer)}`;break;case T.unrecognized_keys:r=`Unrecognized key(s) in object: ${se.joinValues(s.keys,", ")}`;break;case T.invalid_union:r="Invalid input";break;case T.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${se.joinValues(s.options)}`;break;case T.invalid_enum_value:r=`Invalid enum value. Expected ${se.joinValues(s.options)}, received '${s.received}'`;break;case T.invalid_arguments:r="Invalid function arguments";break;case T.invalid_return_type:r="Invalid function return type";break;case T.invalid_date:r="Invalid date";break;case T.invalid_string:typeof s.validation=="object"?"includes"in s.validation?(r=`Invalid input: must include "${s.validation.includes}"`,typeof s.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${s.validation.position}`)):"startsWith"in s.validation?r=`Invalid input: must start with "${s.validation.startsWith}"`:"endsWith"in s.validation?r=`Invalid input: must end with "${s.validation.endsWith}"`:se.assertNever(s.validation):s.validation!=="regex"?r=`Invalid ${s.validation}`:r="Invalid";break;case T.too_small:s.type==="array"?r=`Array must contain ${s.exact?"exactly":s.inclusive?"at least":"more than"} ${s.minimum} element(s)`:s.type==="string"?r=`String must contain ${s.exact?"exactly":s.inclusive?"at least":"over"} ${s.minimum} character(s)`:s.type==="number"?r=`Number must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${s.minimum}`:s.type==="bigint"?r=`Number must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${s.minimum}`:s.type==="date"?r=`Date must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(s.minimum))}`:r="Invalid input";break;case T.too_big:s.type==="array"?r=`Array must contain ${s.exact?"exactly":s.inclusive?"at most":"less than"} ${s.maximum} element(s)`:s.type==="string"?r=`String must contain ${s.exact?"exactly":s.inclusive?"at most":"under"} ${s.maximum} character(s)`:s.type==="number"?r=`Number must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="bigint"?r=`BigInt must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="date"?r=`Date must be ${s.exact?"exactly":s.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(s.maximum))}`:r="Invalid input";break;case T.custom:r="Invalid input";break;case T.invalid_intersection_types:r="Intersection results could not be merged";break;case T.not_multiple_of:r=`Number must be a multiple of ${s.multipleOf}`;break;case T.not_finite:r="Number must be finite";break;default:r=e.defaultError,se.assertNever(s)}return{message:r}},Ct=of;var Ci=Ct;function cf(s){Ci=s}function Fr(){return Ci}var is=s=>{let{data:e,path:r,errorMaps:a,issueData:t}=s,n=[...r,...t.path||[]],o={...t,path:n};if(t.message!==void 0)return{...t,path:n,message:t.message};let i="",l=a.filter(u=>!!u).slice().reverse();for(let u of l)i=u(o,{data:e,defaultError:i}).message;return{...t,path:n,message:i}},lf=[];function F(s,e){let r=Fr(),a=is({issueData:e,data:s.data,path:s.path,errorMaps:[s.common.contextualErrorMap,s.schemaErrorMap,r,r===Ct?void 0:Ct].filter(t=>!!t)});s.common.issues.push(a)}var Ne=class s{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let a=[];for(let t of r){if(t.status==="aborted")return Q;t.status==="dirty"&&e.dirty(),a.push(t.value)}return{status:e.value,value:a}}static async mergeObjectAsync(e,r){let a=[];for(let t of r){let n=await t.key,o=await t.value;a.push({key:n,value:o})}return s.mergeObjectSync(e,a)}static mergeObjectSync(e,r){let a={};for(let t of r){let{key:n,value:o}=t;if(n.status==="aborted"||o.status==="aborted")return Q;n.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),n.value!=="__proto__"&&(typeof o.value<"u"||t.alwaysSet)&&(a[n.value]=o.value)}return{status:e.value,value:a}}},Q=Object.freeze({status:"aborted"}),tr=s=>({status:"dirty",value:s}),Le=s=>({status:"valid",value:s}),Bs=s=>s.status==="aborted",Zs=s=>s.status==="dirty",Ft=s=>s.status==="valid",Lr=s=>typeof Promise<"u"&&s instanceof Promise;var W;(function(s){s.errToObj=e=>typeof e=="string"?{message:e}:e||{},s.toString=e=>typeof e=="string"?e:e?.message})(W||(W={}));var st=class{constructor(e,r,a,t){this._cachedPath=[],this.parent=e,this.data=r,this._path=a,this._key=t}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Ti=(s,e)=>{if(Ft(e))return{success:!0,data:e.value};if(!s.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new ze(s.common.issues);return this._error=r,this._error}}};function Y(s){if(!s)return{};let{errorMap:e,invalid_type_error:r,required_error:a,description:t}=s;if(e&&(r||a))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:t}:{errorMap:(o,i)=>{let{message:l}=s;return o.code==="invalid_enum_value"?{message:l??i.defaultError}:typeof i.data>"u"?{message:l??a??i.defaultError}:o.code!=="invalid_type"?{message:i.defaultError}:{message:l??r??i.defaultError}},description:t}}var ee=class{get description(){return this._def.description}_getType(e){return yt(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:yt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ne,ctx:{common:e.parent.common,data:e.data,parsedType:yt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(Lr(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let a=this.safeParse(e,r);if(a.success)return a.data;throw a.error}safeParse(e,r){let a={common:{issues:[],async:r?.async??!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:yt(e)},t=this._parseSync({data:e,path:a.path,parent:a});return Ti(a,t)}"~validate"(e){let r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:yt(e)};if(!this["~standard"].async)try{let a=this._parseSync({data:e,path:[],parent:r});return Ft(a)?{value:a.value}:{issues:r.common.issues}}catch(a){a?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(a=>Ft(a)?{value:a.value}:{issues:r.common.issues})}async parseAsync(e,r){let a=await this.safeParseAsync(e,r);if(a.success)return a.data;throw a.error}async safeParseAsync(e,r){let a={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:yt(e)},t=this._parse({data:e,path:a.path,parent:a}),n=await(Lr(t)?t:Promise.resolve(t));return Ti(a,n)}refine(e,r){let a=t=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(t):r;return this._refinement((t,n)=>{let o=e(t),i=()=>n.addIssue({code:T.custom,...a(t)});return typeof Promise<"u"&&o instanceof Promise?o.then(l=>l?!0:(i(),!1)):o?!0:(i(),!1)})}refinement(e,r){return this._refinement((a,t)=>e(a)?!0:(t.addIssue(typeof r=="function"?r(a,t):r),!1))}_refinement(e){return new at({schema:this,typeName:A.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return rt.create(this,this._def)}nullable(){return Pt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return At.create(this)}promise(){return qt.create(this,this._def)}or(e){return cr.create([this,e],this._def)}and(e){return lr.create(this,e,this._def)}transform(e){return new at({...Y(this._def),schema:this,typeName:A.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new hr({...Y(this._def),innerType:this,defaultValue:r,typeName:A.ZodDefault})}brand(){return new cs({typeName:A.ZodBranded,type:this,...Y(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new mr({...Y(this._def),innerType:this,catchValue:r,typeName:A.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return ls.create(this,e)}readonly(){return vr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},uf=/^c[^\s-]{8,}$/i,df=/^[0-9a-z]+$/,pf=/^[0-9A-HJKMNP-TV-Z]{26}$/i,ff=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,hf=/^[a-z0-9_-]{21}$/i,mf=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,vf=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,gf=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,yf="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",kn,bf=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Pf=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,xf=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,wf=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,_f=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Ef=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Ai="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Sf=new RegExp(`^${Ai}$`);function Ii(s){let e="[0-5]\\d";s.precision?e=`${e}\\.\\d{${s.precision}}`:s.precision==null&&(e=`${e}(\\.\\d+)?`);let r=s.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${r}`}function Rf(s){return new RegExp(`^${Ii(s)}$`)}function Oi(s){let e=`${Ai}T${Ii(s)}`,r=[];return r.push(s.local?"Z?":"Z"),s.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function Cf(s,e){return!!((e==="v4"||!e)&&bf.test(s)||(e==="v6"||!e)&&xf.test(s))}function Tf(s,e){if(!mf.test(s))return!1;try{let[r]=s.split(".");if(!r)return!1;let a=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),t=JSON.parse(atob(a));return!(typeof t!="object"||t===null||"typ"in t&&t?.typ!=="JWT"||!t.alg||e&&t.alg!==e)}catch{return!1}}function kf(s,e){return!!((e==="v4"||!e)&&Pf.test(s)||(e==="v6"||!e)&&wf.test(s))}var Lt=class s extends ee{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==L.string){let n=this._getOrReturnCtx(e);return F(n,{code:T.invalid_type,expected:L.string,received:n.parsedType}),Q}let a=new Ne,t;for(let n of this._def.checks)if(n.kind==="min")e.data.length<n.value&&(t=this._getOrReturnCtx(e,t),F(t,{code:T.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),a.dirty());else if(n.kind==="max")e.data.length>n.value&&(t=this._getOrReturnCtx(e,t),F(t,{code:T.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),a.dirty());else if(n.kind==="length"){let o=e.data.length>n.value,i=e.data.length<n.value;(o||i)&&(t=this._getOrReturnCtx(e,t),o?F(t,{code:T.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}):i&&F(t,{code:T.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}),a.dirty())}else if(n.kind==="email")gf.test(e.data)||(t=this._getOrReturnCtx(e,t),F(t,{validation:"email",code:T.invalid_string,message:n.message}),a.dirty());else if(n.kind==="emoji")kn||(kn=new RegExp(yf,"u")),kn.test(e.data)||(t=this._getOrReturnCtx(e,t),F(t,{validation:"emoji",code:T.invalid_string,message:n.message}),a.dirty());else if(n.kind==="uuid")ff.test(e.data)||(t=this._getOrReturnCtx(e,t),F(t,{validation:"uuid",code:T.invalid_string,message:n.message}),a.dirty());else if(n.kind==="nanoid")hf.test(e.data)||(t=this._getOrReturnCtx(e,t),F(t,{validation:"nanoid",code:T.invalid_string,message:n.message}),a.dirty());else if(n.kind==="cuid")uf.test(e.data)||(t=this._getOrReturnCtx(e,t),F(t,{validation:"cuid",code:T.invalid_string,message:n.message}),a.dirty());else if(n.kind==="cuid2")df.test(e.data)||(t=this._getOrReturnCtx(e,t),F(t,{validation:"cuid2",code:T.invalid_string,message:n.message}),a.dirty());else if(n.kind==="ulid")pf.test(e.data)||(t=this._getOrReturnCtx(e,t),F(t,{validation:"ulid",code:T.invalid_string,message:n.message}),a.dirty());else if(n.kind==="url")try{new URL(e.data)}catch{t=this._getOrReturnCtx(e,t),F(t,{validation:"url",code:T.invalid_string,message:n.message}),a.dirty()}else n.kind==="regex"?(n.regex.lastIndex=0,n.regex.test(e.data)||(t=this._getOrReturnCtx(e,t),F(t,{validation:"regex",code:T.invalid_string,message:n.message}),a.dirty())):n.kind==="trim"?e.data=e.data.trim():n.kind==="includes"?e.data.includes(n.value,n.position)||(t=this._getOrReturnCtx(e,t),F(t,{code:T.invalid_string,validation:{includes:n.value,position:n.position},message:n.message}),a.dirty()):n.kind==="toLowerCase"?e.data=e.data.toLowerCase():n.kind==="toUpperCase"?e.data=e.data.toUpperCase():n.kind==="startsWith"?e.data.startsWith(n.value)||(t=this._getOrReturnCtx(e,t),F(t,{code:T.invalid_string,validation:{startsWith:n.value},message:n.message}),a.dirty()):n.kind==="endsWith"?e.data.endsWith(n.value)||(t=this._getOrReturnCtx(e,t),F(t,{code:T.invalid_string,validation:{endsWith:n.value},message:n.message}),a.dirty()):n.kind==="datetime"?Oi(n).test(e.data)||(t=this._getOrReturnCtx(e,t),F(t,{code:T.invalid_string,validation:"datetime",message:n.message}),a.dirty()):n.kind==="date"?Sf.test(e.data)||(t=this._getOrReturnCtx(e,t),F(t,{code:T.invalid_string,validation:"date",message:n.message}),a.dirty()):n.kind==="time"?Rf(n).test(e.data)||(t=this._getOrReturnCtx(e,t),F(t,{code:T.invalid_string,validation:"time",message:n.message}),a.dirty()):n.kind==="duration"?vf.test(e.data)||(t=this._getOrReturnCtx(e,t),F(t,{validation:"duration",code:T.invalid_string,message:n.message}),a.dirty()):n.kind==="ip"?Cf(e.data,n.version)||(t=this._getOrReturnCtx(e,t),F(t,{validation:"ip",code:T.invalid_string,message:n.message}),a.dirty()):n.kind==="jwt"?Tf(e.data,n.alg)||(t=this._getOrReturnCtx(e,t),F(t,{validation:"jwt",code:T.invalid_string,message:n.message}),a.dirty()):n.kind==="cidr"?kf(e.data,n.version)||(t=this._getOrReturnCtx(e,t),F(t,{validation:"cidr",code:T.invalid_string,message:n.message}),a.dirty()):n.kind==="base64"?_f.test(e.data)||(t=this._getOrReturnCtx(e,t),F(t,{validation:"base64",code:T.invalid_string,message:n.message}),a.dirty()):n.kind==="base64url"?Ef.test(e.data)||(t=this._getOrReturnCtx(e,t),F(t,{validation:"base64url",code:T.invalid_string,message:n.message}),a.dirty()):se.assertNever(n);return{status:a.value,value:e.data}}_regex(e,r,a){return this.refinement(t=>e.test(t),{validation:r,code:T.invalid_string,...W.errToObj(a)})}_addCheck(e){return new s({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...W.errToObj(e)})}url(e){return this._addCheck({kind:"url",...W.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...W.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...W.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...W.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...W.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...W.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...W.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...W.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...W.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...W.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...W.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...W.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...W.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...W.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...W.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...W.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...W.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...W.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...W.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...W.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...W.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...W.errToObj(r)})}nonempty(e){return this.min(1,W.errToObj(e))}trim(){return new s({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new s({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new s({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Lt.create=s=>new Lt({checks:[],typeName:A.ZodString,coerce:s?.coerce??!1,...Y(s)});function Af(s,e){let r=(s.toString().split(".")[1]||"").length,a=(e.toString().split(".")[1]||"").length,t=r>a?r:a,n=Number.parseInt(s.toFixed(t).replace(".","")),o=Number.parseInt(e.toFixed(t).replace(".",""));return n%o/10**t}var rr=class s extends ee{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==L.number){let n=this._getOrReturnCtx(e);return F(n,{code:T.invalid_type,expected:L.number,received:n.parsedType}),Q}let a,t=new Ne;for(let n of this._def.checks)n.kind==="int"?se.isInteger(e.data)||(a=this._getOrReturnCtx(e,a),F(a,{code:T.invalid_type,expected:"integer",received:"float",message:n.message}),t.dirty()):n.kind==="min"?(n.inclusive?e.data<n.value:e.data<=n.value)&&(a=this._getOrReturnCtx(e,a),F(a,{code:T.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),t.dirty()):n.kind==="max"?(n.inclusive?e.data>n.value:e.data>=n.value)&&(a=this._getOrReturnCtx(e,a),F(a,{code:T.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),t.dirty()):n.kind==="multipleOf"?Af(e.data,n.value)!==0&&(a=this._getOrReturnCtx(e,a),F(a,{code:T.not_multiple_of,multipleOf:n.value,message:n.message}),t.dirty()):n.kind==="finite"?Number.isFinite(e.data)||(a=this._getOrReturnCtx(e,a),F(a,{code:T.not_finite,message:n.message}),t.dirty()):se.assertNever(n);return{status:t.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,W.toString(r))}gt(e,r){return this.setLimit("min",e,!1,W.toString(r))}lte(e,r){return this.setLimit("max",e,!0,W.toString(r))}lt(e,r){return this.setLimit("max",e,!1,W.toString(r))}setLimit(e,r,a,t){return new s({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:a,message:W.toString(t)}]})}_addCheck(e){return new s({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:W.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:W.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:W.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:W.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:W.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:W.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:W.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:W.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:W.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&se.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let a of this._def.checks){if(a.kind==="finite"||a.kind==="int"||a.kind==="multipleOf")return!0;a.kind==="min"?(r===null||a.value>r)&&(r=a.value):a.kind==="max"&&(e===null||a.value<e)&&(e=a.value)}return Number.isFinite(r)&&Number.isFinite(e)}};rr.create=s=>new rr({checks:[],typeName:A.ZodNumber,coerce:s?.coerce||!1,...Y(s)});var sr=class s extends ee{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==L.bigint)return this._getInvalidInput(e);let a,t=new Ne;for(let n of this._def.checks)n.kind==="min"?(n.inclusive?e.data<n.value:e.data<=n.value)&&(a=this._getOrReturnCtx(e,a),F(a,{code:T.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),t.dirty()):n.kind==="max"?(n.inclusive?e.data>n.value:e.data>=n.value)&&(a=this._getOrReturnCtx(e,a),F(a,{code:T.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),t.dirty()):n.kind==="multipleOf"?e.data%n.value!==BigInt(0)&&(a=this._getOrReturnCtx(e,a),F(a,{code:T.not_multiple_of,multipleOf:n.value,message:n.message}),t.dirty()):se.assertNever(n);return{status:t.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return F(r,{code:T.invalid_type,expected:L.bigint,received:r.parsedType}),Q}gte(e,r){return this.setLimit("min",e,!0,W.toString(r))}gt(e,r){return this.setLimit("min",e,!1,W.toString(r))}lte(e,r){return this.setLimit("max",e,!0,W.toString(r))}lt(e,r){return this.setLimit("max",e,!1,W.toString(r))}setLimit(e,r,a,t){return new s({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:a,message:W.toString(t)}]})}_addCheck(e){return new s({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:W.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:W.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:W.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:W.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:W.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};sr.create=s=>new sr({checks:[],typeName:A.ZodBigInt,coerce:s?.coerce??!1,...Y(s)});var ar=class extends ee{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==L.boolean){let a=this._getOrReturnCtx(e);return F(a,{code:T.invalid_type,expected:L.boolean,received:a.parsedType}),Q}return Le(e.data)}};ar.create=s=>new ar({typeName:A.ZodBoolean,coerce:s?.coerce||!1,...Y(s)});var nr=class s extends ee{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==L.date){let n=this._getOrReturnCtx(e);return F(n,{code:T.invalid_type,expected:L.date,received:n.parsedType}),Q}if(Number.isNaN(e.data.getTime())){let n=this._getOrReturnCtx(e);return F(n,{code:T.invalid_date}),Q}let a=new Ne,t;for(let n of this._def.checks)n.kind==="min"?e.data.getTime()<n.value&&(t=this._getOrReturnCtx(e,t),F(t,{code:T.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),a.dirty()):n.kind==="max"?e.data.getTime()>n.value&&(t=this._getOrReturnCtx(e,t),F(t,{code:T.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),a.dirty()):se.assertNever(n);return{status:a.value,value:new Date(e.data.getTime())}}_addCheck(e){return new s({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:W.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:W.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};nr.create=s=>new nr({checks:[],coerce:s?.coerce||!1,typeName:A.ZodDate,...Y(s)});var qr=class extends ee{_parse(e){if(this._getType(e)!==L.symbol){let a=this._getOrReturnCtx(e);return F(a,{code:T.invalid_type,expected:L.symbol,received:a.parsedType}),Q}return Le(e.data)}};qr.create=s=>new qr({typeName:A.ZodSymbol,...Y(s)});var or=class extends ee{_parse(e){if(this._getType(e)!==L.undefined){let a=this._getOrReturnCtx(e);return F(a,{code:T.invalid_type,expected:L.undefined,received:a.parsedType}),Q}return Le(e.data)}};or.create=s=>new or({typeName:A.ZodUndefined,...Y(s)});var ir=class extends ee{_parse(e){if(this._getType(e)!==L.null){let a=this._getOrReturnCtx(e);return F(a,{code:T.invalid_type,expected:L.null,received:a.parsedType}),Q}return Le(e.data)}};ir.create=s=>new ir({typeName:A.ZodNull,...Y(s)});var jt=class extends ee{constructor(){super(...arguments),this._any=!0}_parse(e){return Le(e.data)}};jt.create=s=>new jt({typeName:A.ZodAny,...Y(s)});var kt=class extends ee{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Le(e.data)}};kt.create=s=>new kt({typeName:A.ZodUnknown,...Y(s)});var ut=class extends ee{_parse(e){let r=this._getOrReturnCtx(e);return F(r,{code:T.invalid_type,expected:L.never,received:r.parsedType}),Q}};ut.create=s=>new ut({typeName:A.ZodNever,...Y(s)});var Ur=class extends ee{_parse(e){if(this._getType(e)!==L.undefined){let a=this._getOrReturnCtx(e);return F(a,{code:T.invalid_type,expected:L.void,received:a.parsedType}),Q}return Le(e.data)}};Ur.create=s=>new Ur({typeName:A.ZodVoid,...Y(s)});var At=class s extends ee{_parse(e){let{ctx:r,status:a}=this._processInputParams(e),t=this._def;if(r.parsedType!==L.array)return F(r,{code:T.invalid_type,expected:L.array,received:r.parsedType}),Q;if(t.exactLength!==null){let o=r.data.length>t.exactLength.value,i=r.data.length<t.exactLength.value;(o||i)&&(F(r,{code:o?T.too_big:T.too_small,minimum:i?t.exactLength.value:void 0,maximum:o?t.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:t.exactLength.message}),a.dirty())}if(t.minLength!==null&&r.data.length<t.minLength.value&&(F(r,{code:T.too_small,minimum:t.minLength.value,type:"array",inclusive:!0,exact:!1,message:t.minLength.message}),a.dirty()),t.maxLength!==null&&r.data.length>t.maxLength.value&&(F(r,{code:T.too_big,maximum:t.maxLength.value,type:"array",inclusive:!0,exact:!1,message:t.maxLength.message}),a.dirty()),r.common.async)return Promise.all([...r.data].map((o,i)=>t.type._parseAsync(new st(r,o,r.path,i)))).then(o=>Ne.mergeArray(a,o));let n=[...r.data].map((o,i)=>t.type._parseSync(new st(r,o,r.path,i)));return Ne.mergeArray(a,n)}get element(){return this._def.type}min(e,r){return new s({...this._def,minLength:{value:e,message:W.toString(r)}})}max(e,r){return new s({...this._def,maxLength:{value:e,message:W.toString(r)}})}length(e,r){return new s({...this._def,exactLength:{value:e,message:W.toString(r)}})}nonempty(e){return this.min(1,e)}};At.create=(s,e)=>new At({type:s,minLength:null,maxLength:null,exactLength:null,typeName:A.ZodArray,...Y(e)});function jr(s){if(s instanceof Be){let e={};for(let r in s.shape){let a=s.shape[r];e[r]=rt.create(jr(a))}return new Be({...s._def,shape:()=>e})}else return s instanceof At?new At({...s._def,type:jr(s.element)}):s instanceof rt?rt.create(jr(s.unwrap())):s instanceof Pt?Pt.create(jr(s.unwrap())):s instanceof bt?bt.create(s.items.map(e=>jr(e))):s}var Be=class s extends ee{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),r=se.objectKeys(e);return this._cached={shape:e,keys:r},this._cached}_parse(e){if(this._getType(e)!==L.object){let u=this._getOrReturnCtx(e);return F(u,{code:T.invalid_type,expected:L.object,received:u.parsedType}),Q}let{status:a,ctx:t}=this._processInputParams(e),{shape:n,keys:o}=this._getCached(),i=[];if(!(this._def.catchall instanceof ut&&this._def.unknownKeys==="strip"))for(let u in t.data)o.includes(u)||i.push(u);let l=[];for(let u of o){let p=n[u],h=t.data[u];l.push({key:{status:"valid",value:u},value:p._parse(new st(t,h,t.path,u)),alwaysSet:u in t.data})}if(this._def.catchall instanceof ut){let u=this._def.unknownKeys;if(u==="passthrough")for(let p of i)l.push({key:{status:"valid",value:p},value:{status:"valid",value:t.data[p]}});else if(u==="strict")i.length>0&&(F(t,{code:T.unrecognized_keys,keys:i}),a.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let p of i){let h=t.data[p];l.push({key:{status:"valid",value:p},value:u._parse(new st(t,h,t.path,p)),alwaysSet:p in t.data})}}return t.common.async?Promise.resolve().then(async()=>{let u=[];for(let p of l){let h=await p.key,m=await p.value;u.push({key:h,value:m,alwaysSet:p.alwaysSet})}return u}).then(u=>Ne.mergeObjectSync(a,u)):Ne.mergeObjectSync(a,l)}get shape(){return this._def.shape()}strict(e){return W.errToObj,new s({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,a)=>{let t=this._def.errorMap?.(r,a).message??a.defaultError;return r.code==="unrecognized_keys"?{message:W.errToObj(e).message??t}:{message:t}}}:{}})}strip(){return new s({...this._def,unknownKeys:"strip"})}passthrough(){return new s({...this._def,unknownKeys:"passthrough"})}extend(e){return new s({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new s({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:A.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new s({...this._def,catchall:e})}pick(e){let r={};for(let a of se.objectKeys(e))e[a]&&this.shape[a]&&(r[a]=this.shape[a]);return new s({...this._def,shape:()=>r})}omit(e){let r={};for(let a of se.objectKeys(this.shape))e[a]||(r[a]=this.shape[a]);return new s({...this._def,shape:()=>r})}deepPartial(){return jr(this)}partial(e){let r={};for(let a of se.objectKeys(this.shape)){let t=this.shape[a];e&&!e[a]?r[a]=t:r[a]=t.optional()}return new s({...this._def,shape:()=>r})}required(e){let r={};for(let a of se.objectKeys(this.shape))if(e&&!e[a])r[a]=this.shape[a];else{let n=this.shape[a];for(;n instanceof rt;)n=n._def.innerType;r[a]=n}return new s({...this._def,shape:()=>r})}keyof(){return $i(se.objectKeys(this.shape))}};Be.create=(s,e)=>new Be({shape:()=>s,unknownKeys:"strip",catchall:ut.create(),typeName:A.ZodObject,...Y(e)});Be.strictCreate=(s,e)=>new Be({shape:()=>s,unknownKeys:"strict",catchall:ut.create(),typeName:A.ZodObject,...Y(e)});Be.lazycreate=(s,e)=>new Be({shape:s,unknownKeys:"strip",catchall:ut.create(),typeName:A.ZodObject,...Y(e)});var cr=class extends ee{_parse(e){let{ctx:r}=this._processInputParams(e),a=this._def.options;function t(n){for(let i of n)if(i.result.status==="valid")return i.result;for(let i of n)if(i.result.status==="dirty")return r.common.issues.push(...i.ctx.common.issues),i.result;let o=n.map(i=>new ze(i.ctx.common.issues));return F(r,{code:T.invalid_union,unionErrors:o}),Q}if(r.common.async)return Promise.all(a.map(async n=>{let o={...r,common:{...r.common,issues:[]},parent:null};return{result:await n._parseAsync({data:r.data,path:r.path,parent:o}),ctx:o}})).then(t);{let n,o=[];for(let l of a){let u={...r,common:{...r.common,issues:[]},parent:null},p=l._parseSync({data:r.data,path:r.path,parent:u});if(p.status==="valid")return p;p.status==="dirty"&&!n&&(n={result:p,ctx:u}),u.common.issues.length&&o.push(u.common.issues)}if(n)return r.common.issues.push(...n.ctx.common.issues),n.result;let i=o.map(l=>new ze(l));return F(r,{code:T.invalid_union,unionErrors:i}),Q}}get options(){return this._def.options}};cr.create=(s,e)=>new cr({options:s,typeName:A.ZodUnion,...Y(e)});var Tt=s=>s instanceof ur?Tt(s.schema):s instanceof at?Tt(s.innerType()):s instanceof dr?[s.value]:s instanceof pr?s.options:s instanceof fr?se.objectValues(s.enum):s instanceof hr?Tt(s._def.innerType):s instanceof or?[void 0]:s instanceof ir?[null]:s instanceof rt?[void 0,...Tt(s.unwrap())]:s instanceof Pt?[null,...Tt(s.unwrap())]:s instanceof cs||s instanceof vr?Tt(s.unwrap()):s instanceof mr?Tt(s._def.innerType):[],Gs=class s extends ee{_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==L.object)return F(r,{code:T.invalid_type,expected:L.object,received:r.parsedType}),Q;let a=this.discriminator,t=r.data[a],n=this.optionsMap.get(t);return n?r.common.async?n._parseAsync({data:r.data,path:r.path,parent:r}):n._parseSync({data:r.data,path:r.path,parent:r}):(F(r,{code:T.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[a]}),Q)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,a){let t=new Map;for(let n of r){let o=Tt(n.shape[e]);if(!o.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let i of o){if(t.has(i))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(i)}`);t.set(i,n)}}return new s({typeName:A.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:t,...Y(a)})}};function An(s,e){let r=yt(s),a=yt(e);if(s===e)return{valid:!0,data:s};if(r===L.object&&a===L.object){let t=se.objectKeys(e),n=se.objectKeys(s).filter(i=>t.indexOf(i)!==-1),o={...s,...e};for(let i of n){let l=An(s[i],e[i]);if(!l.valid)return{valid:!1};o[i]=l.data}return{valid:!0,data:o}}else if(r===L.array&&a===L.array){if(s.length!==e.length)return{valid:!1};let t=[];for(let n=0;n<s.length;n++){let o=s[n],i=e[n],l=An(o,i);if(!l.valid)return{valid:!1};t.push(l.data)}return{valid:!0,data:t}}else return r===L.date&&a===L.date&&+s==+e?{valid:!0,data:s}:{valid:!1}}var lr=class extends ee{_parse(e){let{status:r,ctx:a}=this._processInputParams(e),t=(n,o)=>{if(Bs(n)||Bs(o))return Q;let i=An(n.value,o.value);return i.valid?((Zs(n)||Zs(o))&&r.dirty(),{status:r.value,value:i.data}):(F(a,{code:T.invalid_intersection_types}),Q)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([n,o])=>t(n,o)):t(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}};lr.create=(s,e,r)=>new lr({left:s,right:e,typeName:A.ZodIntersection,...Y(r)});var bt=class s extends ee{_parse(e){let{status:r,ctx:a}=this._processInputParams(e);if(a.parsedType!==L.array)return F(a,{code:T.invalid_type,expected:L.array,received:a.parsedType}),Q;if(a.data.length<this._def.items.length)return F(a,{code:T.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Q;!this._def.rest&&a.data.length>this._def.items.length&&(F(a,{code:T.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let n=[...a.data].map((o,i)=>{let l=this._def.items[i]||this._def.rest;return l?l._parse(new st(a,o,a.path,i)):null}).filter(o=>!!o);return a.common.async?Promise.all(n).then(o=>Ne.mergeArray(r,o)):Ne.mergeArray(r,n)}get items(){return this._def.items}rest(e){return new s({...this._def,rest:e})}};bt.create=(s,e)=>{if(!Array.isArray(s))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new bt({items:s,typeName:A.ZodTuple,rest:null,...Y(e)})};var Js=class s extends ee{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:a}=this._processInputParams(e);if(a.parsedType!==L.object)return F(a,{code:T.invalid_type,expected:L.object,received:a.parsedType}),Q;let t=[],n=this._def.keyType,o=this._def.valueType;for(let i in a.data)t.push({key:n._parse(new st(a,i,a.path,i)),value:o._parse(new st(a,a.data[i],a.path,i)),alwaysSet:i in a.data});return a.common.async?Ne.mergeObjectAsync(r,t):Ne.mergeObjectSync(r,t)}get element(){return this._def.valueType}static create(e,r,a){return r instanceof ee?new s({keyType:e,valueType:r,typeName:A.ZodRecord,...Y(a)}):new s({keyType:Lt.create(),valueType:e,typeName:A.ZodRecord,...Y(r)})}},Vr=class extends ee{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:a}=this._processInputParams(e);if(a.parsedType!==L.map)return F(a,{code:T.invalid_type,expected:L.map,received:a.parsedType}),Q;let t=this._def.keyType,n=this._def.valueType,o=[...a.data.entries()].map(([i,l],u)=>({key:t._parse(new st(a,i,a.path,[u,"key"])),value:n._parse(new st(a,l,a.path,[u,"value"]))}));if(a.common.async){let i=new Map;return Promise.resolve().then(async()=>{for(let l of o){let u=await l.key,p=await l.value;if(u.status==="aborted"||p.status==="aborted")return Q;(u.status==="dirty"||p.status==="dirty")&&r.dirty(),i.set(u.value,p.value)}return{status:r.value,value:i}})}else{let i=new Map;for(let l of o){let u=l.key,p=l.value;if(u.status==="aborted"||p.status==="aborted")return Q;(u.status==="dirty"||p.status==="dirty")&&r.dirty(),i.set(u.value,p.value)}return{status:r.value,value:i}}}};Vr.create=(s,e,r)=>new Vr({valueType:e,keyType:s,typeName:A.ZodMap,...Y(r)});var Hr=class s extends ee{_parse(e){let{status:r,ctx:a}=this._processInputParams(e);if(a.parsedType!==L.set)return F(a,{code:T.invalid_type,expected:L.set,received:a.parsedType}),Q;let t=this._def;t.minSize!==null&&a.data.size<t.minSize.value&&(F(a,{code:T.too_small,minimum:t.minSize.value,type:"set",inclusive:!0,exact:!1,message:t.minSize.message}),r.dirty()),t.maxSize!==null&&a.data.size>t.maxSize.value&&(F(a,{code:T.too_big,maximum:t.maxSize.value,type:"set",inclusive:!0,exact:!1,message:t.maxSize.message}),r.dirty());let n=this._def.valueType;function o(l){let u=new Set;for(let p of l){if(p.status==="aborted")return Q;p.status==="dirty"&&r.dirty(),u.add(p.value)}return{status:r.value,value:u}}let i=[...a.data.values()].map((l,u)=>n._parse(new st(a,l,a.path,u)));return a.common.async?Promise.all(i).then(l=>o(l)):o(i)}min(e,r){return new s({...this._def,minSize:{value:e,message:W.toString(r)}})}max(e,r){return new s({...this._def,maxSize:{value:e,message:W.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}};Hr.create=(s,e)=>new Hr({valueType:s,minSize:null,maxSize:null,typeName:A.ZodSet,...Y(e)});var Qs=class s extends ee{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==L.function)return F(r,{code:T.invalid_type,expected:L.function,received:r.parsedType}),Q;function a(i,l){return is({data:i,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Fr(),Ct].filter(u=>!!u),issueData:{code:T.invalid_arguments,argumentsError:l}})}function t(i,l){return is({data:i,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Fr(),Ct].filter(u=>!!u),issueData:{code:T.invalid_return_type,returnTypeError:l}})}let n={errorMap:r.common.contextualErrorMap},o=r.data;if(this._def.returns instanceof qt){let i=this;return Le(async function(...l){let u=new ze([]),p=await i._def.args.parseAsync(l,n).catch(d=>{throw u.addIssue(a(l,d)),u}),h=await Reflect.apply(o,this,p);return await i._def.returns._def.type.parseAsync(h,n).catch(d=>{throw u.addIssue(t(h,d)),u})})}else{let i=this;return Le(function(...l){let u=i._def.args.safeParse(l,n);if(!u.success)throw new ze([a(l,u.error)]);let p=Reflect.apply(o,this,u.data),h=i._def.returns.safeParse(p,n);if(!h.success)throw new ze([t(p,h.error)]);return h.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new s({...this._def,args:bt.create(e).rest(kt.create())})}returns(e){return new s({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,a){return new s({args:e||bt.create([]).rest(kt.create()),returns:r||kt.create(),typeName:A.ZodFunction,...Y(a)})}},ur=class extends ee{get schema(){return this._def.getter()}_parse(e){let{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};ur.create=(s,e)=>new ur({getter:s,typeName:A.ZodLazy,...Y(e)});var dr=class extends ee{_parse(e){if(e.data!==this._def.value){let r=this._getOrReturnCtx(e);return F(r,{received:r.data,code:T.invalid_literal,expected:this._def.value}),Q}return{status:"valid",value:e.data}}get value(){return this._def.value}};dr.create=(s,e)=>new dr({value:s,typeName:A.ZodLiteral,...Y(e)});function $i(s,e){return new pr({values:s,typeName:A.ZodEnum,...Y(e)})}var pr=class s extends ee{_parse(e){if(typeof e.data!="string"){let r=this._getOrReturnCtx(e),a=this._def.values;return F(r,{expected:se.joinValues(a),received:r.parsedType,code:T.invalid_type}),Q}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let r=this._getOrReturnCtx(e),a=this._def.values;return F(r,{received:r.data,code:T.invalid_enum_value,options:a}),Q}return Le(e.data)}get options(){return this._def.values}get enum(){let e={};for(let r of this._def.values)e[r]=r;return e}get Values(){let e={};for(let r of this._def.values)e[r]=r;return e}get Enum(){let e={};for(let r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return s.create(e,{...this._def,...r})}exclude(e,r=this._def){return s.create(this.options.filter(a=>!e.includes(a)),{...this._def,...r})}};pr.create=$i;var fr=class extends ee{_parse(e){let r=se.getValidEnumValues(this._def.values),a=this._getOrReturnCtx(e);if(a.parsedType!==L.string&&a.parsedType!==L.number){let t=se.objectValues(r);return F(a,{expected:se.joinValues(t),received:a.parsedType,code:T.invalid_type}),Q}if(this._cache||(this._cache=new Set(se.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let t=se.objectValues(r);return F(a,{received:a.data,code:T.invalid_enum_value,options:t}),Q}return Le(e.data)}get enum(){return this._def.values}};fr.create=(s,e)=>new fr({values:s,typeName:A.ZodNativeEnum,...Y(e)});var qt=class extends ee{unwrap(){return this._def.type}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==L.promise&&r.common.async===!1)return F(r,{code:T.invalid_type,expected:L.promise,received:r.parsedType}),Q;let a=r.parsedType===L.promise?r.data:Promise.resolve(r.data);return Le(a.then(t=>this._def.type.parseAsync(t,{path:r.path,errorMap:r.common.contextualErrorMap})))}};qt.create=(s,e)=>new qt({type:s,typeName:A.ZodPromise,...Y(e)});var at=class extends ee{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===A.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:r,ctx:a}=this._processInputParams(e),t=this._def.effect||null,n={addIssue:o=>{F(a,o),o.fatal?r.abort():r.dirty()},get path(){return a.path}};if(n.addIssue=n.addIssue.bind(n),t.type==="preprocess"){let o=t.transform(a.data,n);if(a.common.async)return Promise.resolve(o).then(async i=>{if(r.value==="aborted")return Q;let l=await this._def.schema._parseAsync({data:i,path:a.path,parent:a});return l.status==="aborted"?Q:l.status==="dirty"?tr(l.value):r.value==="dirty"?tr(l.value):l});{if(r.value==="aborted")return Q;let i=this._def.schema._parseSync({data:o,path:a.path,parent:a});return i.status==="aborted"?Q:i.status==="dirty"?tr(i.value):r.value==="dirty"?tr(i.value):i}}if(t.type==="refinement"){let o=i=>{let l=t.refinement(i,n);if(a.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return i};if(a.common.async===!1){let i=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return i.status==="aborted"?Q:(i.status==="dirty"&&r.dirty(),o(i.value),{status:r.value,value:i.value})}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(i=>i.status==="aborted"?Q:(i.status==="dirty"&&r.dirty(),o(i.value).then(()=>({status:r.value,value:i.value}))))}if(t.type==="transform")if(a.common.async===!1){let o=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!Ft(o))return Q;let i=t.transform(o.value,n);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:i}}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(o=>Ft(o)?Promise.resolve(t.transform(o.value,n)).then(i=>({status:r.value,value:i})):Q);se.assertNever(t)}};at.create=(s,e,r)=>new at({schema:s,typeName:A.ZodEffects,effect:e,...Y(r)});at.createWithPreprocess=(s,e,r)=>new at({schema:e,effect:{type:"preprocess",transform:s},typeName:A.ZodEffects,...Y(r)});var rt=class extends ee{_parse(e){return this._getType(e)===L.undefined?Le(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};rt.create=(s,e)=>new rt({innerType:s,typeName:A.ZodOptional,...Y(e)});var Pt=class extends ee{_parse(e){return this._getType(e)===L.null?Le(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Pt.create=(s,e)=>new Pt({innerType:s,typeName:A.ZodNullable,...Y(e)});var hr=class extends ee{_parse(e){let{ctx:r}=this._processInputParams(e),a=r.data;return r.parsedType===L.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};hr.create=(s,e)=>new hr({innerType:s,typeName:A.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Y(e)});var mr=class extends ee{_parse(e){let{ctx:r}=this._processInputParams(e),a={...r,common:{...r.common,issues:[]}},t=this._def.innerType._parse({data:a.data,path:a.path,parent:{...a}});return Lr(t)?t.then(n=>({status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new ze(a.common.issues)},input:a.data})})):{status:"valid",value:t.status==="valid"?t.value:this._def.catchValue({get error(){return new ze(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}};mr.create=(s,e)=>new mr({innerType:s,typeName:A.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Y(e)});var Wr=class extends ee{_parse(e){if(this._getType(e)!==L.nan){let a=this._getOrReturnCtx(e);return F(a,{code:T.invalid_type,expected:L.nan,received:a.parsedType}),Q}return{status:"valid",value:e.data}}};Wr.create=s=>new Wr({typeName:A.ZodNaN,...Y(s)});var If=Symbol("zod_brand"),cs=class extends ee{_parse(e){let{ctx:r}=this._processInputParams(e),a=r.data;return this._def.type._parse({data:a,path:r.path,parent:r})}unwrap(){return this._def.type}},ls=class s extends ee{_parse(e){let{status:r,ctx:a}=this._processInputParams(e);if(a.common.async)return(async()=>{let n=await this._def.in._parseAsync({data:a.data,path:a.path,parent:a});return n.status==="aborted"?Q:n.status==="dirty"?(r.dirty(),tr(n.value)):this._def.out._parseAsync({data:n.value,path:a.path,parent:a})})();{let t=this._def.in._parseSync({data:a.data,path:a.path,parent:a});return t.status==="aborted"?Q:t.status==="dirty"?(r.dirty(),{status:"dirty",value:t.value}):this._def.out._parseSync({data:t.value,path:a.path,parent:a})}}static create(e,r){return new s({in:e,out:r,typeName:A.ZodPipeline})}},vr=class extends ee{_parse(e){let r=this._def.innerType._parse(e),a=t=>(Ft(t)&&(t.value=Object.freeze(t.value)),t);return Lr(r)?r.then(t=>a(t)):a(r)}unwrap(){return this._def.innerType}};vr.create=(s,e)=>new vr({innerType:s,typeName:A.ZodReadonly,...Y(e)});function ki(s,e){let r=typeof s=="function"?s(e):typeof s=="string"?{message:s}:s;return typeof r=="string"?{message:r}:r}function Di(s,e={},r){return s?jt.create().superRefine((a,t)=>{let n=s(a);if(n instanceof Promise)return n.then(o=>{if(!o){let i=ki(e,a),l=i.fatal??r??!0;t.addIssue({code:"custom",...i,fatal:l})}});if(!n){let o=ki(e,a),i=o.fatal??r??!0;t.addIssue({code:"custom",...o,fatal:i})}}):jt.create()}var Of={object:Be.lazycreate},A;(function(s){s.ZodString="ZodString",s.ZodNumber="ZodNumber",s.ZodNaN="ZodNaN",s.ZodBigInt="ZodBigInt",s.ZodBoolean="ZodBoolean",s.ZodDate="ZodDate",s.ZodSymbol="ZodSymbol",s.ZodUndefined="ZodUndefined",s.ZodNull="ZodNull",s.ZodAny="ZodAny",s.ZodUnknown="ZodUnknown",s.ZodNever="ZodNever",s.ZodVoid="ZodVoid",s.ZodArray="ZodArray",s.ZodObject="ZodObject",s.ZodUnion="ZodUnion",s.ZodDiscriminatedUnion="ZodDiscriminatedUnion",s.ZodIntersection="ZodIntersection",s.ZodTuple="ZodTuple",s.ZodRecord="ZodRecord",s.ZodMap="ZodMap",s.ZodSet="ZodSet",s.ZodFunction="ZodFunction",s.ZodLazy="ZodLazy",s.ZodLiteral="ZodLiteral",s.ZodEnum="ZodEnum",s.ZodEffects="ZodEffects",s.ZodNativeEnum="ZodNativeEnum",s.ZodOptional="ZodOptional",s.ZodNullable="ZodNullable",s.ZodDefault="ZodDefault",s.ZodCatch="ZodCatch",s.ZodPromise="ZodPromise",s.ZodBranded="ZodBranded",s.ZodPipeline="ZodPipeline",s.ZodReadonly="ZodReadonly"})(A||(A={}));var $f=(s,e={message:`Input not instance of ${s.name}`})=>Di(r=>r instanceof s,e),Ni=Lt.create,Mi=rr.create,Df=Wr.create,Nf=sr.create,Fi=ar.create,Mf=nr.create,Ff=qr.create,Lf=or.create,jf=ir.create,qf=jt.create,Uf=kt.create,Vf=ut.create,Hf=Ur.create,Wf=At.create,zf=Be.create,Bf=Be.strictCreate,Zf=cr.create,Gf=Gs.create,Jf=lr.create,Qf=bt.create,Kf=Js.create,Xf=Vr.create,Yf=Hr.create,eh=Qs.create,th=ur.create,rh=dr.create,sh=pr.create,ah=fr.create,nh=qt.create,oh=at.create,ih=rt.create,ch=Pt.create,lh=at.createWithPreprocess,uh=ls.create,dh=()=>Ni().optional(),ph=()=>Mi().optional(),fh=()=>Fi().optional(),hh={string:s=>Lt.create({...s,coerce:!0}),number:s=>rr.create({...s,coerce:!0}),boolean:s=>ar.create({...s,coerce:!0}),bigint:s=>sr.create({...s,coerce:!0}),date:s=>nr.create({...s,coerce:!0})};var mh=Q;var vh=["error","warning","information","hint"],gh={error:Se.DiagnosticSeverity.Error,warning:Se.DiagnosticSeverity.Warning,information:Se.DiagnosticSeverity.Information,hint:Se.DiagnosticSeverity.Hint},Li=c.object({maxDiagnostics:c.number().int().positive().max(1e3).default(50),file:c.string().optional(),source:c.union([c.string(),c.array(c.string())]).optional(),code:c.union([c.string(),c.array(c.string())]).optional(),includeNonWorkspaceDiagnostics:c.boolean().default(!1),minSeverity:c.enum(vh).default("information")}),ji=c.object({diagnostics:c.array(c.object({filePath:c.string(),relativePath:c.string().nullable(),range:c.object({start:c.object({line:c.number().int().nonnegative(),character:c.number().int().nonnegative()}),end:c.object({line:c.number().int().nonnegative(),character:c.number().int().nonnegative()})}),severity:c.string(),source:c.string().nullable(),code:c.string().nullable(),message:c.string()})),returnedDiagnostics:c.number().int().nonnegative(),totalDiagnosticsAfterFiltering:c.number().int().nonnegative(),limit:c.number().int().positive(),truncated:c.boolean(),summary:c.array(c.string())});function qi(s){s.registerTool("vscodeDiagnostics",{title:"VS Code Diagnostics",description:"Retrieve diagnostics from vscode.languages.getDiagnostics() with optional filters.",inputSchema:Li.shape,outputSchema:ji.shape},async e=>{let{maxDiagnostics:r,file:a,source:t,code:n,minSeverity:o,includeNonWorkspaceDiagnostics:i}=Li.parse(e),l=t?new Set(Array.isArray(t)?t:[t]):void 0,u=n?new Set(Array.isArray(n)?n:[n]):void 0,p=a?Ph(a):void 0,h=yh(p),m=bh(h,a,gh[o],i,l,u),d=m.slice(0,r),v=ji.parse(Sh(d,r,m.length));return{content:[{type:"text",text:v.summary.join(`
`)}],structuredContent:v}})}function yh(s){if(s)return Se.languages.getDiagnostics(s).map(r=>({uri:s,diagnostic:r}));let e=[];for(let[r,a]of Se.languages.getDiagnostics())for(let t of a)e.push({uri:r,diagnostic:t});return e}function bh(s,e,r,a,t,n){let o=[];for(let i of s)e&&!wh(i.uri,e)||(i.diagnostic.severity??Se.DiagnosticSeverity.Error)>r||!a&&!e&&!xh(i.uri)||t&&!_h(i.diagnostic,t)||n&&!Eh(i.diagnostic,n)||o.push(i);return o}function Ph(s){let e=Ui(s);if(e)return e;let r=Se.workspace.workspaceFolders;if(!r||r.length===0)return;let a=us(s);for(let t of r){let n=Ut.join(t.uri.fsPath,s);if(us(n).endsWith(a))return Se.Uri.file(n)}}function xh(s){return Se.workspace.getWorkspaceFolder(s)!==void 0}function wh(s,e){let r=Ui(e);if(r)return In(s)===In(r);let a=us(e),t=Vi(s);return t&&us(t)===a?!0:In(s).endsWith(a)}function Ui(s){if(s.startsWith("file:"))try{let e=Se.Uri.parse(s);if(e.scheme==="file")return e}catch{return}if(Ut.isAbsolute(s))return Se.Uri.file(s)}function In(s){return us(s.fsPath)}function us(s){let e=Ut.normalize(s).replace(/\\/g,"/");return typeof process<"u"&&process.platform==="win32"?e.toLowerCase():e}function _h(s,e){let r=s.source;return r?e.has(r):!1}function Eh(s,e){let r=s.code;if(r===void 0)return!1;let a=typeof r=="object"&&"value"in r?String(r.value):String(r);return e.has(a)}function Sh(s,e,r){let a=[],t=[],n=1;for(let{uri:l,diagnostic:u}of s){let p=Vi(l),h=u.range,m=h.start.line+1,d=h.start.character+1,v=Rh(u.severity),b=u.source??null,g=Ch(u.code),x=[`${n}. ${p??l.fsPath}:${m}:${d}`,`[${v}]`];b?x.push(`(${b}${g?`:${g}`:""})`):g&&x.push(`(${g})`),a.push(`${x.join(" ")}
${u.message}`),t.push({filePath:l.fsPath,relativePath:p??null,range:{start:{line:h.start.line,character:h.start.character},end:{line:h.end.line,character:h.end.character}},severity:v,source:b,code:g,message:u.message}),n=n+1}let o=r>s.length,i=a.length>0?[`Returned ${s.length} diagnostics (limit ${e}, total after filtering ${r}, truncated: ${o?"yes":"no"}).`,"",...a]:[`Returned 0 diagnostics (limit ${e}, total after filtering ${r}, truncated: no).`];return{diagnostics:t,returnedDiagnostics:s.length,totalDiagnosticsAfterFiltering:r,limit:e,truncated:o,summary:i}}function Vi(s){let e=Se.workspace.getWorkspaceFolder(s);if(e)return Ut.relative(e.uri.fsPath,s.fsPath)}function Rh(s){switch(s){case Se.DiagnosticSeverity.Error:return"error";case Se.DiagnosticSeverity.Warning:return"warning";case Se.DiagnosticSeverity.Information:return"information";case Se.DiagnosticSeverity.Hint:return"hint"}}function Ch(s){return s===void 0?null:typeof s=="object"&&"value"in s?String(s.value):String(s)}var On="2025-06-18";var Hi=[On,"2025-03-26","2024-11-05","2024-10-07"],Ks="2.0",Wi=c.union([c.string(),c.number().int()]),zi=c.string(),Th=c.object({progressToken:c.optional(Wi)}).passthrough(),nt=c.object({_meta:c.optional(Th)}).passthrough(),Ze=c.object({method:c.string(),params:c.optional(nt)}),ds=c.object({_meta:c.optional(c.object({}).passthrough())}).passthrough(),xt=c.object({method:c.string(),params:c.optional(ds)}),ot=c.object({_meta:c.optional(c.object({}).passthrough())}).passthrough(),Xs=c.union([c.string(),c.number().int()]),Bi=c.object({jsonrpc:c.literal(Ks),id:Xs}).merge(Ze).strict(),Zi=s=>Bi.safeParse(s).success,Gi=c.object({jsonrpc:c.literal(Ks)}).merge(xt).strict(),Ji=s=>Gi.safeParse(s).success,Qi=c.object({jsonrpc:c.literal(Ks),id:Xs,result:ot}).strict(),$n=s=>Qi.safeParse(s).success,he;(function(s){s[s.ConnectionClosed=-32e3]="ConnectionClosed",s[s.RequestTimeout=-32001]="RequestTimeout",s[s.ParseError=-32700]="ParseError",s[s.InvalidRequest=-32600]="InvalidRequest",s[s.MethodNotFound=-32601]="MethodNotFound",s[s.InvalidParams=-32602]="InvalidParams",s[s.InternalError=-32603]="InternalError"})(he||(he={}));var Ki=c.object({jsonrpc:c.literal(Ks),id:Xs,error:c.object({code:c.number().int(),message:c.string(),data:c.optional(c.unknown())})}).strict(),Xi=s=>Ki.safeParse(s).success,Yi=c.union([Bi,Gi,Qi,Ki]),Ys=ot.strict(),ea=xt.extend({method:c.literal("notifications/cancelled"),params:ds.extend({requestId:Xs,reason:c.string().optional()})}),kh=c.object({src:c.string(),mimeType:c.optional(c.string()),sizes:c.optional(c.array(c.string()))}).passthrough(),ps=c.object({icons:c.array(kh).optional()}).passthrough(),fs=c.object({name:c.string(),title:c.optional(c.string())}).passthrough(),ec=fs.extend({version:c.string(),websiteUrl:c.optional(c.string())}).merge(ps),Ah=c.object({experimental:c.optional(c.object({}).passthrough()),sampling:c.optional(c.object({}).passthrough()),elicitation:c.optional(c.object({}).passthrough()),roots:c.optional(c.object({listChanged:c.optional(c.boolean())}).passthrough())}).passthrough(),Dn=Ze.extend({method:c.literal("initialize"),params:nt.extend({protocolVersion:c.string(),capabilities:Ah,clientInfo:ec})});var Ih=c.object({experimental:c.optional(c.object({}).passthrough()),logging:c.optional(c.object({}).passthrough()),completions:c.optional(c.object({}).passthrough()),prompts:c.optional(c.object({listChanged:c.optional(c.boolean())}).passthrough()),resources:c.optional(c.object({subscribe:c.optional(c.boolean()),listChanged:c.optional(c.boolean())}).passthrough()),tools:c.optional(c.object({listChanged:c.optional(c.boolean())}).passthrough())}).passthrough(),Oh=ot.extend({protocolVersion:c.string(),capabilities:Ih,serverInfo:ec,instructions:c.optional(c.string())}),Nn=xt.extend({method:c.literal("notifications/initialized")});var ta=Ze.extend({method:c.literal("ping")}),$h=c.object({progress:c.number(),total:c.optional(c.number()),message:c.optional(c.string())}).passthrough(),ra=xt.extend({method:c.literal("notifications/progress"),params:ds.merge($h).extend({progressToken:Wi})}),sa=Ze.extend({params:nt.extend({cursor:c.optional(zi)}).optional()}),aa=ot.extend({nextCursor:c.optional(zi)}),tc=c.object({uri:c.string(),mimeType:c.optional(c.string()),_meta:c.optional(c.object({}).passthrough())}).passthrough(),rc=tc.extend({text:c.string()}),Mn=c.string().refine(s=>{try{return atob(s),!0}catch{return!1}},{message:"Invalid Base64 string"}),sc=tc.extend({blob:Mn}),ac=fs.extend({uri:c.string(),description:c.optional(c.string()),mimeType:c.optional(c.string()),_meta:c.optional(c.object({}).passthrough())}).merge(ps),Dh=fs.extend({uriTemplate:c.string(),description:c.optional(c.string()),mimeType:c.optional(c.string()),_meta:c.optional(c.object({}).passthrough())}).merge(ps),na=sa.extend({method:c.literal("resources/list")}),Nh=aa.extend({resources:c.array(ac)}),oa=sa.extend({method:c.literal("resources/templates/list")}),Mh=aa.extend({resourceTemplates:c.array(Dh)}),ia=Ze.extend({method:c.literal("resources/read"),params:nt.extend({uri:c.string()})}),Fh=ot.extend({contents:c.array(c.union([rc,sc]))}),Lh=xt.extend({method:c.literal("notifications/resources/list_changed")}),jh=Ze.extend({method:c.literal("resources/subscribe"),params:nt.extend({uri:c.string()})}),qh=Ze.extend({method:c.literal("resources/unsubscribe"),params:nt.extend({uri:c.string()})}),Uh=xt.extend({method:c.literal("notifications/resources/updated"),params:ds.extend({uri:c.string()})}),Vh=c.object({name:c.string(),description:c.optional(c.string()),required:c.optional(c.boolean())}).passthrough(),Hh=fs.extend({description:c.optional(c.string()),arguments:c.optional(c.array(Vh)),_meta:c.optional(c.object({}).passthrough())}).merge(ps),ca=sa.extend({method:c.literal("prompts/list")}),Wh=aa.extend({prompts:c.array(Hh)}),la=Ze.extend({method:c.literal("prompts/get"),params:nt.extend({name:c.string(),arguments:c.optional(c.record(c.string()))})}),Fn=c.object({type:c.literal("text"),text:c.string(),_meta:c.optional(c.object({}).passthrough())}).passthrough(),Ln=c.object({type:c.literal("image"),data:Mn,mimeType:c.string(),_meta:c.optional(c.object({}).passthrough())}).passthrough(),jn=c.object({type:c.literal("audio"),data:Mn,mimeType:c.string(),_meta:c.optional(c.object({}).passthrough())}).passthrough(),zh=c.object({type:c.literal("resource"),resource:c.union([rc,sc]),_meta:c.optional(c.object({}).passthrough())}).passthrough(),Bh=ac.extend({type:c.literal("resource_link")}),nc=c.union([Fn,Ln,jn,Bh,zh]),Zh=c.object({role:c.enum(["user","assistant"]),content:nc}).passthrough(),Gh=ot.extend({description:c.optional(c.string()),messages:c.array(Zh)}),Jh=xt.extend({method:c.literal("notifications/prompts/list_changed")}),Qh=c.object({title:c.optional(c.string()),readOnlyHint:c.optional(c.boolean()),destructiveHint:c.optional(c.boolean()),idempotentHint:c.optional(c.boolean()),openWorldHint:c.optional(c.boolean())}).passthrough(),Kh=fs.extend({description:c.optional(c.string()),inputSchema:c.object({type:c.literal("object"),properties:c.optional(c.object({}).passthrough()),required:c.optional(c.array(c.string()))}).passthrough(),outputSchema:c.optional(c.object({type:c.literal("object"),properties:c.optional(c.object({}).passthrough()),required:c.optional(c.array(c.string()))}).passthrough()),annotations:c.optional(Qh),_meta:c.optional(c.object({}).passthrough())}).merge(ps),ua=sa.extend({method:c.literal("tools/list")}),Xh=aa.extend({tools:c.array(Kh)}),oc=ot.extend({content:c.array(nc).default([]),structuredContent:c.object({}).passthrough().optional(),isError:c.optional(c.boolean())}),sP=oc.or(ot.extend({toolResult:c.unknown()})),da=Ze.extend({method:c.literal("tools/call"),params:nt.extend({name:c.string(),arguments:c.optional(c.record(c.unknown()))})}),Yh=xt.extend({method:c.literal("notifications/tools/list_changed")}),hs=c.enum(["debug","info","notice","warning","error","critical","alert","emergency"]),qn=Ze.extend({method:c.literal("logging/setLevel"),params:nt.extend({level:hs})}),em=xt.extend({method:c.literal("notifications/message"),params:ds.extend({level:hs,logger:c.optional(c.string()),data:c.unknown()})}),tm=c.object({name:c.string().optional()}).passthrough(),rm=c.object({hints:c.optional(c.array(tm)),costPriority:c.optional(c.number().min(0).max(1)),speedPriority:c.optional(c.number().min(0).max(1)),intelligencePriority:c.optional(c.number().min(0).max(1))}).passthrough(),sm=c.object({role:c.enum(["user","assistant"]),content:c.union([Fn,Ln,jn])}).passthrough(),am=Ze.extend({method:c.literal("sampling/createMessage"),params:nt.extend({messages:c.array(sm),systemPrompt:c.optional(c.string()),includeContext:c.optional(c.enum(["none","thisServer","allServers"])),temperature:c.optional(c.number()),maxTokens:c.number().int(),stopSequences:c.optional(c.array(c.string())),metadata:c.optional(c.object({}).passthrough()),modelPreferences:c.optional(rm)})}),Un=ot.extend({model:c.string(),stopReason:c.optional(c.enum(["endTurn","stopSequence","maxTokens"]).or(c.string())),role:c.enum(["user","assistant"]),content:c.discriminatedUnion("type",[Fn,Ln,jn])}),nm=c.object({type:c.literal("boolean"),title:c.optional(c.string()),description:c.optional(c.string()),default:c.optional(c.boolean())}).passthrough(),om=c.object({type:c.literal("string"),title:c.optional(c.string()),description:c.optional(c.string()),minLength:c.optional(c.number()),maxLength:c.optional(c.number()),format:c.optional(c.enum(["email","uri","date","date-time"]))}).passthrough(),im=c.object({type:c.enum(["number","integer"]),title:c.optional(c.string()),description:c.optional(c.string()),minimum:c.optional(c.number()),maximum:c.optional(c.number())}).passthrough(),cm=c.object({type:c.literal("string"),title:c.optional(c.string()),description:c.optional(c.string()),enum:c.array(c.string()),enumNames:c.optional(c.array(c.string()))}).passthrough(),lm=c.union([nm,om,im,cm]),um=Ze.extend({method:c.literal("elicitation/create"),params:nt.extend({message:c.string(),requestedSchema:c.object({type:c.literal("object"),properties:c.record(c.string(),lm),required:c.optional(c.array(c.string()))}).passthrough()})}),Vn=ot.extend({action:c.enum(["accept","decline","cancel"]),content:c.optional(c.record(c.string(),c.unknown()))}),dm=c.object({type:c.literal("ref/resource"),uri:c.string()}).passthrough();var pm=c.object({type:c.literal("ref/prompt"),name:c.string()}).passthrough(),pa=Ze.extend({method:c.literal("completion/complete"),params:nt.extend({ref:c.union([pm,dm]),argument:c.object({name:c.string(),value:c.string()}).passthrough(),context:c.optional(c.object({arguments:c.optional(c.record(c.string(),c.string()))}))})}),fm=ot.extend({completion:c.object({values:c.array(c.string()).max(100),total:c.optional(c.number().int()),hasMore:c.optional(c.boolean())}).passthrough()}),hm=c.object({uri:c.string().startsWith("file://"),name:c.optional(c.string()),_meta:c.optional(c.object({}).passthrough())}).passthrough(),mm=Ze.extend({method:c.literal("roots/list")}),Hn=ot.extend({roots:c.array(hm)}),vm=xt.extend({method:c.literal("notifications/roots/list_changed")}),aP=c.union([ta,Dn,pa,qn,la,ca,na,oa,ia,jh,qh,da,ua]),nP=c.union([ea,ra,Nn,vm]),oP=c.union([Ys,Un,Vn,Hn]),iP=c.union([ta,am,um,mm]),cP=c.union([ea,ra,em,Uh,Lh,Yh,Jh]),lP=c.union([Ys,Oh,fm,Gh,Wh,Nh,Mh,Fh,oc,Xh]),me=class extends Error{constructor(e,r,a){super(`MCP error ${e}: ${r}`),this.code=e,this.data=a,this.name="McpError"}};var ic=require("node:crypto"),cc=require("node:events"),lc=z(require("node:readline")),fa=class{socket;rl;started=!1;closedNotified=!1;protocolVersion;sessionId;onclose;onerror;onmessage;constructor(e){this.socket=e,this.sessionId=(0,ic.randomUUID)(),this.rl=lc.default.createInterface({input:this.socket,crlfDelay:1/0}),this.onclose=this.handleClose.bind(this),this.onerror=this.handleError.bind(this),this.onmessage=this.handleMessage.bind(this)}async start(){if(this.started)throw new Error("UnixDomainSocketTransport already started.");this.started=!0,this.closedNotified=!1,this.socket.setEncoding("utf8"),this.socket.on("error",this.handleSocketError),this.socket.on("close",this.handleSocketClose),this.rl.on("line",this.handleLine),this.rl.on("close",this.handleReadlineClose)}async send(e,r){if(!this.started)throw new Error("Transport not started.");let a=JSON.stringify(e)+`
`;this.socket.write(a)||await(0,cc.once)(this.socket,"drain")}async close(){let e=this.started;this.started=!1,this.detachListeners(),e&&this.socket.end(),this.socket.destroy(),this.rl.close(),this.notifyClosed()}setProtocolVersion(e){this.protocolVersion=e}handleClose(){process.stderr.write(`UnixDomainSocketTransport connection closed
`)}handleError(e){process.stderr.write(`${e.stack??e.message}
`)}handleMessage(e,r){this.send(e).catch(a=>this.onerror(a))}handleSocketError=e=>{let r=e instanceof Error?e:new Error(String(e));this.onerror(r)};handleSocketClose=()=>{this.detachListeners(),this.rl.close(),this.notifyClosed()};handleLine=e=>{if(e.trim())try{let r=Yi.parse(JSON.parse(e));this.onmessage(r)}catch(r){this.onerror(r instanceof Error?r:new Error(String(r)))}};handleReadlineClose=()=>{this.rl.removeAllListeners()};detachListeners(){this.socket.removeListener("error",this.handleSocketError),this.socket.removeListener("close",this.handleSocketClose),this.rl.removeListener("line",this.handleLine),this.rl.removeListener("close",this.handleReadlineClose)}notifyClosed(){this.closedNotified||(this.closedNotified=!0,this.onclose())}};var uc=require("node:events"),Wn=require("node:fs"),dc=z(require("node:net")),ha=class{constructor(e){this.socketPath=e}server=null;transports=new Set;async listen(e){if(this.server)throw new Error("UnixDomainSocketServer is already listening.");await this.removeExistingSocket(),this.server=dc.default.createServer(r=>{let a=new fa(r);this.transports.add(a),r.once("close",()=>{this.transports.delete(a)}),Promise.resolve(e(a)).catch(t=>{let n=t instanceof Error?t:new Error(String(t));a.onerror(n),a.close()})}),this.server.on("error",r=>{let a=r instanceof Error?r:new Error(String(r));process.stderr.write(`${a.stack??a.message}
`)}),this.server.listen(this.socketPath),this.server.listening||await(0,uc.once)(this.server,"listening")}async close(){let e=this.server;this.server=null;let r=[...this.transports].map(a=>a.close().catch(()=>{}));this.transports.clear(),await Promise.all(r),e&&e.listening&&await new Promise(a=>e.close(()=>a())),await this.removeExistingSocket()}async removeExistingSocket(){try{if((await Wn.promises.lstat(this.socketPath)).isSocket())await Wn.promises.unlink(this.socketPath);else throw new Error(`Cannot reuse ${this.socketPath}: existing path is not a socket.`)}catch(e){if(e.code!=="ENOENT")throw e}}};var gm=6e4,ma=class{constructor(e){this._options=e,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this.setNotificationHandler(ea,r=>{let a=this._requestHandlerAbortControllers.get(r.params.requestId);a?.abort(r.params.reason)}),this.setNotificationHandler(ra,r=>{this._onprogress(r)}),this.setRequestHandler(ta,r=>({}))}_setupTimeout(e,r,a,t,n=!1){this._timeoutInfo.set(e,{timeoutId:setTimeout(t,r),startTime:Date.now(),timeout:r,maxTotalTimeout:a,resetTimeoutOnProgress:n,onTimeout:t})}_resetTimeout(e){let r=this._timeoutInfo.get(e);if(!r)return!1;let a=Date.now()-r.startTime;if(r.maxTotalTimeout&&a>=r.maxTotalTimeout)throw this._timeoutInfo.delete(e),new me(he.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:r.maxTotalTimeout,totalElapsed:a});return clearTimeout(r.timeoutId),r.timeoutId=setTimeout(r.onTimeout,r.timeout),!0}_cleanupTimeout(e){let r=this._timeoutInfo.get(e);r&&(clearTimeout(r.timeoutId),this._timeoutInfo.delete(e))}async connect(e){var r,a,t;this._transport=e;let n=(r=this.transport)===null||r===void 0?void 0:r.onclose;this._transport.onclose=()=>{n?.(),this._onclose()};let o=(a=this.transport)===null||a===void 0?void 0:a.onerror;this._transport.onerror=l=>{o?.(l),this._onerror(l)};let i=(t=this._transport)===null||t===void 0?void 0:t.onmessage;this._transport.onmessage=(l,u)=>{i?.(l,u),$n(l)||Xi(l)?this._onresponse(l):Zi(l)?this._onrequest(l,u):Ji(l)?this._onnotification(l):this._onerror(new Error(`Unknown message type: ${JSON.stringify(l)}`))},await this._transport.start()}_onclose(){var e;let r=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._pendingDebouncedNotifications.clear(),this._transport=void 0,(e=this.onclose)===null||e===void 0||e.call(this);let a=new me(he.ConnectionClosed,"Connection closed");for(let t of r.values())t(a)}_onerror(e){var r;(r=this.onerror)===null||r===void 0||r.call(this,e)}_onnotification(e){var r;let a=(r=this._notificationHandlers.get(e.method))!==null&&r!==void 0?r:this.fallbackNotificationHandler;a!==void 0&&Promise.resolve().then(()=>a(e)).catch(t=>this._onerror(new Error(`Uncaught error in notification handler: ${t}`)))}_onrequest(e,r){var a,t;let n=(a=this._requestHandlers.get(e.method))!==null&&a!==void 0?a:this.fallbackRequestHandler,o=this._transport;if(n===void 0){o?.send({jsonrpc:"2.0",id:e.id,error:{code:he.MethodNotFound,message:"Method not found"}}).catch(u=>this._onerror(new Error(`Failed to send an error response: ${u}`)));return}let i=new AbortController;this._requestHandlerAbortControllers.set(e.id,i);let l={signal:i.signal,sessionId:o?.sessionId,_meta:(t=e.params)===null||t===void 0?void 0:t._meta,sendNotification:u=>this.notification(u,{relatedRequestId:e.id}),sendRequest:(u,p,h)=>this.request(u,p,{...h,relatedRequestId:e.id}),authInfo:r?.authInfo,requestId:e.id,requestInfo:r?.requestInfo};Promise.resolve().then(()=>n(e,l)).then(u=>{if(!i.signal.aborted)return o?.send({result:u,jsonrpc:"2.0",id:e.id})},u=>{var p;if(!i.signal.aborted)return o?.send({jsonrpc:"2.0",id:e.id,error:{code:Number.isSafeInteger(u.code)?u.code:he.InternalError,message:(p=u.message)!==null&&p!==void 0?p:"Internal error"}})}).catch(u=>this._onerror(new Error(`Failed to send response: ${u}`))).finally(()=>{this._requestHandlerAbortControllers.delete(e.id)})}_onprogress(e){let{progressToken:r,...a}=e.params,t=Number(r),n=this._progressHandlers.get(t);if(!n){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(e)}`));return}let o=this._responseHandlers.get(t),i=this._timeoutInfo.get(t);if(i&&o&&i.resetTimeoutOnProgress)try{this._resetTimeout(t)}catch(l){o(l);return}n(a)}_onresponse(e){let r=Number(e.id),a=this._responseHandlers.get(r);if(a===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(e)}`));return}if(this._responseHandlers.delete(r),this._progressHandlers.delete(r),this._cleanupTimeout(r),$n(e))a(e);else{let t=new me(e.error.code,e.error.message,e.error.data);a(t)}}get transport(){return this._transport}async close(){var e;await((e=this._transport)===null||e===void 0?void 0:e.close())}request(e,r,a){let{relatedRequestId:t,resumptionToken:n,onresumptiontoken:o}=a??{};return new Promise((i,l)=>{var u,p,h,m,d,v;if(!this._transport){l(new Error("Not connected"));return}((u=this._options)===null||u===void 0?void 0:u.enforceStrictCapabilities)===!0&&this.assertCapabilityForMethod(e.method),(p=a?.signal)===null||p===void 0||p.throwIfAborted();let b=this._requestMessageId++,g={...e,jsonrpc:"2.0",id:b};a?.onprogress&&(this._progressHandlers.set(b,a.onprogress),g.params={...e.params,_meta:{...((h=e.params)===null||h===void 0?void 0:h._meta)||{},progressToken:b}});let x=C=>{var I;this._responseHandlers.delete(b),this._progressHandlers.delete(b),this._cleanupTimeout(b),(I=this._transport)===null||I===void 0||I.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:b,reason:String(C)}},{relatedRequestId:t,resumptionToken:n,onresumptiontoken:o}).catch(O=>this._onerror(new Error(`Failed to send cancellation: ${O}`))),l(C)};this._responseHandlers.set(b,C=>{var I;if(!(!((I=a?.signal)===null||I===void 0)&&I.aborted)){if(C instanceof Error)return l(C);try{let O=r.parse(C.result);i(O)}catch(O){l(O)}}}),(m=a?.signal)===null||m===void 0||m.addEventListener("abort",()=>{var C;x((C=a?.signal)===null||C===void 0?void 0:C.reason)});let S=(d=a?.timeout)!==null&&d!==void 0?d:gm,E=()=>x(new me(he.RequestTimeout,"Request timed out",{timeout:S}));this._setupTimeout(b,S,a?.maxTotalTimeout,E,(v=a?.resetTimeoutOnProgress)!==null&&v!==void 0?v:!1),this._transport.send(g,{relatedRequestId:t,resumptionToken:n,onresumptiontoken:o}).catch(C=>{this._cleanupTimeout(b),l(C)})})}async notification(e,r){var a,t;if(!this._transport)throw new Error("Not connected");if(this.assertNotificationCapability(e.method),((t=(a=this._options)===null||a===void 0?void 0:a.debouncedNotificationMethods)!==null&&t!==void 0?t:[]).includes(e.method)&&!e.params&&!r?.relatedRequestId){if(this._pendingDebouncedNotifications.has(e.method))return;this._pendingDebouncedNotifications.add(e.method),Promise.resolve().then(()=>{var l;if(this._pendingDebouncedNotifications.delete(e.method),!this._transport)return;let u={...e,jsonrpc:"2.0"};(l=this._transport)===null||l===void 0||l.send(u,r).catch(p=>this._onerror(p))});return}let i={...e,jsonrpc:"2.0"};await this._transport.send(i,r)}setRequestHandler(e,r){let a=e.shape.method.value;this.assertRequestHandlerCapability(a),this._requestHandlers.set(a,(t,n)=>Promise.resolve(r(e.parse(t),n)))}removeRequestHandler(e){this._requestHandlers.delete(e)}assertCanSetRequestHandler(e){if(this._requestHandlers.has(e))throw new Error(`A request handler for ${e} already exists, which would be overridden`)}setNotificationHandler(e,r){this._notificationHandlers.set(e.shape.method.value,a=>Promise.resolve(r(e.parse(a))))}removeNotificationHandler(e){this._notificationHandlers.delete(e)}};function pc(s,e){return Object.entries(e).reduce((r,[a,t])=>(t&&typeof t=="object"?r[a]=r[a]?{...r[a],...t}:t:r[a]=t,r),{...s})}var hu=z(fu(),1),Da=class extends ma{constructor(e,r){var a;super(r),this._serverInfo=e,this._loggingLevels=new Map,this.LOG_LEVEL_SEVERITY=new Map(hs.options.map((t,n)=>[t,n])),this.isMessageIgnored=(t,n)=>{let o=this._loggingLevels.get(n);return o?this.LOG_LEVEL_SEVERITY.get(t)<this.LOG_LEVEL_SEVERITY.get(o):!1},this._capabilities=(a=r?.capabilities)!==null&&a!==void 0?a:{},this._instructions=r?.instructions,this.setRequestHandler(Dn,t=>this._oninitialize(t)),this.setNotificationHandler(Nn,()=>{var t;return(t=this.oninitialized)===null||t===void 0?void 0:t.call(this)}),this._capabilities.logging&&this.setRequestHandler(qn,async(t,n)=>{var o;let i=n.sessionId||((o=n.requestInfo)===null||o===void 0?void 0:o.headers["mcp-session-id"])||void 0,{level:l}=t.params,u=hs.safeParse(l);return u.success&&this._loggingLevels.set(i,u.data),{}})}registerCapabilities(e){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");this._capabilities=pc(this._capabilities,e)}assertCapabilityForMethod(e){var r,a,t;switch(e){case"sampling/createMessage":if(!(!((r=this._clientCapabilities)===null||r===void 0)&&r.sampling))throw new Error(`Client does not support sampling (required for ${e})`);break;case"elicitation/create":if(!(!((a=this._clientCapabilities)===null||a===void 0)&&a.elicitation))throw new Error(`Client does not support elicitation (required for ${e})`);break;case"roots/list":if(!(!((t=this._clientCapabilities)===null||t===void 0)&&t.roots))throw new Error(`Client does not support listing roots (required for ${e})`);break;case"ping":break}}assertNotificationCapability(e){switch(e){case"notifications/message":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"notifications/resources/updated":case"notifications/resources/list_changed":if(!this._capabilities.resources)throw new Error(`Server does not support notifying about resources (required for ${e})`);break;case"notifications/tools/list_changed":if(!this._capabilities.tools)throw new Error(`Server does not support notifying of tool list changes (required for ${e})`);break;case"notifications/prompts/list_changed":if(!this._capabilities.prompts)throw new Error(`Server does not support notifying of prompt list changes (required for ${e})`);break;case"notifications/cancelled":break;case"notifications/progress":break}}assertRequestHandlerCapability(e){switch(e){case"sampling/createMessage":if(!this._capabilities.sampling)throw new Error(`Server does not support sampling (required for ${e})`);break;case"logging/setLevel":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"prompts/get":case"prompts/list":if(!this._capabilities.prompts)throw new Error(`Server does not support prompts (required for ${e})`);break;case"resources/list":case"resources/templates/list":case"resources/read":if(!this._capabilities.resources)throw new Error(`Server does not support resources (required for ${e})`);break;case"tools/call":case"tools/list":if(!this._capabilities.tools)throw new Error(`Server does not support tools (required for ${e})`);break;case"ping":case"initialize":break}}async _oninitialize(e){let r=e.params.protocolVersion;return this._clientCapabilities=e.params.capabilities,this._clientVersion=e.params.clientInfo,{protocolVersion:Hi.includes(r)?r:On,capabilities:this.getCapabilities(),serverInfo:this._serverInfo,...this._instructions&&{instructions:this._instructions}}}getClientCapabilities(){return this._clientCapabilities}getClientVersion(){return this._clientVersion}getCapabilities(){return this._capabilities}async ping(){return this.request({method:"ping"},Ys)}async createMessage(e,r){return this.request({method:"sampling/createMessage",params:e},Un,r)}async elicitInput(e,r){let a=await this.request({method:"elicitation/create",params:e},Vn,r);if(a.action==="accept"&&a.content)try{let t=new hu.default,n=t.compile(e.requestedSchema);if(!n(a.content))throw new me(he.InvalidParams,`Elicitation response content does not match requested schema: ${t.errorsText(n.errors)}`)}catch(t){throw t instanceof me?t:new me(he.InternalError,`Error validating elicitation response: ${t}`)}return a}async listRoots(e,r){return this.request({method:"roots/list",params:e},Hn,r)}async sendLoggingMessage(e,r){if(this._capabilities.logging&&!this.isMessageIgnored(e.level,r))return this.notification({method:"notifications/message",params:e})}async sendResourceUpdated(e){return this.notification({method:"notifications/resources/updated",params:e})}async sendResourceListChanged(){return this.notification({method:"notifications/resources/list_changed"})}async sendToolListChanged(){return this.notification({method:"notifications/tools/list_changed"})}async sendPromptListChanged(){return this.notification({method:"notifications/prompts/list_changed"})}};var vu=Symbol("Let zodToJsonSchema decide on which parser to use");var mu={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},gu=s=>typeof s=="string"?{...mu,name:s}:{...mu,...s};var yu=s=>{let e=gu(s),r=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([a,t])=>[t._def,{def:t._def,path:[...e.basePath,e.definitionPath,a],jsonSchema:void 0}]))}};function vo(s,e,r,a){a?.errorMessages&&r&&(s.errorMessage={...s.errorMessage,[e]:r})}function ae(s,e,r,a,t){s[e]=r,vo(s,e,a,t)}var Na=(s,e)=>{let r=0;for(;r<s.length&&r<e.length&&s[r]===e[r];r++);return[(s.length-r).toString(),...e.slice(r)].join("/")};function ge(s){if(s.target!=="openAi")return{};let e=[...s.basePath,s.definitionPath,s.openAiAnyTypeName];return s.flags.hasReferencedOpenAiAnyType=!0,{$ref:s.$refStrategy==="relative"?Na(e,s.currentPath):e.join("/")}}function bu(s,e){let r={type:"array"};return s.type?._def&&s.type?._def?.typeName!==A.ZodAny&&(r.items=K(s.type._def,{...e,currentPath:[...e.currentPath,"items"]})),s.minLength&&ae(r,"minItems",s.minLength.value,s.minLength.message,e),s.maxLength&&ae(r,"maxItems",s.maxLength.value,s.maxLength.message,e),s.exactLength&&(ae(r,"minItems",s.exactLength.value,s.exactLength.message,e),ae(r,"maxItems",s.exactLength.value,s.exactLength.message,e)),r}function Pu(s,e){let r={type:"integer",format:"int64"};if(!s.checks)return r;for(let a of s.checks)switch(a.kind){case"min":e.target==="jsonSchema7"?a.inclusive?ae(r,"minimum",a.value,a.message,e):ae(r,"exclusiveMinimum",a.value,a.message,e):(a.inclusive||(r.exclusiveMinimum=!0),ae(r,"minimum",a.value,a.message,e));break;case"max":e.target==="jsonSchema7"?a.inclusive?ae(r,"maximum",a.value,a.message,e):ae(r,"exclusiveMaximum",a.value,a.message,e):(a.inclusive||(r.exclusiveMaximum=!0),ae(r,"maximum",a.value,a.message,e));break;case"multipleOf":ae(r,"multipleOf",a.value,a.message,e);break}return r}function xu(){return{type:"boolean"}}function Ma(s,e){return K(s.type._def,e)}var wu=(s,e)=>K(s.innerType._def,e);function go(s,e,r){let a=r??e.dateStrategy;if(Array.isArray(a))return{anyOf:a.map((t,n)=>go(s,e,t))};switch(a){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Qv(s,e)}}var Qv=(s,e)=>{let r={type:"integer",format:"unix-time"};if(e.target==="openApi3")return r;for(let a of s.checks)switch(a.kind){case"min":ae(r,"minimum",a.value,a.message,e);break;case"max":ae(r,"maximum",a.value,a.message,e);break}return r};function _u(s,e){return{...K(s.innerType._def,e),default:s.defaultValue()}}function Eu(s,e){return e.effectStrategy==="input"?K(s.schema._def,e):ge(e)}function Su(s){return{type:"string",enum:Array.from(s.values)}}var Kv=s=>"type"in s&&s.type==="string"?!1:"allOf"in s;function Ru(s,e){let r=[K(s.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),K(s.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(n=>!!n),a=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,t=[];return r.forEach(n=>{if(Kv(n))t.push(...n.allOf),n.unevaluatedProperties===void 0&&(a=void 0);else{let o=n;if("additionalProperties"in n&&n.additionalProperties===!1){let{additionalProperties:i,...l}=n;o=l}else a=void 0;t.push(o)}}),t.length?{allOf:t,...a}:void 0}function Cu(s,e){let r=typeof s.value;return r!=="bigint"&&r!=="number"&&r!=="boolean"&&r!=="string"?{type:Array.isArray(s.value)?"array":"object"}:e.target==="openApi3"?{type:r==="bigint"?"integer":r,enum:[s.value]}:{type:r==="bigint"?"integer":r,const:s.value}}var yo,dt={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(yo===void 0&&(yo=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),yo),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Fa(s,e){let r={type:"string"};if(s.checks)for(let a of s.checks)switch(a.kind){case"min":ae(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,a.value):a.value,a.message,e);break;case"max":ae(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,a.value):a.value,a.message,e);break;case"email":switch(e.emailStrategy){case"format:email":pt(r,"email",a.message,e);break;case"format:idn-email":pt(r,"idn-email",a.message,e);break;case"pattern:zod":He(r,dt.email,a.message,e);break}break;case"url":pt(r,"uri",a.message,e);break;case"uuid":pt(r,"uuid",a.message,e);break;case"regex":He(r,a.regex,a.message,e);break;case"cuid":He(r,dt.cuid,a.message,e);break;case"cuid2":He(r,dt.cuid2,a.message,e);break;case"startsWith":He(r,RegExp(`^${bo(a.value,e)}`),a.message,e);break;case"endsWith":He(r,RegExp(`${bo(a.value,e)}$`),a.message,e);break;case"datetime":pt(r,"date-time",a.message,e);break;case"date":pt(r,"date",a.message,e);break;case"time":pt(r,"time",a.message,e);break;case"duration":pt(r,"duration",a.message,e);break;case"length":ae(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,a.value):a.value,a.message,e),ae(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,a.value):a.value,a.message,e);break;case"includes":{He(r,RegExp(bo(a.value,e)),a.message,e);break}case"ip":{a.version!=="v6"&&pt(r,"ipv4",a.message,e),a.version!=="v4"&&pt(r,"ipv6",a.message,e);break}case"base64url":He(r,dt.base64url,a.message,e);break;case"jwt":He(r,dt.jwt,a.message,e);break;case"cidr":{a.version!=="v6"&&He(r,dt.ipv4Cidr,a.message,e),a.version!=="v4"&&He(r,dt.ipv6Cidr,a.message,e);break}case"emoji":He(r,dt.emoji(),a.message,e);break;case"ulid":{He(r,dt.ulid,a.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{pt(r,"binary",a.message,e);break}case"contentEncoding:base64":{ae(r,"contentEncoding","base64",a.message,e);break}case"pattern:zod":{He(r,dt.base64,a.message,e);break}}break}case"nanoid":He(r,dt.nanoid,a.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return r}function bo(s,e){return e.patternStrategy==="escape"?Yv(s):s}var Xv=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Yv(s){let e="";for(let r=0;r<s.length;r++)Xv.has(s[r])||(e+="\\"),e+=s[r];return e}function pt(s,e,r,a){s.format||s.anyOf?.some(t=>t.format)?(s.anyOf||(s.anyOf=[]),s.format&&(s.anyOf.push({format:s.format,...s.errorMessage&&a.errorMessages&&{errorMessage:{format:s.errorMessage.format}}}),delete s.format,s.errorMessage&&(delete s.errorMessage.format,Object.keys(s.errorMessage).length===0&&delete s.errorMessage)),s.anyOf.push({format:e,...r&&a.errorMessages&&{errorMessage:{format:r}}})):ae(s,"format",e,r,a)}function He(s,e,r,a){s.pattern||s.allOf?.some(t=>t.pattern)?(s.allOf||(s.allOf=[]),s.pattern&&(s.allOf.push({pattern:s.pattern,...s.errorMessage&&a.errorMessages&&{errorMessage:{pattern:s.errorMessage.pattern}}}),delete s.pattern,s.errorMessage&&(delete s.errorMessage.pattern,Object.keys(s.errorMessage).length===0&&delete s.errorMessage)),s.allOf.push({pattern:Tu(e,a),...r&&a.errorMessages&&{errorMessage:{pattern:r}}})):ae(s,"pattern",Tu(e,a),r,a)}function Tu(s,e){if(!e.applyRegexFlags||!s.flags)return s.source;let r={i:s.flags.includes("i"),m:s.flags.includes("m"),s:s.flags.includes("s")},a=r.i?s.source.toLowerCase():s.source,t="",n=!1,o=!1,i=!1;for(let l=0;l<a.length;l++){if(n){t+=a[l],n=!1;continue}if(r.i){if(o){if(a[l].match(/[a-z]/)){i?(t+=a[l],t+=`${a[l-2]}-${a[l]}`.toUpperCase(),i=!1):a[l+1]==="-"&&a[l+2]?.match(/[a-z]/)?(t+=a[l],i=!0):t+=`${a[l]}${a[l].toUpperCase()}`;continue}}else if(a[l].match(/[a-z]/)){t+=`[${a[l]}${a[l].toUpperCase()}]`;continue}}if(r.m){if(a[l]==="^"){t+=`(^|(?<=[\r
]))`;continue}else if(a[l]==="$"){t+=`($|(?=[\r
]))`;continue}}if(r.s&&a[l]==="."){t+=o?`${a[l]}\r
`:`[${a[l]}\r
]`;continue}t+=a[l],a[l]==="\\"?n=!0:o&&a[l]==="]"?o=!1:!o&&a[l]==="["&&(o=!0)}try{new RegExp(t)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),s.source}return t}function La(s,e){if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&s.keyType?._def.typeName===A.ZodEnum)return{type:"object",required:s.keyType._def.values,properties:s.keyType._def.values.reduce((a,t)=>({...a,[t]:K(s.valueType._def,{...e,currentPath:[...e.currentPath,"properties",t]})??ge(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};let r={type:"object",additionalProperties:K(s.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return r;if(s.keyType?._def.typeName===A.ZodString&&s.keyType._def.checks?.length){let{type:a,...t}=Fa(s.keyType._def,e);return{...r,propertyNames:t}}else{if(s.keyType?._def.typeName===A.ZodEnum)return{...r,propertyNames:{enum:s.keyType._def.values}};if(s.keyType?._def.typeName===A.ZodBranded&&s.keyType._def.type._def.typeName===A.ZodString&&s.keyType._def.type._def.checks?.length){let{type:a,...t}=Ma(s.keyType._def,e);return{...r,propertyNames:t}}}return r}function ku(s,e){if(e.mapStrategy==="record")return La(s,e);let r=K(s.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||ge(e),a=K(s.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||ge(e);return{type:"array",maxItems:125,items:{type:"array",items:[r,a],minItems:2,maxItems:2}}}function Au(s){let e=s.values,a=Object.keys(s.values).filter(n=>typeof e[e[n]]!="number").map(n=>e[n]),t=Array.from(new Set(a.map(n=>typeof n)));return{type:t.length===1?t[0]==="string"?"string":"number":["string","number"],enum:a}}function Iu(s){return s.target==="openAi"?void 0:{not:ge({...s,currentPath:[...s.currentPath,"not"]})}}function Ou(s){return s.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var vs={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Du(s,e){if(e.target==="openApi3")return $u(s,e);let r=s.options instanceof Map?Array.from(s.options.values()):s.options;if(r.every(a=>a._def.typeName in vs&&(!a._def.checks||!a._def.checks.length))){let a=r.reduce((t,n)=>{let o=vs[n._def.typeName];return o&&!t.includes(o)?[...t,o]:t},[]);return{type:a.length>1?a:a[0]}}else if(r.every(a=>a._def.typeName==="ZodLiteral"&&!a.description)){let a=r.reduce((t,n)=>{let o=typeof n._def.value;switch(o){case"string":case"number":case"boolean":return[...t,o];case"bigint":return[...t,"integer"];case"object":if(n._def.value===null)return[...t,"null"];case"symbol":case"undefined":case"function":default:return t}},[]);if(a.length===r.length){let t=a.filter((n,o,i)=>i.indexOf(n)===o);return{type:t.length>1?t:t[0],enum:r.reduce((n,o)=>n.includes(o._def.value)?n:[...n,o._def.value],[])}}}else if(r.every(a=>a._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((a,t)=>[...a,...t._def.values.filter(n=>!a.includes(n))],[])};return $u(s,e)}var $u=(s,e)=>{let r=(s.options instanceof Map?Array.from(s.options.values()):s.options).map((a,t)=>K(a._def,{...e,currentPath:[...e.currentPath,"anyOf",`${t}`]})).filter(a=>!!a&&(!e.strictUnions||typeof a=="object"&&Object.keys(a).length>0));return r.length?{anyOf:r}:void 0};function Nu(s,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(s.innerType._def.typeName)&&(!s.innerType._def.checks||!s.innerType._def.checks.length))return e.target==="openApi3"?{type:vs[s.innerType._def.typeName],nullable:!0}:{type:[vs[s.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let a=K(s.innerType._def,{...e,currentPath:[...e.currentPath]});return a&&"$ref"in a?{allOf:[a],nullable:!0}:a&&{...a,nullable:!0}}let r=K(s.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function Mu(s,e){let r={type:"number"};if(!s.checks)return r;for(let a of s.checks)switch(a.kind){case"int":r.type="integer",vo(r,"type",a.message,e);break;case"min":e.target==="jsonSchema7"?a.inclusive?ae(r,"minimum",a.value,a.message,e):ae(r,"exclusiveMinimum",a.value,a.message,e):(a.inclusive||(r.exclusiveMinimum=!0),ae(r,"minimum",a.value,a.message,e));break;case"max":e.target==="jsonSchema7"?a.inclusive?ae(r,"maximum",a.value,a.message,e):ae(r,"exclusiveMaximum",a.value,a.message,e):(a.inclusive||(r.exclusiveMaximum=!0),ae(r,"maximum",a.value,a.message,e));break;case"multipleOf":ae(r,"multipleOf",a.value,a.message,e);break}return r}function Fu(s,e){let r=e.target==="openAi",a={type:"object",properties:{}},t=[],n=s.shape();for(let i in n){let l=n[i];if(l===void 0||l._def===void 0)continue;let u=tg(l);u&&r&&(l._def.typeName==="ZodOptional"&&(l=l._def.innerType),l.isNullable()||(l=l.nullable()),u=!1);let p=K(l._def,{...e,currentPath:[...e.currentPath,"properties",i],propertyPath:[...e.currentPath,"properties",i]});p!==void 0&&(a.properties[i]=p,u||t.push(i))}t.length&&(a.required=t);let o=eg(s,e);return o!==void 0&&(a.additionalProperties=o),a}function eg(s,e){if(s.catchall._def.typeName!=="ZodNever")return K(s.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(s.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function tg(s){try{return s.isOptional()}catch{return!0}}var Lu=(s,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return K(s.innerType._def,e);let r=K(s.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return r?{anyOf:[{not:ge(e)},r]}:ge(e)};var ju=(s,e)=>{if(e.pipeStrategy==="input")return K(s.in._def,e);if(e.pipeStrategy==="output")return K(s.out._def,e);let r=K(s.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),a=K(s.out._def,{...e,currentPath:[...e.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,a].filter(t=>t!==void 0)}};function qu(s,e){return K(s.type._def,e)}function Uu(s,e){let a={type:"array",uniqueItems:!0,items:K(s.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return s.minSize&&ae(a,"minItems",s.minSize.value,s.minSize.message,e),s.maxSize&&ae(a,"maxItems",s.maxSize.value,s.maxSize.message,e),a}function Vu(s,e){return s.rest?{type:"array",minItems:s.items.length,items:s.items.map((r,a)=>K(r._def,{...e,currentPath:[...e.currentPath,"items",`${a}`]})).reduce((r,a)=>a===void 0?r:[...r,a],[]),additionalItems:K(s.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:s.items.length,maxItems:s.items.length,items:s.items.map((r,a)=>K(r._def,{...e,currentPath:[...e.currentPath,"items",`${a}`]})).reduce((r,a)=>a===void 0?r:[...r,a],[])}}function Hu(s){return{not:ge(s)}}function Wu(s){return ge(s)}var zu=(s,e)=>K(s.innerType._def,e);var Bu=(s,e,r)=>{switch(e){case A.ZodString:return Fa(s,r);case A.ZodNumber:return Mu(s,r);case A.ZodObject:return Fu(s,r);case A.ZodBigInt:return Pu(s,r);case A.ZodBoolean:return xu();case A.ZodDate:return go(s,r);case A.ZodUndefined:return Hu(r);case A.ZodNull:return Ou(r);case A.ZodArray:return bu(s,r);case A.ZodUnion:case A.ZodDiscriminatedUnion:return Du(s,r);case A.ZodIntersection:return Ru(s,r);case A.ZodTuple:return Vu(s,r);case A.ZodRecord:return La(s,r);case A.ZodLiteral:return Cu(s,r);case A.ZodEnum:return Su(s);case A.ZodNativeEnum:return Au(s);case A.ZodNullable:return Nu(s,r);case A.ZodOptional:return Lu(s,r);case A.ZodMap:return ku(s,r);case A.ZodSet:return Uu(s,r);case A.ZodLazy:return()=>s.getter()._def;case A.ZodPromise:return qu(s,r);case A.ZodNaN:case A.ZodNever:return Iu(r);case A.ZodEffects:return Eu(s,r);case A.ZodAny:return ge(r);case A.ZodUnknown:return Wu(r);case A.ZodDefault:return _u(s,r);case A.ZodBranded:return Ma(s,r);case A.ZodReadonly:return zu(s,r);case A.ZodCatch:return wu(s,r);case A.ZodPipeline:return ju(s,r);case A.ZodFunction:case A.ZodVoid:case A.ZodSymbol:return;default:return(a=>{})(e)}};function K(s,e,r=!1){let a=e.seen.get(s);if(e.override){let i=e.override?.(s,e,a,r);if(i!==vu)return i}if(a&&!r){let i=rg(a,e);if(i!==void 0)return i}let t={def:s,path:e.currentPath,jsonSchema:void 0};e.seen.set(s,t);let n=Bu(s,s.typeName,e),o=typeof n=="function"?K(n(),e):n;if(o&&sg(s,e,o),e.postProcess){let i=e.postProcess(o,s,e);return t.jsonSchema=o,i}return t.jsonSchema=o,o}var rg=(s,e)=>{switch(e.$refStrategy){case"root":return{$ref:s.path.join("/")};case"relative":return{$ref:Na(e.currentPath,s.path)};case"none":case"seen":return s.path.length<e.currentPath.length&&s.path.every((r,a)=>e.currentPath[a]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),ge(e)):e.$refStrategy==="seen"?ge(e):void 0}},sg=(s,e,r)=>(s.description&&(r.description=s.description,e.markdownDescription&&(r.markdownDescription=s.description)),r);var ja=(s,e)=>{let r=yu(e),a=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((l,[u,p])=>({...l,[u]:K(p._def,{...r,currentPath:[...r.basePath,r.definitionPath,u]},!0)??ge(r)}),{}):void 0,t=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,n=K(s._def,t===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,t]},!1)??ge(r),o=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;o!==void 0&&(n.title=o),r.flags.hasReferencedOpenAiAnyType&&(a||(a={}),a[r.openAiAnyTypeName]||(a[r.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:r.$refStrategy==="relative"?"1":[...r.basePath,r.definitionPath,r.openAiAnyTypeName].join("/")}}));let i=t===void 0?a?{...n,[r.definitionPath]:a}:n:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,t].join("/"),[r.definitionPath]:{...a,[t]:n}};return r.target==="jsonSchema7"?i.$schema="http://json-schema.org/draft-07/schema#":(r.target==="jsonSchema2019-09"||r.target==="openAi")&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),r.target==="openAi"&&("anyOf"in i||"oneOf"in i||"allOf"in i||"type"in i&&Array.isArray(i.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),i};var Po;(function(s){s.Completable="McpCompletable"})(Po||(Po={}));var zr=class extends ee{_parse(e){let{ctx:r}=this._processInputParams(e),a=r.data;return this._def.type._parse({data:a,path:r.path,parent:r})}unwrap(){return this._def.type}};zr.create=(s,e)=>new zr({type:s,typeName:Po.Completable,complete:e.complete,...ag(e)});function ag(s){if(!s)return{};let{errorMap:e,invalid_type_error:r,required_error:a,description:t}=s;if(e&&(r||a))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:t}:{errorMap:(o,i)=>{var l,u;let{message:p}=s;return o.code==="invalid_enum_value"?{message:p??i.defaultError}:typeof i.data>"u"?{message:(l=p??a)!==null&&l!==void 0?l:i.defaultError}:o.code!=="invalid_type"?{message:i.defaultError}:{message:(u=p??r)!==null&&u!==void 0?u:i.defaultError}},description:t}}var Ua=class{constructor(e,r){this._registeredResources={},this._registeredResourceTemplates={},this._registeredTools={},this._registeredPrompts={},this._toolHandlersInitialized=!1,this._completionHandlerInitialized=!1,this._resourceHandlersInitialized=!1,this._promptHandlersInitialized=!1,this.server=new Da(e,r)}async connect(e){return await this.server.connect(e)}async close(){await this.server.close()}setToolRequestHandlers(){this._toolHandlersInitialized||(this.server.assertCanSetRequestHandler(ua.shape.method.value),this.server.assertCanSetRequestHandler(da.shape.method.value),this.server.registerCapabilities({tools:{listChanged:!0}}),this.server.setRequestHandler(ua,()=>({tools:Object.entries(this._registeredTools).filter(([,e])=>e.enabled).map(([e,r])=>{let a={name:e,title:r.title,description:r.description,inputSchema:r.inputSchema?ja(r.inputSchema,{strictUnions:!0}):ng,annotations:r.annotations,_meta:r._meta};return r.outputSchema&&(a.outputSchema=ja(r.outputSchema,{strictUnions:!0})),a})})),this.server.setRequestHandler(da,async(e,r)=>{let a=this._registeredTools[e.params.name];if(!a)throw new me(he.InvalidParams,`Tool ${e.params.name} not found`);if(!a.enabled)throw new me(he.InvalidParams,`Tool ${e.params.name} disabled`);let t;if(a.inputSchema){let n=await a.inputSchema.safeParseAsync(e.params.arguments);if(!n.success)throw new me(he.InvalidParams,`Invalid arguments for tool ${e.params.name}: ${n.error.message}`);let o=n.data,i=a.callback;try{t=await Promise.resolve(i(o,r))}catch(l){t={content:[{type:"text",text:l instanceof Error?l.message:String(l)}],isError:!0}}}else{let n=a.callback;try{t=await Promise.resolve(n(r))}catch(o){t={content:[{type:"text",text:o instanceof Error?o.message:String(o)}],isError:!0}}}if(a.outputSchema&&!t.isError){if(!t.structuredContent)throw new me(he.InvalidParams,`Tool ${e.params.name} has an output schema but no structured content was provided`);let n=await a.outputSchema.safeParseAsync(t.structuredContent);if(!n.success)throw new me(he.InvalidParams,`Invalid structured content for tool ${e.params.name}: ${n.error.message}`)}return t}),this._toolHandlersInitialized=!0)}setCompletionRequestHandler(){this._completionHandlerInitialized||(this.server.assertCanSetRequestHandler(pa.shape.method.value),this.server.registerCapabilities({completions:{}}),this.server.setRequestHandler(pa,async e=>{switch(e.params.ref.type){case"ref/prompt":return this.handlePromptCompletion(e,e.params.ref);case"ref/resource":return this.handleResourceCompletion(e,e.params.ref);default:throw new me(he.InvalidParams,`Invalid completion reference: ${e.params.ref}`)}}),this._completionHandlerInitialized=!0)}async handlePromptCompletion(e,r){let a=this._registeredPrompts[r.name];if(!a)throw new me(he.InvalidParams,`Prompt ${r.name} not found`);if(!a.enabled)throw new me(he.InvalidParams,`Prompt ${r.name} disabled`);if(!a.argsSchema)return qa;let t=a.argsSchema.shape[e.params.argument.name];if(!(t instanceof zr))return qa;let o=await t._def.complete(e.params.argument.value,e.params.context);return Gu(o)}async handleResourceCompletion(e,r){let a=Object.values(this._registeredResourceTemplates).find(o=>o.resourceTemplate.uriTemplate.toString()===r.uri);if(!a){if(this._registeredResources[r.uri])return qa;throw new me(he.InvalidParams,`Resource template ${e.params.ref.uri} not found`)}let t=a.resourceTemplate.completeCallback(e.params.argument.name);if(!t)return qa;let n=await t(e.params.argument.value,e.params.context);return Gu(n)}setResourceRequestHandlers(){this._resourceHandlersInitialized||(this.server.assertCanSetRequestHandler(na.shape.method.value),this.server.assertCanSetRequestHandler(oa.shape.method.value),this.server.assertCanSetRequestHandler(ia.shape.method.value),this.server.registerCapabilities({resources:{listChanged:!0}}),this.server.setRequestHandler(na,async(e,r)=>{let a=Object.entries(this._registeredResources).filter(([n,o])=>o.enabled).map(([n,o])=>({uri:n,name:o.name,...o.metadata})),t=[];for(let n of Object.values(this._registeredResourceTemplates)){if(!n.resourceTemplate.listCallback)continue;let o=await n.resourceTemplate.listCallback(r);for(let i of o.resources)t.push({...n.metadata,...i})}return{resources:[...a,...t]}}),this.server.setRequestHandler(oa,async()=>({resourceTemplates:Object.entries(this._registeredResourceTemplates).map(([r,a])=>({name:r,uriTemplate:a.resourceTemplate.uriTemplate.toString(),...a.metadata}))})),this.server.setRequestHandler(ia,async(e,r)=>{let a=new URL(e.params.uri),t=this._registeredResources[a.toString()];if(t){if(!t.enabled)throw new me(he.InvalidParams,`Resource ${a} disabled`);return t.readCallback(a,r)}for(let n of Object.values(this._registeredResourceTemplates)){let o=n.resourceTemplate.uriTemplate.match(a.toString());if(o)return n.readCallback(a,o,r)}throw new me(he.InvalidParams,`Resource ${a} not found`)}),this.setCompletionRequestHandler(),this._resourceHandlersInitialized=!0)}setPromptRequestHandlers(){this._promptHandlersInitialized||(this.server.assertCanSetRequestHandler(ca.shape.method.value),this.server.assertCanSetRequestHandler(la.shape.method.value),this.server.registerCapabilities({prompts:{listChanged:!0}}),this.server.setRequestHandler(ca,()=>({prompts:Object.entries(this._registeredPrompts).filter(([,e])=>e.enabled).map(([e,r])=>({name:e,title:r.title,description:r.description,arguments:r.argsSchema?ig(r.argsSchema):void 0}))})),this.server.setRequestHandler(la,async(e,r)=>{let a=this._registeredPrompts[e.params.name];if(!a)throw new me(he.InvalidParams,`Prompt ${e.params.name} not found`);if(!a.enabled)throw new me(he.InvalidParams,`Prompt ${e.params.name} disabled`);if(a.argsSchema){let t=await a.argsSchema.safeParseAsync(e.params.arguments);if(!t.success)throw new me(he.InvalidParams,`Invalid arguments for prompt ${e.params.name}: ${t.error.message}`);let n=t.data,o=a.callback;return await Promise.resolve(o(n,r))}else{let t=a.callback;return await Promise.resolve(t(r))}}),this.setCompletionRequestHandler(),this._promptHandlersInitialized=!0)}resource(e,r,...a){let t;typeof a[0]=="object"&&(t=a.shift());let n=a[0];if(typeof r=="string"){if(this._registeredResources[r])throw new Error(`Resource ${r} is already registered`);let o=this._createRegisteredResource(e,void 0,r,t,n);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),o}else{if(this._registeredResourceTemplates[e])throw new Error(`Resource template ${e} is already registered`);let o=this._createRegisteredResourceTemplate(e,void 0,r,t,n);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),o}}registerResource(e,r,a,t){if(typeof r=="string"){if(this._registeredResources[r])throw new Error(`Resource ${r} is already registered`);let n=this._createRegisteredResource(e,a.title,r,a,t);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),n}else{if(this._registeredResourceTemplates[e])throw new Error(`Resource template ${e} is already registered`);let n=this._createRegisteredResourceTemplate(e,a.title,r,a,t);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),n}}_createRegisteredResource(e,r,a,t,n){let o={name:e,title:r,metadata:t,readCallback:n,enabled:!0,disable:()=>o.update({enabled:!1}),enable:()=>o.update({enabled:!0}),remove:()=>o.update({uri:null}),update:i=>{typeof i.uri<"u"&&i.uri!==a&&(delete this._registeredResources[a],i.uri&&(this._registeredResources[i.uri]=o)),typeof i.name<"u"&&(o.name=i.name),typeof i.title<"u"&&(o.title=i.title),typeof i.metadata<"u"&&(o.metadata=i.metadata),typeof i.callback<"u"&&(o.readCallback=i.callback),typeof i.enabled<"u"&&(o.enabled=i.enabled),this.sendResourceListChanged()}};return this._registeredResources[a]=o,o}_createRegisteredResourceTemplate(e,r,a,t,n){let o={resourceTemplate:a,title:r,metadata:t,readCallback:n,enabled:!0,disable:()=>o.update({enabled:!1}),enable:()=>o.update({enabled:!0}),remove:()=>o.update({name:null}),update:i=>{typeof i.name<"u"&&i.name!==e&&(delete this._registeredResourceTemplates[e],i.name&&(this._registeredResourceTemplates[i.name]=o)),typeof i.title<"u"&&(o.title=i.title),typeof i.template<"u"&&(o.resourceTemplate=i.template),typeof i.metadata<"u"&&(o.metadata=i.metadata),typeof i.callback<"u"&&(o.readCallback=i.callback),typeof i.enabled<"u"&&(o.enabled=i.enabled),this.sendResourceListChanged()}};return this._registeredResourceTemplates[e]=o,o}_createRegisteredPrompt(e,r,a,t,n){let o={title:r,description:a,argsSchema:t===void 0?void 0:c.object(t),callback:n,enabled:!0,disable:()=>o.update({enabled:!1}),enable:()=>o.update({enabled:!0}),remove:()=>o.update({name:null}),update:i=>{typeof i.name<"u"&&i.name!==e&&(delete this._registeredPrompts[e],i.name&&(this._registeredPrompts[i.name]=o)),typeof i.title<"u"&&(o.title=i.title),typeof i.description<"u"&&(o.description=i.description),typeof i.argsSchema<"u"&&(o.argsSchema=c.object(i.argsSchema)),typeof i.callback<"u"&&(o.callback=i.callback),typeof i.enabled<"u"&&(o.enabled=i.enabled),this.sendPromptListChanged()}};return this._registeredPrompts[e]=o,o}_createRegisteredTool(e,r,a,t,n,o,i,l){let u={title:r,description:a,inputSchema:t===void 0?void 0:c.object(t),outputSchema:n===void 0?void 0:c.object(n),annotations:o,_meta:i,callback:l,enabled:!0,disable:()=>u.update({enabled:!1}),enable:()=>u.update({enabled:!0}),remove:()=>u.update({name:null}),update:p=>{typeof p.name<"u"&&p.name!==e&&(delete this._registeredTools[e],p.name&&(this._registeredTools[p.name]=u)),typeof p.title<"u"&&(u.title=p.title),typeof p.description<"u"&&(u.description=p.description),typeof p.paramsSchema<"u"&&(u.inputSchema=c.object(p.paramsSchema)),typeof p.callback<"u"&&(u.callback=p.callback),typeof p.annotations<"u"&&(u.annotations=p.annotations),typeof p._meta<"u"&&(u._meta=p._meta),typeof p.enabled<"u"&&(u.enabled=p.enabled),this.sendToolListChanged()}};return this._registeredTools[e]=u,this.setToolRequestHandlers(),this.sendToolListChanged(),u}tool(e,...r){if(this._registeredTools[e])throw new Error(`Tool ${e} is already registered`);let a,t,n,o;if(typeof r[0]=="string"&&(a=r.shift()),r.length>1){let l=r[0];Zu(l)?(t=r.shift(),r.length>1&&typeof r[0]=="object"&&r[0]!==null&&!Zu(r[0])&&(o=r.shift())):typeof l=="object"&&l!==null&&(o=r.shift())}let i=r[0];return this._createRegisteredTool(e,void 0,a,t,n,o,void 0,i)}registerTool(e,r,a){if(this._registeredTools[e])throw new Error(`Tool ${e} is already registered`);let{title:t,description:n,inputSchema:o,outputSchema:i,annotations:l,_meta:u}=r;return this._createRegisteredTool(e,t,n,o,i,l,u,a)}prompt(e,...r){if(this._registeredPrompts[e])throw new Error(`Prompt ${e} is already registered`);let a;typeof r[0]=="string"&&(a=r.shift());let t;r.length>1&&(t=r.shift());let n=r[0],o=this._createRegisteredPrompt(e,void 0,a,t,n);return this.setPromptRequestHandlers(),this.sendPromptListChanged(),o}registerPrompt(e,r,a){if(this._registeredPrompts[e])throw new Error(`Prompt ${e} is already registered`);let{title:t,description:n,argsSchema:o}=r,i=this._createRegisteredPrompt(e,t,n,o,a);return this.setPromptRequestHandlers(),this.sendPromptListChanged(),i}isConnected(){return this.server.transport!==void 0}async sendLoggingMessage(e,r){return this.server.sendLoggingMessage(e,r)}sendResourceListChanged(){this.isConnected()&&this.server.sendResourceListChanged()}sendToolListChanged(){this.isConnected()&&this.server.sendToolListChanged()}sendPromptListChanged(){this.isConnected()&&this.server.sendPromptListChanged()}};var ng={type:"object",properties:{}};function Zu(s){return typeof s!="object"||s===null?!1:Object.keys(s).length===0||Object.values(s).some(og)}function og(s){return s!==null&&typeof s=="object"&&"parse"in s&&typeof s.parse=="function"&&"safeParse"in s&&typeof s.safeParse=="function"}function ig(s){return Object.entries(s.shape).map(([e,r])=>({name:e,description:r.description,required:!r.isOptional()}))}function Gu(s){return{completion:{values:s.slice(0,100),total:s.length,hasMore:s.length>100}}}var qa={completion:{values:[],hasMore:!1}};var Va=z(require("fs/promises")),Ju=z(require("os")),Br=z(require("path")),cg="codex-mcp-lsp";async function Qu(s,e){let r=Br.join(Ju.tmpdir(),"mcp-lsp-"),a=await Va.mkdtemp(r),t=Br.join(a,"mcp-lsp.sock"),n=Br.join(e.fsPath,"bin","uds-proxy.js"),o=new xo(s,t,n);return await o.initUnixDomainSocketServer(t),o}var xo=class{constructor(e,r,a){this.version=e;this.socketPath=r;this.udsProxyPath=a}getCodexConfig(){return{[`mcp_servers.${cg}`]:{command:"node",args:[this.udsProxyPath,this.socketPath]}}}async initUnixDomainSocketServer(e){await new ha(e).listen(async a=>{let t=lg(this.version),n=a.onclose,o=a.onerror;a.onclose=()=>{n?.(),t.close().catch(()=>{})},a.onerror=i=>{o?.(i),process.stderr.write(`${i.stack??i.message}
`)};try{await t.connect(a)}catch(i){throw await a.close().catch(()=>{}),i}}),R.info(`MCP LSP server listening on ${e}`)}dispose(){let e=Br.dirname(this.socketPath);Va.rm(e,{recursive:!0,force:!0}).catch(r=>{R.error(`Failed to remove MCP LSP socket directory ${e}:`,r)})}};function lg(s){let e=new Ua({name:"vscode-codex-mcp-lsp-server",version:s});return qi(e),e}$t();we();var gs=z(require("vscode")),Ha=class{proxyAvailableSubscription=null;isModelProxyAvailable=!1;pendingProxy=null;proxy=null;constructor(){try{this.isModelProxyAvailable=gs.lm.isModelProxyAvailable,gs.lm.onDidChangeModelProxyAvailability(()=>{let e=gs.lm.isModelProxyAvailable;e||(this.pendingProxy=null,this.proxy&&(this.proxy.dispose(),this.proxy=null)),this.isModelProxyAvailable=e})}catch{}}isProxyAvailable(){return this.isModelProxyAvailable}getProxy(){if(!this.isModelProxyAvailable||!Oe().get(ct.USE_COPILOT_FOR_CODEX_LOGIN,!1))return null;if(this.pendingProxy)return this.pendingProxy;try{R.info("Requesting Language Model Proxy from VS Code API");let e=gs.lm.getModelProxy().then(r=>{if(R.info(`Language Model Proxy running on ${r.uri}`),e!==this.pendingProxy){if(r.dispose(),this.proxy)return this.proxy;throw new Error("Model proxy was disposed before it could be used.")}else return this.proxy=r,r},r=>{throw R.error(`Failed to get Language Model Proxy from VS Code API: ${r}`),this.pendingProxy=null,r});return this.pendingProxy=e,this.pendingProxy}catch{return null}}dispose(){this.proxyAvailableSubscription?.dispose(),this.proxy?.dispose()}};function ug(s){return s===""?"''":/[^\w@%\-+=:,./]/.test(s)?("'"+s.replace(/('+)/g,`'"$1"'`)+"'").replace(/^''|''$/g,""):s}function Ku(s){if(!Array.isArray(s))throw new TypeError("args should be an array");return s.map(ug).join(" ")}var Yu=z(require("vscode")),Xu="VSCODE_CODEX_API_KEY",ys="codex_vscode_copilot",pg="Copilot";async function ed(s,e,r){let a=[Ds(s)],t={};if(e)for(let[l,u]of Object.entries(e))u!==void 0&&a.push("--config",`${l}=${wo(u)}`);let n=null;try{n=await r.getProxy()}catch{}n!=null&&(t[Xu]=n.key,a.push("-c",`model_provider=${ys}`),a.push("-c",`model_providers.${ys}.name=${pg}`),a.push("-c",`model_providers.${ys}.base_url=${n.uri}`),a.push("-c",`model_providers.${ys}.env_key=${Xu}`),a.push("-c",`model_providers.${ys}.wire_api=responses`));let o={name:"Codex",env:t},i=Yu.window.createTerminal(o);i.show(),i.sendText(Ku(a))}function wo(s){if(s==null)return"null";if(typeof s=="object")return Array.isArray(s)?`[${s.map(r=>wo(r)).join(",")}]`:`{${Object.entries(s).map(([r,a])=>a===void 0?null:`${r}=${wo(a)}`).filter(r=>r!=null).join(",")}}`;if(typeof s=="string")return JSON.stringify(s);if(typeof s=="number"||typeof s=="boolean")return s.toString();throw new Error(`Unsupported JsonValue type: ${typeof s}`)}var _o=z(require("vscode")),Wa=class{shellIntegrationSubscription;pendingTerminals=new Map;constructor(){this.shellIntegrationSubscription=_o.window.onDidChangeTerminalShellIntegration(e=>{let{terminal:r}=e,a=this.pendingTerminals.get(r);a&&(a(r),this.pendingTerminals.delete(r))})}createTerminal(e){let r=_o.window.createTerminal(e);return new Promise(a=>{this.pendingTerminals.set(r,a)})}dispose(){this.shellIntegrationSubscription.dispose()}};function rd(s){let e=[],r=s.length,a=0;function t(i,l){let u=s[i],p=l;for(;p<r&&s[p]===u;)p++;let h=za(s,p),m=td(s,h,"TODO",!0),d=h;for(;d<r&&s[d]!==`
`&&s[d]!=="\r";)d++;if(m!==-1){let v=s.slice(m,d);e.push({body:v.trimEnd(),index:i})}return d}let n=null,o=!1;for(;a<r;){let i=s[a];if(n){o?o=!1:i==="\\"?o=!0:i===n&&(n=null),a++;continue}else if(i==='"'||i==="'"||i==="`"){n=i,a++;continue}if(i==="/"&&a+1<r){let l=s[a+1];if(l==="/"){a=t(a,a+2);continue}if(l==="*"){let u=a,p=a+2,h=s.indexOf("*/",p),m=h===-1?r:h+2,d=s.slice(p,h===-1?r:h);d=d.replace(/^(?:[ \t]*\*?[ \t]*(?:\r?\n|$))+/,"");let v=za(d,0);d[v]==="*"&&(v=za(d,v+1));let b=td(d,v,"TODO",!0);if(b!==-1){let g=d.slice(b);e.push({body:g.replace(/\s+$/,""),index:u})}a=m;continue}}else if(i==="#"){a=t(a,a+1);continue}else if(i==="-"&&a+1<r&&s[a+1]==="-"){a=t(a,a+2);continue}a++}return e}function fg(s){return s>=48&&s<=57||s>=65&&s<=90||s>=97&&s<=122||s===95}function za(s,e){let r=e;for(;r<s.length;){let a=s.charCodeAt(r);if(a!==32&&a!==9)break;r++}return r}function td(s,e,r,a=!0){let t=s.slice(e,e+r.length),n=a?r.toUpperCase():r;if((a?t.toUpperCase():t)!==n)return-1;let o=s.charCodeAt(e+r.length);if(fg(o))return-1;let i=e+r.length;return(s[i]===":"||s[i]==="-")&&i++,i=za(s,i),i}var Za=z(require("vscode")),Ba=class{provideCodeLenses(e,r){let a=e.getText(),t=[];for(let{index:n,body:o}of rd(a)){if(r?.isCancellationRequested)break;let i=e.positionAt(n),l=new Za.Range(i,i);t.push(new Za.CodeLens(l,{title:"Implement with Codex",command:"chatgpt.implementTodo",arguments:[{fileName:encodeURIComponent(e.uri.fsPath),line:i.line+1,comment:o}]}))}return t}};we();var Ga=class{constructor(e){this.codexWebviewProvider=e}async handleUri(e){R.info({event:"handleUri",path:e.path});try{await Dt();let r=e.path||"/";this.codexWebviewProvider.navigateToRoute(r)}catch(r){R.error(`Failed to handle URI ${e.toString()}: ${r instanceof Error?r.message:String(r)}`)}}};var Ja=class{userAgent=null;getUserAgent(){return this.userAgent}setUserAgent(e){this.userAgent=e}};var je=z(require("vscode")),Eg="chatgpt.newChat";async function Sg(s){let{subscriptions:e}=s;e.push(R),R.info("Activating Codex extension");let r=new Wa;e.push(r);let a=null;if(Oe().get(Ko,!1)){let S=s.extension.packageJSON.version,E=await Qu(S,s.extensionUri);a=E.getCodexConfig(),e.push(E)}let n=new Ja,o=new Ha;e.push(o);let i=new Ns(s.extensionUri,n);e.push(i),Rg(i,e);let l=Zo(i),u=new Ws(s),p=new zs;e.push(p);let h=new Hs(l,p,u,o),m=new $s(l,h,n),d=new Nt(s.extensionUri,i,m,p);e.push(d);let v=new Ga(d);if(e.push(je.window.registerUriHandler(v)),e.push(je.window.registerWebviewViewProvider(Nt.viewType,d,{webviewOptions:{retainContextWhenHidden:!0}})),e.push(je.window.registerCustomEditorProvider(Nt.customEditorViewType,d,{webviewOptions:{retainContextWhenHidden:!0},supportsMultipleEditorsPerDocument:!1})),e.push(je.commands.registerCommand("chatgpt.openSidebar",Dt)),e.push(je.commands.registerCommand("chatgpt.newCodexPanel",S=>{let E;if(typeof S=="string")E={path:S};else if(S&&typeof S=="object"&&"path"in S&&typeof S.path=="string"){let{path:C,viewColumn:I,preserveFocus:O}=S;E={path:C,viewColumn:I,preserveFocus:O}}else E=void 0;return d.createNewPanel(E)})),e.push(je.commands.registerCommand("chatgpt.addToThread",async()=>zo(d))),e.push(je.commands.registerCommand(Eg,async()=>{await Dt(),d.triggerNewChatViaWebview()})),e.push(je.commands.registerCommand("chatgpt.runCodexInTerminal",()=>ed(s.extensionUri,a,o))),Oe().get(ct.COMMENT_CODELENS_ENABLED,!0)){let S=new Ba,E=[{scheme:"file"},{scheme:"untitled"}];e.push(je.languages.registerCodeLensProvider(E,S))}Oe().get(ct.OPEN_ON_STARTUP,!1)&&Dt(),e.push(je.commands.registerCommand("chatgpt.dumpNuxState",()=>{u.dumpNuxState()}),je.commands.registerCommand("chatgpt.resetNuxState",()=>{u.resetNuxState()}));let x=i.startCodexProcess();!x.success&&x.errorMessage&&R.error(x.errorMessage),process.platform==="darwin"&&(async()=>{try{let S=await Promise.resolve().then(()=>(Zd(),Bd));typeof S.activate=="function"&&(S.activate(s),R.info("Work with apps desktop bridge initialized"))}catch(S){R.warn("Desktop bridge init failed: "+(S instanceof Error?S.message:String(S)))}})()}function Rg(s,e){try{let r=new Os(s);e.push(je.chat.registerChatSessionItemProvider(kr,r))}catch(r){R.info("Codex chat session item provider not registered: "+(r instanceof Error?r.message:String(r)))}}0&&(module.exports={activate});
/*! Bundled license information:

uri-js/dist/es5/uri.all.js:
  (** @license URI.js v4.4.1 (c) 2011 Gary Court. License: http://github.com/garycourt/uri-js *)
*/
